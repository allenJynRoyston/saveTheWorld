var __generator=this&&this.__generator||function(e,t){var a,i,n,r,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,i&&(n=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[0,n.value]),r[0]){case 0:case 1:n=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){o.label=r[1];break}if(6===r[0]&&o.label<n[1]){o.label=n[1],n=r;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(r);break}n[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],i=0}finally{a=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},PhaserGameObject=function(){function e(){this.game=null,this.global={pause:!1}}return e.prototype.init=function(e,t,a){var i=new Phaser.Game(a.width,a.height,Phaser.WEBGL,e,{preload:function(){var e=n.game();e.load.enableParallel=!0,e.stage.backgroundColor="#2f2f2f";var t="src/phaser/saveTheWorld/resources";e.load.atlas("atlas",t+"/spritesheets/heroSelect/heroSelectAtlas.png",t+"/spritesheets/heroSelect/heroSelectAtlas.json",Phaser.Loader.TEXTURE_ATLAS_JSON_HASH),e.load.atlas("atlas_main",t+"/spritesheets/main/main.png",t+"/spritesheets/main/main.json",Phaser.Loader.TEXTURE_atlas_main_JSON_HASH),e.load.atlas("atlas_weapons",t+"/spritesheets/weapons/weaponsAtlas.png",t+"/spritesheets/weapons/weaponsAtlas.json",Phaser.Loader.TEXTURE_atlas_main_JSON_HASH),e.load.atlas("atlas_ships",t+"/spritesheets/ships/ships.png",t+"/spritesheets/ships/ships.json",Phaser.Loader.TEXTURE_atlas_main_JSON_HASH),e.load.bitmapFont("gem",t+"/fonts/gem.png",t+"/fonts/gem.xml"),e.load.json("weaponData",t+"/json/weaponData.json"),e.load.json("pilotData",t+"/json/pilotData.json"),n.changeState("PRELOAD"),new PHASER_PRELOADER({game:e,delayInSeconds:0,done:function(){!function(){n.game();var e=s.getOnly(["pointer"]).pointer,t=n.getOnly(["currentSelection","pilotSelection"]),a=t.currentSelection,i=t.pilotSelection;e.updateLocation(a),S(i),A(),b("WIPEOUT",function(){g.overlayBGControls({transition:"FADEOUT",delay:0,speed:250},function(){n.changeState("MAINMENU")})})}()}})},create:function(){var e=n.game();r.assign(e),o.assign(e),s.assign(e),l.assign(e),p.assign(e),h.assign(e),u.assign(e,20),d.assign(e),m.assign(e,n,s,u,"atlas_weapons"),c.assign(e,n,s,p,u,r,m,"atlas_ships","atlas_weapons"),g.assign(e,s,d,u,"atlas_main");n.let("currentSelection",0);var t=n.let("pilotSelection",0),a=(n.let("loadoutSelection",0),n.let("primaryWeaponSelection",0),n.let("subWeaponSelection",0),n.let("perkSelection",0),n.let("weaponData",e.cache.getJSON("weaponData")),n.let("pilotData",e.cache.getJSON("pilotData"))),i=this.game.world.width-240,y=this.game.world.height/2,f=s.addFromAtlas({x:i,y:0,height:e.world.height,name:"verticleFrame",group:"ui_frame",filename:"ui_frame_v.png",atlas:"atlas"}),v=s.addFromAtlas({x:0,y:y,width:f.x,name:"dividerFrame1",group:"ui_frame",filename:"ui_frame_h.png",atlas:"atlas"}),b=d.addGradient({name:"overlayFadeout",start:"#ffffff",end:"#ffffff",width:1,height:1,render:!1}),x=s.add({x:0,y:0,name:"container_1",width:i,height:y,reference:b.cacheBitmapData,visible:!1}),w=s.add({x:0,y:325,name:"container_2",width:i,height:y,reference:b.cacheBitmapData,visible:!1}),A=s.add({x:i,y:0,name:"container_3",width:e.world.width-i,height:e.world.height,reference:b.cacheBitmapData,visible:!1}),_=s.addBasicMaskToSprite(x);g.buildOverlayBackground("#ffffff","#ffffff",19,!0),g.buildOverlayGrid(240,132,20,"logo_small.png");var T=s.addTilespriteFromAtlas({name:"bg_clouds",group:"ui_bg",x:x.x,y:x.y,width:x.width,height:x.height,atlas:"atlas",filename:"bg_clouds.png"});T.mask=_,T.onUpdate=function(){0===n.get("currentSelection")&&(this.tilePosition.x-=3)};var E=s.addTilespriteFromAtlas({name:"bg_cityscape",group:"ui_bg",x:w.x,y:w.y,width:w.width,height:w.height,atlas:"atlas",filename:"bg_cityscape.png"});E.onUpdate=function(){1===n.get("currentSelection")&&(this.tilePosition.x-=.25)};var I=s.addTilespriteFromAtlas({name:"bg_cityscape_1",group:"ui_bg",x:w.x,y:w.y+50,width:w.width,height:w.height,atlas:"atlas",filename:"bg_cityscape_1.png"});I.onUpdate=function(){1===n.get("currentSelection")&&(this.tilePosition.x-=.5)};var D=s.addTilespriteFromAtlas({name:"bg_cityscape_2",group:"ui_bg",x:w.x,y:w.y+115,width:w.width,height:w.height,atlas:"atlas",filename:"bg_cityscape_2.png"});D.onUpdate=function(){1===n.get("currentSelection")&&(this.tilePosition.x-=1)};var P=s.addTilespriteFromAtlas({name:"bg_cityscape_3",group:"ui_bg",x:w.x,y:w.y+200,width:w.width,height:w.height,atlas:"atlas",filename:"bg_cityscape_3.png"});P.onUpdate=function(){1===n.get("currentSelection")&&(this.tilePosition.x-=2)};var L=s.addTilespriteFromAtlas({name:"bg_space",group:"ui_bg",x:A.x,y:A.y,width:A.width,height:A.height,atlas:"atlas",filename:"bg_space.png"});L.onUpdate=function(){2===n.get("currentSelection")?this.tilePosition.y+=2:this.tilePosition.y+=.1};var C=s.addFromAtlas({name:"pointer",group:"ui",atlas:"atlas",filename:"ui_pointer.png"});C.anchor.setTo(.5,.5),C.hide=function(){this.visible=!1},C.show=function(){this.visible=!0},C.updateLocation=function(e){n.forceLet("currentSelection",e);var t=s.get("textbox"+e),a=t.x,i=t.y;this.x=a-90,this.y=i};var O=s.addFromAtlas({name:"downarrow",group:"ui",atlas:"atlas",filename:"ui_downarrow.png",visible:!1});O.anchor.setTo(.5,.5),O.hide=function(){this.visible=!1},O.show=function(){this.visible=!0},O.updateLocation=function(e,t){this.x=e,this.y=t};var M=s.addFromAtlas({name:"textbox0",group:"ui_textholders",atlas:"atlas",filename:"ui_textbox.png",alpha:1});M.anchor.setTo(.5,.5),s.centerOnPoint("textbox0",x.width/2+M.width/2,x.y+40);var k=p.add({name:"text0",group:"ui_text",x:M.x,y:M.y,font:"gem",size:12,default:"SELECT PILOT"});k.anchor.setTo(.5,.5);var R=s.addFromAtlas({name:"textbox1",group:"ui_textholders",atlas:"atlas",filename:"ui_textbox.png",alpha:1});R.anchor.setTo(.5,.5),s.centerOnPoint("textbox1",w.width/2+R.width/2,w.y+50);var B=p.add({name:"text1",group:"ui_text",x:R.x,y:R.y,font:"gem",size:12,default:"LOADOUT"});B.anchor.setTo(.5,.5);var W=s.addFromAtlas({name:"textbox2",group:"ui_textholders",atlas:"atlas",filename:"ui_textbox.png",alpha:1});W.anchor.setTo(.5,.5),s.centerOnPoint("textbox2",A.x+A.width/2+W.width/2,A.y+40);var F=p.add({name:"text2",group:"ui_text",x:W.x,y:W.y,font:"gem",size:12,default:"START"});F.anchor.setTo(.5,.5);var N=s.addFromAtlas({name:"pilotDescriptionBox",group:"ui_textholders",atlas:"atlas",filename:"ui_descriptionbox.png",alpha:1});N.anchor.setTo(.5,.5),s.centerOnPoint("pilotDescriptionBox",x.width/2+N.width/2,x.y+295);var G=p.add({name:"pilotDescriptionText",group:"ui_text",x:N.x-N.width/2+20,y:N.y-N.height/2,font:"gem",size:14,default:""});G.maxWidth=N.width-40,G.updateThisText=function(e){this.setText("\nNAME:               "+U[e].name+"\n\nFIRING RATE:        "+U[e].firerate+"\nSUBWEAPON RECHARGE: "+U[e].subweaponRecharge+"\nHEALTH:             "+U[e].health+"\nMOVEMENT:           "+U[e].movement+"\n              ")},u.addMany(17,[M,R,W,N]),u.addMany(18,[k,B,F,G]);for(var U=a.pilots,j=0;j<U.length;j++){var H=s.addFromAtlas({name:"profile"+j,group:"ui_profiles",y:x.y+110,atlas:"atlas",filename:""+U[j].image,alpha:0});H.anchor.setTo(.5,.5);var K=H.width/2*(U.length-1);H.x=x.x+j*H.width+x.width/2-K,H.alpha=1,u.add(18,H)}var Y=s.addFromAtlas({name:"profileSelector",group:"ui_profiles",atlas:"atlas",filename:"ui_pictureframe.png",alpha:0});Y.anchor.setTo(.5,.5),Y.updateLocation=function(e){n.forceLet("pilotSelection",e),s.getGroup("ui_profiles").map(function(e){e.alpha=.85});var t=s.get("profile"+e);t.alpha=1;var a=t.x,i=t.y;this.x=a,this.y=i,O.updateLocation(a,i-t.height/2-8)},Y.inc=function(){(t+=1)>U.length-1&&(t=0),S(t)},Y.dec=function(){(t-=1)<0&&(t=U.length-1),S(t)},u.add(18,Y),u.addMany(1,[L]),u.addMany(6,[T,E,I,D,P]),u.addMany(10,[f,v]),u.addMany(14,[C,O])},update:function(){n.game();var e=n.getAll(),a=e.currentSelection,i=(e.pilotSelection,e.loadoutSelection),o=e.primaryWeaponList,l=e.primaryWeaponSelection,h=(e.secondaryWeaponList,e.subWeaponSelection,s.getAll()),u=h.profileSelector,d=h.loadoutCatagorySelector,c=h.pointer,m=h.downarrow,f=h.loadoutDescription,x=r.getOnly(["DOWN","UP","LEFT","RIGHT","A","START"]),A=(x.DOWN,x.UP,x.LEFT,x.RIGHT,p.getAll("OBJECT").loadoutDescriptionText);s.getManyGroups(["ui_bg","playership","ship_wpn_preview"]).map(function(e){e.onUpdate()}),r.checkWithDelay({isActive:!0,key:"BACK",delay:250})&&2===a&&c.updateLocation(0);r.checkWithDelay({isActive:!0,key:"START",delay:250})&&(2!==a&&(n.forceLet("loadoutSelection",0),c.show(),m.hide(),f.hide(),A.hide(),d.hide(),n.changeState("MAINMENU"),c.updateLocation(2)),2===a&&(c.hide(),n.forceLet("currentSelection",null),g.overlayBGControls({transition:"FADEIN",delay:0,speed:250},function(){b("WIPEIN",function(){setTimeout(function(){!function(){n.game();var e=n.getAll(),a=e.primaryWeaponList,i=e.primaryWeaponSelection,r=(e.loadoutSelection,e.secondaryWeaponList),o=e.subWeaponSelection,s=e.perkList,l=e.perkSelection;v("pilot",e.pilotSelection),v("primaryWeapon",a[i].reference),v("secondaryWeapon",r[o].reference),v("perk",s[l].reference),p=n.get("gameData"),y.commit("setGamedata",p),t.startGame();var p}()},1e3)})})));n.checkState("MAINMENU")&&(r.checkWithDelay({isActive:!0,key:"UP",delay:250})&&2!==a&&c.updateLocation(0),r.checkWithDelay({isActive:!0,key:"DOWN",delay:250})&&(1===a&&(c.hide(),m.show(),f.show(),A.show(),d.show(),d.updateLocation(i),T(i),n.changeState("LOADOUTSELECT")),2!==a&&c.updateLocation(1)),r.checkWithDelay({isActive:!0,key:"RIGHT",delay:250})&&0===a&&u.inc(),r.checkWithDelay({isActive:!0,key:"LEFT",delay:250})&&0===a&&u.dec(),r.checkWithDelay({isActive:!0,key:"A",delay:250})&&2===a&&(c.hide(),n.forceLet("currentSelection",null),b("FADEIN")));n.checkState("PILOTSELECT")&&(r.checkWithDelay({isActive:!0,key:"LEFT",delay:250})&&u.dec(),r.checkWithDelay({isActive:!0,key:"RIGHT",delay:250})&&u.inc(),r.checkWithDelay({isActive:!0,key:"A",delay:250})&&(m.hide(),c.show(),n.changeState("MAINMENU")));n.checkState("LOADOUTSELECT")&&(0===i&&r.checkWithDelay({isActive:!1,key:"R3",delay:o[l].cooldown})&&w("PRIMARY"),1===i&&r.checkWithDelay({isActive:!1,key:"R3",delay:2e3})&&w("SECONDARY"),r.checkWithDelay({isActive:!0,key:"DOWN",delay:250})&&_(1),r.checkWithDelay({isActive:!0,key:"UP",delay:250})&&(0===i?(n.forceLet("loadoutSelection",0),c.show(),m.hide(),f.hide(),A.hide(),d.hide(),n.changeState("MAINMENU")):_(-1)),r.checkWithDelay({isActive:!0,key:"RIGHT",delay:250})&&T(1),r.checkWithDelay({isActive:!0,key:"LEFT",delay:250})&&T(-1),r.checkWithDelay({isActive:!0,key:"BACK",delay:250})&&(n.forceLet("loadoutSelection",0),c.show(),m.hide(),f.hide(),A.hide(),d.hide(),n.changeState("MAINMENU")))}});i.preserveDrawingBuffer=!0;var n=new PHASER_MASTER({game:i,resolution:{width:a.width,height:a.height}}),r=new PHASER_CONTROLS,o=new PHASER_MOUSE({showDebugger:!1}),s=new PHASER_SPRITE_MANAGER,l=new PHASER_BITMAPDATA_MANAGER,p=new PHASER_TEXT_MANAGER,h=new PHASER_BUTTON_MANAGER,u=new PHASER_GROUP_MANAGER,d=new PHASER_BITMAPDATA_MANAGER,c=new PLAYER_MANAGER,m=new WEAPON_MANAGER,g=new UTILITY_MANAGER,y=a.store,f=JSON.stringify(y.getters._gameData());function v(e,t){n.get("gameData")[e]=t}function b(e,t){void 0===t&&(t=function(){}),g.overlayControls({transition:e,delay:1,speed:250,tileDelay:10},t)}function x(e){m.createBomblet(e,function(t){var a,i,n,r;a=t.x,i=t.y,n=.5,r=e.layer+1,m.createExplosion(a,i,n,r)})}function w(e){n.game();var t=n.getAll(),a=t.primaryWeaponList,i=t.primaryWeaponSelection,r=(t.loadoutSelection,t.secondaryWeaponList),o=t.subWeaponSelection;t.perkSelection,s.getAll("OBJECT").ship;if("PRIMARY"===e)switch(a[i].reference){case"BULLET":!function(){var e=n.game(),t=s.getOnly(["ship"]).ship,a=10,i=2,r=5;t.fireWeapon();for(var o=function(i){setTimeout(function(){m.createBullet({name:"bullet_"+e.rnd.integer(),group:"ship_wpn_preview",x:t.x+i*a-r,y:t.y,spread:0,layer:7})},25)},l=0;l<i;l++)o(l)}();break;case"LASER":!function(){var e=n.game(),t=s.getOnly(["ship"]).ship,a=30,i=1,r=0;t.fireWeapon();for(var o=0;o<i;o++)m.createLaser({name:"laser_"+e.rnd.integer(),group:"ship_wpn_preview",x:t.x+o*a-r,y:t.y-t.height/2,spread:0,layer:7})}();break;case"MISSLE":!function(){var e=n.game(),t=s.getOnly(["ship"]).ship,a=30,i=2,r=15;t.fireWeapon();for(var o=0;o<i;o++)m.createMissle({name:"missle_"+e.rnd.integer(),group:"ship_wpn_preview",x:t.x+o*a-r,y:t.y-t.height/2,spread:o%2==0?-.5:.5,layer:7})}()}if("SECONDARY"===e)switch(s.getGroup("ship_wpn_preview").map(function(e){e.destroyIt()}),r[o].reference){case"CLUSTERBOMB":!function(){var e=n.game(),t=s.getOnly(["ship"]).ship;t.fireSubweapon(),m.createClusterbomb({name:"clusterbomb_"+e.rnd.integer(),group:"ship_wpn_preview",x:t.x-22,y:t.y,layer:2},function(t){for(var a=0;a<t.bomblets;a++)x({x:t.x,y:t.y,ix:e.rnd.integerInRange(-400,400),iy:e.rnd.integerInRange(-400,100),damage:t.damageAmount/4,group:"ship_wpn_preview",layer:2})})}();break;case"TRIPLEBOMB":!function(){for(var e=n.game(),t=s.getOnly(["ship"]).ship,a=0;a<3;a++)setTimeout(function(){t.fireSubweapon(),m.createTriplebomb({name:"triplebomb_"+e.rnd.integer(),group:"ship_wpn_preview",x:t.x+20,y:t.y,layer:2})},300*a)}();break;case"TURRET":!function(){var e=n.game(),t=s.getOnly(["ship"]).ship,a=function(t){var a=10,i=3,n=10;t.fireInterval=setInterval(function(){for(var r=0;r<i;r++)m.createBullet({name:"bullet_"+e.rnd.integer(),group:"ship_wpn_preview",x:t.x+r*a-n,y:t.y,spread:0,layer:2})},200),t.fireInterval},i=function(e){e.x=t.x-e.offset,e.y=t.y},r=function(e){};m.createTurret({name:"turret_"+e.rnd.integer(),group:"ship_wpn_preview",x:t.x,y:t.y,offset:50,layer:3},a,r,i),m.createTurret({name:"turret_"+e.rnd.integer(),group:"ship_wpn_preview",x:t.x,y:t.y,offset:-50,layer:3},a,r,i)}()}}function A(){var e=n.getAll(),t=e.primaryWeaponSelection,a=e.subWeaponSelection,i=e.perkSelection;s.getGroup("ui_box_selected").map(function(e){e.alpha=0}),s.get("sbox_pw_"+t).alpha=1,s.get("sbox_sw_"+a).alpha=1,s.get("sbox_sp_"+i).alpha=1}function S(e){var t=s.getOnly(["profileSelector","loadoutCatagorySelector","container_3"]),a=t.profileSelector,i=(t.loadoutCatagorySelector,t.container_3),r=p.getOnly(["pilotDescriptionText"]).pilotDescriptionText;n.forceLet("primaryWeaponSelection",0),n.forceLet("subWeaponSelection",0),n.forceLet("perkSelection",0),void 0!==s.get("ship")&&c.destroyShip("ship"),function(e){var t=n.getOnly(["weaponData","pilotData"]),a=t.weaponData,i=t.pilotData,r=s.getOnly(["container_2","downarrow"]),o=r.container_2,l=r.downarrow;s.getManyGroups(["ui_loadout","ui_box_selected"]).map(function(e){s.destroy(e.name)}),p.getManyGroups(["ui_loadout"]).map(function(e){p.destroy(e.name)});for(var h=[],d=[],c=[],m=0,g=Object.keys(a.primaryWeapons);m<g.length;m++){var y=g[m];h.push(a.primaryWeapons[y])}for(var f=0,v=Object.keys(a.secondaryWeapons);f<v.length;f++)y=v[f],d.push(a.secondaryWeapons[y]);for(var b=0,x=Object.keys(a.perks);b<x.length;b++)y=x[b],c.push(a.perks[y]);var w=h.filter(function(t){for(var a=0;a<i.pilots[e].weapons.length;a++)if(t.reference===i.pilots[e].weapons[a])return t}),A=d.filter(function(t){for(var a=0;a<i.pilots[e].subweapons.length;a++)if(t.reference===i.pilots[e].subweapons[a])return t}),S=c.filter(function(t){for(var a=0;a<i.pilots[e].perks.length;a++)if(t.reference===i.pilots[e].perks[a])return t});n.forceLet("primaryWeaponList",w),n.forceLet("secondaryWeaponList",A),n.forceLet("perkList",S),w.map(function(e,t){var a=s.addFromAtlas({name:"box_pw_"+t,group:"ui_loadout",y:o.y+90,atlas:"atlas",filename:"ui_box_unselected.png",alpha:0});a.anchor.setTo(.5,.5);var i=(a.width+5)/2*(w.length-1);a.x=o.x+t*a.width+o.width/2-i+5*t,a.alpha=1;var n=s.addFromAtlas({name:"sbox_pw_"+t,group:"ui_box_selected",y:o.y+90,atlas:"atlas",filename:"ui_box_selected.png",alpha:0});n.anchor.setTo(.5,.5),n.x=o.x+t*n.width+o.width/2-i+5*t,n.alpha=0;var r=s.addFromAtlas({name:"icon_pw_"+t,group:"ui_loadout",y:o.y+90,atlas:"atlas_weapons",filename:""+e.spriteIcon,alpha:1});r.anchor.setTo(.5,.5),r.x=o.x+t*n.width+o.width/2-i+5*t,u.addMany(13,[a,n,r])}),A.map(function(e,t){var a=s.addFromAtlas({name:"box_sw_"+t,group:"ui_loadout",y:o.y+140,atlas:"atlas",filename:"ui_box_unselected.png",alpha:0});a.anchor.setTo(.5,.5);var i=(a.width+5)/2*(A.length-1);a.x=o.x+t*a.width+o.width/2-i+5*t,a.alpha=1;var n=s.addFromAtlas({name:"sbox_sw_"+t,group:"ui_box_selected",y:o.y+140,atlas:"atlas",filename:"ui_box_selected.png",alpha:0});n.anchor.setTo(.5,.5),n.x=o.x+t*n.width+o.width/2-i+5*t,n.alpha=0;var r=s.addFromAtlas({name:"icon_sw_"+t,group:"ui_loadout",y:o.y+140,atlas:"atlas_weapons",filename:""+e.spriteIcon,alpha:1});r.anchor.setTo(.5,.5),r.x=o.x+t*n.width+o.width/2-i+5*t,u.addMany(13,[a,n,r])}),S.map(function(e,t){var a=s.addFromAtlas({name:"box_sp_"+t,group:"ui_loadout",y:o.y+190,atlas:"atlas",filename:"ui_box_unselected.png",alpha:0});a.anchor.setTo(.5,.5);var i=(a.width+5)/2*(S.length-1);a.x=o.x+t*a.width+o.width/2-i+5*t,a.alpha=1;var n=s.addFromAtlas({name:"sbox_sp_"+t,group:"ui_box_selected",y:o.y+190,atlas:"atlas",filename:"ui_box_selected.png",alpha:0});n.anchor.setTo(.5,.5),n.x=o.x+t*n.width+o.width/2-i+5*t,n.alpha=0;var r=s.addFromAtlas({name:"icon_sp_"+t,group:"ui_loadout",y:o.y+190,atlas:"atlas_weapons",filename:""+e.spriteIcon,alpha:1});r.anchor.setTo(.5,.5),r.x=o.x+t*n.width+o.width/2-i+5*t,u.addMany(13,[a,n,r])});var _=s.addFromAtlas({name:"loadoutCatagorySelector",group:"ui_loadout",atlas:"atlas",filename:"ui_pointer.png",visible:!1,alpha:0});_.anchor.setTo(.5,.5),_.show=function(){this.visible=!0},_.hide=function(){this.visible=!1},_.updateLocation=function(e){var t,a=n.getAll(),i=a.primaryWeaponSelection,r=a.subWeaponSelection,o=a.perkSelection;if(0===e){var p=(t=s.get("box_pw_"+i)).x,h=t.y;l.updateLocation(p,h-30)}if(1===e){var u=(t=s.get("box_sw_"+r)).x,d=t.y;l.updateLocation(u,d-30)}if(2===e){var c=(t=s.get("box_sp_"+o)).x,m=t.y;l.updateLocation(c,m-30)}t.x;var g=t.y;this.x=40,this.y=g,this.visible};var T=s.addFromAtlas({name:"loadoutDescription",group:"ui_loadout",atlas:"atlas",filename:"ui_descriptionbox_small.png",visible:!1});T.anchor.setTo(.5,.5),s.centerOnPoint("loadoutDescription",o.width/2+T.width/2,o.y+310);var E=p.add({name:"loadoutDescriptionText",group:"ui_loadout",x:T.x,y:T.y,font:"gem",size:14,default:""});E.anchor.setTo(.5,.5),E.maxWidth=T.width-40,u.add(17,T),u.add(18,E)}(e),a.updateLocation(e),r.updateThisText(e),A();var o=n.getOnly(["primaryWeaponSelection","primaryWeaponList","secondaryWeaponList","subWeaponSelection","perkSelection","perkList"]),l=o.primaryWeaponSelection,h=o.primaryWeaponList,d=o.secondaryWeaponList,m=o.subWeaponSelection,g=o.perkSelection,y=o.perkList,f=c.createShip({name:"ship",group:"playership",shipId:e,layer:5});f.attachPerk(y[g].reference),f.attachWeapon(h[l].reference),f.attachSubweapon(d[m].reference),f.visible=!0,s.centerOnPoint("ship",i.x+i.width/2+f.width/2,i.height-100)}function _(e){var t=n.getAll().loadoutSelection,a=s.getAll("OBJECT"),i=(a.downarrow,a.loadoutCatagorySelector);t+=e,e>0&&t>2&&(t=2),e<0&&t<0&&(t=0),n.forceLet("loadoutSelection",t),T(null),i.updateLocation(t)}function T(e){var t,a=n.getOnly(["weaponData","loadoutSelection","primaryWeaponSelection","subWeaponSelection","perkSelection","primaryWeaponList","secondaryWeaponList","perkList"]),i=(a.weaponData,a.loadoutSelection),r=a.primaryWeaponSelection,o=a.subWeaponSelection,l=a.perkSelection,h=a.primaryWeaponList,u=a.secondaryWeaponList,d=a.perkList,c=s.getOnly(["downarrow","loadoutCatagorySelector","ship"]),m=c.downarrow,g=c.loadoutCatagorySelector,y=c.ship,f=p.getOnly(["loadoutDescriptionText"]).loadoutDescriptionText;switch(i){case 0:r+=e,e>0&&(r>=h.length&&(r=0),n.forceLet("primaryWeaponSelection",r)),e<0&&(r<0&&(r=h.length-1),n.forceLet("primaryWeaponSelection",r)),f.setText(h[r].name+": "+h[r].description);break;case 1:o+=e,e>0&&(o>=u.length&&(o=0),n.forceLet("subWeaponSelection",o)),e<0&&(o<0&&(o=u.length-1),n.forceLet("subWeaponSelection",o)),f.setText(u[o].name+": "+u[o].description);break;case 2:l+=e,e>0&&(l>=d.length&&(l=0),n.forceLet("perkSelection",l)),e<0&&(l<0&&(l=d.length-1),n.forceLet("perkSelection",l)),f.setText(d[l].name+": "+d[l].description)}if(y.attachPerk(d[l].reference),y.attachWeapon(h[r].reference),y.attachSubweapon(u[o].reference),0===i){var v=(t=s.get("box_pw_"+r)).x,b=t.y;m.updateLocation(v,b-30)}if(1===i){v=(t=s.get("box_sw_"+o)).x,b=t.y;m.updateLocation(v,b-30)}if(2===i){v=(t=s.get("box_sp_"+l)).x,b=t.y;m.updateLocation(v,b-30)}A(),g.updateLocation(i)}n.let("gameData",JSON.parse(f)),t.game=this,this.game=n.game()},e.prototype.destroy=function(){this.game.destroy()},e}(),__phaser=new PhaserGameObject,PHASER_AUDIO=function(){return function(){}}(),PHASER_BITMAPDATA_MANAGER=function(){function e(){this.game=null,this.bmd={array:[],object:{}}}return e.prototype.assign=function(e){this.game=e},e.prototype.addGradient=function(e){if(0===this.bmd.array.filter(function(t){return t.name===e.name}).length){var t=this.game.make.bitmapData(e.width,e.height),a=t.context.createLinearGradient(0,0,0,e.height);a.addColorStop(0,e.start),a.addColorStop(1,e.end),t.context.fillStyle=a,t.context.fillRect(0,0,e.width,e.height);var i=this.game.cache.addBitmapData(e.name,t),n=this.game.make.bitmapData();return n.load(this.game.cache.getBitmapData(e.name)),e.render&&n.addToWorld(e.x,e.y),n.name=e.name,n.group=e.group,n.cacheBitmapData=i,this.bmd.array.push(n),this.bmd.object[e.name]=n,n}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.addImage=function(e){if(0===this.bmd.array.filter(function(t){return t.name===e.name}).length){var t=this.game.make.bitmapData();return t.load(e.reference),t.addToWorld(e.x,e.y),e.render||t.cls(),t.name=e.name,t.group=e.group,t.cacheBitmapData=e.reference,this.bmd.array.push(t),this.bmd.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.addEmpty=function(e){if(0===this.bmd.array.filter(function(t){return t.name===e.name}).length){var t=this.game.make.bitmapData(e.width,e.height);return t.addToWorld(e.x,e.y),e.render||t.cls(),t.name=e.name,t.group=e.group,this.bmd.array.push(t),this.bmd.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.destroy=function(e){for(var t=[],a=0,i=this.bmd.array.filter(function(t){return t.name===e});a<i.length;a++){var n=i[a];t.push(n.name),n.destroy()}return delete this.bmd.object[e],this.bmd.array=this.bmd.array.filter(function(t){return t.name!==e}),t},e.prototype.destroyGroup=function(e){for(var t=[],a=0,i=this.bmd.array.filter(function(e){return e.group===name});a<i.length;a++){var n=i[a];t.push(n.name),n.destroy()}return delete this.bmd.object[name],this.bmd.array=this.bmd.array.filter(function(e){return e.group!==name}),t},e.prototype.get=function(e){return this.bmd.object[e]},e.prototype.getGroup=function(e){return this.bmd.array.filter(function(t){return t.group===e})},e.prototype.getAll=function(e){return void 0===e&&(e="BOTH"),"ARRAY"===e?this.bmd.array:"OBJECT"==e?this.bmd.object:{object:this.bmd.object,array:this.bmd.array}},e.prototype.takeSnapshot=function(){return this.game.canvas.toDataURL()},e}(),PHASER_BUTTON_MANAGER=function(){function e(){this.game=null,this.resources={array:[],object:{}}}return e.prototype.assign=function(e){this.game=e.game},e.prototype.add=function(e){if(0===this.resources.array.filter(function(t){return t.name===e.name}).length){var t=this.game.add.button(e.x,e.y,e.reference,e.onclick);return t.name=e.name,t.group=e.group||null,this.resources.array.push(t),this.resources.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.destroy=function(e){for(var t=[],a=0,i=this.resources.array.filter(function(t){return t.key===e});a<i.length;a++){var n=i[a];t.push(n.key),n.destroy()}return delete this.resources.object[e],this.resources.array=this.resources.array.filter(function(t){return t.key!==e}),t},e.prototype.destroyGroup=function(e){for(var t=[],a=0,i=this.resources.array.filter(function(t){return t.group===e});a<i.length;a++){var n=i[a];t.push(n.key),n.destroy()}return delete this.resources.object[e],this.resources.array=this.resources.array.filter(function(t){return t.group!==e}),t},e.prototype.get=function(e){return this.resources.object[e]},e.prototype.getGroup=function(e){return this.resources.array.filter(function(t){return t.group===e})},e.prototype.getAll=function(e){return void 0===e&&(e="BOTH"),"ARRAY"===e?this.resources.array:"OBJECT"==e?this.resources.object:{object:this.resources.object,array:this.resources.array}},e}(),PHASER_CONTROLS=function(){function e(){this.IO=null,this.game=null,this.buttonSensitivity={QUICK:1,SHORT:50,LONG:150,SUPERLONG:300},this.releasedKeys=[],this.properties={isReady:!1,allowDebugger:!0,buttonDelay:50,timingRefreshRate:1},this.directionalButtons=["UP","DOWN","LEFT","RIGHT"],this.actionButtons=["A","B","X","Y"],this.triggerButtons=["L1","L2","R1","R2","L3","R3"],this.systemButtons=["START","BACK"],this.buttonArray=this.directionalButtons.concat(this.actionButtons,this.triggerButtons,this.systemButtons),this.buttonMap={UP:{name:"UP",code:"ArrowUp"},DOWN:{name:"DOWN",code:"ArrowDown"},LEFT:{name:"LEFT",code:"ArrowLeft"},RIGHT:{name:"RIGHT",code:"ArrowRight"},A:{name:"A",code:"KeyA"},B:{name:"S",code:"KeyS"},X:{name:"D",code:"KeyD"},Y:{name:"F",code:"KeyF"},L1:{name:"Q",code:"KeyQ"},L2:{name:"W",code:"KeyW"},R1:{name:"E",code:"KeyE"},R2:{name:"R",code:"KeyR"},L3:{name:"O",code:"KeyO"},R3:{name:"P",code:"KeyP"},START:{name:"ENTER",code:"Enter"},BACK:{name:"BACKSPACE",code:"Backspace"}},this.buttonMapId={UP:1,DOWN:2,LEFT:3,RIGHT:4,A:5,B:6,X:7,Y:8,L1:9,L2:10,R1:11,R2:12,L3:13,R3:14,START:15,BACK:16},this.disabledButtons={ALL:!1,DIRECTIONAL:!1,TRIGGER:!1,ACTION:!1,SYSTEM:!1},this.debugger={enabled:!1,text:{}},this.inputDelay={delay:Array.apply(null,Array(20)).map(function(){return 0})}}return e.prototype.assign=function(e){var t=this;this.game=e;var a={font:"12px Courier New",fill:"#fff",align:"left"};this.buttonArray.forEach(function(i,n){t.debugger.text[i]=null,t.debugger.text[i]=e.add.text(10,10+15*n,"",a),t.disabledButtons[i]=!1});for(var i={buttons:{},sensitivityPress:{},sensitivityBuffer:{},state:{}},n=function(a){i.buttons[a]=e.input.keyboard.addKey(Phaser.Keyboard[r.buttonMap[a].name]),i.sensitivityPress[a]=null,i.sensitivityBuffer[a]=0,i.state[a]=function(){return t.getBtnPressType(t.IO.sensitivityBuffer[a])}},r=this,o=0,s=this.buttonArray;o<s.length;o++){n(s[o])}for(var l=function(e){i.buttons[e].onDown.add(function(a){var n,r;clearInterval(i.sensitivityPress[e]);var o=["DIRECTIONAL","ACTION","TRIGGER","SYSTEM"];Object.keys(t.buttonMap).forEach(function(e,i){if(t.buttonMap[e].code===a.event.code)for(var s=0,l=o;s<l.length;s++){var p=l[s];t[p.toLowerCase()+"Buttons"].indexOf(e)+1&&(n=p,r=e)}});var s=!1;t.disabledButtons.ALL&&(s=!0);for(var l=0,p=o;l<p.length;l++){var h=p[l];t.disabledButtons[h]&&n===h&&(s=!0)}Object.keys(t.buttonMap).forEach(function(e,a){t.disabledButtons[e]&&r===e&&(s=!0)}),s||(i.sensitivityPress[e]=setInterval(function(){i.sensitivityBuffer[e]+=1},t.properties.timingRefreshRate))},p)},p=this,h=0,u=this.buttonArray;h<u.length;h++){l(u[h])}return e.input.keyboard.onUpCallback=function(e){for(var a=0,n=t.buttonArray;a<n.length;a++){var r=n[a];e.code===t.buttonMap[r].code&&(t.releasedKeys.push(t.buttonMap[r].code),setTimeout(function(){t.releasedKeys.shift()},1500),clearInterval(i.sensitivityPress[r]),i.sensitivityBuffer[r]=0)}"Backquote"===e.code&&t.properties.allowDebugger&&(t.setDebugger(!t.debugger.enabled),t.updateDebugger())},this.properties.isReady=!0,this.IO=i,i},e.prototype.mapKeys=function(e){var t=this;this.properties.isReady=!1,this.destroyAll(),setTimeout(function(){t.buttonMap=e,t.properties.isReady=!0,t.assign(t.game)},1)},e.prototype.isReady=function(){return this.properties.isReady},e.prototype.checkWithDelay=function(e){return this.read(e.key).active===e.isActive&&(this.game.time.now>this.inputDelay.delay[this.getKeyId(e.key)]&&(this.inputDelay.delay[this.getKeyId(e.key)]=e.delay+this.game.time.now,!0))},e.prototype.isDebuggerEnabled=function(){return this.debugger.enabled},e.prototype.setDebugger=function(e){void 0===e&&(e=!0),this.debugger.enabled=e},e.prototype.updateDebugger=function(){if(this.properties.isReady)for(var e=0,t=this.buttonArray;e<t.length;e++){var a=t[e];this.debugger.text[a].setText(this.debugger.enabled?this.debuggerString(a):"").bringToTop()}},e.prototype.disableAllInput=function(){this.disabledButtons.ALL=!0},e.prototype.enableAllInput=function(){this.disabledButtons.ALL=!1},e.prototype.disableAllDirectionalButtons=function(){this.disabledButtons.DIRECTIONAL=!0},e.prototype.enableAllDirectionalButtons=function(){this.disabledButtons.DIRECTIONAL=!1},e.prototype.disableAllTriggerButtons=function(){this.disabledButtons.TRIGGER=!0},e.prototype.enableAllTriggerButtons=function(){this.disabledButtons.TRIGGER=!1},e.prototype.disableAllActionButtons=function(){this.disabledButtons.ACTION=!0},e.prototype.enableAllActionButtons=function(){this.disabledButtons.ACTION=!1},e.prototype.disableAllSystemButtons=function(){this.disabledButtons.SYSTEM=!0},e.prototype.enableAllSystemButtons=function(){this.disabledButtons.SYSTEM=!1},e.prototype.setDisableKeyProperty=function(e,t){void 0===t&&(t=!0),this.properties.isReady&&(this.disabledButtons[e.toUpperCase()]=t)},e.prototype.getKeyDisabledValue=function(e){return this.properties.isReady?this.disabledButtons[e.toUpperCase()]:null},e.prototype.clearAllControlIntervals=function(){if(this.properties.isReady)for(var e=0,t=this.buttonArray;e<t.length;e++){var a=t[e];clearInterval(this.IO.sensitivityPress[a])}},e.prototype.getKeyId=function(e){return this.buttonMapId[e.toUpperCase()]},e.prototype.read=function(e){if(this.properties.isReady){return{}[e]={id:this.buttonMapId[e.toUpperCase()],active:this.IO.state[e.toUpperCase()]().val>0,duration:this.IO.state[e.toUpperCase()]().val,state:this.IO.state[e.toUpperCase()]().state,type:this.IO.state[e.toUpperCase()]().type,disabled:this.disabledButtons[e.toUpperCase()]}}return{}},e.prototype.readMulti=function(e,t){if(void 0===t&&(t="OBJECT"),this.properties.isReady){if("OBJECT"===t){for(var a={},i=0,n=e;i<n.length;i++){a[s=n[i]]={id:this.buttonMapId[s.toUpperCase()],active:this.IO.state[s.toUpperCase()]().val>0,duration:this.IO.state[s.toUpperCase()]().val,state:this.IO.state[s.toUpperCase()]().state,type:this.IO.state[s.toUpperCase()]().type,disabled:this.disabledButtons[s.toUpperCase()]}}return a}if("ARRAY"===t){a=[];for(var r=0,o=e;r<o.length;r++){var s=o[r];a.push({id:this.buttonMapId[s.toUpperCase()],key:s,active:this.IO.state[s.toUpperCase()]().val>0,duration:this.IO.state[s.toUpperCase()]().val,state:this.IO.state[s.toUpperCase()]().state,type:this.IO.state[s.toUpperCase()]().type,disabled:this.disabledButtons[s.toUpperCase()]})}return a}}},e.prototype.getReleasedKeys=function(){return this.releasedKeys},e.prototype.getOnly=function(e){for(var t=this,a={},i=function(i){e.map(function(e){i===e&&(a[i]={id:t.buttonMapId[i.toUpperCase()],active:t.IO.state[i.toUpperCase()]().val>0,duration:t.IO.state[i.toUpperCase()]().val,state:t.IO.state[i.toUpperCase()]().state,type:t.IO.state[i.toUpperCase()]().type,disabled:t.disabledButtons[i.toUpperCase()]})})},n=0,r=this.buttonArray;n<r.length;n++){i(r[n])}return a},e.prototype.getAll=function(){for(var e={},t=0,a=this.buttonArray;t<a.length;t++){var i=a[t];e[i]={id:this.buttonMapId[i.toUpperCase()],active:this.IO.state[i.toUpperCase()]().val>0,duration:this.IO.state[i.toUpperCase()]().val,state:this.IO.state[i.toUpperCase()]().state,type:this.IO.state[i.toUpperCase()]().type,disabled:this.disabledButtons[i.toUpperCase()]}}return e},e.prototype.debuggerString=function(e){return e.toUpperCase()+" ("+this.buttonMap[e.toUpperCase()].name+"/"+this.buttonMap[e.toUpperCase()].code+") | id: "+this.buttonMapId[e.toUpperCase()]+" duration: "+this.IO.state[e.toUpperCase()]().val+" | state: "+this.IO.state[e.toUpperCase()]().state+" | type: "+this.IO.state[e.toUpperCase()]().type+" | disabled: "+this.disabledButtons[e.toUpperCase()]},e.prototype.getBtnPressType=function(e){var t=this,a="NONE",i=0,n=0;return Object.keys(this.buttonSensitivity).forEach(function(r){n++,e>t.buttonSensitivity[r]&&(a=r,i=n)}),{val:e,type:a,state:i}},e.prototype.destroyAll=function(){var e=this;this.clearAllControlIntervals(),Object.keys(this.debugger.text).forEach(function(t){e.debugger.text[t].destroy()})},e}(),PHASER_GROUP_MANAGER=function(){function e(){this.game=null,this.group={array:[],object:{}}}return e.prototype.assign=function(e,t){void 0===t&&(t=10),this.game=e;for(var a=0;a<=t;a++){var i=e.add.group();this.group.object[""+a]=i,this.group.array.push(i)}},e.prototype.layer=function(e){return this.group.object[e]},e.prototype.add=function(e,t){this.group.object[e].add(t)},e.prototype.addMany=function(e,t){var a=this;t.forEach(function(t){a.group.object[e].add(t)})},e}(),PHASER_MASTER=function(){function e(e){var t=this;this._game=e.game,this.element=e.element,this.resolution=e.resolution,this.states={BOOT:"BOOT",PRELOAD:"PRELOAD",READY:"READY"},this.currentState=this.states[0],this.variables={},setTimeout(function(){t._game.time.pausedTimeTotal=0,t._game.time.addToPausedTime=function(e){t._game.time.pausedTimeTotal+=e},t._game.time.returnTrueTime=function(){return t._game.time.now-t._game.time.pausedTimeTotal}},1)}return e.prototype.let=function(e,t){if(void 0===t&&(t=null),void 0===this.variables[e])return this.variables[e]=t;console.log("Cannot LET duplicate key in PHASER_MASTER: "+e)},e.prototype.forceLet=function(e,t){return void 0===t&&(t=null),this.variables[e]=t},e.prototype.delete=function(e){delete this.variables[e]},e.prototype.get=function(e){return void 0!==this.variables[e]?this.variables[e]:(console.log("Cannot GET a variable that does not exist in PHASER_MASTER."),null)},e.prototype.getAll=function(){return this.variables},e.prototype.getOnly=function(e){var t={},a=[];for(var i in this.variables)a.push({key:i,data:this.variables[i]});for(var n=function(i){a.filter(function(t){return t.key===e[i]}).map(function(e){t[e.key]=e.data})},r=0;r<e.length;r++)n(r);return t},e.prototype.changeState=function(e){void 0===e&&(e=null);var t=e.toUpperCase(),a=!1;return void 0===this.states[t]&&(this.states[t]=t,a=!0),this.currentState=t,{created:a,state:this.currentState}},e.prototype.getCurrentState=function(){return this.currentState},e.prototype.getElement=function(){return this.element},e.prototype.getStates=function(){return this.states},e.prototype.getResolution=function(){return this.resolution},e.prototype.checkState=function(e){return this.currentState===e.toUpperCase()},e.prototype.getState=function(){return{currentState:this.currentState}},e.prototype.game=function(){return this._game},e}(),PHASER_MOUSE=function(){function e(e){this.game=null,this.clickSensitvity={QUICK:1,SHORT:50,LONG:150,SUPERLONG:300},this.mouseMapping=[0,1,2],this.mouseMap={LEFT:0,MIDDLE:1,RIGHT:2},this.metrics={sensitivityPress:{},sensitivityBuffer:{},location:{},state:{}},this.properties={allowDebugger:!0,timingRefreshRate:1},this.inputDelay={delay:Array.apply(null,Array(2)).map(function(){return 0})},this.debugger={enabled:void 0!==e.showDebugger&&e.showDebugger,text:{},pointer:null}}return e.prototype.assign=function(e){var t=this;this.game=e;for(var a=function(e){i.metrics.sensitivityPress[e]=null,i.metrics.sensitivityBuffer[e]=0,i.metrics.location[e]={x:null,y:null},i.metrics.state[e]=function(){return t.getBtnPressType(t.metrics.sensitivityBuffer[e])}},i=this,n=0,r=this.mouseMapping;n<r.length;n++){a(r[n])}this.game.input.onDown.add(function(e){var a=t.checkMouseClick();clearInterval(t.metrics.sensitivityPress[a]),t.metrics.sensitivityPress[a]=setInterval(function(){t.metrics.sensitivityBuffer[a]+=1,t.metrics.location[a]={x:e.x,y:e.y}},t.properties.timingRefreshRate)}),this.game.input.onUp.add(function(e){var a=t.checkMouseClick();t.clearAllControlIntervals(),t.metrics.sensitivityBuffer[a]=0});var o={font:"12px Courier New",fill:"#fff",align:"left"};this.mouseMapping.forEach(function(e,a){t.debugger.text[e]=null,t.debugger.text[e]=t.game.add.text(5,t.game.height-35-15*a,"",o)}),this.debugger.pointer=this.game.add.text(5,this.game.height-20,"",o),e.canvas.oncontextmenu=function(e){e.preventDefault()}},e.prototype.checkMouseClick=function(){var e=0;return this.game.input.activePointer.leftButton.isDown&&(e=0),this.game.input.activePointer.middleButton.isDown&&(e=1),this.game.input.activePointer.rightButton.isDown&&(e=2),e},e.prototype.debuggerString=function(e){return"Button_"+e+" | {x: "+this.metrics.location[e].x+", y: "+this.metrics.location[e].y+"} | active: "+(this.metrics.sensitivityBuffer[e]>0)+" | state: "+this.metrics.state[e]().state+" | duration: "+this.metrics.state[e]().val+" | type: "+this.metrics.state[e]().type},e.prototype.setDebugger=function(e){void 0===e&&(e=!0),this.debugger.enabled=e},e.prototype.updateDebugger=function(){for(var e=0,t=this.mouseMapping;e<t.length;e++){var a=t[e];this.debugger.text[a].setText(this.debugger.enabled?this.debuggerString(a):"").bringToTop()}this.debugger.pointer.setText(this.debugger.enabled?"Pointer: {x: "+this.game.input.mousePointer.x+", y: "+this.game.input.mousePointer.y+"}":"").bringToTop()},e.prototype.clearAllControlIntervals=function(){for(var e=0,t=this.mouseMapping;e<t.length;e++){var a=t[e];this.metrics.sensitivityBuffer[a]=0,clearInterval(this.metrics.sensitivityPress[a])}},e.prototype.checkWithDelay=function(e){if(this.read(e.key).active===e.isActive){var t=this.mouseMap[e.key.toUpperCase()];return this.game.time.now>this.inputDelay.delay[t]&&(this.inputDelay.delay[t]=e.delay+this.game.time.now,!0)}return!1},e.prototype.read=function(e){void 0===e&&(e="LEFT");var t=this.mouseMap[e.toUpperCase()];return{id:t,x:this.metrics.location[t].x,y:this.metrics.location[t].y,active:this.metrics.sensitivityBuffer[t]>0,duration:this.metrics.sensitivityBuffer[t],state:this.metrics.state[t]().state,type:this.metrics.state[t]().type}},e.prototype.getBtnPressType=function(e){var t=this,a="NONE",i=0,n=0;return Object.keys(this.clickSensitvity).forEach(function(r){n++,e>t.clickSensitvity[r]&&(a=r,i=n)}),{val:e,type:a,state:i}},e}(),PHASER_PRELOADER=function(){function e(e){this.game=e.game,this.init(e.delayInSeconds,e.done)}return e.prototype.init=function(e,t){var a,i,n=this;this.game.load.onLoadStart.add(function(){(a=n.game.add.text(n.game.world.centerX,n.game.world.centerY/2,"",{font:"18px Impact",fill:"#fff",align:"center"})).anchor.set(.5),(i=n.game.add.text(n.game.world.centerX,n.game.world.centerY,"",{font:"32px Impact",fill:"#fff",align:"center"})).anchor.set(.5)},this),this.game.load.onFileComplete.add(function(e,t,n,r,o){a.setText("Please wait..."),i.setText(e+"%")},this),this.game.load.onLoadComplete.add(function(){a.setText("File loaded!"),i.setText(""),n.game.time.events.add(Phaser.Timer.SECOND*e,function(){a.destroy(),i.destroy(),t()},n).autoDestroy=!0},this)},e}(),PHASER_SPRITE_MANAGER=function(){function e(){this.game=null,this.sprites={array:[],object:{}},this.spriteCount=0}return e.prototype.assign=function(e){this.game=e},e.prototype.add=function(e){if(0===this.sprites.array.filter(function(t){return t.name===e.name}).length){e.x=void 0!==e.x?e.x:0,e.y=void 0!==e.y?e.y:0,e.group=void 0!==e.group?e.group:null,e.org=void 0!==e.org?e.org:null,e.visible=void 0===e.visible||e.visible,e.alpha=void 0!==e.alpha?e.alpha:1,e.width=void 0!==e.width?e.width:null,e.height=void 0!==e.height?e.height:null;var t=this.game.add.sprite(e.x,e.y,e.reference);return t.name=e.name,t.group=e.group,t.org=e.org,t.defaultPosition={x:e.x,y:e.y},t.visible=e.visible,t.alpha=e.alpha,null!==e.width&&(t.width=e.width),null!==e.height&&(t.height=e.height),t.setDefaultPositions=function(e,t){this.defaultPosition.x=e||this.x,this.defaultPosition.y=t||this.y},t.getDefaultPositions=function(){return this.defaultPosition},t.init=function(){},t.onUpdate=function(){},t.reveal=function(){},t.show=function(){this.visible=!0},t.hide=function(){this.visible=!1},this.sprites.array.push(t),this.sprites.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.addFromAtlas=function(e){if(0===this.sprites.array.filter(function(t){return t.name===e.name}).length){e.x=void 0!==e.x?e.x:0,e.y=void 0!==e.y?e.y:0,e.group=void 0!==e.group?e.group:null,e.org=void 0!==e.org?e.org:null,e.visible=void 0===e.visible||e.visible,e.alpha=void 0!==e.alpha?e.alpha:1,e.width=void 0!==e.width?e.width:null,e.height=void 0!==e.height?e.height:null;var t=this.game.add.sprite(e.x,e.y,e.atlas,e.filename);return t.name=e.name,t.group=e.group,t.org=e.org,t.defaultPosition={x:e.x,y:e.y},t.visible=e.visible,t.alpha=e.alpha,null!==e.width&&(t.width=e.width),null!==e.height&&(t.height=e.height),t.setDefaultPositions=function(e,t){this.defaultPosition.x=e||this.x,this.defaultPosition.y=t||this.y},t.getDefaultPositions=function(){return this.defaultPosition},t.init=function(){},t.onUpdate=function(){},t.reveal=function(){},t.show=function(){this.visible=!0},t.hide=function(){this.visible=!1},this.sprites.array.push(t),this.sprites.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.addTilespriteFromAtlas=function(e){if(0===this.sprites.array.filter(function(t){return t.name===e.name}).length){e.x=void 0!==e.x?e.x:0,e.y=void 0!==e.y?e.y:0,e.group=void 0!==e.group?e.group:null,e.org=void 0!==e.org?e.org:null,e.visible=void 0===e.visible||e.visible,e.alpha=void 0!==e.alpha?e.alpha:1,e.width=void 0!==e.width?e.width:null,e.height=void 0!==e.height?e.height:null;var t=this.game.add.tileSprite(e.x,e.y,e.width,e.height,e.atlas,e.filename);return t.name=e.name,t.group=e.group,t.org=e.org,t.defaultPosition={x:e.x,y:e.y},t.visible=e.visible,t.alpha=e.alpha,null!==e.width&&(t.width=e.width),null!==e.height&&(t.height=e.height),t.setDefaultPositions=function(e,t){this.defaultPosition.x=e||this.x,this.defaultPosition.y=t||this.y},t.getDefaultPositions=function(){return this.defaultPosition},t.init=function(){},t.onUpdate=function(){},t.reveal=function(){},t.show=function(){this.visible=!0},t.hide=function(){this.visible=!1},this.sprites.array.push(t),this.sprites.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.addEmptySprite=function(e){if(0===this.sprites.array.filter(function(t){return t.name===e.name}).length){e.x=void 0!==e.x?e.x:0,e.y=void 0!==e.y?e.y:0,e.group=void 0!==e.group?e.group:null,e.org=void 0!==e.org?e.org:null,e.visible=void 0===e.visible||e.visible,e.alpha=void 0!==e.alpha?e.alpha:1,e.width=void 0!==e.width?e.width:null,e.height=void 0!==e.height?e.height:null;var t=this.game.add.sprite(e.x,e.y);return t.name=e.name,t.group=e.group,t.org=e.org,t.defaultPosition={x:e.x,y:e.y},t.visible=e.visible,t.alpha=e.alpha,null!==e.width&&(t.width=e.width),null!==e.height&&(t.height=e.height),t.setDefaultPositions=function(e,t){this.defaultPosition.x=e||this.x,this.defaultPosition.y=t||this.y},t.getDefaultPositions=function(){return this.defaultPosition},t.init=function(){},t.onUpdate=function(){},t.reveal=function(){},t.show=function(){this.visible=!0},t.hide=function(){this.visible=!1},this.sprites.array.push(t),this.sprites.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.createBasicMask=function(e,t,a,i){var n=this.game.add.graphics(0,0);return n.beginFill(16777215),n.drawRect(e,t,a,i),n},e.prototype.addBasicMaskToSprite=function(e){var t=this.game.add.graphics(0,0);return t.beginFill(16777215),t.drawRect(e.x,e.y,e.width,e.height),e.mask=t,t},e.prototype.destroy=function(e){if(void 0!==this.sprites.object[e]){for(var t=[],a=0,i=this.sprites.array.filter(function(t){return t.name===e});a<i.length;a++){var n=i[a];t.push(n.name),n.destroy()}return delete this.sprites.object[e],this.sprites.array=this.sprites.array.filter(function(t){return t.name!==e}),t}return console.log("Cannot delete "+e+" because it does not exist."),null},e.prototype.destroyGroup=function(e){for(var t=[],a=0,i=this.sprites.array.filter(function(t){return t.group===e});a<i.length;a++){var n=i[a];t.push(n.name),n.destroy()}return delete this.sprites.object[e],this.sprites.array=this.sprites.array.filter(function(t){return t.group!==e}),t},e.prototype.get=function(e){return this.sprites.object[e]},e.prototype.getGroup=function(e){return this.sprites.array.filter(function(t){return t.group===e||t.org===e})},e.prototype.getManyGroups=function(e){for(var t=[],a=function(a){var n=i.sprites.array.filter(function(t){return t.group===e[a]||t.org===e[a]});t=t.concat(n)},i=this,n=0;n<e.length;n++)a(n);return t},e.prototype.getOnly=function(e){for(var t={},a=function(a){i.sprites.array.filter(function(t){return t.group===e[a]||t.name===e[a]}).map(function(e){t[e.name]=e})},i=this,n=0;n<e.length;n++)a(n);return t},e.prototype.getAll=function(e){return void 0===e&&(e="OBJECT"),"ARRAY"===e?this.sprites.array:"OBJECT"==e?this.sprites.object:{object:this.sprites.object,array:this.sprites.array}},e.prototype.count=function(){return this.spriteCount++,{total:this.sprites.array.length,unique:this.spriteCount}},e.prototype.centerWorld=function(e){if(void 0===this.sprites.object[e])return console.log("Error centering sprite:  key does not exists."),null;var t=this.sprites.object[e];return t.alignIn(this.game.world.bounds,Phaser.CENTER),t},e.prototype.centerOnPoint=function(e,t,a){if(void 0===this.sprites.object[e])return console.log("Error centering sprite:  key does not exists."),null;var i=this.sprites.object[e];return i.x=t-i.width/2,i.y=a-i.height/2,i},e}(),PHASER_TEXT_MANAGER=function(){function e(){this.game=null,this.texts={array:[],object:{}}}return e.prototype.assign=function(e){this.game=e},e.prototype.add=function(e){var t=this.texts.array.filter(function(t){return t.name===e.name});if(e.x=void 0!==e.x?e.x:0,e.y=void 0!==e.y?e.y:0,e.group=void 0!==e.group?e.group:null,e.size=void 0!==e.size?e.size:12,e.default=void 0!==e.default?e.default:"",e.visible=void 0===e.visible||e.visible,e.alpha=void 0!==e.alpha?e.alpha:1,0===t.length){var a=this.game.add.bitmapText(e.x,e.y,e.font,e.default,e.size);return a.name=e.name,a.group=e.group,a.visible=e.visible,a.alpha=e.alpha,a.init=function(){},a.show=function(){this.visible=!0},a.hide=function(){this.visible=!1},this.texts.array.push(a),this.texts.object[e.name]=a,a}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.destroy=function(e){for(var t=[],a=0,i=this.texts.array.filter(function(t){return t.name===e});a<i.length;a++){var n=i[a];t.push(n.name),n.destroy()}return delete this.texts.object[e],this.texts.array=this.texts.array.filter(function(t){return t.name!==e}),t},e.prototype.destroyGroup=function(e){for(var t=[],a=0,i=this.texts.array.filter(function(t){return t.group===e});a<i.length;a++){var n=i[a];t.push(n.key),n.destroy()}return delete this.texts.object[e],this.texts.array=this.texts.array.filter(function(t){return t.group!==e}),t},e.prototype.get=function(e){return this.texts.object[e]},e.prototype.getGroup=function(e){return this.texts.array.filter(function(t){return t.group===e})},e.prototype.getManyGroups=function(e){for(var t=[],a=function(a){var n=i.texts.array.filter(function(t){return t.group===e[a]});t=t.concat(n)},i=this,n=0;n<e.length;n++)a(n);return t},e.prototype.getAll=function(e){return void 0===e&&(e="OBJECT"),"ARRAY"===e?this.texts.array:"OBJECT"==e?this.texts.object:{object:this.texts.object,array:this.texts.array}},e.prototype.getOnly=function(e){for(var t={},a=function(a){i.texts.array.filter(function(t){return t.group===e[a]||t.name===e[a]}).map(function(e){t[e.name]=e})},i=this,n=0;n<e.length;n++)a(n);return t},e.prototype.alignToBottomLeftCorner=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],i=this.game;return a.x=t,a.y=i.canvas.height-a.height-t,a},e.prototype.alignToBottomCenter=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],i=this.game;return a.x=i.canvas.width/2-a.width/2,a.y=i.canvas.height-a.height-t,a},e.prototype.alignToBottomRightCorner=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],i=this.game;return a.x=i.canvas.width-a.width-t,a.y=i.canvas.height-a.height-t,a},e.prototype.alignToCenterRight=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],i=this.game;return a.x=i.canvas.width-a.width-t,a.y=i.canvas.height/2-a.height/2,a},e.prototype.alignToTopRightCorner=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],i=this.game;return a.x=i.canvas.width-a.width-t,a.y=t,a},e.prototype.alignToTopCenter=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],i=this.game;return a.x=i.canvas.width/2-a.width/2-t,a.y=t,a},e.prototype.alignToTopLeftCorner=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e];this.game;return a.x=t,a.y=t,a},e.prototype.alignToCenterLeft=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],i=this.game;return a.x=t,a.y=i.canvas.height/2-a.height/2,a},e.prototype.alignToCenter=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],i=this.game;return a.x=i.canvas.width/2-a.width/2,a.y=i.canvas.height/2-a.height/2,a},e.prototype.center=function(e,t,a){if(void 0===t&&(t=0),void 0===a&&(a=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var i=this.texts.object[e],n=this.game;return i.x=n.canvas.width/2-i.width/2+t,i.y=n.canvas.height/2-i.height/2+a,i},e}(),DIALOG_MANAGER=function(){function e(){}return e.prototype.assign=function(e,t,a,i,n,r,o){this.game=e,this.phaserSprites=a,this.phaserMaster=t,this.phaserGroup=i,this.phaserTexts=n,this.phaserControls=r,this.atlas=o,this.dialogGenerator,this.dialogbox},e.prototype.create=function(){var e=this,t=e.game,a=e.phaserMaster,i=e.phaserSprites,n=e.phaserGroup,r=e.phaserTexts,o=(e.atlas,a.getResolution()),s=o.w,l=o.h,p=i.addEmptySprite({x:0,y:l+300,name:"dialogbox",visible:!1});p.reveal=function(e){p.getDefaultPositions().y;p.visible=!0,p.setDefaultPositions(),p.children.map(function(e){void 0!==e.onStart&&e.onStart()}),t.add.tween(p).to({y:l-110},Phaser.Timer.SECOND/2,Phaser.Easing.Circular.InOut,!0,1,0,!1).onComplete.add(function(){e()})},p.hide=function(){p.text.replaceText(""),t.add.tween(p).to({y:p.getDefaultPositions().y},Phaser.Timer.SECOND/2,Phaser.Easing.Circular.InOut,!0,1,0,!1).onComplete.add(function(){p.children.map(function(e){void 0!==e.onStop&&e.onStop()})})};var h=i.addFromAtlas({x:0,y:0,width:s,height:110,name:"dialogboxGraphic",filename:"dialogbox",atlas:"atlas_main",alpha:.8});p.addChild(h);var u=i.addFromAtlas({x:10,y:8,name:"dialogPortraitFrame",filename:"ui_portraitContainer",atlas:"atlas_main",visible:!0});p.addChild(u);var d=i.createBasicMask(13,11,u.width-3,u.height-3);p.addChild(d),u.replaceImage=function(e){void 0!==i.get("dialogPortraitImage")&&i.destroy("dialogPortraitImage");var t=i.addFromAtlas({name:"dialogPortraitImage",filename:e,atlas:"atlas_main"});t.mask=d,u.addChild(t)},u.onStart=function(){var e=Phaser.Animation.generateFrameNames("portrait_static_",1,4).concat(Phaser.Animation.generateFrameNames("portrait_static_",3,1)),t=i.addFromAtlas({x:10,y:8,name:"dialogboxStatic",filename:e[0],atlas:"atlas_main",visible:!0,alpha:.35});t.animations.add("static",e,1,!0),t.mask=d,p.addChild(t),t.animations.play("static",30,!0)},u.onStop=function(){i.destroy("dialogboxStatic"),void 0!==i.get("dialogPortraitImage")&&i.destroy("dialogPortraitImage")};var c=Phaser.Animation.generateFrameNames("a_button_",1,9).slice(),m=i.addFromAtlas({x:h.width-40,y:h.height-40,name:"dialogboxButton",filename:c[0],atlas:"atlas_main",visible:!1});m.animations.add("animate",c),m.onStop=function(){m.animations.stop(null,!0)},p.addChild(m);var g=r.add({x:100,y:10,name:"dialogtext",font:"gem",size:16});g.maxWidth=s-100-15,p.addChild(g),g.replaceText=function(e,a){void 0===a&&(a=function(){}),g.alpha=0,m.visible=!1,g.setText(e),t.add.tween(g).to({alpha:1},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.In,!0,1,0,!1).onComplete.add(function(){m.visible=!0,a()})},g.onStart=function(){},g.onStop=function(){g.replaceText("")};var y=r.add({y:-20,name:"skipallText",font:"gem",default:"PRESS START TO SKIP",size:15,visible:!1});y.x=s-y.width-10,p.addChild(y),p.portrait=u,p.text=g,p.skipallText=y,p.dialogboxButton=m,this.dialogbox=p,n.addMany(a.get("layers").DIALOGBOX,[p])},e.prototype.dialog=function(e){var t;return __generator(this,function(a){switch(a.label){case 0:t=0,a.label=1;case 1:return t<e.length?[4,e[t]]:[3,4];case 2:a.sent(),a.label=3;case 3:return t++,[3,1];case 4:return[4,null];case 5:return a.sent(),[2]}})},e.prototype.start=function(e,t){var a=this,i=(a.game,a.phaserMaster),n=a.phaserSprites,r=(a.phaserGroup,a.phaserTexts,a.phaserControls),o=(a.atlas,i.getState().currentState),s=this.dialog(e);this.canSkip=!1,this.onTimer=!1,this.autoplay=!1,s.complete=t,s.revertToState=o,s.isReady=!1,r.enableAllActionButtons(),this.createDialogbox(s),s.nextItem=function(e){var t=e.text,a=e.portrait;s.dialogbox.portrait.replaceImage(a),s.dialogbox.text.replaceText(t,function(){})},s.finished=function(){n.getGroup("player_healthbar").concat(n.getGroup("player_pow")).map(function(e){e.fadeIn()}),i.changeState(s.revertToState),s.dialogbox.hide(),t()},i.changeState("DIALOG"),this.dialogGenerator=s},e.prototype.createDialogbox=function(e){var t=this,a=this,i=(a.game,a.phaserMaster,a.phaserSprites),n=(a.phaserGroup,a.phaserTexts,a.phaserControls,a.atlas,this.dialogbox);i.getGroup("player_healthbar").concat(i.getGroup("player_pow")).map(function(e){e.fadeOut()}),n.reveal(function(){e.dialogbox=n,e.dialogbox.text.replaceText("",function(){e.isReady=!0,t.next()})})},e.prototype.next=function(e){var t=this;void 0===e&&(e=!1);var a=this.dialogbox;if(this.dialogGenerator.isReady&&!this.onTimer||e){var i=this.dialogGenerator.next().value;null===i?this.dialogGenerator.finished():(i.autoplay&&(this.autoplay=i.autoplay,this.autoplay?a.dialogboxButton.animations.play("animate",6,!0):a.dialogboxButton.animations.stop("animate")),this.autoplay&&(i.timer=50*i.text.length>2500?50*i.text.length:2500),i.canSkip&&(this.canSkip=i.canSkip),a.skipallText.visible=this.canSkip,i.timer?(this.onTimer=!0,this.execute(i),this.game.time.events.add(i.timer,function(){t.execute(i,function(){t.next(!0)})},this).autoDestroy=!0):(this.onTimer=!1,this.execute(i)))}},e.prototype.execute=function(e,t){void 0===t&&(t=function(){}),null!==e&&(this.dialogGenerator.nextItem(e),t()),null===e&&this.dialogGenerator.finished()},e.prototype.skipAll=function(){this.dialogGenerator.isReady&&this.canSkip&&this.dialogGenerator.finished()},e}(),EFFECTS_MANAGER=function(){function e(){}return e.prototype.assign=function(e,t,a,i,n){this.game=e,this.phaserSprites=a,this.phaserMaster=t,this.phaserGroup=i,this.atlas=n,this.currentExplosionCount=0,this.maxExplosions=5,this.currentAmmoCount=0,this.maxAmmo=3},e.prototype.debris=function(e){var t=this.game,a=(this.phaserMaster.getOnly(["onscreenDebrisCount"]).onscreenDebrisCount,Phaser.Animation.generateFrameNames("debrs__",1,9)),i=t.add.weapon(e,this.atlas,a[0]);return i.bulletKillType=Phaser.Weapon.KILL_CAMERA_BOUNDS,i.bulletSpeed=200,i.bulletSpeedVariance=500,i.multiFire=!0,i.bulletPoolTotal=e,this.phaserGroup.add(this.phaserMaster.get("layers").DEBRIS,i.bullets),i.bullets.children.map(function(e){e.animations.add("explosion",a,30,!0)}),i.customFire=function(e,a){for(var n=0;n<a;n++)i.fire(e,e.x+t.rnd.integerInRange(-360,360),e.y+t.rnd.integerInRange(-360,360));i.bullets.children.map(function(e,a){t.time.events.add(15*a,function(){e.animations.play("explosion",30,!0),t.add.tween(e).to({alpha:0},500,Phaser.Easing.Linear.In,!0,500).onComplete.add(function(){e.alpha=1,e.kill()})}).autoDestroy=!0})},i},e.prototype.createExplosion=function(e,t,a,i,n,r){var o=this;if(void 0===n&&(n=function(){}),void 0===r&&(r=function(){}),this.currentExplosionCount<this.maxExplosions){this.currentExplosionCount++;var s=this.game,l=this.phaserSprites,p=this.phaserGroup,h=this.atlas,u={spriteAnimation:Phaser.Animation.generateFrameNames("explosion2_layer_",1,12)},d=l.addFromAtlas({name:"explosion_"+s.rnd.integer(),group:"noimpactExplosions",x:e,y:t,atlas:h,filename:u.spriteAnimation[0]});return d.scale.setTo(a,a),d.anchor.setTo(.5,.5),d.animations.add("explosion",u.spriteAnimation,1,!0),d.animations.play("explosion",30,!1).onComplete.add(function(){d.destroyIt()},d),d.destroyIt=function(){o.currentExplosionCount--,l.destroy(d.name)},p.add(void 0===i?this.phaserMaster.get("layers").VISUALS:i,d),d}},e.prototype.pelletImpact=function(e,t,a,i){var n=this;if(this.currentAmmoCount<this.maxAmmo){this.currentAmmoCount++;var r=this.game,o=this.phaserSprites,s=this.phaserGroup,l=this.atlas,p={spriteAnimation:Phaser.Animation.generateFrameNames("sparks_",1,5)},h=o.addFromAtlas({name:"impact_"+r.rnd.integer(),group:"noimpactExplosions",x:e,y:t,atlas:l,filename:p.spriteAnimation[0]});return h.scale.setTo(a,a),h.anchor.setTo(.5,.5),h.animations.add("explosion",p.spriteAnimation,1,!0),h.animations.play("explosion",30,!1).onComplete.add(function(){h.destroyIt()},h),h.destroyIt=function(){n.currentAmmoCount--,o.destroy(h.name)},s.add(void 0===i?this.phaserMaster.get("layers").BULLET_IMPACT:i,h),r.physics.enable(h,Phaser.Physics.ARCADE),h}},e.prototype.blueImpact=function(e,t,a,i){var n=this;if(this.currentAmmoCount<this.maxAmmo){this.currentAmmoCount++;var r=this.game,o=this.phaserSprites,s=this.phaserGroup,l=this.atlas,p={spriteAnimation:Phaser.Animation.generateFrameNames("blue_explosion_small_layer_",1,7)},h=(Phaser.Animation.generateFrameNames("blue_explosion_small_layer_",1,7),o.addFromAtlas({name:"impact_"+r.rnd.integer(),group:"noimpactExplosions",x:e,y:t,atlas:l,filename:p.spriteAnimation[0]}));return h.scale.setTo(a,a),h.anchor.setTo(.5,.5),r.physics.enable(h,Phaser.Physics.ARCADE),h.animations.add("explosion",p.spriteAnimation,1,!0),h.animations.play("explosion",30,!1).onComplete.add(function(){h.destroyIt()},h),h.destroyIt=function(){n.currentAmmoCount--,o.destroy(h.name)},s.add(void 0===i?this.phaserMaster.get("layers").BULLET_IMPACT:i,h),h}},e.prototype.orangeImpact=function(e,t,a,i){var n=this;if(this.currentAmmoCount<this.maxAmmo){this.currentAmmoCount++;var r=this.game,o=this.phaserSprites,s=this.phaserGroup,l=this.atlas,p={spriteAnimation:Phaser.Animation.generateFrameNames("orange_ring_explosion_layer_",1,7)},h=(Phaser.Animation.generateFrameNames("orange_ring_explosion_layer_",1,7),o.addFromAtlas({name:"impact_"+r.rnd.integer(),group:"noimpactExplosions",x:e,y:t,atlas:l,filename:p.spriteAnimation[0]}));return h.scale.setTo(a,a),h.anchor.setTo(.5,.5),r.physics.enable(h,Phaser.Physics.ARCADE),h.animations.add("explosion",p.spriteAnimation,1,!0),h.animations.play("explosion",30,!1).onComplete.add(function(){h.destroyIt()},h),h.destroyIt=function(){n.currentAmmoCount--,o.destroy(h.name)},s.add(void 0===i?this.phaserMaster.get("layers").BULLET_IMPACT:i,h),h}},e.prototype.electricDischarge=function(e,t,a,i){var n=this;if(this.currentAmmoCount<this.maxAmmo){this.currentAmmoCount++;var r=this.game,o=this.phaserSprites,s=this.phaserGroup,l=this.atlas,p={spriteAnimation:Phaser.Animation.generateFrameNames("disintegrate",1,10)},h=o.addFromAtlas({name:"impact_"+r.rnd.integer(),group:"noimpactExplosions",x:e,y:t,atlas:l,filename:p.spriteAnimation[0]});return h.scale.setTo(a,a),h.anchor.setTo(.5,.5),r.physics.enable(h,Phaser.Physics.ARCADE),h.animations.add("explosion",p.spriteAnimation,1,!0),h.animations.play("explosion",r.rnd.integerInRange(20,30),!1).onComplete.add(function(){h.destroyIt()},h),h.destroyIt=function(){n.currentAmmoCount--,o.destroy(h.name)},s.add(void 0===i?this.phaserMaster.get("layers").BULLET_IMPACT:i,h),h}},e}(),ENEMY_MANAGER=function(){function e(e){this.showHitbox=e.showHitbox}return e.prototype.assign=function(e,t,a,i,n,r,o,s,l){this.game=e,this.phaserSprites=a,this.phaserMaster=t,this.phaserTexts=i,this.phaserGroup=n,this.weaponManager=r,this.effectsManager=o,this.atlas=s,this.atlas_weapons=l,this.enemyLayer},e.prototype.facePlayer=function(e){var t=this.game,a=this.phaserSprites.getOnly(["player"]).player;return Math.ceil(360/(2*Math.PI)*t.math.angleBetween(e.x,e.y,a.x,a.y)-90)},e.prototype.generateWaveData=function(e,t){return this.game.math.sinCosGenerator(e,t,0,1).cos.map(function(e){return Math.abs(e)})},e.prototype.bulletCollisionWithPlayer=function(e){var t=this.phaserSprites.getGroup("player_hitboxes").slice(),a=e.collidables.primaryWeapon.slice();this.game.physics.arcade.overlap(t,a,function(e,t){var a=e.parent;a.isInvincible||a.isDead||a.isDamaged||a.isForceMoved||(a.takeDamage(t.damgeOnImpact),t.destroyIt())})},e.prototype.addSharedBehavior=function(e){var t=this,a=this.game,i=this.phaserSprites,n=this.phaserMaster,r=this.phaserGroup;e.onLayer=n.get("layers").ENEMIES,e.anchor.setTo(.5,.5),e.health=e.maxHealth,e.isInvincible=!1,e.isDamaged=!1,e.isDestroyed=!1,e.belowBlinkTimer=a.time.returnTrueTime(),e.isBelow50=!1,e.isBelow75=!1,e.weaponSystems=[],e.collidables={primaryWeapon:[],secondaryWeapon:[]},e.removeIt=function(){e.isDestroyed||(e.weaponSystems.map(function(e){e.destroyIt()}),e.children.map(function(e){t.phaserSprites.destroy(e.name)}),i.destroy(e.name))},r.add(e.onLayer,e)},e.prototype.attachHitbox=function(e,t){var a=this,i=this.game,n=this.phaserSprites,r=this.atlas;t.map(function(t){var o=n.addFromAtlas({name:"enemy_hitbox_"+i.rnd.integer(),group:"enemy_hitboxes",atlas:r,filename:t,alpha:a.showHitbox?.75:0});o.anchor.setTo(.5,.5),i.physics.enable(o,Phaser.Physics.ARCADE),e.addChild(o)})},e.prototype.attachWeaponSystem=function(e,t,a){var i=this,n=this.game,r=this.phaserSprites,o=this.phaserGroup,s=(this.atlas,this.phaserSprites.addFromAtlas({name:"enemy_weapons_"+this.game.rnd.integer(),group:"enemy_weapons",atlas:this.atlas_weapons,filename:a[0],visible:!0}));return s.anchor.setTo(.5,.5),s.angle=180,s.animations.add("fireWeapon",a,1,!0),s.sync=function(e){var t=e.x,a=e.y;s.x=t,s.y=a},s.destroyIt=function(){var t=s.x,a=s.y;i.effectsManager.blueImpact(t,a,1,e.onLayer),i.phaserSprites.destroy(s.name),n.time.events.add(4*Phaser.Timer.SECOND,function(){s.ammo.destroy()},i).autoDestroy=!0},s.onUpdate=function(){t.onUpdate()},s.fire=function(){var e=r.get("player");e.isInvincible||e.isDead?(t.checkOrientation(s),t.fire(s)):t.fire(s,e.x,e.y),s.animations.play("fireWeapon",24,!1)},o.add(e.onLayer+1,s),s.ammo=t,e.weaponSystems.push(s),e.collidables.primaryWeapon=[],e.collidables.primaryWeapon.push(t.bullets),s},e.prototype.createAsteroid1=function(e,t,a,i){var n=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===i&&(i=function(){});var r=this.game,o=(this.phaserMaster,this.phaserSprites),s=(this.phaserGroup,this.atlas),l=Phaser.Animation.generateFrameNames("asteroid1/asteroid_",1,28).slice(),p=o.addFromAtlas({x:e.x,y:e.y,name:"enemy_"+r.rnd.integer(),group:"enemies",org:"gameobjects",atlas:s,filename:l[0],visible:!0});p.maxHealth=50,this.addSharedBehavior(p),p.animations.add("idol",l),p.animations.play("idol",16,!0),this.attachHitbox(p,["asteroid1/hitbox"]);var h=this.weaponManager.enemyBullet(0);h.bullets.children.map(function(e){});var u=Phaser.Animation.generateFrameNames("bullet_fire_",1,4).slice();return this.attachWeaponSystem(p,h,u),p.onUpdate=function(){p.y+=2,p.isBelow50&&r.time.returnTrueTime()>p.belowBlinkTimer&&(p.belowBlinkTimer+=500,p.tint=16711680,p.game.add.tween(p).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1)),p.isBelow75&&r.time.returnTrueTime()>p.belowBlinkTimer&&(p.belowBlinkTimer+=250,p.tint=16711680,p.game.add.tween(p).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1)),i(p),p.y>n.game.world.height+p.height&&p.removeIt(),n.bulletCollisionWithPlayer(p)},p.destroyIt=function(){p.isDestroyed=!0,p.isBelow50=!1,p.isBelow75=!1,p.tint=16711680,p.weaponSystems.map(function(e){e.destroyIt()}),p.game.add.tween(p).to({alpha:.75},150,Phaser.Easing.Linear.Out,!0,1,0,!1).onComplete.add(function(){a(p),n.weaponManager.createExplosionBasic(p.x,p.y,1,p.onLayer+1,0),r.time.events.remove(p.explodeInterval),p.children.map(function(e){n.phaserSprites.destroy(e.name)}),o.destroy(p.name)})},p.damageIt=function(e){t(p),p.isDamaged=!0,r.time.events.add(10,function(){p.isDamaged=!1},n).autoDestroy=!0,p.y>0&&(p.health-=e),p.tint=16711680,p.game.add.tween(p).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),p.health/p.maxHealth<.5&&(p.isBelow50=!0),p.health/p.maxHealth<.25&&(p.isBelow75=!0),p.health<=0&&p.destroyIt()},p},e.prototype.createAsteroid2=function(e,t,a,i){var n=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===i&&(i=function(){});var r=this.game,o=(this.phaserMaster,this.phaserSprites),s=(this.phaserGroup,this.atlas),l=Phaser.Animation.generateFrameNames("asteroid2/asteroid_",1,19).slice(),p=o.addFromAtlas({x:e.x,y:e.y,name:"enemy_"+r.rnd.integer(),group:"enemies",org:"gameobjects",atlas:s,filename:l[0],visible:!0});p.maxHealth=150,this.addSharedBehavior(p),p.animations.add("idol",l),p.animations.play("idol",12,!0),this.attachHitbox(p,["asteroid2/hitbox"]);var h=this.weaponManager.enemyBullet(0);h.bullets.children.map(function(e){});var u=Phaser.Animation.generateFrameNames("bullet_fire_",1,4).slice();return this.attachWeaponSystem(p,h,u),p.onUpdate=function(){p.y+=.5,p.isBelow50&&r.time.returnTrueTime()>p.belowBlinkTimer&&(p.belowBlinkTimer+=500,p.tint=16711680,p.game.add.tween(p).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1)),p.isBelow75&&r.time.returnTrueTime()>p.belowBlinkTimer&&(p.belowBlinkTimer+=250,p.tint=16711680,p.game.add.tween(p).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1)),i(p),p.y>n.game.world.height+p.height&&p.removeIt(),n.bulletCollisionWithPlayer(p)},p.destroyIt=function(){p.isDestroyed=!0,p.isBelow50=!1,p.isBelow75=!1,p.tint=16711680,p.weaponSystems.map(function(e){e.destroyIt()}),p.game.add.tween(p).to({alpha:.5},10,Phaser.Easing.Linear.Out,!0,1,0,!1).onComplete.add(function(){a(p),n.phaserMaster.get("sharedDebris").customFire(p,25),r.time.events.remove(p.explodeInterval),p.children.map(function(e){n.phaserSprites.destroy(e.name)}),o.destroy(p.name)})},p.damageIt=function(e){t(p),p.isDamaged=!0,r.time.events.add(10,function(){p.isDamaged=!1},n).autoDestroy=!0,p.health-=e,p.tint=16711680,p.game.add.tween(p).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),p.health/p.maxHealth<.5&&(p.isBelow50=!0),p.health/p.maxHealth<.25&&(p.isBelow75=!0),p.health<=0&&p.destroyIt()},p},e.prototype.createSmallEnemy1=function(e,t,a,i){var n=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===i&&(i=function(){});var r=this.game,o=(this.phaserMaster,this.phaserSprites),s=this.phaserGroup,l=this.atlas,p=Phaser.Animation.generateFrameNames("smallShip/small_",1,1).slice(),h=o.addFromAtlas({x:e.x,y:e.y,name:"enemy_"+r.rnd.integer(),group:"enemies",org:"gameobjects",atlas:l,filename:p[0],visible:!0});h.maxHealth=50,this.addSharedBehavior(h),h.yWave={data:this.generateWaveData(200,.6*r.world.height),count:0},h.fireDelay=0,h.fireTimer=1e3,s.add(h.onLayer,h),this.attachHitbox(h,["smallShip/hitbox"]);var u=this.weaponManager.enemyBullet(3);u.bullets.children.map(function(e){});var d=Phaser.Animation.generateFrameNames("bullet_fire_",1,4).slice(),c=this.attachWeaponSystem(h,u,d);return h.onUpdate=function(){h.angle=n.facePlayer(h),h.weaponSystems.map(function(e){e.angle=n.facePlayer(h)-180}),r.time.returnTrueTime()>h.fireDelay&&!h.isDestroyed&&h.y>.4*h.game.canvas.height&&(h.fireDelay=r.time.returnTrueTime()+h.fireTimer,h.weaponSystems.map(function(e){c.fire()})),h.isDestroyed||(h.y=h.yWave.data[h.yWave.count]-h.height,h.yWave.count++,h.yWave.count>=h.yWave.data.length&&h.removeIt(),h.weaponSystems.map(function(e){e.sync(h)})),h.isBelow50&&r.time.returnTrueTime()>h.belowBlinkTimer&&(h.belowBlinkTimer+=500,h.tint=16711680,h.game.add.tween(h).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1)),h.isBelow75&&r.time.returnTrueTime()>h.belowBlinkTimer&&(h.belowBlinkTimer+=250,h.tint=16711680,h.game.add.tween(h).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1)),i(h),h.y>n.game.world.height+h.height&&h.removeIt(),n.bulletCollisionWithPlayer(h)},h.damageIt=function(e){t(h),h.isDamaged=!0,r.time.events.add(10,function(){h.isDamaged=!1},n).autoDestroy=!0,h.health-=e,h.tint=16711680,h.game.add.tween(h).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),h.health<=0&&h.destroyIt()},h.removeIt=function(){h.weaponSystems.map(function(e){e.destroyIt()}),h.children.map(function(e){n.phaserSprites.destroy(e.name)}),o.destroy(h.name)},h.destroyIt=function(){h.isDestroyed=!0,h.tint=16711680,h.weaponSystems.map(function(e){e.destroyIt()}),h.explodeInterval=r.time.events.loop(250,function(){n.effectsManager.createExplosion(h.x+r.rnd.integerInRange(-h.width/2,h.width/2),h.y+r.rnd.integerInRange(-h.height/2,h.height/2),1,h.onLayer+1)}),h.game.add.tween(h).to({y:h.y+50,alpha:.5},500,Phaser.Easing.Linear.Out,!0,250,0,!1).onComplete.add(function(){n.phaserMaster.get("sharedDebris").customFire(h,25),a(h),r.time.events.remove(h.explodeInterval),h.children.map(function(e){n.phaserSprites.destroy(e.name)}),o.destroy(h.name)})},h},e.prototype.createSmallEnemy2=function(e,t,a,i){var n=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===i&&(i=function(){});var r=this.game,o=this.phaserMaster,s=this.phaserSprites,l=this.phaserGroup,p=this.atlas,h=s.addFromAtlas({name:"enemy_"+r.rnd.integer(),group:"enemies",org:"gameobjects",atlas:p,filename:"big_1",visible:!0,x:e.x});h.anchor.setTo(.5,.5),h.scale.setTo(1,1),h.maxHealth=700,h.health=h.maxHealth,h.pierceResistence=1,h.fallThreshold=r.rnd.integerInRange(0,75),h.cosWave={data:r.math.sinCosGenerator(400,.5*r.world.height,0,1).cos,count:0},h.fireDelay=0,h.fireTimer=200,h.isInvincible=!1,h.isDamaged=!1,h.isDestroyed=!1,h.onLayer=o.get("layers").ENEMIES,h.bulletCycle={count:0,total:3,delay:500,lock:!1},h.weaponSystems=[],h.collidables={primaryWeapon:[],secondaryWeapon:[]},l.add(h.onLayer,h);["big_1_hitbox_1","big_1_hitbox_2"].map(function(e){var t=s.addFromAtlas({name:"enemy_hitbox_"+r.rnd.integer(),group:"enemy_hitboxes",atlas:p,filename:e,alpha:n.showHitbox?.75:0});t.anchor.setTo(.5,.5),r.physics.enable(t,Phaser.Physics.ARCADE),h.addChild(t)});var u=this.weaponManager.enemyBullet(9);u.bullets.children.map(function(e){e.damgeOnImpact=10});var d=Phaser.Animation.generateFrameNames("bullet_fire_",1,4).slice(),c=this.phaserSprites.addFromAtlas({name:"enemy_weapons_"+this.game.rnd.integer(),group:"enemy_weapons",atlas:this.atlas_weapons,filename:d[0],visible:!0});return c.anchor.setTo(.5,.5),c.angle=180,c.animations.add("fireWeapon",d,1,!0),c.sync=function(e){var t=e.x,a=e.y;c.x=t,c.y=a},c.destroyIt=function(){var e=c.x,t=c.y;n.effectsManager.blueImpact(e,t,1,h.onLayer),n.phaserSprites.destroy(c.name),r.time.events.add(4*Phaser.Timer.SECOND,function(){c.ammo.destroy()},n).autoDestroy=!0},c.fire=function(){s.get("player");u.fire(c,c.x,c.y+100),u.fire(c,c.x+50,c.y+100),u.fire(c,c.x-50,c.y+100),c.animations.play("fireWeapon",24,!1)},l.add(h.onLayer+1,c),c.ammo=u,h.weaponSystems.push(c),h.collidables.primaryWeapon=[],h.collidables.primaryWeapon.push(u.bullets),h.onUpdate=function(){s.get("player");i(h),r.time.returnTrueTime()>h.fireDelay&&!h.isDestroyed&&h.y>.3*h.game.canvas.height&&(h.fireDelay=r.time.returnTrueTime()+h.fireTimer,h.bulletCycle.count<h.bulletCycle.total?(h.weaponSystems.map(function(e){c.fire()}),h.bulletCycle.count++):h.bulletCycle.lock||(h.bulletCycle.lock=!0,r.time.events.add(1.5*Phaser.Timer.SECOND,function(){h.bulletCycle.count=0,h.bulletCycle.lock=!1}).autoDestroy=!0)),h.isDestroyed||(h.cosWave.count<h.cosWave.data.length/2&&(h.y=-h.cosWave.data[h.cosWave.count]-h.height,h.cosWave.count++),h.cosWave.count>=h.cosWave.data.length&&h.removeIt(),h.weaponSystems.map(function(e){e.sync(h)})),n.bulletCollisionWithPlayer(h)},h.damageIt=function(e){t(h),h.isDamaged=!0,r.time.events.add(10,function(){h.isDamaged=!1},n).autoDestroy=!0,h.health-=e,h.tint=16711680,h.game.add.tween(h).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),h.health<=0&&h.destroyIt()},h.removeIt=function(){h.weaponSystems.map(function(e){e.destroyIt()}),h.children.map(function(e){n.phaserSprites.destroy(e.name)}),s.destroy(h.name)},h.destroyIt=function(){h.isDestroyed=!0,h.tint=16711680,h.weaponSystems.map(function(e){e.destroyIt()}),h.explodeInterval=r.time.events.loop(500,function(){n.effectsManager.createExplosion(h.x+r.rnd.integerInRange(-h.width/2,h.width/2),h.y+r.rnd.integerInRange(-h.height/2,h.height/2),1,h.onLayer+1)}),h.game.add.tween(h.scale).to({x:.85,y:.85},500,Phaser.Easing.Linear.Out,!0,500,0,!1).onComplete.add(function(){n.weaponManager.createExplosionVacuum(h.x,h.y,1.5,h.onLayer+1,10),n.phaserMaster.get("sharedDebris").customFire(h,50),r.time.events.remove(h.explodeInterval),a(h),h.children.map(function(e){n.phaserSprites.destroy(e.name)}),s.destroy(h.name)})},h},e.prototype.createBoss1=function(e,t,a,i){var n=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===i&&(i=function(){});var r=this.game,o=this.phaserMaster,s=this.phaserSprites,l=this.phaserGroup,p=this.atlas,h=s.addFromAtlas({name:"enemy_"+r.rnd.integer(),group:"enemies",org:"gameobjects",atlas:p,filename:"big_1",visible:!0,x:e.x});h.anchor.setTo(.5,.5),h.scale.setTo(1,1),h.maxHealth=15e3,h.health=h.maxHealth,h.pierceResistence=1,h.fallThreshold=r.rnd.integerInRange(0,75),h.cosWave={data:r.math.sinCosGenerator(400,.5*r.world.height,0,1).cos,count:0},h.fireDelay=0,h.fireTimer=200,h.isInvincible=!1,h.isDamaged=!1,h.isDestroyed=!1,h.onLayer=o.get("layers").ENEMIES,h.bulletCycle={count:0,total:3,delay:500,lock:!1},h.weaponSystems=[],h.collidables={primaryWeapon:[],secondaryWeapon:[]},h.trackinbox=null,l.add(h.onLayer,h);var u=["big_1_hitbox_1","big_1_hitbox_2"];u.map(function(e){var t=s.addFromAtlas({name:"enemy_hitbox_"+r.rnd.integer(),group:"enemy_hitboxes",atlas:p,filename:e,alpha:n.showHitbox?.75:0});t.anchor.setTo(.5,.5),r.physics.enable(t,Phaser.Physics.ARCADE),h.addChild(t)});var d=s.addFromAtlas({name:"targetingBox_"+r.rnd.integer(),group:"enemy_hitboxes",width:h.width,height:h.height,atlas:p,filename:u[0],alpha:this.showHitbox?.75:0});d.anchor.setTo(.5,.5),d.sync=function(){var e=s.get("player");d.x=h.x,d.y=h.y,d.angle=Math.ceil(360/(2*Math.PI)*r.math.angleBetween(d.x,d.y,e.x,e.y)-90)},h.targetingBox=d;var c=this.weaponManager.enemyBullet(9);c.bullets.children.map(function(e){e.damgeOnImpact=10});var m=Phaser.Animation.generateFrameNames("bullet_fire_",1,4).slice(),g=this.phaserSprites.addFromAtlas({name:"enemy_weapons_"+this.game.rnd.integer(),group:"enemy_weapons",atlas:this.atlas_weapons,filename:m[0],visible:!0});return g.anchor.setTo(.5,.5),g.angle=180,g.animations.add("fireWeapon",m,1,!0),g.sync=function(e){var t=e.x,a=e.y;g.x=t,g.y=a},g.destroyIt=function(){var e=g.x,t=g.y;n.effectsManager.blueImpact(e,t,1,h.onLayer),n.phaserSprites.destroy(g.name),r.time.events.add(4*Phaser.Timer.SECOND,function(){g.ammo.destroy()},n).autoDestroy=!0},g.fire=function(){s.get("player");c.fire(g,g.x,g.y+100),c.fire(g,g.x+50,g.y+100),c.fire(g,g.x-50,g.y+100),g.animations.play("fireWeapon",24,!1)},l.add(h.onLayer+1,g),g.ammo=c,h.weaponSystems.push(g),h.collidables.primaryWeapon=[],h.collidables.primaryWeapon.push(c.bullets),h.onUpdate=function(){s.get("player");i(h),d.sync(),r.time.returnTrueTime()>h.fireDelay&&!h.isDestroyed&&h.y>.3*h.game.canvas.height&&(h.fireDelay=r.time.returnTrueTime()+h.fireTimer,h.bulletCycle.count<h.bulletCycle.total?(h.weaponSystems.map(function(e){g.fire()}),h.bulletCycle.count++):h.bulletCycle.lock||(h.bulletCycle.lock=!0,r.time.events.add(1.5*Phaser.Timer.SECOND,function(){h.bulletCycle.count=0,h.bulletCycle.lock=!1}).autoDestroy=!0)),h.isDestroyed||(h.cosWave.count<h.cosWave.data.length/2&&(h.y=-h.cosWave.data[h.cosWave.count]-h.height,h.cosWave.count++),h.cosWave.count>=h.cosWave.data.length&&h.removeIt(),h.weaponSystems.map(function(e){e.sync(h)})),n.bulletCollisionWithPlayer(h)},h.damageIt=function(e){t(h),h.isDamaged=!0,r.time.events.add(10,function(){h.isDamaged=!1},n).autoDestroy=!0,h.health-=e,h.tint=16711680,h.game.add.tween(h).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),h.health<=0&&h.destroyIt()},h.removeIt=function(){h.weaponSystems.map(function(e){e.destroyIt()}),h.children.map(function(e){n.phaserSprites.destroy(e.name)}),s.destroy(h.name)},h.destroyIt=function(){h.isDestroyed=!0,h.tint=16711680,h.weaponSystems.map(function(e){e.destroyIt()}),s.destroy(d.name),n.weaponManager.createExplosionVacuum(h.x,h.y,2,h.onLayer+1,10),h.game.add.tween(h).to({y:h.y-100},6e3,Phaser.Easing.Linear.Out,!0,0,0,!1),r.time.events.add(2*Phaser.Timer.SECOND,function(){h.explodeInterval=r.time.events.loop(150,function(){h.tint=16711680,h.game.add.tween(h).to({tint:16777215},50,Phaser.Easing.Linear.Out,!0,0,0,!1),n.effectsManager.createExplosion(h.x+r.rnd.integerInRange(-h.width/2,h.width/2),h.y+r.rnd.integerInRange(-h.height/2,h.height/2),1,h.onLayer+1)}),a(h),h.game.add.tween(h.scale).to({x:.75,y:.75},4500,Phaser.Easing.Linear.Out,!0,0,0,!1).onComplete.add(function(){n.weaponManager.createExplosionVacuum(h.x,h.y,1.5,h.onLayer+1,10),n.phaserMaster.get("sharedDebris").customFire(h),r.time.events.remove(h.explodeInterval),h.children.map(function(e){n.phaserSprites.destroy(e.name)}),s.destroy(h.name)})}).autoDestroy=!0},h},e}(),ITEMSPAWN_MANAGER=function(){function e(){}return e.prototype.assign=function(e,t,a,i,n){this.game=e,this.phaserSprites=a,this.phaserMaster=t,this.phaserGroup=i,this.atlas=n},e.prototype.getDistanceFromPlayer=function(e){var t=this.phaserSprites.get("player");return t.isForceMoved?0:Math.round(Phaser.Math.distance(t.x,t.y,e.x,e.y))},e.prototype.spawnHealthpack=function(e,t,a,i){var n=this;void 0===i&&(i=function(){});var r=Phaser.Animation.generateFrameNames("healthpack_",1,4).slice(),o=this.phaserSprites.addFromAtlas({name:"healthpack_"+this.game.rnd.integer(),group:"itemspawns",x:e,y:t,atlas:this.atlas,filename:r[0]});o.animations.add("animate",r,8,!0),o.animations.play("animate"),o.anchor.setTo(.5,.5),o.blinkLifespan=this.game.time.returnTrueTime()+10*Phaser.Timer.SECOND,o.blinkLifespanInterval=this.game.time.returnTrueTime(),o.blinkLifespanCount=0,this.game.physics.enable(o,Phaser.Physics.ARCADE),o.body.collideWorldBounds=!0,o.body.bounce.setTo(1,1),o.body.velocity.y=this.game.rnd.integerInRange(50,50),o.body.velocity.x=this.game.rnd.integerInRange(-200,200),o.destroyIt=function(){n.phaserSprites.destroy(o.name)},o.pickedUp=function(){n.phaserSprites.destroy(o.name)},o.onUpdate=function(){if(n.getDistanceFromPlayer(o)<200){var e=n.phaserSprites.get("player");n.game.physics.arcade.moveToObject(o,e,400)}n.game.time.returnTrueTime()>o.blinkLifespan&&o.destroyIt(),n.game.time.returnTrueTime()>o.blinkLifespan-3*Phaser.Timer.SECOND&&n.game.time.returnTrueTime()>o.blinkLifespanInterval&&(o.blinkLifespanInterval=n.game.time.returnTrueTime()+200-5*o.blinkLifespanCount,o.alpha=o.blinkLifespanCount%2==0?.25:1,o.blinkLifespanCount++),n.phaserSprites.getManyGroups(["playership"]).map(function(e){e.game.physics.arcade.overlap(o,e,function(e,t){i(),o.pickedUp()},null,o)})},this.phaserGroup.add(this.phaserMaster.get("layers").ITEMDROPS,o)},e.prototype.spawnPowerup=function(e,t,a,i){var n=this;void 0===i&&(i=function(){});var r=Phaser.Animation.generateFrameNames("powerup_",1,4).slice(),o=this.phaserSprites.addFromAtlas({name:"healthpack_"+this.game.rnd.integer(),group:"itemspawns",x:e,y:t,atlas:this.atlas,filename:r[0]});o.animations.add("animate",r,8,!0),o.animations.play("animate"),o.anchor.setTo(.5,.5),o.blinkLifespan=this.game.time.returnTrueTime()+10*Phaser.Timer.SECOND,o.blinkLifespanInterval=this.game.time.returnTrueTime(),o.blinkLifespanCount=0,this.game.physics.enable(o,Phaser.Physics.ARCADE),o.body.collideWorldBounds=!0,o.body.bounce.setTo(1,1),o.body.velocity.y=this.game.rnd.integerInRange(50,50),o.body.velocity.x=this.game.rnd.integerInRange(-200,200),o.destroyIt=function(){n.phaserSprites.destroy(o.name)},o.pickedUp=function(){n.phaserSprites.destroy(o.name)},o.onUpdate=function(){if(n.getDistanceFromPlayer(o)<200){var e=n.phaserSprites.get("player");n.game.physics.arcade.moveToObject(o,e,400)}n.game.time.returnTrueTime()>o.blinkLifespan&&o.destroyIt(),n.game.time.returnTrueTime()>o.blinkLifespan-3*Phaser.Timer.SECOND&&n.game.time.returnTrueTime()>o.blinkLifespanInterval&&(o.blinkLifespanInterval=n.game.time.returnTrueTime()+200-5*o.blinkLifespanCount,o.alpha=o.blinkLifespanCount%2==0?.25:1,o.blinkLifespanCount++),n.phaserSprites.getManyGroups(["playership"]).map(function(e){e.game.physics.arcade.overlap(o,e,function(e,t){i(),o.pickedUp()},null,o)})},this.phaserGroup.add(this.phaserMaster.get("layers").ITEMDROPS,o)},e.prototype.spawnSpecial=function(e,t,a,i){var n=this;void 0===i&&(i=function(){});var r=Phaser.Animation.generateFrameNames("special_",1,5).slice(),o=this.phaserSprites.addFromAtlas({name:"healthpack_"+this.game.rnd.integer(),group:"itemspawns",x:e,y:t,atlas:this.atlas,filename:r[0]});o.animations.add("animate",r,8,!0),o.animations.play("animate"),o.anchor.setTo(.5,.5),o.blinkLifespan=this.game.time.returnTrueTime()+10*Phaser.Timer.SECOND,o.blinkLifespanInterval=this.game.time.returnTrueTime(),o.blinkLifespanCount=0,this.game.physics.enable(o,Phaser.Physics.ARCADE),o.body.collideWorldBounds=!0,o.body.bounce.setTo(1,1),o.body.velocity.y=this.game.rnd.integerInRange(50,50),o.body.velocity.x=this.game.rnd.integerInRange(-200,200),o.destroyIt=function(){n.phaserSprites.destroy(o.name)},o.pickedUp=function(){n.phaserSprites.destroy(o.name)},o.onUpdate=function(){if(n.getDistanceFromPlayer(o)<200){var e=n.phaserSprites.get("player");n.game.physics.arcade.moveToObject(o,e,400)}n.game.time.returnTrueTime()>o.blinkLifespan&&o.destroyIt(),n.game.time.returnTrueTime()>o.blinkLifespan-3*Phaser.Timer.SECOND&&n.game.time.returnTrueTime()>o.blinkLifespanInterval&&(o.blinkLifespanInterval=n.game.time.returnTrueTime()+200-5*o.blinkLifespanCount,o.alpha=o.blinkLifespanCount%2==0?.25:1,o.blinkLifespanCount++),n.phaserSprites.getManyGroups(["playership"]).map(function(e){e.game.physics.arcade.overlap(o,e,function(e,t){i(),o.pickedUp()},null,o)})},this.phaserGroup.add(this.phaserMaster.get("layers").ITEMDROPS,o)},e.prototype.spawnScrap=function(e,t,a,i){var n=this;void 0===i&&(i=function(){});var r=Phaser.Animation.generateFrameNames("scrap_",1,1).slice(),o=this.phaserSprites.addFromAtlas({name:"healthpack_"+this.game.rnd.integer(),group:"itemspawns",x:e,y:t,atlas:this.atlas,filename:r[0]});r.length>1&&(o.animations.add("animate",r,8,!0),o.animations.play("animate")),o.anchor.setTo(.5,.5),o.blinkLifespan=this.game.time.returnTrueTime()+10*Phaser.Timer.SECOND,o.blinkLifespanInterval=this.game.time.returnTrueTime(),o.blinkLifespanCount=0,this.game.physics.enable(o,Phaser.Physics.ARCADE),o.body.collideWorldBounds=!0,o.body.bounce.setTo(1,1),o.body.velocity.y=this.game.rnd.integerInRange(50,50),o.body.velocity.x=this.game.rnd.integerInRange(-200,200),o.destroyIt=function(){n.phaserSprites.destroy(o.name)},o.pickedUp=function(){n.phaserSprites.destroy(o.name)},o.onUpdate=function(){if(n.getDistanceFromPlayer(o)<200){var e=n.phaserSprites.get("player");n.game.physics.arcade.moveToObject(o,e,400)}n.game.time.returnTrueTime()>o.blinkLifespan&&o.destroyIt(),n.game.time.returnTrueTime()>o.blinkLifespan-3*Phaser.Timer.SECOND&&n.game.time.returnTrueTime()>o.blinkLifespanInterval&&(o.blinkLifespanInterval=n.game.time.returnTrueTime()+200-5*o.blinkLifespanCount,o.alpha=o.blinkLifespanCount%2==0?.25:1,o.blinkLifespanCount++),n.phaserSprites.getManyGroups(["playership"]).map(function(e){e.game.physics.arcade.overlap(o,e,function(e,t){i(),o.pickedUp()},null,o)})},this.phaserGroup.add(this.phaserMaster.get("layers").ITEMDROPS,o)},e}(),PLAYER_MANAGER=function(){function e(){}return e.prototype.assign=function(e,t,a,i,n,r,o,s,l,p){this.game=e,this.phaserSprites=a,this.phaserMaster=t,this.phaserTexts=i,this.phaserGroup=n,this.phaserControls=r,this.weaponManager=o,this.effectsManager=s,this.atlas=l,this.weaponAtlas=p,this.player=null},e.prototype.createShip=function(e,t,a,i,n){var r=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===i&&(i=function(){}),void 0===n&&(n=function(){});var o=this.game,s=(e.shipId,this.phaserMaster.getOnly(["gameData"]).gameData),l=(this.phaserMaster.getOnly(["starMomentum"]).starMomentum,this.phaserSprites.addFromAtlas({x:this.game.world.centerX,y:2e3,name:e.name,group:e.group,org:e.org,atlas:this.atlas,filename:"ship_base_form"}));l.anchor.setTo(.5,.5),l.scale.setTo(1,1),l.isInvincible=!1,l.isDead=!0,l.isDamaged=!1,l.isForceMoved=!1,l.ignoreBoundaries=null,l.onLayer=e.layer,l.primaryWeapon=e.primaryWeapon,l.secondaryWeapon=e.secondaryWeapon,l.perk=e.perk,l.explodeInterval=null,l.weaponSystems=[],l.subweaponSystems=[],l.attachments=[],l.xCapture=[],l.yCapture=[],l.clearEnemyBulletsInterval,l.collidables={primaryWeapon:[],secondaryWeapon:[]};var p=Phaser.Animation.generateFrameNames("ship_start_",1,7).slice(),h=Phaser.Animation.generateFrameNames("ship_explode_",1,5).slice(),u=Phaser.Animation.generateFrameNames("ship_explode_",6,7).slice();l.animations.add("shipDamage",["ship_damage","ship_damage","ship_damage","ship_damage","ship_start_7"],1,!0),l.animations.add("shipStart",p,1,!0),l.animations.add("preExplode",h,1,!0),l.animations.add("preExplodeLoop",u,1,!0),o.physics.enable(l,Phaser.Physics.ARCADE),this.phaserGroup.add(this.phaserMaster.get("layers").PLAYER,l);var d=["ship_hitbox_1","ship_hitbox_2"];d.map(function(e,t){var a=r.phaserSprites.addFromAtlas({y:10,name:"player_hitbox_"+o.rnd.integer(),group:"player_hitboxes",atlas:r.atlas,filename:e,alpha:0});a.anchor.setTo(.5,.5),o.physics.enable(a,Phaser.Physics.ARCADE),l.addChild(a)});var c=this.phaserSprites.addFromAtlas({name:"mock_trackingbox_"+o.rnd.integer(),group:"player_trackingBox",atlas:this.atlas,filename:d[0],width:10,height:10,alpha:0});c.sync=function(){c.x=l.x-c.width/2,c.y=l.y-o.canvas.height/2},l.defaultTargetingBox=c,l.targetBox=c;var m=Phaser.Animation.generateFrameNames("ship_fullpower_",1,7).concat(Phaser.Animation.generateFrameNames("ship_fullpower__",1,7).reverse()),g=this.phaserSprites.addFromAtlas({name:"ship_fullpower_addon",atlas:this.atlas,filename:m[0],visible:!1});return g.anchor.setTo(.5,.5),g.animations.add("fullpower",m,1,!0),g.animations.play("fullpower",45,!0),l.addChild(g),l.clearAllEnemyBullets=function(e){l.clearEnemyBulletsInterval=o.time.returnTrueTime()+e},l.assignTarget=function(e){l.targetBox=e},l.removeTarget=function(){l.isForceMoved=!0,l.game.add.tween(l).to({angle:0},500,Phaser.Easing.Linear.Out,!0,100,0,!1).onComplete.add(function(){l.targetBox=c,l.isForceMoved=!1})},l.getDistanceFromTargetingBox=function(){return Math.round(Phaser.Math.distance(l.x,l.y,l.defaultTargetingBox.x,l.defaultTargetingBox.y))},l.onUpdate=function(){g.visible=s.player.powerup>=30,l.targetBox&&!l.isForceMoved&&(l.angle=Math.ceil(360/(2*Math.PI)*o.math.angleBetween(l.x,l.y,l.targetBox.x,l.targetBox.y)+90)),l.isForceMoved||(l.alpha=l.isInvincible&&!l.isDead?.5:1),c.sync(),l.isDead||(l.xCapture.length>0&&(l.x+=l.xCapture[0],l.xCapture.shift()),l.yCapture.length>0&&(l.y+=l.yCapture[0],l.yCapture.shift()),l.ignoreBoundaries||l.checkLimits());var e=[];l.weaponSystems.concat(l.subweaponSystems).map(function(t){t.angle=l.angle,t.onUpdate(),t.sync(l),e.push(t.ammo.bullets)}),r.bulletCollisionDetection(),l.attachments.map(function(e){e.sync(l)}),n(l)},l.restoreHealth=function(e){var a=r.phaserMaster.getOnly(["gameData"]).gameData.player.health+e;a>100&&(a=100),t(a)},l.takeDamage=function(e){a(l);var n=r.phaserMaster.getOnly(["gameData"]).gameData.player.health-e;t(n),n>0?(l.animations.play("shipDamage",45,!1),l.isDamaged=!0,o.time.events.add(250,function(){l.isDamaged=!1},r).autoDestroy=!0,l.tint=16711680,l.alpha=.75,l.game.add.tween(l).to({tint:16777215,alpha:1},10,Phaser.Easing.Linear.Out,!0,100,0,!1).onComplete.add(function(){o.time.events.add(500,function(){l.isInvincible=!1},r).autoDestroy=!0})):(l.isDestroyed(),o.time.events.add(500,function(){i(l)}).autoDestroy=!0)},l.isDestroyed=function(e){void 0===e&&(e=!0),l.isDead||(l.isDead=!0,l.isInvincible=!0,l.destroyWeaponSystems(),l.onUpdate(),l.explodeInterval=o.time.events.loop(250,function(){r.effectsManager.createExplosion(l.x+o.rnd.integerInRange(-l.width/2,l.width/2),l.y+o.rnd.integerInRange(-l.height/2,l.height/2),1,l.onLayer+1)}),r.effectsManager.createExplosion(l.x,l.y,1,6),o.add.tween(r).to({angle:o.rnd.integerInRange(-90,90),alpha:0},1e3,Phaser.Easing.Linear.In,!0,0).onComplete.add(function(){r.weaponManager.createExplosionVacuum(l.x,l.y,1.5,l.onLayer+1,10);var e=r.effectsManager.debris(100);(e=e).customFire(l),o.time.events.remove(l.explodeInterval),l.visible=!1}))},l.destroyWeaponSystems=function(){l.weaponSystems.map(function(e){e.destroyIt(),e.ammo.destroy()}),l.weaponSystems=[]},l.attachPerk=function(t){r.attachPerk(l,e,t)},l.attachWeapon=function(t){var a;switch(t){case"BULLET":a=r.attachBullet(l,e,t);break;case"SPREAD":a=r.attachSpread(l,e,t);break;case"LASER":a=r.attachLaser(l,e,t);break;case"MISSLE":a=r.attachMissle(l,e,t);break;case"SHOTGUN":a=r.attachShotgun(l,e,t);break;case"GATLING":a=r.attachGatling(l,e,t)}l.collidables.primaryWeapon=[],a.map(function(e){l.collidables.primaryWeapon.push(e.ammo.bullets)})},l.attachSubweapon=function(t){var a;switch(t){case"CLUSTERBOMB":a=r.attachClusterbomb(l,e,t)}l.collidables.secondaryWeapon=[],a.map(function(e){l.collidables.secondaryWeapon.push(e.ammo.bullets),e.ammo.bomblets&&e.ammo.bomblets.map(function(e){l.collidables.secondaryWeapon.push(e.bullets)})})},l.fireWeapon=function(){l.weaponSystems.map(function(e){e.fire()})},l.fireSubweapon=function(){l.subweaponSystems.map(function(e){e.fire()})},l.regenerateHealth=function(e){void 0===e&&(e=!1)},l.moveX=function(e){l.xCapture[0]=e},l.moveY=function(e){l.yCapture[0]=e},l.checkLimits=function(){this.y-this.height<0&&(this.y=this.height),this.y+this.height>this.game.world.height&&(this.y=this.game.world.height-this.height),this.x<0&&(this.x=0),this.x>this.game.world.width+this.width&&(this.x=this.game.world.width+this.width)},l.moveTo=function(e,t,a,i){void 0===i&&(i=function(){}),l.isInvincible=!0,l.isForceMoved=!0,r.phaserControls.disableAllInput(),o.add.tween(l).to({x:e,y:t},a,Phaser.Easing.Exponential.InOut,!0,0,0,!1).onComplete.add(function(){l.isInvincible=!1,l.isForceMoved=!1,r.phaserControls.enableAllInput(),i()})},l.moveToStart=function(e){void 0===e&&(e=function(){}),l.isDead=!1,l.isInvincible=!0,l.ignoreBoundaries=!0,l.x=r.game.world.centerX,l.y=2*r.game.world.height,o.time.events.add(150,function(){l.alpha=1,l.visible=!0,o.add.tween(l).to({y:o.world.centerY+100},1e3,Phaser.Easing.Exponential.InOut,!0,0,0,!1).onComplete.add(function(){l.ignoreBoundaries=!1,r.phaserControls.enableAllInput(),l.attachWeapon(l.primaryWeapon),l.attachSubweapon(l.secondaryWeapon),l.animations.play("shipStart",12,!1),o.time.events.add(1e3,function(){l.isInvincible=!1,e()}).autoDestroy=!0})}).autoDestroy=!0},l.playEndSequence=function(e){l.isInvincible=!0,l.game.add.tween(l.scale).to({x:2,y:2},750,Phaser.Easing.Exponential.InOut,!0,0,0,!1),l.game.add.tween(l).to({x:o.world.centerX,y:o.world.centerY+50},750,Phaser.Easing.Exponential.InOut,!0,0,0,!1).onComplete.add(function(){l.game.add.tween(l).to({y:o.world.height+200},750,Phaser.Easing.Exponential.InOut,!0,100,0,!1).onComplete.add(function(){l.game.add.tween(l).to({y:-200},1e3,Phaser.Easing.Exponential.InOut,!0,0,0,!1).onComplete.add(function(){e()},l)},l)},l)},this.player=l,l},e.prototype.attachPerk=function(e,t,a){var i,n,r,o=this;switch(a){case"FIREPOWER":i=Phaser.Animation.generateFrameNames("firepower_",1,8).concat(Phaser.Animation.generateFrameNames("firepower_",1,8).reverse()),n=30;break;case"ARMORPLATING":i=["armor_plating"],n=30;break;case"REGEN":i=Phaser.Animation.generateFrameNames("shield_layer_",1,8).slice(),n=30}void 0!==this.phaserSprites.get(t.name+"_ship_perk")&&this.phaserSprites.destroy(t.name+"_ship_perk"),"REGEN"===a?((r=this.phaserSprites.addFromAtlas({name:t.name+"_ship_perk",atlas:this.atlas,filename:i[0],alpha:.5})).anchor.setTo(.5,.5),r.scale.set(1.25,1.25),r.tweenFadeIn=function(){o.game.add.tween(r).to({alpha:.8},1e3,Phaser.Easing.Linear.In,!0,8e3).onComplete.add(function(){e.regenerateHealth(!0),r.tweenFadeOut()})},r.tweenFadeOut=function(){o.game.add.tween(r).to({alpha:0},1e3,Phaser.Easing.Linear.In,!0,1e3).onComplete.add(function(){e.regenerateHealth(!1),r.tweenFadeIn()})},this.game.time.events.add(1e3,function(){void 0!==r&&r.tweenFadeOut()}).autoDestroy=!0,r.animations.add("animate",i,1,!0),r.animations.play("animate",n,!0),e.addChild(r)):((r=this.phaserSprites.addFromAtlas({name:t.name+"_ship_perk",atlas:this.atlas,filename:i[0],visible:!0})).anchor.setTo(.5,.5),r.animations.add("animate",i,1,!0),r.animations.play("animate",n,!0),e.addChild(r))},e.prototype.attachLaser=function(e,t,a){for(var i=this,n=Phaser.Animation.generateFrameNames("laser_fire_",1,1).slice(),r=function(t){var r=o.phaserSprites.addFromAtlas({name:"ship_weapon_"+o.game.rnd.integer(),atlas:o.weaponAtlas,filename:n[0],alpha:0});r.anchor.setTo(.5,.5),n.length>0&&r.animations.add("fireWeapon",n,1,!0),r.offset=15*t-45,r.index=t,r.onUpdate=function(){},r.sync=function(e){var t=e.x,a=e.y,n=(e.angle,i.weaponManager.calculateRotateCoords(r.offset,e.targetBox));r.x=t+n.x,r.y=a+n.y},r.destroyIt=function(){i.phaserSprites.destroy(r.name)},r.fire=function(){var e=i.phaserMaster.getOnly(["gameData"]).gameData,t=Math.floor((e.player.powerup-1)/5);n.length>0&&r.animations.play("fireWeapon",60,!1),s.fireAngle=270+r.angle,0===t&&3===r.index&&s.fireOffset(0,0),1!==t||2!==r.index&&4!==r.index||s.fireOffset(0,0),2!==t||2!==r.index&&3!==r.index&&4!==r.index||s.fireOffset(0,0),3!==t||1!==r.index&&2!==r.index&&4!==r.index&&5!==r.index||s.fireOffset(0,0),4!==t||1!==r.index&&2!==r.index&&3!==r.index&&4!==r.index&&5!==r.index||s.fireOffset(0,0),5===t&&s.fireOffset(0,0)},o.phaserGroup.add(o.phaserMaster.get("layers").PLAYER_OVER,r);var s=o.weaponManager.playerBullets(3,a);s.checkOrientation(r.angle),s.onUpdate=function(){},s.trackSprite(r,0,0),s.weaponSystem=r,r.ammo=s,e.weaponSystems.push(r)},o=this,s=0;s<7;s++)r(s);return e.weaponSystems},e.prototype.attachShotgun=function(e,t,a){for(var i=this,n=Phaser.Animation.generateFrameNames("bullet_fire_",1,4).slice(),r=function(t){var r=o.phaserSprites.addFromAtlas({name:"ship_weapon_"+o.game.rnd.integer(),atlas:o.weaponAtlas,filename:n[0],alpha:0});r.anchor.setTo(.5,.5),n.length>0&&r.animations.add("fireWeapon",n,1,!0),r.offset=20*t-0,r.index=t,r.onUpdate=function(){s.onUpdate()},r.sync=function(e){var t=e.x,a=e.y,n=i.weaponManager.calculateRotateCoords(r.offset,e.targetBox);r.x=t+n.x,r.y=a+n.y},r.destroyIt=function(){i.phaserSprites.destroy(r.name)},r.fire=function(){for(var e=i.phaserMaster.getOnly(["gameData"]).gameData,t=Math.floor((e.player.powerup-1)/5),a=0;a<5*(t+1);a++)s.fireAngle=270+r.angle,s.fire(r,null,r+1);n.length>0&&r.animations.play("fireWeapon",60,!1)},o.phaserGroup.add(o.phaserMaster.get("layers").PLAYER_OVER,r);var s=o.weaponManager.playerBullets(60,a);s.checkOrientation(r.angle),s.onUpdate=function(){},s.trackSprite(r,0,0),r.ammo=s,e.weaponSystems.push(r)},o=this,s=0;s<1;s++)r(s);return e.weaponSystems},e.prototype.attachBullet=function(e,t,a){for(var i=this,n=Phaser.Animation.generateFrameNames("bullet_fire_",1,4).slice(),r=function(t){var r=o.phaserSprites.addFromAtlas({name:"ship_weapon_"+o.game.rnd.integer(),atlas:o.weaponAtlas,filename:n[0],alpha:0});r.anchor.setTo(.5,.5),n.length>0&&r.animations.add("fireWeapon",n,1,!0),r.offset=15*t-82.5,r.index=t,r.onUpdate=function(){},r.sync=function(e){var t=e.x,a=e.y,n=i.weaponManager.calculateRotateCoords(r.offset,e.targetBox);r.x=t+n.x,r.y=a+n.y},r.destroyIt=function(){var t=r.x,a=r.y;i.effectsManager.blueImpact(t,a,1,e.onLayer),i.phaserSprites.destroy(r.name)},r.fire=function(){var t=i.phaserMaster.getOnly(["gameData"]).gameData,a=Math.floor((t.player.powerup-1)/5);i.weaponManager.calculateRotateCoords(30,e.targetBox);s.fireAngle=270+r.angle,a>=0&&(5===r.index||6===r.index)&&s.fireOffset(0,0),a>=1&&(4===r.index||7===r.index)&&s.fireOffset(0,0),a>=2&&(3===r.index||8===r.index)&&s.fireOffset(0,0),a>=3&&(2===r.index||9===r.index)&&s.fireOffset(0,0),a>=4&&(1===r.index||10===r.index)&&s.fireOffset(0,0),a>=5&&(0===r.index||11===r.index)&&s.fireOffset(0,0)},o.phaserGroup.add(o.phaserMaster.get("layers").PLAYER_OVER,r);var s=o.weaponManager.playerBullets(3,a);s.checkOrientation(r.angle),s.onUpdate=function(){},s.trackSprite(r),r.ammo=s,e.weaponSystems.push(r)},o=this,s=0;s<12;s++)r(s);return e.weaponSystems},e.prototype.attachSpread=function(e,t,a){for(var i=this,n=Phaser.Animation.generateFrameNames("bullet_fire_",1,4).slice(),r=this.phaserMaster.getOnly(["gameData"]).gameData,o=Math.floor((r.player.powerup-1)/5),s=5===o?2:1,l=function(t){var r=p.phaserSprites.addFromAtlas({name:"ship_weapon_"+p.game.rnd.integer(),atlas:p.weaponAtlas,filename:n[0],alpha:0});r.anchor.setTo(.5,.5),n.length>0&&r.animations.add("fireWeapon",n,1,!0),r.offset=20*t-10*(s-1),r.onUpdate=function(){h.onUpdate()},r.sync=function(e){var t=e.x,a=e.y,i=e.angle;r.x=t+r.offset,r.y=a,r.angle=i},r.destroyIt=function(){var t=r.x,a=r.y;i.effectsManager.blueImpact(t,a,1,e.onLayer),i.phaserSprites.destroy(r.name)},r.fire=function(){var t,a=i.phaserMaster.getOnly(["gameData"]).gameData,o=Math.floor((a.player.powerup-1)/5);n.length>0&&r.animations.play("fireWeapon",60,!1);var s=Math.abs(e.getDistanceFromTargetingBox()/Math.round(Phaser.Math.distance(e.x,e.y,e.targetBox.x,e.targetBox.y)));o>=0&&h.fire(r,e.targetBox.x,e.targetBox.y-1),o>=1&&(t=i.weaponManager.calculateSpread(50,e.targetBox),h.fire(r,t.x1,t.y1),h.fire(r,t.x2,t.y2)),o>=2&&(t=i.weaponManager.calculateSpread(100/s,e.targetBox),h.fire(r,t.x1,t.y1),h.fire(r,t.x2,t.y2)),o>=3&&(t=i.weaponManager.calculateSpread(150/s,e.targetBox),h.fire(r,t.x1,t.y1),h.fire(r,t.x2,t.y2)),o>=4&&(t=i.weaponManager.calculateSpread(200/s,e.targetBox),h.fire(r,t.x1,t.y1),h.fire(r,t.x2,t.y2)),o>=5&&(t=i.weaponManager.calculateSpread(250/s,e.targetBox),h.fire(r,t.x1,t.y1),h.fire(r,t.x2,t.y2))},p.phaserGroup.add(p.phaserMaster.get("layers").PLAYER_OVER,r);var l=12*(o+2),h=p.weaponManager.playerBullets(l,a);h.checkOrientation(r.angle),h.onUpdate=function(){},r.ammo=h,e.weaponSystems.push(r)},p=this,h=0;h<s;h++)l(h);return e.weaponSystems},e.prototype.attachMissle=function(e,t,a){for(var i=this,n=Phaser.Animation.generateFrameNames("missle_fire_",1,4).slice(),r=this.phaserMaster.getOnly(["gameData"]).gameData,o=Math.floor((r.player.powerup-1)/5),s=5===o?2:1,l=function(t){var r=p.phaserSprites.addFromAtlas({name:"ship_weapon_"+p.game.rnd.integer(),atlas:p.weaponAtlas,filename:n[0],alpha:0});r.anchor.setTo(.5,.5),n.length>0&&r.animations.add("fireWeapon",n,1,!0),r.offset=20*t-10*(s-1),r.onUpdate=function(){},r.sync=function(e){var t=e.x,a=e.y,n=i.weaponManager.calculateRotateCoords(r.offset,e.targetBox);r.x=t+n.x,r.y=a+n.y},r.destroyIt=function(){r.x,r.y},r.fire=function(){var e=i.phaserMaster.getOnly(["gameData"]).gameData,t=Math.floor((e.player.powerup-1)/5);n.length>0&&r.animations.play("fireWeapon",60,!1),h.fireAngle=270+r.angle,h.fire(r),0===t&&(h.fire(r),h.fire(r)),t>=1&&(h.fire(r),h.fire(r)),t>=3&&(h.fire(r),h.fire(r)),t>=4&&(h.fire(r),h.fire(r)),t>=5&&(h.fire(r),h.fire(r))},p.phaserGroup.add(p.phaserMaster.get("layers").PLAYER_OVER,r);var l=8*(o+2),h=p.weaponManager.playerBullets(l,a);h.checkOrientation(r.angle),h.onUpdate=function(){},r.ammo=h,e.weaponSystems.push(r)},p=this,h=0;h<s;h++)l(h);return e.weaponSystems},e.prototype.attachGatling=function(e,t,a){for(var i=this,n=Phaser.Animation.generateFrameNames("missle_fire_",1,4).slice(),r=this.phaserMaster.getOnly(["gameData"]).gameData,o=(Math.floor((r.player.powerup-1)/5),function(t){var r=s.phaserSprites.addFromAtlas({name:"ship_weapon_"+s.game.rnd.integer(),atlas:s.weaponAtlas,filename:n[0],visible:!0});r.anchor.setTo(.5,.5),n.length>0&&r.animations.add("fireWeapon",n,1,!0),r.offset=20*t-0,r.onUpdate=function(){},r.sync=function(e){var t=e.x,a=e.y,n=i.weaponManager.calculateRotateCoords(r.offset,e.targetBox);r.x=t+n.x,r.y=a+n.y},r.destroyIt=function(){i.phaserSprites.destroy(r.name)},r.fire=function(){var e=i.phaserMaster.getOnly(["gameData"]).gameData,t=Math.floor((e.player.powerup-1)/5);n.length>0&&r.animations.play("fireWeapon",60,!1),o.fireAngle=270+r.angle,0==t&&o.fire(r),t>=1&&(i.game.time.events.add(50,function(){o.fire(r)}).autoDestroy=!0),t>=2&&(i.game.time.events.add(100,function(){o.fire(r)}).autoDestroy=!0),t>=3&&(i.game.time.events.add(150,function(){o.fire(r)}).autoDestroy=!0),t>=4&&(i.game.time.events.add(200,function(){o.fire(r)}).autoDestroy=!0),t>=5&&(i.game.time.events.add(50,function(){o.fire(r)}).autoDestroy=!0)},s.phaserGroup.add(s.phaserMaster.get("layers").PLAYER_OVER,r);var o=s.weaponManager.playerBullets(12,a);o.checkOrientation(r.angle),o.onUpdate=function(){},r.ammo=o,e.weaponSystems.push(r)}),s=this,l=0;l<1;l++)o(l);return e.weaponSystems},e.prototype.attachClusterbomb=function(e,t,a){var i=Phaser.Animation.generateFrameNames("laser_fire_",1,6).slice(),n=this.phaserSprites.addFromAtlas({name:"ship_weapon_"+this.game.rnd.integer(),atlas:this.weaponAtlas,filename:i[0],alpha:0});n.anchor.setTo(.5,.5),i.length>0&&n.animations.add("fireWeapon",i,1,!0),n.onUpdate=function(){r.onUpdate()},n.sync=function(e){var t=e.x,a=e.y;n.x=t,n.y=a},n.destroyIt=function(){n.x,n.y},n.fire=function(){r.fire(n,e.targetBox.x,e.targetBox.y-1)},this.phaserGroup.add(this.phaserMaster.get("layers").PLAYER_OVER,n);var r=this.weaponManager.createClusterbomb(4,function(){e.clearAllEnemyBullets(2*Phaser.Timer.SECOND)});return r.onUpdate=function(){},n.ammo=r,e.subweaponSystems.push(n),e.subweaponSystems},e.prototype.damgePopup=function(e,t){var a=this,i=e.x,n=e.y;e.width,e.height;this.game.time.events.add(this.game.rnd.integerInRange(0,150),function(){var e=a.phaserTexts.add({name:"enemy_"+a.game.rnd.integer(),group:"ui",font:"gem",x:i+a.game.rnd.integerInRange(-20,20),y:n+a.game.rnd.integerInRange(-20,20),size:12,default:t});a.game.add.tween(e.scale).to({x:1.5,y:1.5},250,Phaser.Easing.Back.In,!0,0,0,!1),a.game.add.tween(e).to({y:e.y+10},250,Phaser.Easing.Back.In,!0,0,0,!1).onComplete.add(function(){a.game.add.tween(e).to({y:e.y-10,alpha:0},250,Phaser.Easing.Bounce.Out,!0,0,0,!1).onComplete.add(function(){a.phaserTexts.destroy(e.name)})})},this).autoDestroy=!0},e.prototype.bulletCollisionDetection=function(){var e=this,t=this.phaserSprites.getGroup("enemy_hitboxes").slice(),a=this.player.collidables.primaryWeapon.concat(this.player.collidables.secondaryWeapon);this.phaserSprites.getManyGroups(["impactExplosions"]).map(function(e){a.push(e)}),this.game.physics.arcade.overlap(t,a,function(t,a){var i=t.parent;if(!i.isDestroyed){var n=a.weaponData;if(!i.isDamaged&&!i.isDestroyed||n.ignoreDamageState&&!i.isDestroyed){if("LASER"===n.reference){e.weaponManager.calculateRotateCoords(0,e.player.targetBox);e.effectsManager.electricDischarge(i.x+e.game.rnd.integerInRange(-10,10),i.y+e.game.rnd.integerInRange(-10,10),1,i.onLayer+1)}"SPREAD"===n.reference&&e.effectsManager.blueImpact(a.x,a.y,1,i.onLayer+1),"SHOTGUN"===n.reference&&e.effectsManager.pelletImpact(a.x,a.y,1,i.onLayer+1),"GATLING"===n.reference&&e.effectsManager.pelletImpact(a.x,a.y,1,i.onLayer+1),"BULLET"===n.reference&&e.effectsManager.orangeImpact(a.x,a.y,1,i.onLayer+1),"MISSLE"===n.reference&&e.weaponManager.createExplosionBasic(a.x,a.y,1,i.onLayer+1,Math.round(n.damage/2)),e.damgePopup(i,n.damage),i.damageIt(n.damage)}n.pierce||n.completeAnimation||a.destroyIt(i.onLayer-1)}})},e.prototype.destroyShip=function(e){this.phaserSprites.destroy(e),this.phaserSprites.destroy(e+"_exhaust"),this.phaserSprites.getGroup(e+"_trails").map(function(e){e.destroySelf()})},e}(),UTILITY_MANAGER=function(){function e(){}return e.prototype.assign=function(e,t,a,i,n,r){this.game=e,this.phaserSprites=a,this.phaserMaster=t,this.phaserBitmapdata=i,this.phaserGroup=n,this.atlas=r},e.prototype.buildOverlayBackground=function(e,t,a,i){void 0===i&&(i=!1);var n=this.game,r=this.phaserBitmapdata.addGradient({name:"um_overlay__bmd",start:e,end:t,width:5,height:5,render:!1}),o=this.phaserSprites.add({x:0,y:0,name:"um_overlay__bg",width:n.world.width,height:n.world.height,reference:r.cacheBitmapData,visible:i});o.flash=function(e,t){void 0===e&&(e=500),void 0===t&&(t=function(){}),o.visible=!0,o.alpha=1,n.time.events.add(250,function(){n.add.tween(o).to({alpha:0},e,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){}),t()}).autoDestroy=!0},o.fadeIn=function(e,t){void 0===e&&(e=500),void 0===t&&(t=function(){}),o.visible=!0,o.alpha=0,n.add.tween(o).to({alpha:1},e,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){t()})},o.fadeOut=function(e,t){void 0===e&&(e=500),void 0===t&&(t=function(){}),o.visible=!0,o.alpha=1,n.add.tween(o).to({alpha:0},e,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){t()})},this.phaserGroup.add(this.phaserMaster.get("layers").OVERLAY,o)},e.prototype.buildOverlayGrid=function(e,t,a,i){void 0===e&&(e=80),void 0===t&&(t=80);for(var n=this.game,r=0,o=0;o<Math.ceil(n.world.height/t)+1;o++)for(var s=function(a){var s=l.phaserSprites.addFromAtlas({x:a*e,y:o*t,name:"grid"+r,group:"um_grid__bg",width:e,height:t,atlas:l.atlas,filename:i,visible:!0});s.anchor.setTo(.5,.5),s.scale.setTo(1,1),s.fadeOut=function(e){s.scale.setTo(1,1),n.add.tween(s).to({height:0},e,Phaser.Easing.Linear.Out,!0,0,0,!1)},s.fadeIn=function(e){n.add.tween(s).to({height:t},e,Phaser.Easing.Linear.In,!0,0,0,!1)},s.scaleOut=function(e){n.add.tween(s.scale).to({x:0,y:0},e,Phaser.Easing.Linear.In,!0,0,0,!1)},s.scaleIn=function(e){n.add.tween(s.scale).to({x:1,y:1},e,Phaser.Easing.Linear.Out,!0,0,0,!1)},r++,l.phaserGroup.add(l.phaserMaster.get("layers").OVERLAY,s)},l=this,p=0;p<Math.ceil(n.world.width/e)+1;p++)s(p)},e.prototype.overlayBGControls=function(e,t){var a=e.transition,i=e.delay,n=e.speed,r=this.phaserSprites.getOnly(["um_overlay__bg"]).um_overlay__bg;this.game.time.events.add(i,function(){switch(a){case"FLASHWHITE":r.flash(n,t);break;case"FADEIN":r.fadeIn(n,t);break;case"FADEOUT":r.fadeOut(n,t)}}).autoDestroy=!0},e.prototype.overlayControls=function(e,t){var a=this.game,i=e.transition,n=e.delay,r=e.speed,o=e.tileDelay,s=this.phaserSprites.getGroup("um_grid__bg"),l=[],p=[],h=o*s.length*.75,u=h+o*s.length;a.time.events.add(n,function(){switch(i){case"WIPEIN":s.map(function(e,t){t%2==0?p.push(e):l.push(e)}),p.map(function(e,t){a.time.events.add(o*t,function(){e.scaleIn(r)}).autoDestroy=!0}),a.time.events.add(u,function(){l.slice(0).reverse().map(function(e,t){a.time.events.add(o*t,function(){e.scaleIn(r)}).autoDestroy=!0})},h),a.time.events.add(u,function(){t()}).autoDestroy=!0;break;case"WIPEOUT":s.map(function(e,t){t%2==0?p.push(e):l.push(e)}),p.map(function(e,t){a.time.events.add(o*t,function(){e.scaleOut(r)}).autoDestroy=!0}),a.time.events.add(u,function(){l.slice(0).reverse().map(function(e,t){a.time.events.add(o*t,function(){e.scaleOut(r)}).autoDestroy=!0})},h),a.time.events.add(u,function(){t()}).autoDestroy=!0;break;case"FADEOUT":s.map(function(e,t){a.time.events.add(o*t,function(){e.fadeOut(r)}).autoDestroy=!0}),a.time.events.add(s.length*o+r,function(){t()}).autoDestroy=!0;break;case"FADEIN":s.map(function(e,t){a.time.events.add(u,function(){e.fadeIn(r)},o*t)}),a.time.events.add(u,function(){t()},s.length*o+r)}}).autoDestroy=!0},e}(),WEAPON_MANAGER=function(){function e(){}return e.prototype.assign=function(e,t,a,i,n,r){this.game=e,this.phaserSprites=a,this.phaserMaster=t,this.phaserGroup=i,this.effectsManager=n,this.atlas=r},e.prototype.calculateRotateCoords=function(e,t){var a,i=t.angle,n=Math.abs(t.angle);n>90&&(n=Math.abs(n-180)),i>=0&&i<90&&(a=0),i>=90&&i<180&&(a=1),i>=-180&&i<-90&&(a=2),i>=-90&&i<0&&(a=3);var r=Math.round(e-e*(n/90)),o=Math.round(e*(n/90));return{x:r=1===a?-r:r,y:o=3===a?-o:o}},e.prototype.calculateSpread=function(e,t){var a,i=t.angle,n=Math.abs(t.angle);n>90&&(n=Math.abs(n-180)),i>=0&&i<90&&(a=0),i>=90&&i<180&&(a=1),i>=-180&&i<-90&&(a=2),i>=-90&&i<0&&(a=3);var r=Math.round(e-e*(n/90)),o=Math.round(e*(n/90));return r=1===a?-r:r,o=3===a?-o:o,{x1:t.x+r,y1:t.y+o,x2:t.x-r,y2:t.y-o}},e.prototype.enemyBullet=function(e){var t=this;void 0===e&&(e=2);var a=this.game,i=(this.phaserMaster,a.add.weapon(e,this.atlas,"enemy_bullet"));return i.bulletKillType=Phaser.Weapon.KILL_CAMERA_BOUNDS,i.bulletSpeed=400,i.bulletAngleOffset=90,i.multiFire=!0,i.checkOrientation=function(e){i.bulletSpeed=-Math.abs(i.bulletSpeed),i.bulletAngleOffset=-Math.abs(i.bulletAngleOffset)},this.phaserGroup.add(this.phaserMaster.get("layers").ENEMY_BULLETS,i.bullets),i.bullets.children.map(function(e){e.destroyIt=function(a){e.kill(),t.effectsManager.orangeImpact(e.x+t.game.rnd.integerInRange(-5,5),e.y+t.game.rnd.integerInRange(-5,15),1,a)}}),i},e.prototype.playerBullets=function(e,t){var a=this.game,i=this.phaserMaster.getAll(["weaponData"]).weaponData.primaryWeapons[t],n=a.add.weapon(e,this.atlas,i.spriteAnimation[0]);switch(n.bulletKillType=Phaser.Weapon.KILL_CAMERA_BOUNDS,n.bulletSpeed=i.bulletSpeed,n.bulletAngleOffset=90,n.multiFire=!0,i.spriteAnimation.length>0&&(n.bullets.callAll("animations.add","animations","fire",i.spriteAnimation,20,!0),n.bullets.callAll("play",null,"fire")),t){case"MISSLE":n.bulletSpeedVariance=300,n.bulletAngleVariance=15;break;case"SHOTGUN":n.bulletSpeedVariance=1e3,n.bulletAngleOffset=-10,n.bulletAngleVariance=20;break;case"GATLING":n.bulletSpeedVariance=300,n.bulletAngleVariance=3}return n.onKill.add(function(e){}),n.checkOrientation=function(e){e<180?(n.bulletSpeed=Math.abs(n.bulletSpeed),n.bulletAngleOffset=Math.abs(n.bulletAngleOffset)):(n.bulletSpeed=-Math.abs(n.bulletSpeed),n.bulletAngleOffset=-Math.abs(n.bulletAngleOffset))},this.phaserGroup.add(this.phaserMaster.get("layers").PLAYER_BULLETS,n.bullets),n.bullets.children.map(function(e){e.weaponData=i,e.pierce=i.pierce,e.destroyIt=function(t){e.kill()}}),n},e.prototype.createClusterbomb=function(e,t){var a=this;void 0===t&&(t=function(){});var i=this.game,n=this.phaserMaster,r=(this.phaserSprites,this.phaserGroup,this.atlas,n.getAll().weaponData.secondaryWeapons.CLUSTERBOMB),o=this.createBomblet(25),s=i.add.weapon(1,this.atlas,r.spriteAnimation[0]);return s.bulletKillType=Phaser.Weapon.KILL_LIFESPAN,s.bulletSpeed=r.bulletSpeed,s.bulletAngleOffset=90,s.multiFire=!0,s.bulletLifespan=750,s.bomblets=o,r.spriteAnimation.length>0&&(s.bullets.callAll("animations.add","animations","fire",r.spriteAnimation,20,!0),s.bullets.callAll("play",null,"fire")),s.onKill.add(function(e){t(),o.map(function(t){t.fire(e)}),a.createExplosionVacuum(e.x,e.y,1.25,8,r.damage)}),s.bullets.children.map(function(e){e.weaponData=r,e.pierce=r.pierce,e.destroyIt=function(t){e.kill()}}),this.phaserGroup.add(this.phaserMaster.get("layers").SPECIAL_WEAPON,s.bullets),s},e.prototype.createBomblet=function(e){for(var t=this,a=this.game,i=this.phaserMaster,n=(this.phaserSprites,this.phaserGroup,this.atlas,i.getAll().weaponData,{reference:"BOMBLET",spriteAnimation:["bomblet"],damage:25,pierce:!1,ignoreDamageState:!1,completeAnimation:!1}),r=[],o=0;o<e;o++){var s=a.add.weapon(1,this.atlas,n.spriteAnimation[0]);s.bulletKillType=Phaser.Weapon.KILL_LIFESPAN,s.bulletSpeed=500+a.rnd.integerInRange(50,150),s.bulletAngleVariance=140,s.bulletLifespan=a.rnd.integerInRange(50,500),n.spriteAnimation.length>0&&(s.bullets.callAll("animations.add","animations","fire",n.spriteAnimation,20,!0),s.bullets.callAll("play",null,"fire")),s.onKill.add(function(e){t.createExplosionBasic(e.x,e.y,1.25,t.phaserMaster.get("layers").SPECIAL_WEAPON,n.damage)}),s.bullets.children.map(function(e){e.weaponData=n,e.pierce=n.pierce,e.destroyIt=function(t){e.kill()}}),this.phaserGroup.add(this.phaserMaster.get("layers").SPECIAL_WEAPON,s.bullets),r.push(s)}return r},e.prototype.createExplosionVacuum=function(e,t,a,i,n,r,o){void 0===r&&(r=function(){}),void 0===o&&(o=function(){});var s=this.game,l=this.phaserSprites,p=this.phaserGroup,h=this.atlas,u={reference:"EXPLOSION_VACUUM",spriteAnimation:Phaser.Animation.generateFrameNames("explosion_vacuum_",1,9).slice(),damage:25,pierce:!1,ignoreDamageState:!1,completeAnimation:!0},d=l.addFromAtlas({name:"impact_"+s.rnd.integer(),group:"impactExplosions",x:e,y:t,atlas:h,filename:u.spriteAnimation[0]});return d.scale.setTo(a,a),d.anchor.setTo(.5,.5),d.weaponData=u,d.animations.add("explosion",u.spriteAnimation,1,!0),d.animations.play("explosion",30,!1).onComplete.add(function(){d.destroyIt()},d),d.destroyIt=function(){l.destroy(d.name)},s.camera.shake(.004,500),p.add(void 0===i?this.phaserMaster.get("layers").VISUALS:i,d),s.physics.enable(d,Phaser.Physics.ARCADE),d},e.prototype.createExplosionVacuumFire=function(e,t,a,i,n,r,o){void 0===r&&(r=function(){}),void 0===o&&(o=function(){});var s=this.game,l=this.phaserSprites,p=this.phaserGroup,h=this.atlas,u={reference:"VACUUMEXPLOSION",spriteAnimation:Phaser.Animation.generateFrameNames("explosion_vacuum_inner_",1,13).slice(),damage:25,pierce:!1,ignoreDamageState:!1,completeAnimation:!0},d=l.addFromAtlas({name:"impact_"+s.rnd.integer(),group:"impactExplosions",x:e,y:t,atlas:h,filename:u.spriteAnimation[0]});return d.scale.setTo(a,a),d.anchor.setTo(.5,.5),d.weaponData=u,d.animations.add("explosion",u.spriteAnimation,1,!0),d.animations.play("explosion",30,!1).onComplete.add(function(){d.destroyIt()},d),d.destroyIt=function(){l.destroy(d.name)},s.camera.shake(.004,500),p.add(void 0===i?this.phaserMaster.get("layers").VISUALS:i,d),s.physics.enable(d,Phaser.Physics.ARCADE),d},e.prototype.createExplosionBasic=function(e,t,a,i,n,r,o){void 0===r&&(r=function(){}),void 0===o&&(o=function(){});var s=this.game;console.log(n);var l=this.phaserSprites,p=this.phaserGroup,h=this.atlas,u={reference:"EXPLOSION_BASIC",spriteAnimation:Phaser.Animation.generateFrameNames("explosions_Layer_",1,16),damage:void 0!==n?n:25,pierce:!1,ignoreDamageState:!1,completeAnimation:!0},d=l.addFromAtlas({name:"impact_"+s.rnd.integer(),group:"impactExplosions",x:e,y:t,atlas:h,filename:u.spriteAnimation[0]});return d.scale.setTo(a,a),d.anchor.setTo(.5,.5),d.weaponData=u,d.animations.add("explosion",u.spriteAnimation,1,!0),d.animations.play("explosion",30,!1).onComplete.add(function(){d.destroyIt()},d),d.destroyIt=function(){l.destroy(d.name)},s.camera.shake(.002,500),p.add(void 0===i?this.phaserMaster.get("layers").VISUALS:i,d),s.physics.enable(d,Phaser.Physics.ARCADE),d},e}();