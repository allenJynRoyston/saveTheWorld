var __generator=this&&this.__generator||function(e,t){var a,n,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,n&&(i=n[2&r[0]?"return":r[0]?"throw":"next"])&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[0,i.value]),r[0]){case 0:case 1:i=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,n=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){o.label=r[1];break}if(6===r[0]&&o.label<i[1]){o.label=i[1],i=r;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(r);break}i[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},PhaserGameObject=function(){function e(){this.game=null,this.global={pause:!1},this.devMode={skip:{intro:!0}}}return e.prototype.init=function(e,t,a){var n=new Phaser.Game(a.width,a.height,Phaser.WEBGL,e,{preload:function(){var e=i.game();e.world.setBounds(0,0,e.canvas.width+100,e.canvas.height),e.load.enableParallel=!0,e.stage.backgroundColor="#000000";var t="src/phaser/saveTheWorld/resources";e.load.atlas("atlas_main",t+"/textureAtlas/main/main.png",t+"/textureAtlas/main/main.json",Phaser.Loader.TEXTURE_ATLAS_JSON_HASH),e.load.atlas("atlas_weapons",t+"/textureAtlas/weapons/weaponsAtlas.png",t+"/textureAtlas/weapons/weaponsAtlas.json",Phaser.Loader.TEXTURE_ATLAS_JSON_HASH),e.load.atlas("atlas_large",t+"/textureAtlas/large/large.png",t+"/textureAtlas/large/large.json",Phaser.Loader.TEXTURE_ATLAS_JSON_HASH),e.load.atlas("atlas_enemies",t+"/textureAtlas/enemies/enemies.png",t+"/textureAtlas/enemies/enemies.json",Phaser.Loader.TEXTURE_ATLAS_JSON_HASH),e.load.atlas("atlas_ships",t+"/textureAtlas/ships/ships.png",t+"/textureAtlas/ships/ships.json",Phaser.Loader.TEXTURE_ATLAS_JSON_HASH),e.load.atlas("atlas_letters",t+"/textureAtlas/letters/letters.png",t+"/textureAtlas/letters/letters.json",Phaser.Loader.TEXTURE_ATLAS_JSON_HASH),e.load.audio("music-main",[t+"/music/level1.mp3"]),e.load.json("weaponData",t+"/json/weaponData.json"),e.load.bitmapFont("gem",t+"/fonts/gem.png",t+"/fonts/gem.xml"),i.changeState("PRELOAD"),new PHASER_PRELOADER({game:e,delayInSeconds:0,done:function(){!function(){var e=i.game();i.get("devMode"),s.getOnly(["overlay"]).overlay;s.getAll("ARRAY").map(function(e){e.init()}),p.getAll("ARRAY").map(function(e){e.init()}),M();var t=function(){var e=i.game(),t=i.getOnly(["gameData","primaryWeapon","secondaryWeapon","perk"]),a=t.gameData,n=t.primaryWeapon,o=t.secondaryWeapon,l=t.perk,p=function(e){var t=i.getOnly(["gameData"]).gameData;C(e),A("player",{health:e,lives:t.player.lives,powerup:t.player.powerup,special:t.player.special})};return y.createShip({name:"player",group:"playership",org:"gameobjects",layer:i.get("layers").PLAYER,shipId:a.pilot,primaryWeapon:n.reference,secondaryWeapon:o.reference,perk:l.reference},p,function(e){F(),function(){var e=i.getOnly(["gameData"]).gameData,t=(s.getOnly(["powerbar"]).powerbar,e.player.powerup-1);t<0&&(t=0);A("player",{health:e.player.health,lives:e.player.lives,powerup:t,special:e.player.special}),s.get("powerbar_pow_"+t).popLost()}()},function(t){var a=i.getOnly(["gameData"]).gameData;a.player.lives--,s.getOnly(["healthbar_player"]).healthbar_player.loseLife(),a.player.lives>0&&(A("player",{health:100,lives:a.player.lives,powerup:0,special:a.player.special}),r.clearAllControlIntervals(),r.disableAllInput(),e.time.events.add(Phaser.Timer.SECOND,function(){p(100),t.moveToStart()}).autoDestroy=!0)},function(e){})}();e.camera.follow(t),e.add.audio("music-main").play(),O("WIPEOUT",function(){v.overlayBGControls({transition:"FADEOUT",delay:500,speed:1e3},function(){I()})})}()}})},create:function(){var e=i.game(),t=i.get("gameData");e.physics.startSystem(Phaser.Physics.ARCADE),r.assign(e),o.assign(e),s.assign(e),l.assign(e),p.assign(e),h.assign(e),u.assign(e,20),d.assign(e),c.assign(e,i,s,u,"atlas_weapons"),m.assign(e,i,s,u,c,"atlas_weapons"),f.assign(e,i,s,u,"atlas_main"),g.assign(e,i,s,p,u,m,c,"atlas_enemies","atlas_weapons"),y.assign(e,i,s,p,u,r,m,c,"atlas_ships","atlas_weapons"),v.assign(e,i,s,d,u,"atlas_main"),b.assign(e,i,s,u,p,r,"atlas_main");var a={BACKGROUND_0:0,BACKGROUND_1:1,ENEMIES_UNDER:2,ENEMIES:3,ENEMIES_OVER:4,ENEMY_BULLETS:5,PLAYER_BULLETS:5,PLAYER_UNDER:5,PLAYER:6,PLAYER_OVER:7,DEBRIS:7,VISUALS:8,BULLET_IMPACT:8,SPECIAL_WEAPON:9,ITEMDROPS:10,FOREGROUND_0:11,FOREGROUND_1:12,DIALOGBOX:13,UI:14,OVERLAY:20};i.let("roundTime",60),i.let("clock",e.time.create(!1)),i.let("elapsedTime",0),i.let("inGameSeconds",0),i.let("devMode",!1),i.let("starMomentum",{x:0,y:0}),i.let("pauseStatus",!1),i.let("bossHealth",null),i.let("powerupTimer",0),i.let("bossMode",!1),i.let("showWarningBand",!1),i.let("layers",a),i.let("dialogPortraits",{PLAYER:"ui_portrait_1",MOTHERSHIP:"ui_portrait_2",STATIC:"ui_portrait_4",BOSS:"ui_portrait_3"}),i.let("sharedDebris",c.debris(200)),i.let("velocityFactor",{x:0,y:1});var n=i.let("weaponData",e.cache.getJSON("weaponData"));i.let("primaryWeapon",n.primaryWeapons[t.primaryWeapon]),i.let("secondaryWeapon",n.secondaryWeapons[t.secondaryWeapon]),i.let("perk",n.perks[t.perk]);b.create(),e.onPause.add(function(){i.get("clock").stop(),i.forceLet("pauseStatus",!0)},this),e.onResume.add(function(){e.time.addToPausedTime(e.time.pauseDuration),i.get("clock").start(),i.forceLet("pauseStatus",!1)},this);var x=u.layer(a.UI);x.fixedToCamera=!0,x.cameraOffset.setTo(0,0);var w=u.layer(a.DIALOGBOX);w.fixedToCamera=!0,w.cameraOffset.setTo(0,0),function(){var e=i.game();e.physics.startSystem(Phaser.Physics.ARCADE),v.buildOverlayBackground("#ffffff","#ffffff",19,!0),v.buildOverlayGrid(240,132,20,"logo_small");var t=d.addGradient({name:"boundryObj",start:"#ffffff",end:"#ffffff",width:5,height:5,render:!1}),a=s.add({x:-9,y:-e.world.height/2,name:"leftBoundry",group:"boundries",width:10,height:2*e.world.height,reference:t.cacheBitmapData,alpha:0}),n=s.add({x:e.world.width-1,y:-e.world.height/2,name:"rightBoundry",group:"boundries",width:10,height:2*e.world.height,reference:t.cacheBitmapData,alpha:0});e.physics.enable([a,n],Phaser.Physics.ARCADE),a.body.immovable=!0,n.body.immovable=!0}(),E(),function(){var e=i.game(),t=i.getResolution(),a=t.w,n=(t.h,s.addFromAtlas({name:"scoreContainer",group:"uiScore",org:"ui",filename:"ui_roundContainer",atlas:"atlas_main",visible:!1}));n.anchor.setTo(.5,.5),s.centerOnPoint("scoreContainer",a/2+n.width/2,n.height/2+n.height/2+15),u.addMany(i.get("layers").UI,[n]),n.setDefaultPositions(),n.init=function(){n.y=-100},n.reveal=function(){var t=n.getDefaultPositions().y;n.setDefaultPositions(),e.add.tween(n).to({y:t},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){})},n.hide=function(){e.add.tween(n).to({y:n.getDefaultPositions().y},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){})};var r=p.add({name:"scoreText",group:"uiScore",font:"gem",size:18,default:"1100",visible:!0});r.anchor.setTo(.5,.5),n.addChild(r),r.init=function(){r.updateScore()},r.updateScore=function(){r.setText(""+i.get("gameData").score)};var o=s.addFromAtlas({name:"scrapContainer",group:"uiScrap",org:"ui",filename:"scrapContainer",atlas:"atlas_main",visible:!0});o.anchor.setTo(.5,.5),o.showLifespan=e.time.returnTrueTime()+2*Phaser.Timer.SECOND,o.isShowing,s.centerOnPoint("scrapContainer",65,o.height/2+o.height/2+15),u.addMany(i.get("layers").UI,[o]),o.init=function(){o.y=-50,o.isShowing=!1},o.onPickup=function(){o.isShowing?l.updateScrap():o.reveal(),o.showLifespan=e.time.returnTrueTime()+3*Phaser.Timer.SECOND},o.onUpdate=function(){e.time.returnTrueTime()>o.showLifespan&&o.isShowing&&o.hide()},o.reveal=function(){o.isShowing=!0,e.add.tween(o).to({y:25},1e3,Phaser.Easing.Back.InOut,!0,1,0,!1).onComplete.add(function(){l.updateScrap()})},o.hide=function(){o.isShowing=!1,e.add.tween(o).to({y:-50},1e3,Phaser.Easing.Back.InOut,!0,1,0,!1).onComplete.add(function(){})};var l=p.add({x:-8,y:5,name:"scrapText",group:"uiScrap",font:"gem",size:16,default:"0",visible:!0});l.stroke="#000000",l.strokeThickness=2,l.fill="#43d637",l.updateText(),l.anchor.setTo(.5,.5),o.addChild(l),l.init=function(){l.updateScrap()},l.updateScrap=function(){l.scale.setTo(1.25,1.25),l.setText(""+i.get("gameData").scrap),e.add.tween(l.scale).to({x:1,y:1},250,Phaser.Easing.Back.InOut,!0,1,0,!1).onComplete.add(function(){})}}(),function(){var e=i.getResolution(),t=e.w,a=e.h,n=s.addFromAtlas({name:"menuButton1",group:"menuButtons",x:t/2,y:a/2+125,atlas:"atlas_main",filename:"ui_button",visible:!1});n.anchor.setTo(.5,.5),n.init=function(){n.visible=!1},n.reveal=function(){this.visible=!0},n.text=p.add({name:"menuButton1Text",group:"ui",font:"gem",size:14,default:""}),n.text.anchor.setTo(.5,.5),n.addChild(n.text);var r=s.addFromAtlas({name:"menuButton2",group:"menuButtons",x:t/2,y:a/2+175,atlas:"atlas_main",filename:"ui_button",visible:!0});r.anchor.setTo(.5,.5),r.init=function(){r.visible=!1},r.reveal=function(){this.visible=!0},r.text=p.add({name:"menuButton2Text",group:"ui",font:"gem",size:14,default:""}),r.text.anchor.setTo(.5,.5),r.addChild(r.text);var o=s.addFromAtlas({name:"menuButtonCursor",group:"menuButtons",x:t/2-125,atlas:"atlas_main",filename:"ui_cursor",visible:!0});o.anchor.setTo(.5,.5),o.init=function(){o.visible=!1},o.reveal=function(){this.visible=!0},o.updateLocation=function(e){i.forceLet("menuButtonSelection",e);var t=s.get("menuButton"+e);this.y=t.y},o.updateLocation(1),u.addMany(i.get("layers").UI,[n,r,o])}(),_(),P(),function(){var e=i.game(),t=i.getResolution(),a=(t.w,t.h),n=s.addFromAtlas({y:100,name:"healthbar_player",group:"player_healthbar",org:"ui",filename:"healthbar_player",atlas:"atlas_main",visible:!0});s.centerOnPoint("healthbar_player",200,a-n.height/2-8),u.addMany(i.get("layers").UI,[n]),n.setDefaultPositions();var r=s.addFromAtlas({x:5,y:3,width:n.width-10,name:"unit_damage_player",filename:"unit_damage",atlas:"atlas_main",visible:!0});r.maxHealth=r.width-10,n.addChild(r),r.init=function(){},r.updateHealth=function(t){var a=t/100,n=i.getAll().damageBar;void 0!==n&&n.stop(),i.forceLet("damageBar",e.add.tween(r).to({width:r.maxHealth*a},500,Phaser.Easing.Linear.In,!0,500,0,!1))};var o=s.addFromAtlas({x:5,y:3,width:n.width-10,name:"unit_health_player",filename:"unit_health",atlas:"atlas_main",visible:!0});n.maxHealth=n.width-10,n.addChild(o),o.init=function(){var e=i.getOnly(["gameData"]).gameData,t=e.player.health;C(t)},o.updateHealth=function(e){var t=e/100;o.width=n.maxHealth*t},n.init=function(){n.y=n.y+200,n.isHidden=!0},n.reveal=function(){if(n.isHidden){n.isHidden=!1;var t=n.getDefaultPositions().y;n.setDefaultPositions(),e.add.tween(n).to({y:t},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){n.buildLives()})}},n.hide=function(){n.isHidden||(n.isHidden=!0,e.add.tween(n).to({y:n.getDefaultPositions().y},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){}))},n.fadeIn=function(){e.add.tween(n).to({alpha:1},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.In,!0,1,0,!1).onComplete.add(function(){})},n.fadeOut=function(){e.add.tween(n).to({alpha:0},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.Out,!0,1,0,!1).onComplete.add(function(){})},n.buildLives=function(){for(var t=i.getOnly(["gameData"]).gameData,a=function(t){var a=s.addFromAtlas({x:0+25*t,y:-25,name:"life_icon_"+e.rnd.integer(),group:"playerLives",filename:"ship_icon",atlas:"atlas_main",alpha:0});n.addChild(a),e.add.tween(a).to({alpha:1},250,Phaser.Easing.Linear.In,!0,250*t,0,!1),a.destroyIt=function(){e.add.tween(a).to({y:a.y-10,alpha:0},250,Phaser.Easing.Linear.In,!0,1,0,!1).onComplete.add(function(){s.destroy(a.name)})}},r=0;r<t.player.lives;r++)a(r)},n.loseLife=function(){var e=s.getGroup("playerLives"),t=e[e.length-1];t.destroyIt()}}(),function(){var e=i.game(),t=i.getResolution(),a=t.w,n=t.h,r=s.addFromAtlas({name:"powerbar",group:"player_pow",org:"ui",filename:"powerbar",atlas:"atlas_main",visible:!0});s.centerOnPoint("powerbar",a-r.width/2-10,n-r.height/2-8),u.addMany(i.get("layers").UI,[r]),r.setDefaultPositions(),r.setup=function(){for(var t=function(t){var a=s.addFromAtlas({x:8*t+5,y:9,name:"powerbar_pow_"+t,filename:"powerbar_level_"+(Math.floor(t/5)+1),group:"powerbar_bars",atlas:"atlas_main",visible:!0});a.anchor.setTo(.5,.5),a.popOut=function(t){e.time.events.add(t,function(){a.scale.setTo(1.5,1.5),e.add.tween(a.scale).to({x:1,y:1},350,Phaser.Easing.Back.InOut,!0,1,0,!1)}).autoDestroy=!0},a.popLost=function(){e.add.tween(a).to({y:a.y-5,alpha:.5},350,Phaser.Easing.Linear.In,!0,1,0,!1).onComplete.add(function(){a.y=a.getDefaultPositions().y,a.alpha=1,a.visible=!1})},r.addChild(a)},a=0;a<30;a++)t(a);var n=s.addFromAtlas({x:-20,y:0,name:"powerbar_pow",filename:"powerbar_pow",atlas:"atlas_main",visible:!0});r.addChild(n)},r.updatePowerbar=function(){for(var e=i.getOnly(["gameData"]).gameData,t=e.player.powerup,a=s.getGroup("powerbar_bars"),n=0;n<a.length;n++)a[n].visible=!0,a[n].popOut(35*n);for(var n=t;n<a.length;n++)a[n].visible=!1,a[n].popLost(35*n)},r.animateFull=function(){for(var e=s.getGroup("powerbar_bars"),t=0;t<30;t++)e[t].visible=!0,e[t].popOut(25*t)},r.init=function(){r.y=r.y+200,r.setup(),r.updatePowerbar(),r.isHidden=!0},r.reveal=function(){if(r.isHidden){r.isHidden=!1;var t=r.getDefaultPositions().y;r.setDefaultPositions(),e.add.tween(r).to({y:t},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){})}},r.hide=function(){r.isHidden||(r.isHidden=!0,e.add.tween(r).to({y:r.getDefaultPositions().y},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){}))},r.fadeIn=function(){e.add.tween(r).to({alpha:1},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.In,!0,1,0,!1).onComplete.add(function(){})},r.fadeOut=function(){e.add.tween(r).to({alpha:0},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.Out,!0,1,0,!1).onComplete.add(function(){})};for(var o=Phaser.Animation.generateFrameNames("special_",1,5).concat(["special_1"]),l=function(t){var a=s.addFromAtlas({x:r.width-15-30*t,y:-20,name:"special_icon_"+t,group:"special_icons",filename:""+o[0],atlas:"atlas_main",visible:!0});a.anchor.setTo(.5,.5),a.animateInterval=e.time.returnTrueTime(),a.index=t,a.animations.add("animate",o,1,!0),a.onUpdate=function(){e.time.returnTrueTime()>a.animateInterval&&(a.animateInterval=e.time.returnTrueTime()+5e3,e.time.events.add(500*a.index,function(){a.animations.play("animate",10,!1)}).autoDestroy=!0)},r.addChild(a)},p=0;p<8;p++)l(p)}(),function(){var e=i.game(),t=i.getResolution(),a=t.w,n=(t.h,s.addFromAtlas({name:"healthbar_boss",group:"boss_healthbar",filename:"healthbar_boss",atlas:"atlas_main",visible:!0}));s.centerOnPoint("healthbar_boss",a/2,25),u.addMany(i.get("layers").UI,[n]),n.setDefaultPositions();var r=s.addFromAtlas({x:5,y:3,width:n.width-10,name:"unit_damage_boss",filename:"unit_damage",atlas:"atlas_main",visible:!0});r.maxHealth=r.width,r.fillComplete=!1,n.addChild(r),r.init=function(){r.width=0},r.updateHealth=function(t){var a=t/100,n=i.getAll().enemyDamageBar;void 0!==n&&n.stop(),i.forceLet("enemyDamageBar",e.add.tween(r).to({width:r.maxHealth*a},500,Phaser.Easing.Linear.In,!0,500,0,!1))},r.fill=function(t){var a=t/100;e.add.tween(r).to({width:r.maxHealth*a},Phaser.Timer.SECOND,Phaser.Easing.Exponential.Out,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){r.fillComplete=!0})};var o=s.addFromAtlas({x:5,y:3,width:n.width-10,name:"unit_health_boss",filename:"unit_health",atlas:"atlas_main",visible:!0});o.maxHealth=o.width,o.fillComplete=!1,n.addChild(o),o.init=function(){o.width=0},o.updateHealth=function(e){if(o.fillComplete){var t=e/100;o.width=o.maxHealth*t}},o.fill=function(t,a){void 0===a&&(a=function(){});var n=t/100;e.add.tween(o).to({width:o.maxHealth*n},Phaser.Timer.SECOND,Phaser.Easing.Exponential.Out,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){o.fillComplete=!0,a()})};var l=s.addFromAtlas({x:-18,y:-2,name:"bossbar_portrait",filename:"bossbar_picture",atlas:"atlas_main",visible:!0});n.addChild(l),n.init=function(){n.y=-200},n.reveal=function(){var t=n.getDefaultPositions().y;n.setDefaultPositions(),e.add.tween(n).to({y:t},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){var e,t,a;e=i.get("bossHealth"),t=s.getOnly(["unit_damage_boss","unit_health_boss"]),a=t.unit_damage_boss,t.unit_health_boss.fill(e,function(){a.updateHealth(e)})})},n.hide=function(){e.add.tween(n).to({y:n.getDefaultPositions().y},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){})}}()},update:function(){var e=i.game(),a=i.getState().currentState,n=i.getOnly(["starMomentum","primaryWeapon","secondaryWeapon","menuButtonSelection","elapsedTime","powerupTimer","gameData"]),o=n.starMomentum,l=n.primaryWeapon,h=(n.secondaryWeapon,n.menuButtonSelection),u=n.elapsedTime,d=(n.powerupTimer,n.gameData),c=s.getOnly(["player","menuButtonCursor"]),m=c.player,g=c.menuButtonCursor,y=r.getOnly(["DOWN","UP","LEFT","RIGHT","A","START"]),f=y.DOWN,v=y.UP,x=y.LEFT,w=y.RIGHT,S=y.A;y.START;"PAUSE"!==a&&"VICTORYSTATE"!==a&&"GAMEOVERSTATE"!==a&&"ENDLEVEL"!==a&&s.getManyGroups(["ui","backgrounds","starfield","playership","special_icons","itemspawns","boss_ui"]).map(function(e){e.onUpdate()});"DIALOG"===a&&(r.checkWithDelay({isActive:!0,key:"A",delay:500})&&b.next(),r.checkWithDelay({isActive:!0,key:"START",delay:500})&&b.skipAll());"READY"===a&&(r.checkWithDelay({isActive:!0,key:"START",delay:500}),e.time.returnTrueTime()>u&&(i.forceLet("elapsedTime",e.time.returnTrueTime()+Phaser.Timer.SECOND/2),W()),s.getManyGroups(["ui_overlay","enemies","boss","trashes"]).map(function(e){void 0!==e&&e.onUpdate()}),p.getManyGroups(["ui_text","timeKeeper"]).map(function(e){void 0!==e&&e.onUpdate()}),w.active&&(o.x=-2,m.moveX(5)),x.active&&(o.x=2,m.moveX(-5)),v.active&&(o.y=5,m.moveY(-5)),f.active&&(o.y=-2,m.moveY(5)),v.active||f.active||(o.y=0),r.checkWithDelay({isActive:!0,key:"A",delay:l.cooldown-S.state*l.rapidFireSpd})&&m.fireWeapon(),r.checkWithDelay({isActive:!0,key:"B",delay:500})&&d.player.special>0&&(!function(){var e=i.getOnly(["gameData"]).gameData,t=e.player.special-1;t<0&&(t=0);A("player",{health:e.player.health,lives:e.player.lives,powerup:e.player.powerup,special:t}),M()}(),m.fireSubweapon()));if("VICTORYSTATE"===a&&(r.checkWithDelay({isActive:!0,key:"UP",delay:100})&&g.updateLocation(1),r.checkWithDelay({isActive:!0,key:"DOWN",delay:100})&&g.updateLocation(2),r.checkWithDelay({isActive:!0,key:"START",delay:250})))switch(i.changeState("LOCKED"),r.disableAllInput(),h){case 1:T(),H(function(){T(),t.loadNextLevel()});break;case 2:T(),H(function(){T(),t.returnToTitle()})}if("GAMEOVERSTATE"===a&&(r.checkWithDelay({isActive:!0,key:"UP",delay:100})&&g.updateLocation(1),r.checkWithDelay({isActive:!0,key:"DOWN",delay:100})&&g.updateLocation(2),r.checkWithDelay({isActive:!0,key:"START",delay:100})))switch(r.disableAllInput(),h){case 1:H(function(){t.retry()});break;case 2:H(function(){t.returnToTitle()})}}});n.preserveDrawingBuffer=!0;var i=new PHASER_MASTER({game:n,element:e,resolution:{w:a.width,h:a.height}}),r=new PHASER_CONTROLS,o=new PHASER_MOUSE({showDebugger:!1}),s=new PHASER_SPRITE_MANAGER,l=new PHASER_BITMAPDATA_MANAGER,p=new PHASER_TEXT_MANAGER,h=new PHASER_BUTTON_MANAGER,u=new PHASER_GROUP_MANAGER,d=new PHASER_BITMAPDATA_MANAGER,c=new EFFECTS_MANAGER,m=new WEAPON_MANAGER,g=new ENEMY_MANAGER({showHitbox:!1}),y=new PLAYER_MANAGER,f=new ITEMSPAWN_MANAGER,v=new UTILITY_MANAGER,b=new DIALOG_MANAGER,x=a.store,w=JSON.stringify(x.getters._gameData());function A(e,t){i.get("gameData")[e]=t}function T(){var e=i.get("gameData");x.commit("setGamedata",e)}function S(e,t){var a=i.getOnly(["velocityFactor"]).velocityFactor,r=e>=a.y?a.y:e,o=e>=a.y?e:a.y,s=!(e>=a.y),l=n.math.sinCosGenerator(100,o,null,r).cos,p=0;l=l.filter(function(e,t){if(e=Math.abs(e),t<50)return e>=r}),s&&(l=l.reverse());var h=setInterval(function(){var t=Phaser.Math.roundTo(Math.abs(l[p]),-2);i.forceLet("velocityFactor",{x:a.x,y:t}),++p>=l.length&&(i.forceLet("velocityFactor",{x:a.x,y:e}),window.clearInterval(h))},t/l.length)}function E(){var e=i.getResolution(),t=(e.w,e.h,i.getOnly(["starMomentum"]).starMomentum),a=s.addTilespriteFromAtlas({name:"bg1",group:"backgrounds",x:0,y:0,width:n.world.width,height:n.world.height,atlas:"atlas_large",filename:"planetBG"});a.tileScale.x=.5,a.tileScale.y=.5,a.onUpdate=function(){var e=i.getOnly(["velocityFactor"]).velocityFactor;a.tilePosition.y+=5*(e.y-1)*.5<=0?.5:5*(e.y-1)*.5,a.tilePosition.x+=t.x/4*e.y},u.addMany(i.get("layers").BACKGROUND_0,[a]);var r=s.addTilespriteFromAtlas({name:"bg2",group:"backgrounds",x:0,y:0,width:n.world.width,height:n.world.height,atlas:"atlas_large",filename:"Nebula1"});r.tilePosition.x=500,a.tileScale.x=.75,a.tileScale.y=.75,r.onUpdate=function(){var e=i.getOnly(["velocityFactor"]).velocityFactor;r.tilePosition.y+=5*(e.y-1)*2<=0?1:5*(e.y-1)*2,r.tilePosition.x+=t.x/2*e.x},u.addMany(i.get("layers").BACKGROUND_1,[r]);var o=s.addTilespriteFromAtlas({name:"fg1",group:"backgrounds",x:0,y:0,width:n.world.width,height:n.world.height,atlas:"atlas_large",filename:"Nebula2",alpha:.25});o.tilePosition.x=300,o.onUpdate=function(){var e=i.getOnly(["velocityFactor"]).velocityFactor;o.tilePosition.y+=5*(e.y-1)*5<=0?1.5:5*(e.y-1)*5,o.tilePosition.x+=t.x*e.x},u.addMany(i.get("layers").FOREGROUND_0,[o]);for(var l=function(e){var t=s.addFromAtlas({x:n.rnd.integerInRange(0,n.world.width),y:n.rnd.integerInRange(0,n.world.height),name:"star_"+e,group:"starfield",filename:"stars_layer_"+n.rnd.integerInRange(1,3),atlas:"atlas_main",visible:!0});switch(t.starType=n.rnd.integerInRange(1,3),t.scale.setTo(t.starType/2,t.starType/2),t.onUpdate=function(){var e=.25+5*(3-t.starType),a=i.getOnly(["velocityFactor","starMomentum"]),r=a.velocityFactor,o=a.starMomentum;this.y>this.game.world.height&&(this.y=10,this.x=n.rnd.integerInRange(-100,n.world.width)),this.x>this.game.world.width&&(this.x=0),this.x<0&&(this.x=this.game.world.width),o.x>0&&(o.x-=.05),o.x<0&&(o.x+=.05),o.y>0&&(o.y-=.05),o.y<0&&(o.y+=.05),this.x+=(3-t.starType)*o.x*r.x,this.y+=(e+(3-t.starType)*o.y)*r.y},t.fadeOut=function(){this.game.add.tween(this).to({alpha:0},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,n.rnd.integerInRange(0,500),0,!1).autoDestroy=!0},t.starType){case 3:u.layer(i.get("layers").BACKGROUND_0).add(t);break;case 2:u.layer(i.get("layers").BACKGROUND_1).add(t);break;case 1:u.layer(i.get("layers").FOREGROUND_0).add(t)}},p=0;p<10;p++)l(p)}function _(){var e=s.addTilespriteFromAtlas({name:"showWarningBand",group:"boss_ui",x:0,y:n.world.centerY-100,width:n.world.width,height:100,atlas:"atlas_main",filename:"warning_band",alpha:0});e.cosWave={data:n.math.sinCosGenerator(150,100,0,1).cos,count:0},e.onUpdate=function(){i.getOnly(["showWarningBand"]).showWarningBand?(e.cosWave.count++,e.cosWave.count>e.cosWave.data.length-1&&(e.cosWave.count=0),e.alpha=Math.round(e.cosWave.data[e.cosWave.count]),e.tilePosition.x+=10):0!==e.cosWave.count&&(e.cosWave.count++,e.cosWave.count>e.cosWave.data.length-1&&(e.cosWave.count=0),e.alpha=Math.round(e.cosWave.data[e.cosWave.count]),e.tilePosition.x+=10)}}function P(){var e=s.addFromAtlas({name:"mothership",group:"mothership",atlas:"atlas_ships",filename:"motherbase",y:n.world.height+200,visible:!1});e.anchor.setTo(.5,.5),e.scale.setTo(1.25,1.25),e.docksequence=function(t,a){var i=t.x,r=t.y;G(.002,3e4),e.visible=!0,e.x=i,n.add.tween(e).to({y:r},8*Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,1,0,!1).onComplete.add(function(){G(.003,3e4),t.visible=!1,n.add.tween(e).to({y:-e.height},1.5*Phaser.Timer.SECOND,Phaser.Easing.Quartic.In,!0,100,0,!1).onComplete.add(function(){a()})})}}function D(e,t,a){void 0===t&&(t=10),void 0===a&&(a=1);var n=i.game(),r=i.getResolution(),o=r.w,l=r.h,p=n.add.sprite(0,0);return p._width=0,p._height=0,(e=e.split("")).map(function(e,a){if(" "===e)p._width+=3*t;else{var i=s.addFromAtlas({x:p._width,name:"l_"+n.rnd.integer(),filename:""+e,atlas:"atlas_letters",visible:!1});p._width+=i.width+t,p._height=i.height,i.setDefaultPositions(),i.init=function(){i.x=-200,i.scale.setTo(.1,.1)},i.reveal=function(){i.visible=!0,n.add.tween(i.scale).to({x:1,y:1},Phaser.Timer.SECOND,Phaser.Easing.Elastic.Out,!0,100*a,0,!1).game.add.tween(i).to({x:i.getDefaultPositions().x},Phaser.Timer.SECOND,Phaser.Easing.Elastic.Out,!0,50*a,0,!1).onComplete.add(function(){})},i.hide=function(){n.add.tween(i).to({alpha:0,y:i.y-25},Phaser.Timer.SECOND,Phaser.Easing.Exponential.Out,!0,50*a,0,!1).onComplete.add(function(){s.destroy(i.name)})},i.init(),p.addChild(i)}}),p.scale.setTo(a,a),p.x=o/2-(p._width/2-t)*a,p.y=l/2-p.height/2*a,u.addMany(i.get("layers").UI,[p]),p}function I(){var e,t,a,r,o=i.getOnly(["clock","dialogPortraits"]),l=o.clock,p=o.dialogPortraits,h=s.get("player");e=function(){n.time.events.add(Phaser.Timer.SECOND,function(){h.moveToStart();var e=[{text:"I'm approaching the asteroid field now.",portrait:p.PLAYER,autoplay:!0},{text:"You know the drill.  Just destroy as many as rocks as possible.  We'll be right behind you to collect the pieces.",portrait:p.MOTHERSHIP},{text:"Yep, and then we sell the rare minerals for money.  ",portrait:p.PLAYER},{text:"Okay, be careful out there.",portrait:p.MOTHERSHIP},{text:"Always.",portrait:p.PLAYER}];b.start(e,function(){n.time.events.add(Phaser.Timer.SECOND,function(){s.getGroup("ui").map(function(e){e.reveal()}),l.start(),i.changeState("READY")}).autoDestroy=!0})}).autoDestroy=!0},(r=D("mission 1",10,1.1)).y=r.y-100,r.children.map(function(e){e.reveal()}),n.time.events.add(1e3,function(){(t=s.addFromAtlas({x:n.world.centerX,y:r.y+r._height+30,name:"divider",filename:"divider",atlas:"atlas_main",alpha:0})).anchor.setTo(.5,.5),n.add.tween(t).to({alpha:1,y:t.y-5},Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,1,0,!1).autoDestroy=!0}).autoDestroy=!0,n.time.events.add(2e3,function(){(a=D("into the breach",10,.35)).y=a.y-20,n.time.events.add(1,function(){a.children.map(function(e){e.reveal()})})}).autoDestroy=!0,n.time.events.add(4500,function(){S(1.5,2500),r.children.map(function(e){e.hide()})}),n.time.events.add(5e3,function(){n.add.tween(t).to({alpha:0},Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,1,0,!1).autoDestroy=!0}),n.time.events.add(5500,function(){a.children.map(function(e){e.hide()})}),n.time.events.add(7e3,function(){e()})}function O(e,t){void 0===t&&(t=function(){});v.overlayControls({transition:e,delay:1e3,speed:250,tileDelay:5},t)}function C(e){var t=s.getOnly(["unit_damage_player","unit_health_player"]),a=t.unit_damage_player,n=t.unit_health_player;a.updateHealth(e),n.updateHealth(e)}function R(){var e=i.getOnly(["gameData"]).gameData,t=s.getOnly(["powerbar"]).powerbar,a=e.player.powerup+1;a>30?(a=30,t.animateFull()):(A("player",{health:e.player.health,lives:e.player.lives,powerup:a,special:e.player.special}),t.updatePowerbar())}function M(){for(var e=i.getOnly(["gameData"]).gameData.player.special,t=s.getGroup("special_icons"),a=0;a<t.length;a++)t[a].visible=!0;for(a=e;a<t.length;a++)t[a].visible=!1}function L(e){var t=i.getOnly(["gameData"]).gameData,a=p.getOnly(["scoreText"]).scoreText;t.score+=e,a.updateScore(),A("score",t.score)}function B(e){i.game(),g.createAsteroid1(e,function(){},function(e){var t;L(50),t={x:e.x,y:e.y},i.game(),g.createAsteroid2(t,function(){},function(e){L(50),U(e.x,e.y)},function(){})},function(){})}function k(e){i.game(),g.createSmallEnemy1(e,function(){},function(e){L(100),U(e.x,e.y)},function(){})}function N(e){var t=i.game(),a=s.getOnly(["healthbar_boss","player"]),n=a.healthbar_boss,o=a.player,l=g.createBoss1(e,function(e){var t,a,n,i,r=Math.round(e.health/e.maxHealth*100);t=r,a=s.getOnly(["unit_damage_boss","unit_health_boss"]),n=a.unit_damage_boss,i=a.unit_health_boss,n.updateHealth(t),i.updateHealth(t)},function(e){n.hide(),o.removeTarget(),t.time.events.add(2*Phaser.Timer.SECOND,function(){var e,t,a,n;e=i.game(),(t=i.getOnly(["gameData","dialogPortraits"])).gameData,a=t.dialogPortraits,n=s.getOnly(["player"]).player,r.disableAllActionButtons(),r.disableAllDirectionalButtons(),e.time.events.add(5e3,function(){var t=D("mission",10,1.1);t.y=t.y-100,t.children.map(function(e){e.reveal()});var o=D("clear",10,1.1);o.y=t.y+80,o.children.map(function(e){e.reveal()}),e.time.events.add(3e3,function(){t.children.concat(o.children).map(function(e){e.hide()});var l=[{text:"Great job Hadrion.  Another successful run.  Prepare for docking sequence.",portrait:a.MOTHERSHIP},{text:"Hehe aww yeah.",portrait:a.PLAYER},{text:"Don't make this weird.",portrait:a.MOTHERSHIP},{text:"... sorry.",portrait:a.PLAYER}];b.start(l,function(){s.getGroup("ui").map(function(e){e.hide()});var t=s.get("mothership");t.docksequence(n,function(){e.time.events.add(150,function(){i.changeState("ENDLEVEL"),G(0,1);var t=e.add.bitmapData(e.width,e.height);t.drawFull(e.world);var a=t.addToWorld(e.world.centerX+100,e.world.centerY+100,.5,.5,2,2);u.add(5,a),s.getManyGroups(["backgrounds","starfield","gameobjects"]).map(function(e){e.destroy()}),v.overlayBGControls({transition:"FLASHWHITE",delay:0,speed:600},function(){a.scale.setTo(.5,.5),a.x=e.world.centerX,a.y=e.world.centerY,e.stage.backgroundColor="#f2f2f2",function(e,t,a,n,r){var o=i.game(),s={step:0},l=o.add.tween(s).to({step:100},n);l.onUpdateCallback(function(){e.tint=Phaser.Color.interpolateColor(t,a,100,s.step)}),r&&l.onComplete.add(r,o),e.tint=t,l.start()}(a,0,16777215,3e3,function(){r.enableAllActionButtons(),r.enableAllDirectionalButtons();var e=s.getOnly(["menuButton1","menuButton2"]),t=e.menuButton1,a=e.menuButton2;i.changeState("VICTORYSTATE"),s.getGroup("menuButtons").map(function(e){e.reveal()}),t.text.setText("NEXT STAGE"),a.text.setText("SAVE AND QUIT")})})}).autoDestroy=!0})})})})})},function(){});o.assignTarget(l.targetingBox)}function G(e,t){n.camera.shake(e,t)}function F(){var e=s.get("healthbar_player"),t={x:e.x+n.rnd.integerInRange(-2,2),y:e.y+n.rnd.integerInRange(-2,2)},a=Phaser.Easing.Bounce.InOut;n.add.tween(e).to(t,45,a,!1,1,4,!0).start()}function U(e,t){f.spawnScrap(e,t,6,function(){var e=s.getOnly(["scrapContainer"]).scrapContainer;A("scrap",i.getOnly(["gameData"]).gameData.scrap+10),e.onPickup()})}function W(){var e=i.getOnly(["gameData","bossMode","powerupTimer"]),t=e.gameData,a=e.bossMode,r=e.powerupTimer,o=function(e){var t=i.getOnly(["inGameSeconds"]).inGameSeconds;return t+=e,i.forceLet("inGameSeconds",t),t}(.5);n.time.returnTrueTime()>r&&(i.forceLet("powerupTimer",t.player.powerup<30?n.time.returnTrueTime()+3*Phaser.Timer.SECOND:n.time.returnTrueTime()+Phaser.Timer.SECOND/2),R()),30===o&&function(e){var t=this,a=i.game(),n=i.getOnly(["dialogPortraits"]).dialogPortraits,r=s.getOnly(["scoreContainer","player","healthbar_boss"]),o=r.scoreContainer,l=r.player,p=r.healthbar_boss;i.forceLet("bossMode",!0),i.forceLet("showWarningBand",!0),G(.005,5e3);i.forceLet("bossHealth",100),S(3,5e3),l.moveTo(a.world.centerX,a.world.centerY+a.world.centerY/2,6e3,function(){i.forceLet("showWarningBand",!1),a.time.events.add(1*Phaser.Timer.SECOND,function(){var t=[{text:"Something big is approaching.  Looks very... murder-y.",portrait:n.PLAYER},{text:"Well murder it first then.",portrait:n.MOTHERSHIP},{text:"You are a terrible life coach.",portrait:n.PLAYER}];b.start(t,function(){o.hide(),p.reveal(),e()})},t).autoDestroy=!0})}(function(){N({x:n.world.width/2,y:-300})}),a||(o%4==0&&B({x:n.rnd.integerInRange(100,n.world.width-100),y:-n.rnd.integerInRange(100,400),iy:n.rnd.integerInRange(0,80)}),o>2&&o%4==0&&k({x:n.rnd.integerInRange(100,n.world.width-100),y:-n.rnd.integerInRange(100,400)}),o%2==0&&k({x:n.rnd.integerInRange(100,n.world.width-100),y:n.rnd.integerInRange(100,400),iy:n.rnd.integerInRange(0,80)}))}function H(e){v.overlayBGControls({transition:"FADEIN",delay:0,speed:250},function(){p.getManyGroups(["ui","ui_text","ui_buttons"]).map(function(e){p.destroy(e.name)}),s.getManyGroups(["ui","ui_buttons"]).map(function(e){s.destroy(e.name)}),O("WIPEIN",function(){n.time.events.add(300,function(){e()}).autoDestroy=!0})})}i.let("gameData",JSON.parse(w)),t.game=this,this.game=i.game()},e.prototype.destroy=function(){this.game.destroy()},e}(),__phaser=new PhaserGameObject,PHASER_AUDIO=function(){return function(){}}(),PHASER_BITMAPDATA_MANAGER=function(){function e(){this.game=null,this.bmd={array:[],object:{}}}return e.prototype.assign=function(e){this.game=e},e.prototype.addGradient=function(e){if(0===this.bmd.array.filter(function(t){return t.name===e.name}).length){var t=this.game.make.bitmapData(e.width,e.height),a=t.context.createLinearGradient(0,0,0,e.height);a.addColorStop(0,e.start),a.addColorStop(1,e.end),t.context.fillStyle=a,t.context.fillRect(0,0,e.width,e.height);var n=this.game.cache.addBitmapData(e.name,t),i=this.game.make.bitmapData();return i.load(this.game.cache.getBitmapData(e.name)),e.render&&i.addToWorld(e.x,e.y),i.name=e.name,i.group=e.group,i.cacheBitmapData=n,this.bmd.array.push(i),this.bmd.object[e.name]=i,i}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.addImage=function(e){if(0===this.bmd.array.filter(function(t){return t.name===e.name}).length){var t=this.game.make.bitmapData();return t.load(e.reference),t.addToWorld(e.x,e.y),e.render||t.cls(),t.name=e.name,t.group=e.group,t.cacheBitmapData=e.reference,this.bmd.array.push(t),this.bmd.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.addEmpty=function(e){if(0===this.bmd.array.filter(function(t){return t.name===e.name}).length){var t=this.game.make.bitmapData(e.width,e.height);return t.addToWorld(e.x,e.y),e.render||t.cls(),t.name=e.name,t.group=e.group,this.bmd.array.push(t),this.bmd.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.destroy=function(e){for(var t=[],a=0,n=this.bmd.array.filter(function(t){return t.name===e});a<n.length;a++){var i=n[a];t.push(i.name),i.destroy()}return delete this.bmd.object[e],this.bmd.array=this.bmd.array.filter(function(t){return t.name!==e}),t},e.prototype.destroyGroup=function(e){for(var t=[],a=0,n=this.bmd.array.filter(function(e){return e.group===name});a<n.length;a++){var i=n[a];t.push(i.name),i.destroy()}return delete this.bmd.object[name],this.bmd.array=this.bmd.array.filter(function(e){return e.group!==name}),t},e.prototype.get=function(e){return this.bmd.object[e]},e.prototype.getGroup=function(e){return this.bmd.array.filter(function(t){return t.group===e})},e.prototype.getAll=function(e){return void 0===e&&(e="BOTH"),"ARRAY"===e?this.bmd.array:"OBJECT"==e?this.bmd.object:{object:this.bmd.object,array:this.bmd.array}},e.prototype.takeSnapshot=function(){return this.game.canvas.toDataURL()},e}(),PHASER_BUTTON_MANAGER=function(){function e(){this.game=null,this.resources={array:[],object:{}}}return e.prototype.assign=function(e){this.game=e.game},e.prototype.add=function(e){if(0===this.resources.array.filter(function(t){return t.name===e.name}).length){var t=this.game.add.button(e.x,e.y,e.reference,e.onclick);return t.name=e.name,t.group=e.group||null,this.resources.array.push(t),this.resources.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.destroy=function(e){for(var t=[],a=0,n=this.resources.array.filter(function(t){return t.key===e});a<n.length;a++){var i=n[a];t.push(i.key),i.destroy()}return delete this.resources.object[e],this.resources.array=this.resources.array.filter(function(t){return t.key!==e}),t},e.prototype.destroyGroup=function(e){for(var t=[],a=0,n=this.resources.array.filter(function(t){return t.group===e});a<n.length;a++){var i=n[a];t.push(i.key),i.destroy()}return delete this.resources.object[e],this.resources.array=this.resources.array.filter(function(t){return t.group!==e}),t},e.prototype.get=function(e){return this.resources.object[e]},e.prototype.getGroup=function(e){return this.resources.array.filter(function(t){return t.group===e})},e.prototype.getAll=function(e){return void 0===e&&(e="BOTH"),"ARRAY"===e?this.resources.array:"OBJECT"==e?this.resources.object:{object:this.resources.object,array:this.resources.array}},e}(),PHASER_CONTROLS=function(){function e(){this.IO=null,this.game=null,this.buttonSensitivity={QUICK:1,SHORT:50,LONG:150,SUPERLONG:300},this.releasedKeys=[],this.properties={isReady:!1,allowDebugger:!0,buttonDelay:50,timingRefreshRate:1},this.directionalButtons=["UP","DOWN","LEFT","RIGHT"],this.actionButtons=["A","B","X","Y"],this.triggerButtons=["L1","L2","R1","R2","L3","R3"],this.systemButtons=["START","BACK"],this.buttonArray=this.directionalButtons.concat(this.actionButtons,this.triggerButtons,this.systemButtons),this.buttonMap={UP:{name:"UP",code:"ArrowUp"},DOWN:{name:"DOWN",code:"ArrowDown"},LEFT:{name:"LEFT",code:"ArrowLeft"},RIGHT:{name:"RIGHT",code:"ArrowRight"},A:{name:"A",code:"KeyA"},B:{name:"S",code:"KeyS"},X:{name:"D",code:"KeyD"},Y:{name:"F",code:"KeyF"},L1:{name:"Q",code:"KeyQ"},L2:{name:"W",code:"KeyW"},R1:{name:"E",code:"KeyE"},R2:{name:"R",code:"KeyR"},L3:{name:"O",code:"KeyO"},R3:{name:"P",code:"KeyP"},START:{name:"ENTER",code:"Enter"},BACK:{name:"BACKSPACE",code:"Backspace"}},this.buttonMapId={UP:1,DOWN:2,LEFT:3,RIGHT:4,A:5,B:6,X:7,Y:8,L1:9,L2:10,R1:11,R2:12,L3:13,R3:14,START:15,BACK:16},this.disabledButtons={ALL:!1,DIRECTIONAL:!1,TRIGGER:!1,ACTION:!1,SYSTEM:!1},this.debugger={enabled:!1,text:{}},this.inputDelay={delay:Array.apply(null,Array(20)).map(function(){return 0})}}return e.prototype.assign=function(e){var t=this;this.game=e;var a={font:"12px Courier New",fill:"#fff",align:"left"};this.buttonArray.forEach(function(n,i){t.debugger.text[n]=null,t.debugger.text[n]=e.add.text(10,10+15*i,"",a),t.disabledButtons[n]=!1});for(var n={buttons:{},sensitivityPress:{},sensitivityBuffer:{},state:{}},i=function(a){n.buttons[a]=e.input.keyboard.addKey(Phaser.Keyboard[r.buttonMap[a].name]),n.sensitivityPress[a]=null,n.sensitivityBuffer[a]=0,n.state[a]=function(){return t.getBtnPressType(t.IO.sensitivityBuffer[a])}},r=this,o=0,s=this.buttonArray;o<s.length;o++){i(s[o])}for(var l=function(e){n.buttons[e].onDown.add(function(a){var i,r;clearInterval(n.sensitivityPress[e]);var o=["DIRECTIONAL","ACTION","TRIGGER","SYSTEM"];Object.keys(t.buttonMap).forEach(function(e,n){if(t.buttonMap[e].code===a.event.code)for(var s=0,l=o;s<l.length;s++){var p=l[s];t[p.toLowerCase()+"Buttons"].indexOf(e)+1&&(i=p,r=e)}});var s=!1;t.disabledButtons.ALL&&(s=!0);for(var l=0,p=o;l<p.length;l++){var h=p[l];t.disabledButtons[h]&&i===h&&(s=!0)}Object.keys(t.buttonMap).forEach(function(e,a){t.disabledButtons[e]&&r===e&&(s=!0)}),s||(n.sensitivityPress[e]=setInterval(function(){n.sensitivityBuffer[e]+=1},t.properties.timingRefreshRate))},p)},p=this,h=0,u=this.buttonArray;h<u.length;h++){l(u[h])}return e.input.keyboard.onUpCallback=function(e){for(var a=0,i=t.buttonArray;a<i.length;a++){var r=i[a];e.code===t.buttonMap[r].code&&(t.releasedKeys.push(t.buttonMap[r].code),setTimeout(function(){t.releasedKeys.shift()},1500),clearInterval(n.sensitivityPress[r]),n.sensitivityBuffer[r]=0)}"Backquote"===e.code&&t.properties.allowDebugger&&(t.setDebugger(!t.debugger.enabled),t.updateDebugger())},this.properties.isReady=!0,this.IO=n,n},e.prototype.mapKeys=function(e){var t=this;this.properties.isReady=!1,this.destroyAll(),setTimeout(function(){t.buttonMap=e,t.properties.isReady=!0,t.assign(t.game)},1)},e.prototype.isReady=function(){return this.properties.isReady},e.prototype.checkWithDelay=function(e){return this.read(e.key).active===e.isActive&&(this.game.time.now>this.inputDelay.delay[this.getKeyId(e.key)]&&(this.inputDelay.delay[this.getKeyId(e.key)]=e.delay+this.game.time.now,!0))},e.prototype.isDebuggerEnabled=function(){return this.debugger.enabled},e.prototype.setDebugger=function(e){void 0===e&&(e=!0),this.debugger.enabled=e},e.prototype.updateDebugger=function(){if(this.properties.isReady)for(var e=0,t=this.buttonArray;e<t.length;e++){var a=t[e];this.debugger.text[a].setText(this.debugger.enabled?this.debuggerString(a):"").bringToTop()}},e.prototype.disableAllInput=function(){this.disabledButtons.ALL=!0},e.prototype.enableAllInput=function(){this.disabledButtons.ALL=!1},e.prototype.disableAllDirectionalButtons=function(){this.disabledButtons.DIRECTIONAL=!0},e.prototype.enableAllDirectionalButtons=function(){this.disabledButtons.DIRECTIONAL=!1},e.prototype.disableAllTriggerButtons=function(){this.disabledButtons.TRIGGER=!0},e.prototype.enableAllTriggerButtons=function(){this.disabledButtons.TRIGGER=!1},e.prototype.disableAllActionButtons=function(){this.disabledButtons.ACTION=!0},e.prototype.enableAllActionButtons=function(){this.disabledButtons.ACTION=!1},e.prototype.disableAllSystemButtons=function(){this.disabledButtons.SYSTEM=!0},e.prototype.enableAllSystemButtons=function(){this.disabledButtons.SYSTEM=!1},e.prototype.setDisableKeyProperty=function(e,t){void 0===t&&(t=!0),this.properties.isReady&&(this.disabledButtons[e.toUpperCase()]=t)},e.prototype.getKeyDisabledValue=function(e){return this.properties.isReady?this.disabledButtons[e.toUpperCase()]:null},e.prototype.clearAllControlIntervals=function(){if(this.properties.isReady)for(var e=0,t=this.buttonArray;e<t.length;e++){var a=t[e];clearInterval(this.IO.sensitivityPress[a])}},e.prototype.getKeyId=function(e){return this.buttonMapId[e.toUpperCase()]},e.prototype.read=function(e){if(this.properties.isReady){return{}[e]={id:this.buttonMapId[e.toUpperCase()],active:this.IO.state[e.toUpperCase()]().val>0,duration:this.IO.state[e.toUpperCase()]().val,state:this.IO.state[e.toUpperCase()]().state,type:this.IO.state[e.toUpperCase()]().type,disabled:this.disabledButtons[e.toUpperCase()]}}return{}},e.prototype.readMulti=function(e,t){if(void 0===t&&(t="OBJECT"),this.properties.isReady){if("OBJECT"===t){for(var a={},n=0,i=e;n<i.length;n++){a[s=i[n]]={id:this.buttonMapId[s.toUpperCase()],active:this.IO.state[s.toUpperCase()]().val>0,duration:this.IO.state[s.toUpperCase()]().val,state:this.IO.state[s.toUpperCase()]().state,type:this.IO.state[s.toUpperCase()]().type,disabled:this.disabledButtons[s.toUpperCase()]}}return a}if("ARRAY"===t){a=[];for(var r=0,o=e;r<o.length;r++){var s=o[r];a.push({id:this.buttonMapId[s.toUpperCase()],key:s,active:this.IO.state[s.toUpperCase()]().val>0,duration:this.IO.state[s.toUpperCase()]().val,state:this.IO.state[s.toUpperCase()]().state,type:this.IO.state[s.toUpperCase()]().type,disabled:this.disabledButtons[s.toUpperCase()]})}return a}}},e.prototype.getReleasedKeys=function(){return this.releasedKeys},e.prototype.getOnly=function(e){for(var t=this,a={},n=function(n){e.map(function(e){n===e&&(a[n]={id:t.buttonMapId[n.toUpperCase()],active:t.IO.state[n.toUpperCase()]().val>0,duration:t.IO.state[n.toUpperCase()]().val,state:t.IO.state[n.toUpperCase()]().state,type:t.IO.state[n.toUpperCase()]().type,disabled:t.disabledButtons[n.toUpperCase()]})})},i=0,r=this.buttonArray;i<r.length;i++){n(r[i])}return a},e.prototype.getAll=function(){for(var e={},t=0,a=this.buttonArray;t<a.length;t++){var n=a[t];e[n]={id:this.buttonMapId[n.toUpperCase()],active:this.IO.state[n.toUpperCase()]().val>0,duration:this.IO.state[n.toUpperCase()]().val,state:this.IO.state[n.toUpperCase()]().state,type:this.IO.state[n.toUpperCase()]().type,disabled:this.disabledButtons[n.toUpperCase()]}}return e},e.prototype.debuggerString=function(e){return e.toUpperCase()+" ("+this.buttonMap[e.toUpperCase()].name+"/"+this.buttonMap[e.toUpperCase()].code+") | id: "+this.buttonMapId[e.toUpperCase()]+" duration: "+this.IO.state[e.toUpperCase()]().val+" | state: "+this.IO.state[e.toUpperCase()]().state+" | type: "+this.IO.state[e.toUpperCase()]().type+" | disabled: "+this.disabledButtons[e.toUpperCase()]},e.prototype.getBtnPressType=function(e){var t=this,a="NONE",n=0,i=0;return Object.keys(this.buttonSensitivity).forEach(function(r){i++,e>t.buttonSensitivity[r]&&(a=r,n=i)}),{val:e,type:a,state:n}},e.prototype.destroyAll=function(){var e=this;this.clearAllControlIntervals(),Object.keys(this.debugger.text).forEach(function(t){e.debugger.text[t].destroy()})},e}(),PHASER_GROUP_MANAGER=function(){function e(){this.game=null,this.group={array:[],object:{}}}return e.prototype.assign=function(e,t){void 0===t&&(t=10),this.game=e;for(var a=0;a<=t;a++){var n=e.add.group();this.group.object[""+a]=n,this.group.array.push(n)}},e.prototype.layer=function(e){return this.group.object[e]},e.prototype.add=function(e,t){this.group.object[e].add(t)},e.prototype.addMany=function(e,t){var a=this;t.forEach(function(t){a.group.object[e].add(t)})},e}(),PHASER_MASTER=function(){function e(e){var t=this;this._game=e.game,this.element=e.element,this.resolution=e.resolution,this.states={BOOT:"BOOT",PRELOAD:"PRELOAD",READY:"READY"},this.currentState=this.states[0],this.variables={},setTimeout(function(){t._game.time.pausedTimeTotal=0,t._game.time.addToPausedTime=function(e){t._game.time.pausedTimeTotal+=e},t._game.time.returnTrueTime=function(){return t._game.time.now-t._game.time.pausedTimeTotal}},1)}return e.prototype.let=function(e,t){if(void 0===t&&(t=null),void 0===this.variables[e])return this.variables[e]=t;console.log("Cannot LET duplicate key in PHASER_MASTER: "+e)},e.prototype.forceLet=function(e,t){return void 0===t&&(t=null),this.variables[e]=t},e.prototype.delete=function(e){delete this.variables[e]},e.prototype.get=function(e){return void 0!==this.variables[e]?this.variables[e]:(console.log("Cannot GET a variable that does not exist in PHASER_MASTER."),null)},e.prototype.getAll=function(){return this.variables},e.prototype.getOnly=function(e){var t={},a=[];for(var n in this.variables)a.push({key:n,data:this.variables[n]});for(var i=function(n){a.filter(function(t){return t.key===e[n]}).map(function(e){t[e.key]=e.data})},r=0;r<e.length;r++)i(r);return t},e.prototype.changeState=function(e){void 0===e&&(e=null);var t=e.toUpperCase(),a=!1;return void 0===this.states[t]&&(this.states[t]=t,a=!0),this.currentState=t,{created:a,state:this.currentState}},e.prototype.getCurrentState=function(){return this.currentState},e.prototype.getElement=function(){return this.element},e.prototype.getStates=function(){return this.states},e.prototype.getResolution=function(){return this.resolution},e.prototype.checkState=function(e){return this.currentState===e.toUpperCase()},e.prototype.getState=function(){return{currentState:this.currentState}},e.prototype.game=function(){return this._game},e}(),PHASER_MOUSE=function(){function e(e){this.game=null,this.clickSensitvity={QUICK:1,SHORT:50,LONG:150,SUPERLONG:300},this.mouseMapping=[0,1,2],this.mouseMap={LEFT:0,MIDDLE:1,RIGHT:2},this.metrics={sensitivityPress:{},sensitivityBuffer:{},location:{},state:{}},this.properties={allowDebugger:!0,timingRefreshRate:1},this.inputDelay={delay:Array.apply(null,Array(2)).map(function(){return 0})},this.debugger={enabled:void 0!==e.showDebugger&&e.showDebugger,text:{},pointer:null}}return e.prototype.assign=function(e){var t=this;this.game=e;for(var a=function(e){n.metrics.sensitivityPress[e]=null,n.metrics.sensitivityBuffer[e]=0,n.metrics.location[e]={x:null,y:null},n.metrics.state[e]=function(){return t.getBtnPressType(t.metrics.sensitivityBuffer[e])}},n=this,i=0,r=this.mouseMapping;i<r.length;i++){a(r[i])}this.game.input.onDown.add(function(e){var a=t.checkMouseClick();clearInterval(t.metrics.sensitivityPress[a]),t.metrics.sensitivityPress[a]=setInterval(function(){t.metrics.sensitivityBuffer[a]+=1,t.metrics.location[a]={x:e.x,y:e.y}},t.properties.timingRefreshRate)}),this.game.input.onUp.add(function(e){var a=t.checkMouseClick();t.clearAllControlIntervals(),t.metrics.sensitivityBuffer[a]=0});var o={font:"12px Courier New",fill:"#fff",align:"left"};this.mouseMapping.forEach(function(e,a){t.debugger.text[e]=null,t.debugger.text[e]=t.game.add.text(5,t.game.height-35-15*a,"",o)}),this.debugger.pointer=this.game.add.text(5,this.game.height-20,"",o),e.canvas.oncontextmenu=function(e){e.preventDefault()}},e.prototype.checkMouseClick=function(){var e=0;return this.game.input.activePointer.leftButton.isDown&&(e=0),this.game.input.activePointer.middleButton.isDown&&(e=1),this.game.input.activePointer.rightButton.isDown&&(e=2),e},e.prototype.debuggerString=function(e){return"Button_"+e+" | {x: "+this.metrics.location[e].x+", y: "+this.metrics.location[e].y+"} | active: "+(this.metrics.sensitivityBuffer[e]>0)+" | state: "+this.metrics.state[e]().state+" | duration: "+this.metrics.state[e]().val+" | type: "+this.metrics.state[e]().type},e.prototype.setDebugger=function(e){void 0===e&&(e=!0),this.debugger.enabled=e},e.prototype.updateDebugger=function(){for(var e=0,t=this.mouseMapping;e<t.length;e++){var a=t[e];this.debugger.text[a].setText(this.debugger.enabled?this.debuggerString(a):"").bringToTop()}this.debugger.pointer.setText(this.debugger.enabled?"Pointer: {x: "+this.game.input.mousePointer.x+", y: "+this.game.input.mousePointer.y+"}":"").bringToTop()},e.prototype.clearAllControlIntervals=function(){for(var e=0,t=this.mouseMapping;e<t.length;e++){var a=t[e];this.metrics.sensitivityBuffer[a]=0,clearInterval(this.metrics.sensitivityPress[a])}},e.prototype.checkWithDelay=function(e){if(this.read(e.key).active===e.isActive){var t=this.mouseMap[e.key.toUpperCase()];return this.game.time.now>this.inputDelay.delay[t]&&(this.inputDelay.delay[t]=e.delay+this.game.time.now,!0)}return!1},e.prototype.read=function(e){void 0===e&&(e="LEFT");var t=this.mouseMap[e.toUpperCase()];return{id:t,x:this.metrics.location[t].x,y:this.metrics.location[t].y,active:this.metrics.sensitivityBuffer[t]>0,duration:this.metrics.sensitivityBuffer[t],state:this.metrics.state[t]().state,type:this.metrics.state[t]().type}},e.prototype.getBtnPressType=function(e){var t=this,a="NONE",n=0,i=0;return Object.keys(this.clickSensitvity).forEach(function(r){i++,e>t.clickSensitvity[r]&&(a=r,n=i)}),{val:e,type:a,state:n}},e}(),PHASER_PRELOADER=function(){function e(e){this.game=e.game,this.init(e.delayInSeconds,e.done)}return e.prototype.init=function(e,t){var a,n,i=this;this.game.load.onLoadStart.add(function(){(a=i.game.add.text(i.game.world.centerX,i.game.world.centerY/2,"",{font:"18px Impact",fill:"#fff",align:"center"})).anchor.set(.5),(n=i.game.add.text(i.game.world.centerX,i.game.world.centerY,"",{font:"32px Impact",fill:"#fff",align:"center"})).anchor.set(.5)},this),this.game.load.onFileComplete.add(function(e,t,i,r,o){a.setText("Please wait..."),n.setText(e+"%")},this),this.game.load.onLoadComplete.add(function(){a.setText("File loaded!"),n.setText(""),i.game.time.events.add(Phaser.Timer.SECOND*e,function(){a.destroy(),n.destroy(),t()},i).autoDestroy=!0},this)},e}(),PHASER_SPRITE_MANAGER=function(){function e(){this.game=null,this.sprites={array:[],object:{}},this.spriteCount=0}return e.prototype.assign=function(e){this.game=e},e.prototype.add=function(e){if(0===this.sprites.array.filter(function(t){return t.name===e.name}).length){e.x=void 0!==e.x?e.x:0,e.y=void 0!==e.y?e.y:0,e.group=void 0!==e.group?e.group:null,e.org=void 0!==e.org?e.org:null,e.visible=void 0===e.visible||e.visible,e.alpha=void 0!==e.alpha?e.alpha:1,e.width=void 0!==e.width?e.width:null,e.height=void 0!==e.height?e.height:null;var t=this.game.add.sprite(e.x,e.y,e.reference);return t.name=e.name,t.group=e.group,t.org=e.org,t.defaultPosition={x:e.x,y:e.y},t.visible=e.visible,t.alpha=e.alpha,null!==e.width&&(t.width=e.width),null!==e.height&&(t.height=e.height),t.setDefaultPositions=function(e,t){this.defaultPosition.x=e||this.x,this.defaultPosition.y=t||this.y},t.getDefaultPositions=function(){return this.defaultPosition},t.init=function(){},t.onUpdate=function(){},t.reveal=function(){},t.show=function(){this.visible=!0},t.hide=function(){this.visible=!1},this.sprites.array.push(t),this.sprites.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.addFromAtlas=function(e){if(0===this.sprites.array.filter(function(t){return t.name===e.name}).length){e.x=void 0!==e.x?e.x:0,e.y=void 0!==e.y?e.y:0,e.group=void 0!==e.group?e.group:null,e.org=void 0!==e.org?e.org:null,e.visible=void 0===e.visible||e.visible,e.alpha=void 0!==e.alpha?e.alpha:1,e.width=void 0!==e.width?e.width:null,e.height=void 0!==e.height?e.height:null;var t=this.game.add.sprite(e.x,e.y,e.atlas,e.filename);return t.name=e.name,t.group=e.group,t.org=e.org,t.defaultPosition={x:e.x,y:e.y},t.visible=e.visible,t.alpha=e.alpha,null!==e.width&&(t.width=e.width),null!==e.height&&(t.height=e.height),t.setDefaultPositions=function(e,t){this.defaultPosition.x=e||this.x,this.defaultPosition.y=t||this.y},t.getDefaultPositions=function(){return this.defaultPosition},t.init=function(){},t.onUpdate=function(){},t.reveal=function(){},t.show=function(){this.visible=!0},t.hide=function(){this.visible=!1},this.sprites.array.push(t),this.sprites.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.addTilespriteFromAtlas=function(e){if(0===this.sprites.array.filter(function(t){return t.name===e.name}).length){e.x=void 0!==e.x?e.x:0,e.y=void 0!==e.y?e.y:0,e.group=void 0!==e.group?e.group:null,e.org=void 0!==e.org?e.org:null,e.visible=void 0===e.visible||e.visible,e.alpha=void 0!==e.alpha?e.alpha:1,e.width=void 0!==e.width?e.width:null,e.height=void 0!==e.height?e.height:null;var t=this.game.add.tileSprite(e.x,e.y,e.width,e.height,e.atlas,e.filename);return t.name=e.name,t.group=e.group,t.org=e.org,t.defaultPosition={x:e.x,y:e.y},t.visible=e.visible,t.alpha=e.alpha,null!==e.width&&(t.width=e.width),null!==e.height&&(t.height=e.height),t.setDefaultPositions=function(e,t){this.defaultPosition.x=e||this.x,this.defaultPosition.y=t||this.y},t.getDefaultPositions=function(){return this.defaultPosition},t.init=function(){},t.onUpdate=function(){},t.reveal=function(){},t.show=function(){this.visible=!0},t.hide=function(){this.visible=!1},this.sprites.array.push(t),this.sprites.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.addEmptySprite=function(e){if(0===this.sprites.array.filter(function(t){return t.name===e.name}).length){e.x=void 0!==e.x?e.x:0,e.y=void 0!==e.y?e.y:0,e.group=void 0!==e.group?e.group:null,e.org=void 0!==e.org?e.org:null,e.visible=void 0===e.visible||e.visible,e.alpha=void 0!==e.alpha?e.alpha:1,e.width=void 0!==e.width?e.width:null,e.height=void 0!==e.height?e.height:null;var t=this.game.add.sprite(e.x,e.y);return t.name=e.name,t.group=e.group,t.org=e.org,t.defaultPosition={x:e.x,y:e.y},t.visible=e.visible,t.alpha=e.alpha,null!==e.width&&(t.width=e.width),null!==e.height&&(t.height=e.height),t.setDefaultPositions=function(e,t){this.defaultPosition.x=e||this.x,this.defaultPosition.y=t||this.y},t.getDefaultPositions=function(){return this.defaultPosition},t.init=function(){},t.onUpdate=function(){},t.reveal=function(){},t.show=function(){this.visible=!0},t.hide=function(){this.visible=!1},this.sprites.array.push(t),this.sprites.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.createBasicMask=function(e,t,a,n){var i=this.game.add.graphics(0,0);return i.beginFill(16777215),i.drawRect(e,t,a,n),i},e.prototype.addBasicMaskToSprite=function(e){var t=this.game.add.graphics(0,0);return t.beginFill(16777215),t.drawRect(e.x,e.y,e.width,e.height),e.mask=t,t},e.prototype.destroy=function(e){if(void 0!==this.sprites.object[e]){for(var t=[],a=0,n=this.sprites.array.filter(function(t){return t.name===e});a<n.length;a++){var i=n[a];t.push(i.name),i.destroy()}return delete this.sprites.object[e],this.sprites.array=this.sprites.array.filter(function(t){return t.name!==e}),t}return console.log("Cannot delete "+e+" because it does not exist."),null},e.prototype.destroyGroup=function(e){for(var t=[],a=0,n=this.sprites.array.filter(function(t){return t.group===e});a<n.length;a++){var i=n[a];t.push(i.name),i.destroy()}return delete this.sprites.object[e],this.sprites.array=this.sprites.array.filter(function(t){return t.group!==e}),t},e.prototype.get=function(e){return this.sprites.object[e]},e.prototype.getGroup=function(e){return this.sprites.array.filter(function(t){return t.group===e||t.org===e})},e.prototype.getManyGroups=function(e){for(var t=[],a=function(a){var i=n.sprites.array.filter(function(t){return t.group===e[a]||t.org===e[a]});t=t.concat(i)},n=this,i=0;i<e.length;i++)a(i);return t},e.prototype.getOnly=function(e){for(var t={},a=function(a){n.sprites.array.filter(function(t){return t.group===e[a]||t.name===e[a]}).map(function(e){t[e.name]=e})},n=this,i=0;i<e.length;i++)a(i);return t},e.prototype.getAll=function(e){return void 0===e&&(e="OBJECT"),"ARRAY"===e?this.sprites.array:"OBJECT"==e?this.sprites.object:{object:this.sprites.object,array:this.sprites.array}},e.prototype.count=function(){return this.spriteCount++,{total:this.sprites.array.length,unique:this.spriteCount}},e.prototype.centerWorld=function(e){if(void 0===this.sprites.object[e])return console.log("Error centering sprite:  key does not exists."),null;var t=this.sprites.object[e];return t.alignIn(this.game.world.bounds,Phaser.CENTER),t},e.prototype.centerOnPoint=function(e,t,a){if(void 0===this.sprites.object[e])return console.log("Error centering sprite:  key does not exists."),null;var n=this.sprites.object[e];return n.x=t-n.width/2,n.y=a-n.height/2,n},e}(),PHASER_TEXT_MANAGER=function(){function e(){this.game=null,this.texts={array:[],object:{}}}return e.prototype.assign=function(e){this.game=e},e.prototype.add=function(e){var t=this.texts.array.filter(function(t){return t.name===e.name});if(e.x=void 0!==e.x?e.x:0,e.y=void 0!==e.y?e.y:0,e.group=void 0!==e.group?e.group:null,e.size=void 0!==e.size?e.size:12,e.default=void 0!==e.default?e.default:"",e.visible=void 0===e.visible||e.visible,e.alpha=void 0!==e.alpha?e.alpha:1,0===t.length){var a=this.game.add.bitmapText(e.x,e.y,e.font,e.default,e.size);return a.name=e.name,a.group=e.group,a.visible=e.visible,a.alpha=e.alpha,a.init=function(){},a.show=function(){this.visible=!0},a.hide=function(){this.visible=!1},this.texts.array.push(a),this.texts.object[e.name]=a,a}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.destroy=function(e){for(var t=[],a=0,n=this.texts.array.filter(function(t){return t.name===e});a<n.length;a++){var i=n[a];t.push(i.name),i.destroy()}return delete this.texts.object[e],this.texts.array=this.texts.array.filter(function(t){return t.name!==e}),t},e.prototype.destroyGroup=function(e){for(var t=[],a=0,n=this.texts.array.filter(function(t){return t.group===e});a<n.length;a++){var i=n[a];t.push(i.key),i.destroy()}return delete this.texts.object[e],this.texts.array=this.texts.array.filter(function(t){return t.group!==e}),t},e.prototype.get=function(e){return this.texts.object[e]},e.prototype.getGroup=function(e){return this.texts.array.filter(function(t){return t.group===e})},e.prototype.getManyGroups=function(e){for(var t=[],a=function(a){var i=n.texts.array.filter(function(t){return t.group===e[a]});t=t.concat(i)},n=this,i=0;i<e.length;i++)a(i);return t},e.prototype.getAll=function(e){return void 0===e&&(e="OBJECT"),"ARRAY"===e?this.texts.array:"OBJECT"==e?this.texts.object:{object:this.texts.object,array:this.texts.array}},e.prototype.getOnly=function(e){for(var t={},a=function(a){n.texts.array.filter(function(t){return t.group===e[a]||t.name===e[a]}).map(function(e){t[e.name]=e})},n=this,i=0;i<e.length;i++)a(i);return t},e.prototype.alignToBottomLeftCorner=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=t,a.y=n.canvas.height-a.height-t,a},e.prototype.alignToBottomCenter=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=n.canvas.width/2-a.width/2,a.y=n.canvas.height-a.height-t,a},e.prototype.alignToBottomRightCorner=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=n.canvas.width-a.width-t,a.y=n.canvas.height-a.height-t,a},e.prototype.alignToCenterRight=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=n.canvas.width-a.width-t,a.y=n.canvas.height/2-a.height/2,a},e.prototype.alignToTopRightCorner=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=n.canvas.width-a.width-t,a.y=t,a},e.prototype.alignToTopCenter=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=n.canvas.width/2-a.width/2-t,a.y=t,a},e.prototype.alignToTopLeftCorner=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e];this.game;return a.x=t,a.y=t,a},e.prototype.alignToCenterLeft=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=t,a.y=n.canvas.height/2-a.height/2,a},e.prototype.alignToCenter=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=n.canvas.width/2-a.width/2,a.y=n.canvas.height/2-a.height/2,a},e.prototype.center=function(e,t,a){if(void 0===t&&(t=0),void 0===a&&(a=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var n=this.texts.object[e],i=this.game;return n.x=i.canvas.width/2-n.width/2+t,n.y=i.canvas.height/2-n.height/2+a,n},e}(),DIALOG_MANAGER=function(){function e(){}return e.prototype.assign=function(e,t,a,n,i,r,o){this.game=e,this.phaserSprites=a,this.phaserMaster=t,this.phaserGroup=n,this.phaserTexts=i,this.phaserControls=r,this.atlas=o,this.dialogGenerator,this.dialogbox},e.prototype.create=function(){var e=this,t=e.game,a=e.phaserMaster,n=e.phaserSprites,i=e.phaserGroup,r=e.phaserTexts,o=(e.atlas,a.getResolution()),s=o.w,l=o.h,p=n.addEmptySprite({x:0,y:l+300,name:"dialogbox",visible:!1});p.reveal=function(e){p.getDefaultPositions().y;p.visible=!0,p.setDefaultPositions(),p.children.map(function(e){void 0!==e.onStart&&e.onStart()}),t.add.tween(p).to({y:l-110},Phaser.Timer.SECOND/2,Phaser.Easing.Circular.InOut,!0,1,0,!1).onComplete.add(function(){e()})},p.hide=function(){p.text.replaceText(""),t.add.tween(p).to({y:p.getDefaultPositions().y},Phaser.Timer.SECOND/2,Phaser.Easing.Circular.InOut,!0,1,0,!1).onComplete.add(function(){p.children.map(function(e){void 0!==e.onStop&&e.onStop()})})};var h=n.addFromAtlas({x:0,y:0,width:s,height:110,name:"dialogboxGraphic",filename:"dialogbox",atlas:"atlas_main",alpha:.8});p.addChild(h);var u=n.addFromAtlas({x:10,y:8,name:"dialogPortraitFrame",filename:"ui_portraitContainer",atlas:"atlas_main",visible:!0});p.addChild(u);var d=n.createBasicMask(13,11,u.width-3,u.height-3);p.addChild(d),u.replaceImage=function(e){void 0!==n.get("dialogPortraitImage")&&n.destroy("dialogPortraitImage");var t=n.addFromAtlas({name:"dialogPortraitImage",filename:e,atlas:"atlas_main"});t.mask=d,u.addChild(t)},u.onStart=function(){var e=Phaser.Animation.generateFrameNames("portrait_static_",1,4).concat(Phaser.Animation.generateFrameNames("portrait_static_",3,1)),t=n.addFromAtlas({x:10,y:8,name:"dialogboxStatic",filename:e[0],atlas:"atlas_main",visible:!0,alpha:.35});t.animations.add("static",e,1,!0),t.mask=d,p.addChild(t),t.animations.play("static",30,!0)},u.onStop=function(){n.destroy("dialogboxStatic"),void 0!==n.get("dialogPortraitImage")&&n.destroy("dialogPortraitImage")};var c=Phaser.Animation.generateFrameNames("a_button_",1,9).slice(),m=n.addFromAtlas({x:h.width-40,y:h.height-40,name:"dialogboxButton",filename:c[0],atlas:"atlas_main",visible:!1});m.animations.add("animate",c),m.onStop=function(){m.animations.stop(null,!0)},p.addChild(m);var g=r.add({x:100,y:10,name:"dialogtext",font:"gem",size:16});g.maxWidth=s-100-15,p.addChild(g),g.replaceText=function(e,a){void 0===a&&(a=function(){}),g.alpha=0,m.visible=!1,g.setText(e),t.add.tween(g).to({alpha:1},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.In,!0,1,0,!1).onComplete.add(function(){m.visible=!0,a()})},g.onStart=function(){},g.onStop=function(){g.replaceText("")};var y=r.add({y:-20,name:"skipallText",font:"gem",default:"PRESS START TO SKIP",size:15,visible:!1});y.x=s-y.width-10,p.addChild(y),p.portrait=u,p.text=g,p.skipallText=y,p.dialogboxButton=m,this.dialogbox=p,i.addMany(a.get("layers").DIALOGBOX,[p])},e.prototype.dialog=function(e){var t;return __generator(this,function(a){switch(a.label){case 0:t=0,a.label=1;case 1:return t<e.length?[4,e[t]]:[3,4];case 2:a.sent(),a.label=3;case 3:return t++,[3,1];case 4:return[4,null];case 5:return a.sent(),[2]}})},e.prototype.start=function(e,t){var a=this,n=(a.game,a.phaserMaster),i=a.phaserSprites,r=(a.phaserGroup,a.phaserTexts,a.phaserControls),o=(a.atlas,n.getState().currentState),s=this.dialog(e);this.canSkip=!1,this.onTimer=!1,this.autoplay=!1,s.complete=t,s.revertToState=o,s.isReady=!1,r.enableAllActionButtons(),this.createDialogbox(s),s.nextItem=function(e){var t=e.text,a=e.portrait;s.dialogbox.portrait.replaceImage(a),s.dialogbox.text.replaceText(t,function(){})},s.finished=function(){i.getGroup("player_healthbar").concat(i.getGroup("player_pow")).map(function(e){e.fadeIn()}),n.changeState(s.revertToState),s.dialogbox.hide(),t()},n.changeState("DIALOG"),this.dialogGenerator=s},e.prototype.createDialogbox=function(e){var t=this,a=this,n=(a.game,a.phaserMaster,a.phaserSprites),i=(a.phaserGroup,a.phaserTexts,a.phaserControls,a.atlas,this.dialogbox);n.getGroup("player_healthbar").concat(n.getGroup("player_pow")).map(function(e){e.fadeOut()}),i.reveal(function(){e.dialogbox=i,e.dialogbox.text.replaceText("",function(){e.isReady=!0,t.next()})})},e.prototype.next=function(e){var t=this;void 0===e&&(e=!1);var a=this.dialogbox;if(this.dialogGenerator.isReady&&!this.onTimer||e){var n=this.dialogGenerator.next().value;null===n?this.dialogGenerator.finished():(n.autoplay&&(this.autoplay=n.autoplay,this.autoplay?a.dialogboxButton.animations.play("animate",6,!0):a.dialogboxButton.animations.stop("animate")),this.autoplay&&(n.timer=50*n.text.length>2500?50*n.text.length:2500),n.canSkip&&(this.canSkip=n.canSkip),a.skipallText.visible=this.canSkip,n.timer?(this.onTimer=!0,this.execute(n),this.game.time.events.add(n.timer,function(){t.execute(n,function(){t.next(!0)})},this).autoDestroy=!0):(this.onTimer=!1,this.execute(n)))}},e.prototype.execute=function(e,t){void 0===t&&(t=function(){}),null!==e&&(this.dialogGenerator.nextItem(e),t()),null===e&&this.dialogGenerator.finished()},e.prototype.skipAll=function(){this.dialogGenerator.isReady&&this.canSkip&&this.dialogGenerator.finished()},e}(),EFFECTS_MANAGER=function(){function e(){}return e.prototype.assign=function(e,t,a,n,i){this.game=e,this.phaserSprites=a,this.phaserMaster=t,this.phaserGroup=n,this.atlas=i,this.currentExplosionCount=0,this.maxExplosions=5,this.currentAmmoCount=0,this.maxAmmo=3},e.prototype.debris=function(e){var t=this.game,a=(this.phaserMaster.getOnly(["onscreenDebrisCount"]).onscreenDebrisCount,Phaser.Animation.generateFrameNames("debrs__",1,9)),n=t.add.weapon(e,this.atlas,a[0]);return n.bulletKillType=Phaser.Weapon.KILL_CAMERA_BOUNDS,n.bulletSpeed=200,n.bulletSpeedVariance=500,n.multiFire=!0,n.bulletPoolTotal=e,this.phaserGroup.add(this.phaserMaster.get("layers").DEBRIS,n.bullets),n.bullets.children.map(function(e){e.animations.add("explosion",a,30,!0)}),n.customFire=function(e,a){for(var i=0;i<a;i++)n.fire(e,e.x+t.rnd.integerInRange(-360,360),e.y+t.rnd.integerInRange(-360,360));n.bullets.children.map(function(e,a){t.time.events.add(15*a,function(){e.animations.play("explosion",30,!0),t.add.tween(e).to({alpha:0},500,Phaser.Easing.Linear.In,!0,500).onComplete.add(function(){e.alpha=1,e.kill()})}).autoDestroy=!0})},n},e.prototype.createExplosion=function(e,t,a,n,i,r){var o=this;if(void 0===i&&(i=function(){}),void 0===r&&(r=function(){}),this.currentExplosionCount<this.maxExplosions){this.currentExplosionCount++;var s=this.game,l=this.phaserSprites,p=this.phaserGroup,h=this.atlas,u={spriteAnimation:Phaser.Animation.generateFrameNames("explosion2_layer_",1,12)},d=l.addFromAtlas({name:"explosion_"+s.rnd.integer(),group:"noimpactExplosions",x:e,y:t,atlas:h,filename:u.spriteAnimation[0]});return d.scale.setTo(a,a),d.anchor.setTo(.5,.5),d.animations.add("explosion",u.spriteAnimation,1,!0),d.animations.play("explosion",30,!1).onComplete.add(function(){d.destroyIt()},d),d.destroyIt=function(){o.currentExplosionCount--,l.destroy(d.name)},p.add(void 0===n?this.phaserMaster.get("layers").VISUALS:n,d),d}},e.prototype.pelletImpact=function(e,t,a,n){var i=this;if(this.currentAmmoCount<this.maxAmmo){this.currentAmmoCount++;var r=this.game,o=this.phaserSprites,s=this.phaserGroup,l=this.atlas,p={spriteAnimation:Phaser.Animation.generateFrameNames("sparks_",1,5)},h=o.addFromAtlas({name:"impact_"+r.rnd.integer(),group:"noimpactExplosions",x:e,y:t,atlas:l,filename:p.spriteAnimation[0]});return h.scale.setTo(a,a),h.anchor.setTo(.5,.5),h.animations.add("explosion",p.spriteAnimation,1,!0),h.animations.play("explosion",30,!1).onComplete.add(function(){h.destroyIt()},h),h.destroyIt=function(){i.currentAmmoCount--,o.destroy(h.name)},s.add(void 0===n?this.phaserMaster.get("layers").BULLET_IMPACT:n,h),r.physics.enable(h,Phaser.Physics.ARCADE),h}},e.prototype.blueImpact=function(e,t,a,n){var i=this;if(this.currentAmmoCount<this.maxAmmo){this.currentAmmoCount++;var r=this.game,o=this.phaserSprites,s=this.phaserGroup,l=this.atlas,p={spriteAnimation:Phaser.Animation.generateFrameNames("blue_explosion_small_layer_",1,7)},h=(Phaser.Animation.generateFrameNames("blue_explosion_small_layer_",1,7),o.addFromAtlas({name:"impact_"+r.rnd.integer(),group:"noimpactExplosions",x:e,y:t,atlas:l,filename:p.spriteAnimation[0]}));return h.scale.setTo(a,a),h.anchor.setTo(.5,.5),r.physics.enable(h,Phaser.Physics.ARCADE),h.animations.add("explosion",p.spriteAnimation,1,!0),h.animations.play("explosion",30,!1).onComplete.add(function(){h.destroyIt()},h),h.destroyIt=function(){i.currentAmmoCount--,o.destroy(h.name)},s.add(void 0===n?this.phaserMaster.get("layers").BULLET_IMPACT:n,h),h}},e.prototype.orangeImpact=function(e,t,a,n){var i=this;if(this.currentAmmoCount<this.maxAmmo){this.currentAmmoCount++;var r=this.game,o=this.phaserSprites,s=this.phaserGroup,l=this.atlas,p={spriteAnimation:Phaser.Animation.generateFrameNames("orange_ring_explosion_layer_",1,7)},h=(Phaser.Animation.generateFrameNames("orange_ring_explosion_layer_",1,7),o.addFromAtlas({name:"impact_"+r.rnd.integer(),group:"noimpactExplosions",x:e,y:t,atlas:l,filename:p.spriteAnimation[0]}));return h.scale.setTo(a,a),h.anchor.setTo(.5,.5),r.physics.enable(h,Phaser.Physics.ARCADE),h.animations.add("explosion",p.spriteAnimation,1,!0),h.animations.play("explosion",30,!1).onComplete.add(function(){h.destroyIt()},h),h.destroyIt=function(){i.currentAmmoCount--,o.destroy(h.name)},s.add(void 0===n?this.phaserMaster.get("layers").BULLET_IMPACT:n,h),h}},e.prototype.electricDischarge=function(e,t,a,n){var i=this;if(this.currentAmmoCount<this.maxAmmo){this.currentAmmoCount++;var r=this.game,o=this.phaserSprites,s=this.phaserGroup,l=this.atlas,p={spriteAnimation:Phaser.Animation.generateFrameNames("disintegrate",1,10)},h=o.addFromAtlas({name:"impact_"+r.rnd.integer(),group:"noimpactExplosions",x:e,y:t,atlas:l,filename:p.spriteAnimation[0]});return h.scale.setTo(a,a),h.anchor.setTo(.5,.5),r.physics.enable(h,Phaser.Physics.ARCADE),h.animations.add("explosion",p.spriteAnimation,1,!0),h.animations.play("explosion",r.rnd.integerInRange(20,30),!1).onComplete.add(function(){h.destroyIt()},h),h.destroyIt=function(){i.currentAmmoCount--,o.destroy(h.name)},s.add(void 0===n?this.phaserMaster.get("layers").BULLET_IMPACT:n,h),h}},e}(),ENEMY_MANAGER=function(){function e(e){this.showHitbox=e.showHitbox}return e.prototype.assign=function(e,t,a,n,i,r,o,s,l){this.game=e,this.phaserSprites=a,this.phaserMaster=t,this.phaserTexts=n,this.phaserGroup=i,this.weaponManager=r,this.effectsManager=o,this.atlas=s,this.atlas_weapons=l,this.enemyLayer},e.prototype.facePlayer=function(e){var t=this.game,a=this.phaserSprites.getOnly(["player"]).player;return Math.ceil(360/(2*Math.PI)*t.math.angleBetween(e.x,e.y,a.x,a.y)-90)},e.prototype.generateWaveData=function(e,t){return this.game.math.sinCosGenerator(e,t,0,1).cos.map(function(e){return Math.abs(e)})},e.prototype.bulletCollisionWithPlayer=function(e){var t=this.phaserSprites.getGroup("player_hitboxes").slice(),a=e.collidables.primaryWeapon.slice();this.game.physics.arcade.overlap(t,a,function(e,t){var a=e.parent;a.isInvincible||a.isDead||a.isDamaged||a.isForceMoved||(a.takeDamage(t.damgeOnImpact),t.destroyIt())})},e.prototype.addSharedBehavior=function(e){var t=this,a=this.game,n=this.phaserSprites,i=this.phaserMaster,r=this.phaserGroup;e.onLayer=i.get("layers").ENEMIES,e.anchor.setTo(.5,.5),e.health=e.maxHealth,e.isInvincible=!1,e.isDamaged=!1,e.isDestroyed=!1,e.belowBlinkTimer=a.time.returnTrueTime(),e.isBelow50=!1,e.isBelow75=!1,e.weaponSystems=[],e.collidables={primaryWeapon:[],secondaryWeapon:[]},e.removeIt=function(){e.isDestroyed||(e.weaponSystems.map(function(e){e.destroyIt()}),e.children.map(function(e){t.phaserSprites.destroy(e.name)}),n.destroy(e.name))},r.add(e.onLayer,e)},e.prototype.attachHitbox=function(e,t){var a=this,n=this.game,i=this.phaserSprites,r=this.atlas;t.map(function(t){var o=i.addFromAtlas({name:"enemy_hitbox_"+n.rnd.integer(),group:"enemy_hitboxes",atlas:r,filename:t,alpha:a.showHitbox?.75:0});o.anchor.setTo(.5,.5),n.physics.enable(o,Phaser.Physics.ARCADE),e.addChild(o)})},e.prototype.attachWeaponSystem=function(e,t,a){var n=this,i=this.game,r=this.phaserSprites,o=this.phaserGroup,s=(this.atlas,this.phaserSprites.addFromAtlas({name:"enemy_weapons_"+this.game.rnd.integer(),group:"enemy_weapons",atlas:this.atlas_weapons,filename:a[0],visible:!0}));return s.anchor.setTo(.5,.5),s.angle=180,s.animations.add("fireWeapon",a,1,!0),s.sync=function(e){var t=e.x,a=e.y;s.x=t,s.y=a},s.destroyIt=function(){var t=s.x,a=s.y;n.effectsManager.blueImpact(t,a,1,e.onLayer),n.phaserSprites.destroy(s.name),i.time.events.add(4*Phaser.Timer.SECOND,function(){s.ammo.destroy()},n).autoDestroy=!0},s.onUpdate=function(){t.onUpdate()},s.fire=function(){var e=r.get("player");e.isInvincible||e.isDead?(t.checkOrientation(s),t.fire(s)):t.fire(s,e.x,e.y),s.animations.play("fireWeapon",24,!1)},o.add(e.onLayer+1,s),s.ammo=t,e.weaponSystems.push(s),e.collidables.primaryWeapon=[],e.collidables.primaryWeapon.push(t.bullets),s},e.prototype.createAsteroid1=function(e,t,a,n){var i=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===n&&(n=function(){});var r=this.game,o=(this.phaserMaster,this.phaserSprites),s=(this.phaserGroup,this.atlas),l=Phaser.Animation.generateFrameNames("asteroid1/asteroid_",1,28).slice(),p=o.addFromAtlas({x:e.x,y:e.y,name:"enemy_"+r.rnd.integer(),group:"enemies",org:"gameobjects",atlas:s,filename:l[0],visible:!0});p.maxHealth=50,this.addSharedBehavior(p),p.animations.add("idol",l),p.animations.play("idol",16,!0),this.attachHitbox(p,["asteroid1/hitbox"]);var h=this.weaponManager.enemyBullet(0);h.bullets.children.map(function(e){});var u=Phaser.Animation.generateFrameNames("bullet_fire_",1,4).slice();return this.attachWeaponSystem(p,h,u),p.onUpdate=function(){p.y+=2,p.isBelow50&&r.time.returnTrueTime()>p.belowBlinkTimer&&(p.belowBlinkTimer+=500,p.tint=16711680,p.game.add.tween(p).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1)),p.isBelow75&&r.time.returnTrueTime()>p.belowBlinkTimer&&(p.belowBlinkTimer+=250,p.tint=16711680,p.game.add.tween(p).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1)),n(p),p.y>i.game.world.height+p.height&&p.removeIt(),i.bulletCollisionWithPlayer(p)},p.destroyIt=function(){p.isDestroyed=!0,p.isBelow50=!1,p.isBelow75=!1,p.tint=16711680,p.weaponSystems.map(function(e){e.destroyIt()}),p.game.add.tween(p).to({alpha:.75},150,Phaser.Easing.Linear.Out,!0,1,0,!1).onComplete.add(function(){a(p),i.weaponManager.createExplosionBasic(p.x,p.y,1,p.onLayer+1,0),r.time.events.remove(p.explodeInterval),p.children.map(function(e){i.phaserSprites.destroy(e.name)}),o.destroy(p.name)})},p.damageIt=function(e){t(p),p.isDamaged=!0,r.time.events.add(10,function(){p.isDamaged=!1},i).autoDestroy=!0,p.y>0&&(p.health-=e),p.tint=16711680,p.game.add.tween(p).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),p.health/p.maxHealth<.5&&(p.isBelow50=!0),p.health/p.maxHealth<.25&&(p.isBelow75=!0),p.health<=0&&p.destroyIt()},p},e.prototype.createAsteroid2=function(e,t,a,n){var i=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===n&&(n=function(){});var r=this.game,o=(this.phaserMaster,this.phaserSprites),s=(this.phaserGroup,this.atlas),l=Phaser.Animation.generateFrameNames("asteroid2/asteroid_",1,19).slice(),p=o.addFromAtlas({x:e.x,y:e.y,name:"enemy_"+r.rnd.integer(),group:"enemies",org:"gameobjects",atlas:s,filename:l[0],visible:!0});p.maxHealth=150,this.addSharedBehavior(p),p.animations.add("idol",l),p.animations.play("idol",12,!0),this.attachHitbox(p,["asteroid2/hitbox"]);var h=this.weaponManager.enemyBullet(0);h.bullets.children.map(function(e){});var u=Phaser.Animation.generateFrameNames("bullet_fire_",1,4).slice();return this.attachWeaponSystem(p,h,u),p.onUpdate=function(){p.y+=.5,p.isBelow50&&r.time.returnTrueTime()>p.belowBlinkTimer&&(p.belowBlinkTimer+=500,p.tint=16711680,p.game.add.tween(p).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1)),p.isBelow75&&r.time.returnTrueTime()>p.belowBlinkTimer&&(p.belowBlinkTimer+=250,p.tint=16711680,p.game.add.tween(p).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1)),n(p),p.y>i.game.world.height+p.height&&p.removeIt(),i.bulletCollisionWithPlayer(p)},p.destroyIt=function(){p.isDestroyed=!0,p.isBelow50=!1,p.isBelow75=!1,p.tint=16711680,p.weaponSystems.map(function(e){e.destroyIt()}),p.game.add.tween(p).to({alpha:.5},10,Phaser.Easing.Linear.Out,!0,1,0,!1).onComplete.add(function(){a(p),i.phaserMaster.get("sharedDebris").customFire(p,25),r.time.events.remove(p.explodeInterval),p.children.map(function(e){i.phaserSprites.destroy(e.name)}),o.destroy(p.name)})},p.damageIt=function(e){t(p),p.isDamaged=!0,r.time.events.add(10,function(){p.isDamaged=!1},i).autoDestroy=!0,p.health-=e,p.tint=16711680,p.game.add.tween(p).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),p.health/p.maxHealth<.5&&(p.isBelow50=!0),p.health/p.maxHealth<.25&&(p.isBelow75=!0),p.health<=0&&p.destroyIt()},p},e.prototype.createSmallEnemy1=function(e,t,a,n){var i=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===n&&(n=function(){});var r=this.game,o=(this.phaserMaster,this.phaserSprites),s=this.phaserGroup,l=this.atlas,p=Phaser.Animation.generateFrameNames("smallShip/small_",1,1).slice(),h=o.addFromAtlas({x:e.x,y:e.y,name:"enemy_"+r.rnd.integer(),group:"enemies",org:"gameobjects",atlas:l,filename:p[0],visible:!0});h.maxHealth=50,this.addSharedBehavior(h),h.yWave={data:this.generateWaveData(200,.6*r.world.height),count:0},h.fireDelay=0,h.fireTimer=1e3,s.add(h.onLayer,h),this.attachHitbox(h,["smallShip/hitbox"]);var u=this.weaponManager.enemyBullet(3);u.bullets.children.map(function(e){});var d=Phaser.Animation.generateFrameNames("bullet_fire_",1,4).slice(),c=this.attachWeaponSystem(h,u,d);return h.onUpdate=function(){h.angle=i.facePlayer(h),h.weaponSystems.map(function(e){e.angle=i.facePlayer(h)-180}),r.time.returnTrueTime()>h.fireDelay&&!h.isDestroyed&&h.y>.4*h.game.canvas.height&&(h.fireDelay=r.time.returnTrueTime()+h.fireTimer,h.weaponSystems.map(function(e){c.fire()})),h.isDestroyed||(h.y=h.yWave.data[h.yWave.count]-h.height,h.yWave.count++,h.yWave.count>=h.yWave.data.length&&h.removeIt(),h.weaponSystems.map(function(e){e.sync(h)})),h.isBelow50&&r.time.returnTrueTime()>h.belowBlinkTimer&&(h.belowBlinkTimer+=500,h.tint=16711680,h.game.add.tween(h).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1)),h.isBelow75&&r.time.returnTrueTime()>h.belowBlinkTimer&&(h.belowBlinkTimer+=250,h.tint=16711680,h.game.add.tween(h).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1)),n(h),h.y>i.game.world.height+h.height&&h.removeIt(),i.bulletCollisionWithPlayer(h)},h.damageIt=function(e){t(h),h.isDamaged=!0,r.time.events.add(10,function(){h.isDamaged=!1},i).autoDestroy=!0,h.health-=e,h.tint=16711680,h.game.add.tween(h).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),h.health<=0&&h.destroyIt()},h.removeIt=function(){h.weaponSystems.map(function(e){e.destroyIt()}),h.children.map(function(e){i.phaserSprites.destroy(e.name)}),o.destroy(h.name)},h.destroyIt=function(){h.isDestroyed=!0,h.tint=16711680,h.weaponSystems.map(function(e){e.destroyIt()}),h.explodeInterval=r.time.events.loop(250,function(){i.effectsManager.createExplosion(h.x+r.rnd.integerInRange(-h.width/2,h.width/2),h.y+r.rnd.integerInRange(-h.height/2,h.height/2),1,h.onLayer+1)}),h.game.add.tween(h).to({y:h.y+50,alpha:.5},500,Phaser.Easing.Linear.Out,!0,250,0,!1).onComplete.add(function(){i.phaserMaster.get("sharedDebris").customFire(h,25),a(h),r.time.events.remove(h.explodeInterval),h.children.map(function(e){i.phaserSprites.destroy(e.name)}),o.destroy(h.name)})},h},e.prototype.createSmallEnemy2=function(e,t,a,n){var i=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===n&&(n=function(){});var r=this.game,o=this.phaserMaster,s=this.phaserSprites,l=this.phaserGroup,p=this.atlas,h=s.addFromAtlas({name:"enemy_"+r.rnd.integer(),group:"enemies",org:"gameobjects",atlas:p,filename:"big_1",visible:!0,x:e.x});h.anchor.setTo(.5,.5),h.scale.setTo(1,1),h.maxHealth=700,h.health=h.maxHealth,h.pierceResistence=1,h.fallThreshold=r.rnd.integerInRange(0,75),h.cosWave={data:r.math.sinCosGenerator(400,.5*r.world.height,0,1).cos,count:0},h.fireDelay=0,h.fireTimer=200,h.isInvincible=!1,h.isDamaged=!1,h.isDestroyed=!1,h.onLayer=o.get("layers").ENEMIES,h.bulletCycle={count:0,total:3,delay:500,lock:!1},h.weaponSystems=[],h.collidables={primaryWeapon:[],secondaryWeapon:[]},l.add(h.onLayer,h);["big_1_hitbox_1","big_1_hitbox_2"].map(function(e){var t=s.addFromAtlas({name:"enemy_hitbox_"+r.rnd.integer(),group:"enemy_hitboxes",atlas:p,filename:e,alpha:i.showHitbox?.75:0});t.anchor.setTo(.5,.5),r.physics.enable(t,Phaser.Physics.ARCADE),h.addChild(t)});var u=this.weaponManager.enemyBullet(9);u.bullets.children.map(function(e){e.damgeOnImpact=10});var d=Phaser.Animation.generateFrameNames("bullet_fire_",1,4).slice(),c=this.phaserSprites.addFromAtlas({name:"enemy_weapons_"+this.game.rnd.integer(),group:"enemy_weapons",atlas:this.atlas_weapons,filename:d[0],visible:!0});return c.anchor.setTo(.5,.5),c.angle=180,c.animations.add("fireWeapon",d,1,!0),c.sync=function(e){var t=e.x,a=e.y;c.x=t,c.y=a},c.destroyIt=function(){var e=c.x,t=c.y;i.effectsManager.blueImpact(e,t,1,h.onLayer),i.phaserSprites.destroy(c.name),r.time.events.add(4*Phaser.Timer.SECOND,function(){c.ammo.destroy()},i).autoDestroy=!0},c.fire=function(){s.get("player");u.fire(c,c.x,c.y+100),u.fire(c,c.x+50,c.y+100),u.fire(c,c.x-50,c.y+100),c.animations.play("fireWeapon",24,!1)},l.add(h.onLayer+1,c),c.ammo=u,h.weaponSystems.push(c),h.collidables.primaryWeapon=[],h.collidables.primaryWeapon.push(u.bullets),h.onUpdate=function(){s.get("player");n(h),r.time.returnTrueTime()>h.fireDelay&&!h.isDestroyed&&h.y>.3*h.game.canvas.height&&(h.fireDelay=r.time.returnTrueTime()+h.fireTimer,h.bulletCycle.count<h.bulletCycle.total?(h.weaponSystems.map(function(e){c.fire()}),h.bulletCycle.count++):h.bulletCycle.lock||(h.bulletCycle.lock=!0,r.time.events.add(1.5*Phaser.Timer.SECOND,function(){h.bulletCycle.count=0,h.bulletCycle.lock=!1}).autoDestroy=!0)),h.isDestroyed||(h.cosWave.count<h.cosWave.data.length/2&&(h.y=-h.cosWave.data[h.cosWave.count]-h.height,h.cosWave.count++),h.cosWave.count>=h.cosWave.data.length&&h.removeIt(),h.weaponSystems.map(function(e){e.sync(h)})),i.bulletCollisionWithPlayer(h)},h.damageIt=function(e){t(h),h.isDamaged=!0,r.time.events.add(10,function(){h.isDamaged=!1},i).autoDestroy=!0,h.health-=e,h.tint=16711680,h.game.add.tween(h).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),h.health<=0&&h.destroyIt()},h.removeIt=function(){h.weaponSystems.map(function(e){e.destroyIt()}),h.children.map(function(e){i.phaserSprites.destroy(e.name)}),s.destroy(h.name)},h.destroyIt=function(){h.isDestroyed=!0,h.tint=16711680,h.weaponSystems.map(function(e){e.destroyIt()}),h.explodeInterval=r.time.events.loop(500,function(){i.effectsManager.createExplosion(h.x+r.rnd.integerInRange(-h.width/2,h.width/2),h.y+r.rnd.integerInRange(-h.height/2,h.height/2),1,h.onLayer+1)}),h.game.add.tween(h.scale).to({x:.85,y:.85},500,Phaser.Easing.Linear.Out,!0,500,0,!1).onComplete.add(function(){i.weaponManager.createExplosionVacuum(h.x,h.y,1.5,h.onLayer+1,10),i.phaserMaster.get("sharedDebris").customFire(h,50),r.time.events.remove(h.explodeInterval),a(h),h.children.map(function(e){i.phaserSprites.destroy(e.name)}),s.destroy(h.name)})},h},e.prototype.createBoss1=function(e,t,a,n){var i=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===n&&(n=function(){});var r=this.game,o=this.phaserMaster,s=this.phaserSprites,l=this.phaserGroup,p=this.atlas,h=s.addFromAtlas({name:"enemy_"+r.rnd.integer(),group:"enemies",org:"gameobjects",atlas:p,filename:"big_1",visible:!0,x:e.x});h.anchor.setTo(.5,.5),h.scale.setTo(1,1),h.maxHealth=15e3,h.health=h.maxHealth,h.pierceResistence=1,h.fallThreshold=r.rnd.integerInRange(0,75),h.cosWave={data:r.math.sinCosGenerator(400,.5*r.world.height,0,1).cos,count:0},h.fireDelay=0,h.fireTimer=200,h.isInvincible=!1,h.isDamaged=!1,h.isDestroyed=!1,h.onLayer=o.get("layers").ENEMIES,h.bulletCycle={count:0,total:3,delay:500,lock:!1},h.weaponSystems=[],h.collidables={primaryWeapon:[],secondaryWeapon:[]},h.trackinbox=null,l.add(h.onLayer,h);var u=["big_1_hitbox_1","big_1_hitbox_2"];u.map(function(e){var t=s.addFromAtlas({name:"enemy_hitbox_"+r.rnd.integer(),group:"enemy_hitboxes",atlas:p,filename:e,alpha:i.showHitbox?.75:0});t.anchor.setTo(.5,.5),r.physics.enable(t,Phaser.Physics.ARCADE),h.addChild(t)});var d=s.addFromAtlas({name:"targetingBox_"+r.rnd.integer(),group:"enemy_hitboxes",width:h.width,height:h.height,atlas:p,filename:u[0],alpha:this.showHitbox?.75:0});d.anchor.setTo(.5,.5),d.sync=function(){var e=s.get("player");d.x=h.x,d.y=h.y,d.angle=Math.ceil(360/(2*Math.PI)*r.math.angleBetween(d.x,d.y,e.x,e.y)-90)},h.targetingBox=d;var c=this.weaponManager.enemyBullet(9);c.bullets.children.map(function(e){e.damgeOnImpact=10});var m=Phaser.Animation.generateFrameNames("bullet_fire_",1,4).slice(),g=this.phaserSprites.addFromAtlas({name:"enemy_weapons_"+this.game.rnd.integer(),group:"enemy_weapons",atlas:this.atlas_weapons,filename:m[0],visible:!0});return g.anchor.setTo(.5,.5),g.angle=180,g.animations.add("fireWeapon",m,1,!0),g.sync=function(e){var t=e.x,a=e.y;g.x=t,g.y=a},g.destroyIt=function(){var e=g.x,t=g.y;i.effectsManager.blueImpact(e,t,1,h.onLayer),i.phaserSprites.destroy(g.name),r.time.events.add(4*Phaser.Timer.SECOND,function(){g.ammo.destroy()},i).autoDestroy=!0},g.fire=function(){s.get("player");c.fire(g,g.x,g.y+100),c.fire(g,g.x+50,g.y+100),c.fire(g,g.x-50,g.y+100),g.animations.play("fireWeapon",24,!1)},l.add(h.onLayer+1,g),g.ammo=c,h.weaponSystems.push(g),h.collidables.primaryWeapon=[],h.collidables.primaryWeapon.push(c.bullets),h.onUpdate=function(){s.get("player");n(h),d.sync(),r.time.returnTrueTime()>h.fireDelay&&!h.isDestroyed&&h.y>.3*h.game.canvas.height&&(h.fireDelay=r.time.returnTrueTime()+h.fireTimer,h.bulletCycle.count<h.bulletCycle.total?(h.weaponSystems.map(function(e){g.fire()}),h.bulletCycle.count++):h.bulletCycle.lock||(h.bulletCycle.lock=!0,r.time.events.add(1.5*Phaser.Timer.SECOND,function(){h.bulletCycle.count=0,h.bulletCycle.lock=!1}).autoDestroy=!0)),h.isDestroyed||(h.cosWave.count<h.cosWave.data.length/2&&(h.y=-h.cosWave.data[h.cosWave.count]-h.height,h.cosWave.count++),h.cosWave.count>=h.cosWave.data.length&&h.removeIt(),h.weaponSystems.map(function(e){e.sync(h)})),i.bulletCollisionWithPlayer(h)},h.damageIt=function(e){t(h),h.isDamaged=!0,r.time.events.add(10,function(){h.isDamaged=!1},i).autoDestroy=!0,h.health-=e,h.tint=16711680,h.game.add.tween(h).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),h.health<=0&&h.destroyIt()},h.removeIt=function(){h.weaponSystems.map(function(e){e.destroyIt()}),h.children.map(function(e){i.phaserSprites.destroy(e.name)}),s.destroy(h.name)},h.destroyIt=function(){h.isDestroyed=!0,h.tint=16711680,h.weaponSystems.map(function(e){e.destroyIt()}),s.destroy(d.name),i.weaponManager.createExplosionVacuum(h.x,h.y,2,h.onLayer+1,10),h.game.add.tween(h).to({y:h.y-100},6e3,Phaser.Easing.Linear.Out,!0,0,0,!1),r.time.events.add(2*Phaser.Timer.SECOND,function(){h.explodeInterval=r.time.events.loop(150,function(){h.tint=16711680,h.game.add.tween(h).to({tint:16777215},50,Phaser.Easing.Linear.Out,!0,0,0,!1),i.effectsManager.createExplosion(h.x+r.rnd.integerInRange(-h.width/2,h.width/2),h.y+r.rnd.integerInRange(-h.height/2,h.height/2),1,h.onLayer+1)}),a(h),h.game.add.tween(h.scale).to({x:.75,y:.75},4500,Phaser.Easing.Linear.Out,!0,0,0,!1).onComplete.add(function(){i.weaponManager.createExplosionVacuum(h.x,h.y,1.5,h.onLayer+1,10),i.phaserMaster.get("sharedDebris").customFire(h),r.time.events.remove(h.explodeInterval),h.children.map(function(e){i.phaserSprites.destroy(e.name)}),s.destroy(h.name)})}).autoDestroy=!0},h},e}(),ITEMSPAWN_MANAGER=function(){function e(){}return e.prototype.assign=function(e,t,a,n,i){this.game=e,this.phaserSprites=a,this.phaserMaster=t,this.phaserGroup=n,this.atlas=i},e.prototype.getDistanceFromPlayer=function(e){var t=this.phaserSprites.get("player");return t.isForceMoved?0:Math.round(Phaser.Math.distance(t.x,t.y,e.x,e.y))},e.prototype.spawnHealthpack=function(e,t,a,n){var i=this;void 0===n&&(n=function(){});var r=Phaser.Animation.generateFrameNames("healthpack_",1,4).slice(),o=this.phaserSprites.addFromAtlas({name:"healthpack_"+this.game.rnd.integer(),group:"itemspawns",x:e,y:t,atlas:this.atlas,filename:r[0]});o.animations.add("animate",r,8,!0),o.animations.play("animate"),o.anchor.setTo(.5,.5),o.blinkLifespan=this.game.time.returnTrueTime()+10*Phaser.Timer.SECOND,o.blinkLifespanInterval=this.game.time.returnTrueTime(),o.blinkLifespanCount=0,this.game.physics.enable(o,Phaser.Physics.ARCADE),o.body.collideWorldBounds=!0,o.body.bounce.setTo(1,1),o.body.velocity.y=this.game.rnd.integerInRange(50,50),o.body.velocity.x=this.game.rnd.integerInRange(-200,200),o.destroyIt=function(){i.phaserSprites.destroy(o.name)},o.pickedUp=function(){i.phaserSprites.destroy(o.name)},o.onUpdate=function(){if(i.getDistanceFromPlayer(o)<200){var e=i.phaserSprites.get("player");i.game.physics.arcade.moveToObject(o,e,400)}i.game.time.returnTrueTime()>o.blinkLifespan&&o.destroyIt(),i.game.time.returnTrueTime()>o.blinkLifespan-3*Phaser.Timer.SECOND&&i.game.time.returnTrueTime()>o.blinkLifespanInterval&&(o.blinkLifespanInterval=i.game.time.returnTrueTime()+200-5*o.blinkLifespanCount,o.alpha=o.blinkLifespanCount%2==0?.25:1,o.blinkLifespanCount++),i.phaserSprites.getManyGroups(["playership"]).map(function(e){e.game.physics.arcade.overlap(o,e,function(e,t){n(),o.pickedUp()},null,o)})},this.phaserGroup.add(this.phaserMaster.get("layers").ITEMDROPS,o)},e.prototype.spawnPowerup=function(e,t,a,n){var i=this;void 0===n&&(n=function(){});var r=Phaser.Animation.generateFrameNames("powerup_",1,4).slice(),o=this.phaserSprites.addFromAtlas({name:"healthpack_"+this.game.rnd.integer(),group:"itemspawns",x:e,y:t,atlas:this.atlas,filename:r[0]});o.animations.add("animate",r,8,!0),o.animations.play("animate"),o.anchor.setTo(.5,.5),o.blinkLifespan=this.game.time.returnTrueTime()+10*Phaser.Timer.SECOND,o.blinkLifespanInterval=this.game.time.returnTrueTime(),o.blinkLifespanCount=0,this.game.physics.enable(o,Phaser.Physics.ARCADE),o.body.collideWorldBounds=!0,o.body.bounce.setTo(1,1),o.body.velocity.y=this.game.rnd.integerInRange(50,50),o.body.velocity.x=this.game.rnd.integerInRange(-200,200),o.destroyIt=function(){i.phaserSprites.destroy(o.name)},o.pickedUp=function(){i.phaserSprites.destroy(o.name)},o.onUpdate=function(){if(i.getDistanceFromPlayer(o)<200){var e=i.phaserSprites.get("player");i.game.physics.arcade.moveToObject(o,e,400)}i.game.time.returnTrueTime()>o.blinkLifespan&&o.destroyIt(),i.game.time.returnTrueTime()>o.blinkLifespan-3*Phaser.Timer.SECOND&&i.game.time.returnTrueTime()>o.blinkLifespanInterval&&(o.blinkLifespanInterval=i.game.time.returnTrueTime()+200-5*o.blinkLifespanCount,o.alpha=o.blinkLifespanCount%2==0?.25:1,o.blinkLifespanCount++),i.phaserSprites.getManyGroups(["playership"]).map(function(e){e.game.physics.arcade.overlap(o,e,function(e,t){n(),o.pickedUp()},null,o)})},this.phaserGroup.add(this.phaserMaster.get("layers").ITEMDROPS,o)},e.prototype.spawnSpecial=function(e,t,a,n){var i=this;void 0===n&&(n=function(){});var r=Phaser.Animation.generateFrameNames("special_",1,5).slice(),o=this.phaserSprites.addFromAtlas({name:"healthpack_"+this.game.rnd.integer(),group:"itemspawns",x:e,y:t,atlas:this.atlas,filename:r[0]});o.animations.add("animate",r,8,!0),o.animations.play("animate"),o.anchor.setTo(.5,.5),o.blinkLifespan=this.game.time.returnTrueTime()+10*Phaser.Timer.SECOND,o.blinkLifespanInterval=this.game.time.returnTrueTime(),o.blinkLifespanCount=0,this.game.physics.enable(o,Phaser.Physics.ARCADE),o.body.collideWorldBounds=!0,o.body.bounce.setTo(1,1),o.body.velocity.y=this.game.rnd.integerInRange(50,50),o.body.velocity.x=this.game.rnd.integerInRange(-200,200),o.destroyIt=function(){i.phaserSprites.destroy(o.name)},o.pickedUp=function(){i.phaserSprites.destroy(o.name)},o.onUpdate=function(){if(i.getDistanceFromPlayer(o)<200){var e=i.phaserSprites.get("player");i.game.physics.arcade.moveToObject(o,e,400)}i.game.time.returnTrueTime()>o.blinkLifespan&&o.destroyIt(),i.game.time.returnTrueTime()>o.blinkLifespan-3*Phaser.Timer.SECOND&&i.game.time.returnTrueTime()>o.blinkLifespanInterval&&(o.blinkLifespanInterval=i.game.time.returnTrueTime()+200-5*o.blinkLifespanCount,o.alpha=o.blinkLifespanCount%2==0?.25:1,o.blinkLifespanCount++),i.phaserSprites.getManyGroups(["playership"]).map(function(e){e.game.physics.arcade.overlap(o,e,function(e,t){n(),o.pickedUp()},null,o)})},this.phaserGroup.add(this.phaserMaster.get("layers").ITEMDROPS,o)},e.prototype.spawnScrap=function(e,t,a,n){var i=this;void 0===n&&(n=function(){});var r=Phaser.Animation.generateFrameNames("scrap_",1,1).slice(),o=this.phaserSprites.addFromAtlas({name:"healthpack_"+this.game.rnd.integer(),group:"itemspawns",x:e,y:t,atlas:this.atlas,filename:r[0]});r.length>1&&(o.animations.add("animate",r,8,!0),o.animations.play("animate")),o.anchor.setTo(.5,.5),o.blinkLifespan=this.game.time.returnTrueTime()+10*Phaser.Timer.SECOND,o.blinkLifespanInterval=this.game.time.returnTrueTime(),o.blinkLifespanCount=0,this.game.physics.enable(o,Phaser.Physics.ARCADE),o.body.collideWorldBounds=!0,o.body.bounce.setTo(1,1),o.body.velocity.y=this.game.rnd.integerInRange(50,50),o.body.velocity.x=this.game.rnd.integerInRange(-200,200),o.destroyIt=function(){i.phaserSprites.destroy(o.name)},o.pickedUp=function(){i.phaserSprites.destroy(o.name)},o.onUpdate=function(){if(i.getDistanceFromPlayer(o)<200){var e=i.phaserSprites.get("player");i.game.physics.arcade.moveToObject(o,e,400)}i.game.time.returnTrueTime()>o.blinkLifespan&&o.destroyIt(),i.game.time.returnTrueTime()>o.blinkLifespan-3*Phaser.Timer.SECOND&&i.game.time.returnTrueTime()>o.blinkLifespanInterval&&(o.blinkLifespanInterval=i.game.time.returnTrueTime()+200-5*o.blinkLifespanCount,o.alpha=o.blinkLifespanCount%2==0?.25:1,o.blinkLifespanCount++),i.phaserSprites.getManyGroups(["playership"]).map(function(e){e.game.physics.arcade.overlap(o,e,function(e,t){n(),o.pickedUp()},null,o)})},this.phaserGroup.add(this.phaserMaster.get("layers").ITEMDROPS,o)},e}(),PLAYER_MANAGER=function(){function e(){}return e.prototype.assign=function(e,t,a,n,i,r,o,s,l,p){this.game=e,this.phaserSprites=a,this.phaserMaster=t,this.phaserTexts=n,this.phaserGroup=i,this.phaserControls=r,this.weaponManager=o,this.effectsManager=s,this.atlas=l,this.weaponAtlas=p,this.player=null},e.prototype.createShip=function(e,t,a,n,i){var r=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===n&&(n=function(){}),void 0===i&&(i=function(){});var o=this.game,s=(e.shipId,this.phaserMaster.getOnly(["gameData"]).gameData),l=(this.phaserMaster.getOnly(["starMomentum"]).starMomentum,this.phaserSprites.addFromAtlas({x:this.game.world.centerX,y:2e3,name:e.name,group:e.group,org:e.org,atlas:this.atlas,filename:"ship_base_form"}));l.anchor.setTo(.5,.5),l.scale.setTo(1,1),l.isInvincible=!1,l.isDead=!0,l.isDamaged=!1,l.isForceMoved=!1,l.ignoreBoundaries=null,l.onLayer=e.layer,l.primaryWeapon=e.primaryWeapon,l.secondaryWeapon=e.secondaryWeapon,l.perk=e.perk,l.explodeInterval=null,l.weaponSystems=[],l.subweaponSystems=[],l.attachments=[],l.xCapture=[],l.yCapture=[],l.clearEnemyBulletsInterval,l.collidables={primaryWeapon:[],secondaryWeapon:[]};var p=Phaser.Animation.generateFrameNames("ship_start_",1,7).slice(),h=Phaser.Animation.generateFrameNames("ship_explode_",1,5).slice(),u=Phaser.Animation.generateFrameNames("ship_explode_",6,7).slice();l.animations.add("shipDamage",["ship_damage","ship_damage","ship_damage","ship_damage","ship_start_7"],1,!0),l.animations.add("shipStart",p,1,!0),l.animations.add("preExplode",h,1,!0),l.animations.add("preExplodeLoop",u,1,!0),o.physics.enable(l,Phaser.Physics.ARCADE),this.phaserGroup.add(this.phaserMaster.get("layers").PLAYER,l);var d=["ship_hitbox_1","ship_hitbox_2"];d.map(function(e,t){var a=r.phaserSprites.addFromAtlas({y:10,name:"player_hitbox_"+o.rnd.integer(),group:"player_hitboxes",atlas:r.atlas,filename:e,alpha:0});a.anchor.setTo(.5,.5),o.physics.enable(a,Phaser.Physics.ARCADE),l.addChild(a)});var c=this.phaserSprites.addFromAtlas({name:"mock_trackingbox_"+o.rnd.integer(),group:"player_trackingBox",atlas:this.atlas,filename:d[0],width:10,height:10,alpha:0});c.sync=function(){c.x=l.x-c.width/2,c.y=l.y-o.canvas.height/2},l.defaultTargetingBox=c,l.targetBox=c;var m=Phaser.Animation.generateFrameNames("ship_fullpower_",1,7).concat(Phaser.Animation.generateFrameNames("ship_fullpower__",1,7).reverse()),g=this.phaserSprites.addFromAtlas({name:"ship_fullpower_addon",atlas:this.atlas,filename:m[0],visible:!1});return g.anchor.setTo(.5,.5),g.animations.add("fullpower",m,1,!0),g.animations.play("fullpower",45,!0),l.addChild(g),l.clearAllEnemyBullets=function(e){l.clearEnemyBulletsInterval=o.time.returnTrueTime()+e},l.assignTarget=function(e){l.targetBox=e},l.removeTarget=function(){l.isForceMoved=!0,l.game.add.tween(l).to({angle:0},500,Phaser.Easing.Linear.Out,!0,100,0,!1).onComplete.add(function(){l.targetBox=c,l.isForceMoved=!1})},l.getDistanceFromTargetingBox=function(){return Math.round(Phaser.Math.distance(l.x,l.y,l.defaultTargetingBox.x,l.defaultTargetingBox.y))},l.onUpdate=function(){g.visible=s.player.powerup>=30,l.targetBox&&!l.isForceMoved&&(l.angle=Math.ceil(360/(2*Math.PI)*o.math.angleBetween(l.x,l.y,l.targetBox.x,l.targetBox.y)+90)),l.isForceMoved||(l.alpha=l.isInvincible&&!l.isDead?.5:1),c.sync(),l.isDead||(l.xCapture.length>0&&(l.x+=l.xCapture[0],l.xCapture.shift()),l.yCapture.length>0&&(l.y+=l.yCapture[0],l.yCapture.shift()),l.ignoreBoundaries||l.checkLimits());var e=[];l.weaponSystems.concat(l.subweaponSystems).map(function(t){t.angle=l.angle,t.onUpdate(),t.sync(l),e.push(t.ammo.bullets)}),r.bulletCollisionDetection(),l.attachments.map(function(e){e.sync(l)}),i(l)},l.restoreHealth=function(e){var a=r.phaserMaster.getOnly(["gameData"]).gameData.player.health+e;a>100&&(a=100),t(a)},l.takeDamage=function(e){a(l);var i=r.phaserMaster.getOnly(["gameData"]).gameData.player.health-e;t(i),i>0?(l.animations.play("shipDamage",45,!1),l.isDamaged=!0,o.time.events.add(250,function(){l.isDamaged=!1},r).autoDestroy=!0,l.tint=16711680,l.alpha=.75,l.game.add.tween(l).to({tint:16777215,alpha:1},10,Phaser.Easing.Linear.Out,!0,100,0,!1).onComplete.add(function(){o.time.events.add(500,function(){l.isInvincible=!1},r).autoDestroy=!0})):(l.isDestroyed(),o.time.events.add(500,function(){n(l)}).autoDestroy=!0)},l.isDestroyed=function(e){void 0===e&&(e=!0),l.isDead||(l.isDead=!0,l.isInvincible=!0,l.destroyWeaponSystems(),l.onUpdate(),l.explodeInterval=o.time.events.loop(250,function(){r.effectsManager.createExplosion(l.x+o.rnd.integerInRange(-l.width/2,l.width/2),l.y+o.rnd.integerInRange(-l.height/2,l.height/2),1,l.onLayer+1)}),r.effectsManager.createExplosion(l.x,l.y,1,6),o.add.tween(r).to({angle:o.rnd.integerInRange(-90,90),alpha:0},1e3,Phaser.Easing.Linear.In,!0,0).onComplete.add(function(){r.weaponManager.createExplosionVacuum(l.x,l.y,1.5,l.onLayer+1,10);var e=r.effectsManager.debris(100);(e=e).customFire(l),o.time.events.remove(l.explodeInterval),l.visible=!1}))},l.destroyWeaponSystems=function(){l.weaponSystems.map(function(e){e.destroyIt(),e.ammo.destroy()}),l.weaponSystems=[]},l.attachPerk=function(t){r.attachPerk(l,e,t)},l.attachWeapon=function(t){var a;switch(t){case"BULLET":a=r.attachBullet(l,e,t);break;case"SPREAD":a=r.attachSpread(l,e,t);break;case"LASER":a=r.attachLaser(l,e,t);break;case"MISSLE":a=r.attachMissle(l,e,t);break;case"SHOTGUN":a=r.attachShotgun(l,e,t);break;case"GATLING":a=r.attachGatling(l,e,t)}l.collidables.primaryWeapon=[],a.map(function(e){l.collidables.primaryWeapon.push(e.ammo.bullets)})},l.attachSubweapon=function(t){var a;switch(t){case"CLUSTERBOMB":a=r.attachClusterbomb(l,e,t)}l.collidables.secondaryWeapon=[],a.map(function(e){l.collidables.secondaryWeapon.push(e.ammo.bullets),e.ammo.bomblets&&e.ammo.bomblets.map(function(e){l.collidables.secondaryWeapon.push(e.bullets)})})},l.fireWeapon=function(){l.weaponSystems.map(function(e){e.fire()})},l.fireSubweapon=function(){l.subweaponSystems.map(function(e){e.fire()})},l.regenerateHealth=function(e){void 0===e&&(e=!1)},l.moveX=function(e){l.xCapture[0]=e},l.moveY=function(e){l.yCapture[0]=e},l.checkLimits=function(){this.y-this.height<0&&(this.y=this.height),this.y+this.height>this.game.world.height&&(this.y=this.game.world.height-this.height),this.x<0&&(this.x=0),this.x>this.game.world.width+this.width&&(this.x=this.game.world.width+this.width)},l.moveTo=function(e,t,a,n){void 0===n&&(n=function(){}),l.isInvincible=!0,l.isForceMoved=!0,r.phaserControls.disableAllInput(),o.add.tween(l).to({x:e,y:t},a,Phaser.Easing.Exponential.InOut,!0,0,0,!1).onComplete.add(function(){l.isInvincible=!1,l.isForceMoved=!1,r.phaserControls.enableAllInput(),n()})},l.moveToStart=function(e){void 0===e&&(e=function(){}),l.isDead=!1,l.isInvincible=!0,l.ignoreBoundaries=!0,l.x=r.game.world.centerX,l.y=2*r.game.world.height,o.time.events.add(150,function(){l.alpha=1,l.visible=!0,o.add.tween(l).to({y:o.world.centerY+100},1e3,Phaser.Easing.Exponential.InOut,!0,0,0,!1).onComplete.add(function(){l.ignoreBoundaries=!1,r.phaserControls.enableAllInput(),l.attachWeapon(l.primaryWeapon),l.attachSubweapon(l.secondaryWeapon),l.animations.play("shipStart",12,!1),o.time.events.add(1e3,function(){l.isInvincible=!1,e()}).autoDestroy=!0})}).autoDestroy=!0},l.playEndSequence=function(e){l.isInvincible=!0,l.game.add.tween(l.scale).to({x:2,y:2},750,Phaser.Easing.Exponential.InOut,!0,0,0,!1),l.game.add.tween(l).to({x:o.world.centerX,y:o.world.centerY+50},750,Phaser.Easing.Exponential.InOut,!0,0,0,!1).onComplete.add(function(){l.game.add.tween(l).to({y:o.world.height+200},750,Phaser.Easing.Exponential.InOut,!0,100,0,!1).onComplete.add(function(){l.game.add.tween(l).to({y:-200},1e3,Phaser.Easing.Exponential.InOut,!0,0,0,!1).onComplete.add(function(){e()},l)},l)},l)},this.player=l,l},e.prototype.attachPerk=function(e,t,a){var n,i,r,o=this;switch(a){case"FIREPOWER":n=Phaser.Animation.generateFrameNames("firepower_",1,8).concat(Phaser.Animation.generateFrameNames("firepower_",1,8).reverse()),i=30;break;case"ARMORPLATING":n=["armor_plating"],i=30;break;case"REGEN":n=Phaser.Animation.generateFrameNames("shield_layer_",1,8).slice(),i=30}void 0!==this.phaserSprites.get(t.name+"_ship_perk")&&this.phaserSprites.destroy(t.name+"_ship_perk"),"REGEN"===a?((r=this.phaserSprites.addFromAtlas({name:t.name+"_ship_perk",atlas:this.atlas,filename:n[0],alpha:.5})).anchor.setTo(.5,.5),r.scale.set(1.25,1.25),r.tweenFadeIn=function(){o.game.add.tween(r).to({alpha:.8},1e3,Phaser.Easing.Linear.In,!0,8e3).onComplete.add(function(){e.regenerateHealth(!0),r.tweenFadeOut()})},r.tweenFadeOut=function(){o.game.add.tween(r).to({alpha:0},1e3,Phaser.Easing.Linear.In,!0,1e3).onComplete.add(function(){e.regenerateHealth(!1),r.tweenFadeIn()})},this.game.time.events.add(1e3,function(){void 0!==r&&r.tweenFadeOut()}).autoDestroy=!0,r.animations.add("animate",n,1,!0),r.animations.play("animate",i,!0),e.addChild(r)):((r=this.phaserSprites.addFromAtlas({name:t.name+"_ship_perk",atlas:this.atlas,filename:n[0],visible:!0})).anchor.setTo(.5,.5),r.animations.add("animate",n,1,!0),r.animations.play("animate",i,!0),e.addChild(r))},e.prototype.attachLaser=function(e,t,a){for(var n=this,i=Phaser.Animation.generateFrameNames("laser_fire_",1,1).slice(),r=function(t){var r=o.phaserSprites.addFromAtlas({name:"ship_weapon_"+o.game.rnd.integer(),atlas:o.weaponAtlas,filename:i[0],alpha:0});r.anchor.setTo(.5,.5),i.length>0&&r.animations.add("fireWeapon",i,1,!0),r.offset=15*t-45,r.index=t,r.onUpdate=function(){},r.sync=function(e){var t=e.x,a=e.y,i=(e.angle,n.weaponManager.calculateRotateCoords(r.offset,e.targetBox));r.x=t+i.x,r.y=a+i.y},r.destroyIt=function(){n.phaserSprites.destroy(r.name)},r.fire=function(){var e=n.phaserMaster.getOnly(["gameData"]).gameData,t=Math.floor((e.player.powerup-1)/5);i.length>0&&r.animations.play("fireWeapon",60,!1),s.fireAngle=270+r.angle,0===t&&3===r.index&&s.fireOffset(0,0),1!==t||2!==r.index&&4!==r.index||s.fireOffset(0,0),2!==t||2!==r.index&&3!==r.index&&4!==r.index||s.fireOffset(0,0),3!==t||1!==r.index&&2!==r.index&&4!==r.index&&5!==r.index||s.fireOffset(0,0),4!==t||1!==r.index&&2!==r.index&&3!==r.index&&4!==r.index&&5!==r.index||s.fireOffset(0,0),5===t&&s.fireOffset(0,0)},o.phaserGroup.add(o.phaserMaster.get("layers").PLAYER_OVER,r);var s=o.weaponManager.playerBullets(3,a);s.checkOrientation(r.angle),s.onUpdate=function(){},s.trackSprite(r,0,0),s.weaponSystem=r,r.ammo=s,e.weaponSystems.push(r)},o=this,s=0;s<7;s++)r(s);return e.weaponSystems},e.prototype.attachShotgun=function(e,t,a){for(var n=this,i=Phaser.Animation.generateFrameNames("bullet_fire_",1,4).slice(),r=function(t){var r=o.phaserSprites.addFromAtlas({name:"ship_weapon_"+o.game.rnd.integer(),atlas:o.weaponAtlas,filename:i[0],alpha:0});r.anchor.setTo(.5,.5),i.length>0&&r.animations.add("fireWeapon",i,1,!0),r.offset=20*t-0,r.index=t,r.onUpdate=function(){s.onUpdate()},r.sync=function(e){var t=e.x,a=e.y,i=n.weaponManager.calculateRotateCoords(r.offset,e.targetBox);r.x=t+i.x,r.y=a+i.y},r.destroyIt=function(){n.phaserSprites.destroy(r.name)},r.fire=function(){for(var e=n.phaserMaster.getOnly(["gameData"]).gameData,t=Math.floor((e.player.powerup-1)/5),a=0;a<5*(t+1);a++)s.fireAngle=270+r.angle,s.fire(r,null,r+1);i.length>0&&r.animations.play("fireWeapon",60,!1)},o.phaserGroup.add(o.phaserMaster.get("layers").PLAYER_OVER,r);var s=o.weaponManager.playerBullets(60,a);s.checkOrientation(r.angle),s.onUpdate=function(){},s.trackSprite(r,0,0),r.ammo=s,e.weaponSystems.push(r)},o=this,s=0;s<1;s++)r(s);return e.weaponSystems},e.prototype.attachBullet=function(e,t,a){for(var n=this,i=Phaser.Animation.generateFrameNames("bullet_fire_",1,4).slice(),r=function(t){var r=o.phaserSprites.addFromAtlas({name:"ship_weapon_"+o.game.rnd.integer(),atlas:o.weaponAtlas,filename:i[0],alpha:0});r.anchor.setTo(.5,.5),i.length>0&&r.animations.add("fireWeapon",i,1,!0),r.offset=15*t-82.5,r.index=t,r.onUpdate=function(){},r.sync=function(e){var t=e.x,a=e.y,i=n.weaponManager.calculateRotateCoords(r.offset,e.targetBox);r.x=t+i.x,r.y=a+i.y},r.destroyIt=function(){var t=r.x,a=r.y;n.effectsManager.blueImpact(t,a,1,e.onLayer),n.phaserSprites.destroy(r.name)},r.fire=function(){var t=n.phaserMaster.getOnly(["gameData"]).gameData,a=Math.floor((t.player.powerup-1)/5);n.weaponManager.calculateRotateCoords(30,e.targetBox);s.fireAngle=270+r.angle,a>=0&&(5===r.index||6===r.index)&&s.fireOffset(0,0),a>=1&&(4===r.index||7===r.index)&&s.fireOffset(0,0),a>=2&&(3===r.index||8===r.index)&&s.fireOffset(0,0),a>=3&&(2===r.index||9===r.index)&&s.fireOffset(0,0),a>=4&&(1===r.index||10===r.index)&&s.fireOffset(0,0),a>=5&&(0===r.index||11===r.index)&&s.fireOffset(0,0)},o.phaserGroup.add(o.phaserMaster.get("layers").PLAYER_OVER,r);var s=o.weaponManager.playerBullets(3,a);s.checkOrientation(r.angle),s.onUpdate=function(){},s.trackSprite(r),r.ammo=s,e.weaponSystems.push(r)},o=this,s=0;s<12;s++)r(s);return e.weaponSystems},e.prototype.attachSpread=function(e,t,a){for(var n=this,i=Phaser.Animation.generateFrameNames("bullet_fire_",1,4).slice(),r=this.phaserMaster.getOnly(["gameData"]).gameData,o=Math.floor((r.player.powerup-1)/5),s=5===o?2:1,l=function(t){var r=p.phaserSprites.addFromAtlas({name:"ship_weapon_"+p.game.rnd.integer(),atlas:p.weaponAtlas,filename:i[0],alpha:0});r.anchor.setTo(.5,.5),i.length>0&&r.animations.add("fireWeapon",i,1,!0),r.offset=20*t-10*(s-1),r.onUpdate=function(){h.onUpdate()},r.sync=function(e){var t=e.x,a=e.y,n=e.angle;r.x=t+r.offset,r.y=a,r.angle=n},r.destroyIt=function(){var t=r.x,a=r.y;n.effectsManager.blueImpact(t,a,1,e.onLayer),n.phaserSprites.destroy(r.name)},r.fire=function(){var t,a=n.phaserMaster.getOnly(["gameData"]).gameData,o=Math.floor((a.player.powerup-1)/5);i.length>0&&r.animations.play("fireWeapon",60,!1);var s=Math.abs(e.getDistanceFromTargetingBox()/Math.round(Phaser.Math.distance(e.x,e.y,e.targetBox.x,e.targetBox.y)));o>=0&&h.fire(r,e.targetBox.x,e.targetBox.y-1),o>=1&&(t=n.weaponManager.calculateSpread(50,e.targetBox),h.fire(r,t.x1,t.y1),h.fire(r,t.x2,t.y2)),o>=2&&(t=n.weaponManager.calculateSpread(100/s,e.targetBox),h.fire(r,t.x1,t.y1),h.fire(r,t.x2,t.y2)),o>=3&&(t=n.weaponManager.calculateSpread(150/s,e.targetBox),h.fire(r,t.x1,t.y1),h.fire(r,t.x2,t.y2)),o>=4&&(t=n.weaponManager.calculateSpread(200/s,e.targetBox),h.fire(r,t.x1,t.y1),h.fire(r,t.x2,t.y2)),o>=5&&(t=n.weaponManager.calculateSpread(250/s,e.targetBox),h.fire(r,t.x1,t.y1),h.fire(r,t.x2,t.y2))},p.phaserGroup.add(p.phaserMaster.get("layers").PLAYER_OVER,r);var l=12*(o+2),h=p.weaponManager.playerBullets(l,a);h.checkOrientation(r.angle),h.onUpdate=function(){},r.ammo=h,e.weaponSystems.push(r)},p=this,h=0;h<s;h++)l(h);return e.weaponSystems},e.prototype.attachMissle=function(e,t,a){for(var n=this,i=Phaser.Animation.generateFrameNames("missle_fire_",1,4).slice(),r=this.phaserMaster.getOnly(["gameData"]).gameData,o=Math.floor((r.player.powerup-1)/5),s=5===o?2:1,l=function(t){var r=p.phaserSprites.addFromAtlas({name:"ship_weapon_"+p.game.rnd.integer(),atlas:p.weaponAtlas,filename:i[0],alpha:0});r.anchor.setTo(.5,.5),i.length>0&&r.animations.add("fireWeapon",i,1,!0),r.offset=20*t-10*(s-1),r.onUpdate=function(){},r.sync=function(e){var t=e.x,a=e.y,i=n.weaponManager.calculateRotateCoords(r.offset,e.targetBox);r.x=t+i.x,r.y=a+i.y},r.destroyIt=function(){r.x,r.y},r.fire=function(){var e=n.phaserMaster.getOnly(["gameData"]).gameData,t=Math.floor((e.player.powerup-1)/5);i.length>0&&r.animations.play("fireWeapon",60,!1),h.fireAngle=270+r.angle,h.fire(r),0===t&&(h.fire(r),h.fire(r)),t>=1&&(h.fire(r),h.fire(r)),t>=3&&(h.fire(r),h.fire(r)),t>=4&&(h.fire(r),h.fire(r)),t>=5&&(h.fire(r),h.fire(r))},p.phaserGroup.add(p.phaserMaster.get("layers").PLAYER_OVER,r);var l=8*(o+2),h=p.weaponManager.playerBullets(l,a);h.checkOrientation(r.angle),h.onUpdate=function(){},r.ammo=h,e.weaponSystems.push(r)},p=this,h=0;h<s;h++)l(h);return e.weaponSystems},e.prototype.attachGatling=function(e,t,a){for(var n=this,i=Phaser.Animation.generateFrameNames("missle_fire_",1,4).slice(),r=this.phaserMaster.getOnly(["gameData"]).gameData,o=(Math.floor((r.player.powerup-1)/5),function(t){var r=s.phaserSprites.addFromAtlas({name:"ship_weapon_"+s.game.rnd.integer(),atlas:s.weaponAtlas,filename:i[0],visible:!0});r.anchor.setTo(.5,.5),i.length>0&&r.animations.add("fireWeapon",i,1,!0),r.offset=20*t-0,r.onUpdate=function(){},r.sync=function(e){var t=e.x,a=e.y,i=n.weaponManager.calculateRotateCoords(r.offset,e.targetBox);r.x=t+i.x,r.y=a+i.y},r.destroyIt=function(){n.phaserSprites.destroy(r.name)},r.fire=function(){var e=n.phaserMaster.getOnly(["gameData"]).gameData,t=Math.floor((e.player.powerup-1)/5);i.length>0&&r.animations.play("fireWeapon",60,!1),o.fireAngle=270+r.angle,0==t&&o.fire(r),t>=1&&(n.game.time.events.add(50,function(){o.fire(r)}).autoDestroy=!0),t>=2&&(n.game.time.events.add(100,function(){o.fire(r)}).autoDestroy=!0),t>=3&&(n.game.time.events.add(150,function(){o.fire(r)}).autoDestroy=!0),t>=4&&(n.game.time.events.add(200,function(){o.fire(r)}).autoDestroy=!0),t>=5&&(n.game.time.events.add(50,function(){o.fire(r)}).autoDestroy=!0)},s.phaserGroup.add(s.phaserMaster.get("layers").PLAYER_OVER,r);var o=s.weaponManager.playerBullets(12,a);o.checkOrientation(r.angle),o.onUpdate=function(){},r.ammo=o,e.weaponSystems.push(r)}),s=this,l=0;l<1;l++)o(l);return e.weaponSystems},e.prototype.attachClusterbomb=function(e,t,a){var n=Phaser.Animation.generateFrameNames("laser_fire_",1,6).slice(),i=this.phaserSprites.addFromAtlas({name:"ship_weapon_"+this.game.rnd.integer(),atlas:this.weaponAtlas,filename:n[0],alpha:0});i.anchor.setTo(.5,.5),n.length>0&&i.animations.add("fireWeapon",n,1,!0),i.onUpdate=function(){r.onUpdate()},i.sync=function(e){var t=e.x,a=e.y;i.x=t,i.y=a},i.destroyIt=function(){i.x,i.y},i.fire=function(){r.fire(i,e.targetBox.x,e.targetBox.y-1)},this.phaserGroup.add(this.phaserMaster.get("layers").PLAYER_OVER,i);var r=this.weaponManager.createClusterbomb(4,function(){e.clearAllEnemyBullets(2*Phaser.Timer.SECOND)});return r.onUpdate=function(){},i.ammo=r,e.subweaponSystems.push(i),e.subweaponSystems},e.prototype.damgePopup=function(e,t){var a=this,n=e.x,i=e.y;e.width,e.height;this.game.time.events.add(this.game.rnd.integerInRange(0,150),function(){var e=a.phaserTexts.add({name:"enemy_"+a.game.rnd.integer(),group:"ui",font:"gem",x:n+a.game.rnd.integerInRange(-20,20),y:i+a.game.rnd.integerInRange(-20,20),size:12,default:t});a.game.add.tween(e.scale).to({x:1.5,y:1.5},250,Phaser.Easing.Back.In,!0,0,0,!1),a.game.add.tween(e).to({y:e.y+10},250,Phaser.Easing.Back.In,!0,0,0,!1).onComplete.add(function(){a.game.add.tween(e).to({y:e.y-10,alpha:0},250,Phaser.Easing.Bounce.Out,!0,0,0,!1).onComplete.add(function(){a.phaserTexts.destroy(e.name)})})},this).autoDestroy=!0},e.prototype.bulletCollisionDetection=function(){var e=this,t=this.phaserSprites.getGroup("enemy_hitboxes").slice(),a=this.player.collidables.primaryWeapon.concat(this.player.collidables.secondaryWeapon);this.phaserSprites.getManyGroups(["impactExplosions"]).map(function(e){a.push(e)}),this.game.physics.arcade.overlap(t,a,function(t,a){var n=t.parent;if(!n.isDestroyed){var i=a.weaponData;if(!n.isDamaged&&!n.isDestroyed||i.ignoreDamageState&&!n.isDestroyed){if("LASER"===i.reference){e.weaponManager.calculateRotateCoords(0,e.player.targetBox);e.effectsManager.electricDischarge(n.x+e.game.rnd.integerInRange(-10,10),n.y+e.game.rnd.integerInRange(-10,10),1,n.onLayer+1)}"SPREAD"===i.reference&&e.effectsManager.blueImpact(a.x,a.y,1,n.onLayer+1),"SHOTGUN"===i.reference&&e.effectsManager.pelletImpact(a.x,a.y,1,n.onLayer+1),"GATLING"===i.reference&&e.effectsManager.pelletImpact(a.x,a.y,1,n.onLayer+1),"BULLET"===i.reference&&e.effectsManager.orangeImpact(a.x,a.y,1,n.onLayer+1),"MISSLE"===i.reference&&e.weaponManager.createExplosionBasic(a.x,a.y,1,n.onLayer+1,Math.round(i.damage/2)),e.damgePopup(n,i.damage),n.damageIt(i.damage)}i.pierce||i.completeAnimation||a.destroyIt(n.onLayer-1)}})},e.prototype.destroyShip=function(e){this.phaserSprites.destroy(e),this.phaserSprites.destroy(e+"_exhaust"),this.phaserSprites.getGroup(e+"_trails").map(function(e){e.destroySelf()})},e}(),UTILITY_MANAGER=function(){function e(){}return e.prototype.assign=function(e,t,a,n,i,r){this.game=e,this.phaserSprites=a,this.phaserMaster=t,this.phaserBitmapdata=n,this.phaserGroup=i,this.atlas=r},e.prototype.buildOverlayBackground=function(e,t,a,n){void 0===n&&(n=!1);var i=this.game,r=this.phaserBitmapdata.addGradient({name:"um_overlay__bmd",start:e,end:t,width:5,height:5,render:!1}),o=this.phaserSprites.add({x:0,y:0,name:"um_overlay__bg",width:i.world.width,height:i.world.height,reference:r.cacheBitmapData,visible:n});o.flash=function(e,t){void 0===e&&(e=500),void 0===t&&(t=function(){}),o.visible=!0,o.alpha=1,i.time.events.add(250,function(){i.add.tween(o).to({alpha:0},e,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){}),t()}).autoDestroy=!0},o.fadeIn=function(e,t){void 0===e&&(e=500),void 0===t&&(t=function(){}),o.visible=!0,o.alpha=0,i.add.tween(o).to({alpha:1},e,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){t()})},o.fadeOut=function(e,t){void 0===e&&(e=500),void 0===t&&(t=function(){}),o.visible=!0,o.alpha=1,i.add.tween(o).to({alpha:0},e,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){t()})},this.phaserGroup.add(this.phaserMaster.get("layers").OVERLAY,o)},e.prototype.buildOverlayGrid=function(e,t,a,n){void 0===e&&(e=80),void 0===t&&(t=80);for(var i=this.game,r=0,o=0;o<Math.ceil(i.world.height/t)+1;o++)for(var s=function(a){var s=l.phaserSprites.addFromAtlas({x:a*e,y:o*t,name:"grid"+r,group:"um_grid__bg",width:e,height:t,atlas:l.atlas,filename:n,visible:!0});s.anchor.setTo(.5,.5),s.scale.setTo(1,1),s.fadeOut=function(e){s.scale.setTo(1,1),i.add.tween(s).to({height:0},e,Phaser.Easing.Linear.Out,!0,0,0,!1)},s.fadeIn=function(e){i.add.tween(s).to({height:t},e,Phaser.Easing.Linear.In,!0,0,0,!1)},s.scaleOut=function(e){i.add.tween(s.scale).to({x:0,y:0},e,Phaser.Easing.Linear.In,!0,0,0,!1)},s.scaleIn=function(e){i.add.tween(s.scale).to({x:1,y:1},e,Phaser.Easing.Linear.Out,!0,0,0,!1)},r++,l.phaserGroup.add(l.phaserMaster.get("layers").OVERLAY,s)},l=this,p=0;p<Math.ceil(i.world.width/e)+1;p++)s(p)},e.prototype.overlayBGControls=function(e,t){var a=e.transition,n=e.delay,i=e.speed,r=this.phaserSprites.getOnly(["um_overlay__bg"]).um_overlay__bg;this.game.time.events.add(n,function(){switch(a){case"FLASHWHITE":r.flash(i,t);break;case"FADEIN":r.fadeIn(i,t);break;case"FADEOUT":r.fadeOut(i,t)}}).autoDestroy=!0},e.prototype.overlayControls=function(e,t){var a=this.game,n=e.transition,i=e.delay,r=e.speed,o=e.tileDelay,s=this.phaserSprites.getGroup("um_grid__bg"),l=[],p=[],h=o*s.length*.75,u=h+o*s.length;a.time.events.add(i,function(){switch(n){case"WIPEIN":s.map(function(e,t){t%2==0?p.push(e):l.push(e)}),p.map(function(e,t){a.time.events.add(o*t,function(){e.scaleIn(r)}).autoDestroy=!0}),a.time.events.add(u,function(){l.slice(0).reverse().map(function(e,t){a.time.events.add(o*t,function(){e.scaleIn(r)}).autoDestroy=!0})},h),a.time.events.add(u,function(){t()}).autoDestroy=!0;break;case"WIPEOUT":s.map(function(e,t){t%2==0?p.push(e):l.push(e)}),p.map(function(e,t){a.time.events.add(o*t,function(){e.scaleOut(r)}).autoDestroy=!0}),a.time.events.add(u,function(){l.slice(0).reverse().map(function(e,t){a.time.events.add(o*t,function(){e.scaleOut(r)}).autoDestroy=!0})},h),a.time.events.add(u,function(){t()}).autoDestroy=!0;break;case"FADEOUT":s.map(function(e,t){a.time.events.add(o*t,function(){e.fadeOut(r)}).autoDestroy=!0}),a.time.events.add(s.length*o+r,function(){t()}).autoDestroy=!0;break;case"FADEIN":s.map(function(e,t){a.time.events.add(u,function(){e.fadeIn(r)},o*t)}),a.time.events.add(u,function(){t()},s.length*o+r)}}).autoDestroy=!0},e}(),WEAPON_MANAGER=function(){function e(){}return e.prototype.assign=function(e,t,a,n,i,r){this.game=e,this.phaserSprites=a,this.phaserMaster=t,this.phaserGroup=n,this.effectsManager=i,this.atlas=r},e.prototype.calculateRotateCoords=function(e,t){var a,n=t.angle,i=Math.abs(t.angle);i>90&&(i=Math.abs(i-180)),n>=0&&n<90&&(a=0),n>=90&&n<180&&(a=1),n>=-180&&n<-90&&(a=2),n>=-90&&n<0&&(a=3);var r=Math.round(e-e*(i/90)),o=Math.round(e*(i/90));return{x:r=1===a?-r:r,y:o=3===a?-o:o}},e.prototype.calculateSpread=function(e,t){var a,n=t.angle,i=Math.abs(t.angle);i>90&&(i=Math.abs(i-180)),n>=0&&n<90&&(a=0),n>=90&&n<180&&(a=1),n>=-180&&n<-90&&(a=2),n>=-90&&n<0&&(a=3);var r=Math.round(e-e*(i/90)),o=Math.round(e*(i/90));return r=1===a?-r:r,o=3===a?-o:o,{x1:t.x+r,y1:t.y+o,x2:t.x-r,y2:t.y-o}},e.prototype.enemyBullet=function(e){var t=this;void 0===e&&(e=2);var a=this.game,n=(this.phaserMaster,a.add.weapon(e,this.atlas,"enemy_bullet"));return n.bulletKillType=Phaser.Weapon.KILL_CAMERA_BOUNDS,n.bulletSpeed=400,n.bulletAngleOffset=90,n.multiFire=!0,n.checkOrientation=function(e){n.bulletSpeed=-Math.abs(n.bulletSpeed),n.bulletAngleOffset=-Math.abs(n.bulletAngleOffset)},this.phaserGroup.add(this.phaserMaster.get("layers").ENEMY_BULLETS,n.bullets),n.bullets.children.map(function(e){e.destroyIt=function(a){e.kill(),t.effectsManager.orangeImpact(e.x+t.game.rnd.integerInRange(-5,5),e.y+t.game.rnd.integerInRange(-5,15),1,a)}}),n},e.prototype.playerBullets=function(e,t){var a=this.game,n=this.phaserMaster.getAll(["weaponData"]).weaponData.primaryWeapons[t],i=a.add.weapon(e,this.atlas,n.spriteAnimation[0]);switch(i.bulletKillType=Phaser.Weapon.KILL_CAMERA_BOUNDS,i.bulletSpeed=n.bulletSpeed,i.bulletAngleOffset=90,i.multiFire=!0,n.spriteAnimation.length>0&&(i.bullets.callAll("animations.add","animations","fire",n.spriteAnimation,20,!0),i.bullets.callAll("play",null,"fire")),t){case"MISSLE":i.bulletSpeedVariance=300,i.bulletAngleVariance=15;break;case"SHOTGUN":i.bulletSpeedVariance=1e3,i.bulletAngleOffset=-10,i.bulletAngleVariance=20;break;case"GATLING":i.bulletSpeedVariance=300,i.bulletAngleVariance=3}return i.onKill.add(function(e){}),i.checkOrientation=function(e){e<180?(i.bulletSpeed=Math.abs(i.bulletSpeed),i.bulletAngleOffset=Math.abs(i.bulletAngleOffset)):(i.bulletSpeed=-Math.abs(i.bulletSpeed),i.bulletAngleOffset=-Math.abs(i.bulletAngleOffset))},this.phaserGroup.add(this.phaserMaster.get("layers").PLAYER_BULLETS,i.bullets),i.bullets.children.map(function(e){e.weaponData=n,e.pierce=n.pierce,e.destroyIt=function(t){e.kill()}}),i},e.prototype.createClusterbomb=function(e,t){var a=this;void 0===t&&(t=function(){});var n=this.game,i=this.phaserMaster,r=(this.phaserSprites,this.phaserGroup,this.atlas,i.getAll().weaponData.secondaryWeapons.CLUSTERBOMB),o=this.createBomblet(25),s=n.add.weapon(1,this.atlas,r.spriteAnimation[0]);return s.bulletKillType=Phaser.Weapon.KILL_LIFESPAN,s.bulletSpeed=r.bulletSpeed,s.bulletAngleOffset=90,s.multiFire=!0,s.bulletLifespan=750,s.bomblets=o,r.spriteAnimation.length>0&&(s.bullets.callAll("animations.add","animations","fire",r.spriteAnimation,20,!0),s.bullets.callAll("play",null,"fire")),s.onKill.add(function(e){t(),o.map(function(t){t.fire(e)}),a.createExplosionVacuum(e.x,e.y,1.25,8,r.damage)}),s.bullets.children.map(function(e){e.weaponData=r,e.pierce=r.pierce,e.destroyIt=function(t){e.kill()}}),this.phaserGroup.add(this.phaserMaster.get("layers").SPECIAL_WEAPON,s.bullets),s},e.prototype.createBomblet=function(e){for(var t=this,a=this.game,n=this.phaserMaster,i=(this.phaserSprites,this.phaserGroup,this.atlas,n.getAll().weaponData,{reference:"BOMBLET",spriteAnimation:["bomblet"],damage:25,pierce:!1,ignoreDamageState:!1,completeAnimation:!1}),r=[],o=0;o<e;o++){var s=a.add.weapon(1,this.atlas,i.spriteAnimation[0]);s.bulletKillType=Phaser.Weapon.KILL_LIFESPAN,s.bulletSpeed=500+a.rnd.integerInRange(50,150),s.bulletAngleVariance=140,s.bulletLifespan=a.rnd.integerInRange(50,500),i.spriteAnimation.length>0&&(s.bullets.callAll("animations.add","animations","fire",i.spriteAnimation,20,!0),s.bullets.callAll("play",null,"fire")),s.onKill.add(function(e){t.createExplosionBasic(e.x,e.y,1.25,t.phaserMaster.get("layers").SPECIAL_WEAPON,i.damage)}),s.bullets.children.map(function(e){e.weaponData=i,e.pierce=i.pierce,e.destroyIt=function(t){e.kill()}}),this.phaserGroup.add(this.phaserMaster.get("layers").SPECIAL_WEAPON,s.bullets),r.push(s)}return r},e.prototype.createExplosionVacuum=function(e,t,a,n,i,r,o){void 0===r&&(r=function(){}),void 0===o&&(o=function(){});var s=this.game,l=this.phaserSprites,p=this.phaserGroup,h=this.atlas,u={reference:"EXPLOSION_VACUUM",spriteAnimation:Phaser.Animation.generateFrameNames("explosion_vacuum_",1,9).slice(),damage:25,pierce:!1,ignoreDamageState:!1,completeAnimation:!0},d=l.addFromAtlas({name:"impact_"+s.rnd.integer(),group:"impactExplosions",x:e,y:t,atlas:h,filename:u.spriteAnimation[0]});return d.scale.setTo(a,a),d.anchor.setTo(.5,.5),d.weaponData=u,d.animations.add("explosion",u.spriteAnimation,1,!0),d.animations.play("explosion",30,!1).onComplete.add(function(){d.destroyIt()},d),d.destroyIt=function(){l.destroy(d.name)},s.camera.shake(.004,500),p.add(void 0===n?this.phaserMaster.get("layers").VISUALS:n,d),s.physics.enable(d,Phaser.Physics.ARCADE),d},e.prototype.createExplosionVacuumFire=function(e,t,a,n,i,r,o){void 0===r&&(r=function(){}),void 0===o&&(o=function(){});var s=this.game,l=this.phaserSprites,p=this.phaserGroup,h=this.atlas,u={reference:"VACUUMEXPLOSION",spriteAnimation:Phaser.Animation.generateFrameNames("explosion_vacuum_inner_",1,13).slice(),damage:25,pierce:!1,ignoreDamageState:!1,completeAnimation:!0},d=l.addFromAtlas({name:"impact_"+s.rnd.integer(),group:"impactExplosions",x:e,y:t,atlas:h,filename:u.spriteAnimation[0]});return d.scale.setTo(a,a),d.anchor.setTo(.5,.5),d.weaponData=u,d.animations.add("explosion",u.spriteAnimation,1,!0),d.animations.play("explosion",30,!1).onComplete.add(function(){d.destroyIt()},d),d.destroyIt=function(){l.destroy(d.name)},s.camera.shake(.004,500),p.add(void 0===n?this.phaserMaster.get("layers").VISUALS:n,d),s.physics.enable(d,Phaser.Physics.ARCADE),d},e.prototype.createExplosionBasic=function(e,t,a,n,i,r,o){void 0===r&&(r=function(){}),void 0===o&&(o=function(){});var s=this.game;console.log(i);var l=this.phaserSprites,p=this.phaserGroup,h=this.atlas,u={reference:"EXPLOSION_BASIC",spriteAnimation:Phaser.Animation.generateFrameNames("explosions_Layer_",1,16),damage:void 0!==i?i:25,pierce:!1,ignoreDamageState:!1,completeAnimation:!0},d=l.addFromAtlas({name:"impact_"+s.rnd.integer(),group:"impactExplosions",x:e,y:t,atlas:h,filename:u.spriteAnimation[0]});return d.scale.setTo(a,a),d.anchor.setTo(.5,.5),d.weaponData=u,d.animations.add("explosion",u.spriteAnimation,1,!0),d.animations.play("explosion",30,!1).onComplete.add(function(){d.destroyIt()},d),d.destroyIt=function(){l.destroy(d.name)},s.camera.shake(.002,500),p.add(void 0===n?this.phaserMaster.get("layers").VISUALS:n,d),s.physics.enable(d,Phaser.Physics.ARCADE),d},e}();