var PhaserGameObject=function(){function t(){this.game=null,this.global={pause:!1}}return t.prototype.init=function(t,e,a){var i=new PHASER_MASTER({game:new Phaser.Game(a.width,a.height,Phaser.WEBGL,t,{preload:function(){var t=i.game();t.load.enableParallel=!0,t.stage.backgroundColor="#2f2f2f";var e="src/phaser/saveTheWorld/resources";t.load.image("background",e+"/images/starfield.png"),t.load.atlas("atlas_main",e+"/spritesheets/main/main.png",e+"/spritesheets/main/main.json",Phaser.Loader.TEXTURE_atlas_main_JSON_HASH),t.load.atlas("atlas_weapons",e+"/spritesheets/weapons/weaponsAtlas.png",e+"/spritesheets/weapons/weaponsAtlas.json",Phaser.Loader.TEXTURE_atlas_main_JSON_HASH),t.load.atlas("atlas_large",e+"/spritesheets/large/large.png",e+"/spritesheets/large/large.json",Phaser.Loader.TEXTURE_atlas_main_JSON_HASH),t.load.json("weaponData",e+"/json/weaponData.json"),t.load.bitmapFont("gem",e+"/fonts/gem.png",e+"/fonts/gem.xml"),i.changeState("PRELOAD"),new PHASER_PRELOADER({game:t,delayInSeconds:0,done:function(){var t,e,a,s,r,h,l;t=i.game(),e=i.get("devMode"),a=o.getOnly(["overlay"]).overlay,s=i.getOnly(["clock","roundTime"]),r=s.clock,h=s.roundTime,l=function(){var t=i.game(),e=o.addFromAtlas({name:"player",group:"playership",atlas:"atlas_main",filename:"ship_body.png",visible:!1});return e.anchor.setTo(.5,.5),e.scale.setTo(1,1),e.isInvincible=!1,e.isDead=!1,t.physics.enable(e,Phaser.Physics.ARCADE),d.add(8,e),a=o.addFromAtlas({name:"exhaust",group:"playership",atlas:"atlas_main",filename:"exhaust_red_1.png",visible:!1}),a.animations.add("exhaust_animation",Phaser.Animation.generateFrameNames("exhaust_red_",1,8,".png"),1,!0),a.animations.play("exhaust_animation",30,!0),d.add(8,a),a.anchor.setTo(.5,.5),a.onUpdate=function(){var t=o.get("player"),e=t.x,a=(t.width,t.height,t.y),n=t.visible,s=t.isDead;this.visible=!i.checkState("ENDLEVEL")&&n,this.x=e,this.y=a+40,this.alpha=!i.checkState("ENDLEVEL")&&s?0:1,this.scale.setTo(1,1)},a.updateCords=function(t,e){var a=i.get("starMomentum");this.x=t,0==a.y&&(this.y=e+40,this.scale.setTo(1,1)),a.y>0&&(this.y=e+50,this.scale.setTo(1,1.5)),a.y<0&&(this.y=e+25,this.scale.setTo(1,.25))},a.destroyIt=function(){o.destroy("exhaust")},e.onUpdate=function(){var t=this;if(this.visible&&!e.isDead&&e.createTrail(),!e.isInvincible&&!i.checkState("ENDLEVEL")){var a=!1;P().map(function(e){e.game.physics.arcade.overlap(t,e,function(t,e){a=!0,e.damageIt(50)},null,t)}),a&&(this.isInvincible=!0,e.takeDamage(10))}},e.takeDamage=function(t){var e=this,a=i.get("gameData"),s=a.player.health-t;f(s),s>0?(y("player",{health:s,lives:a.player.lives}),this.tint=16711680,this.alpha=.75,this.game.add.tween(this).to({tint:16777215,alpha:1},100,Phaser.Easing.Linear.Out,!0,100,0,!1).onComplete.add(function(){e.isInvincible=!1})):(a.player.lives--,o.get("lifeIcon_"+a.player.lives).destroyIt(),a.player.lives>0?(y("player",{health:100,lives:a.player.lives}),n.clearAllControlIntervals(),n.disableAllInput(),this.isDestroyed()):D())},e.isDestroyed=function(){var a=this;e.isDead=!0,c.createExplosion(this.x,this.y,1,6),t.add.tween(this).to({angle:t.rnd.integerInRange(-90,90),alpha:0},1e3,Phaser.Easing.Linear.In,!0,0).onComplete.add(function(){c.createExplosion(a.x,a.y,1,6),a.visible=!1,setTimeout(function(){f(100),e.moveToStart()},1e3)})},e.createTrail=function(){o.getGroup("trails").length,i.checkState("ENDLEVEL");var e=o.addFromAtlas({name:"trail_"+t.rnd.integer(),group:"trails",x:this.x,y:this.y,filename:"ship_body.png",atlas:"atlas_main",visible:!0});e.anchor.setTo(.5,.5),e.scale.setTo(this.scale.x-.2,this.scale.y-.2),e.alpha=.4,e.angle=this.angle,e.tint=255,d.add(7,e),e.destroySelf=function(){var t=this;this.game.add.tween(this).to({alpha:0},i.checkState("ENDLEVEL")?600:250,Phaser.Easing.Linear.In,!0,0).onComplete.add(function(){o.destroy(t.name)},this)},e.destroySelf()},e.selfDestruct=function(){var e=this;this.isInvincible=!0,o.get("exhaust").destroyIt(),t.add.tween(this.scale).to({x:.25,y:.25},3400,Phaser.Easing.Linear.In,!0,0).game.add.tween(this).to({angle:720},3400,Phaser.Easing.Linear.In,!0,0).onComplete.add(function(){o.destroy(e.name),c.createExplosion(e.x,e.y,.5,6)},this)},e.moveToStart=function(){var a=this;e.isDead=!1,this.angle=0,this.alpha=1,this.visible=!0,this.isInvincible=!0,this.x=this.game.world.centerX,this.y=this.game.world.centerY+550,t.add.tween(this).to({y:t.world.centerY+200},1e3,Phaser.Easing.Exponential.InOut,!0,0,0,!1).onComplete.add(function(){n.enableAllInput(),setTimeout(function(){a.isInvincible=!1},1e3)})},e.moveX=function(t){this.x+=t,o.get("exhaust").updateCords(this.x,this.y),this.checkLimits()},e.moveY=function(t){this.y+=t,o.get("exhaust").updateCords(this.x,this.y),this.checkLimits()},e.checkLimits=function(){this.y-this.height<0&&(this.y=this.height),this.y+this.height>this.game.canvas.height&&(this.y=this.game.canvas.height-this.height),this.x<0&&(this.x=this.game.canvas.width+this.width),this.x>this.game.canvas.width+this.width&&(this.x=0)},e.playEndSequence=function(t){var e=this;this.isInvincible=!0,this.game.add.tween(this.scale).to({x:2,y:2},750,Phaser.Easing.Exponential.InOut,!0,0,0,!1),this.game.add.tween(this).to({x:this.game.world.centerX,y:this.game.world.centerY+50},750,Phaser.Easing.Exponential.InOut,!0,0,0,!1).onComplete.add(function(){e.game.add.tween(e).to({y:e.game.world.height+200},750,Phaser.Easing.Exponential.InOut,!0,100,0,!1).onComplete.add(function(){e.game.add.tween(e).to({y:-200},1e3,Phaser.Easing.Exponential.InOut,!0,0,0,!1).onComplete.add(function(){t()},e)},e)},this)},e;var a}(),a.fadeOut(e?0:Phaser.Timer.SECOND/2,function(){T("SAVE THE WORLD",function(){l.moveToStart(),t.time.events.add(e?0*Phaser.Timer.SECOND:1*Phaser.Timer.SECOND,function(){T(h+" SECONDS GO",function(){t.time.events.add(e?0*Phaser.Timer.SECOND:Phaser.Timer.SECOND/2,function(){o.getGroup("ui").map(function(t){t.reveal()})}).autoDestroy=!0,r.start(),i.changeState("READY")})})})})}})},create:function(){var t=i.game(),e=i.get("gameData");t.physics.startSystem(Phaser.Physics.ARCADE),n.assign(t),s.assign(t),o.assign(t),r.assign(t),h.assign(t),l.assign(t),d.assign(t,20),u.assign(t),c.assign(t,i,o,d,"atlas_weapons"),i.let("roundTime",30),i.let("clock",t.time.create(!1)),i.let("elapsedTime",0),i.let("devMode",!1),i.let("starMomentum",{x:0,y:0}),i.let("pauseStatus",!1);var a=i.let("weaponData",t.cache.getJSON("weaponData")),p=(i.let("primaryWeapon",a.primaryWeapons[e.primaryWeapon]),i.let("secondaryWeapon",a.secondaryWeapons[e.secondaryWeapon]));t.onPause.add(function(){i.get("clock").stop(),i.forceLet("pauseStatus",!0)},this),t.onResume.add(function(){i.get("clock").start(),i.forceLet("pauseStatus",!1)},this);var g=u.addGradient({name:"boundryObj",start:"#ffffff",end:"#ffffff",width:5,height:5,render:!1}),m=o.add({x:-9,y:-t.world.height/2,name:"leftBoundry",group:"boundries",width:10,height:2*t.world.height,reference:g.cacheBitmapData,alpha:0}),x=o.add({x:t.world.width-1,y:-t.world.height/2,name:"rightBoundry",group:"boundries",width:10,height:2*t.world.height,reference:g.cacheBitmapData,alpha:0});t.physics.enable([m,x],Phaser.Physics.ARCADE),m.body.immovable=!0,x.body.immovable=!0;var E=o.addTilespriteFromAtlas({name:"background",group:"spaceGroup",x:0,y:0,width:t.canvas.width,height:t.canvas.height,atlas:"atlas_large",filename:"spacebg.png"});E.count=0,E.onUpdate=function(){this.count+=.005,this.tilePosition.y-=.2*Math.sin(this.count)},d.add(0,E);var w=i.let("emitter",t.add.emitter(t,0,0,5e3));w.makeParticles("atlas_main","particle.png"),w.gravity=0,d.layer(1).add(w);for(var A=function(e){var a=o.addFromAtlas({x:t.rnd.integerInRange(0,t.world.width),y:t.rnd.integerInRange(0,t.world.height),name:"star_"+e,group:"movingStarField",filename:"stars_layer_"+t.rnd.integerInRange(1,3)+".png",atlas:"atlas_main",visible:!0});a.starType=t.rnd.integerInRange(1,3),a.scale.setTo(a.starType/2,a.starType/2),a.onUpdate=function(){var e=.25+5*(3-a.starType),n=i.get("starMomentum");this.y>this.game.world.height&&(this.y=10,this.x=t.rnd.integerInRange(-100,t.world.width)),this.x>this.game.world.width&&(this.x=0),this.x<0&&(this.x=this.game.world.width),n.x>0&&(n.x-=.05),n.x<0&&(n.x+=.05),n.y>0&&(n.y-=.05),n.y<0&&(n.y+=.05),this.x+=(3-a.starType)*n.x,this.y+=e+(3-a.starType)*n.y},a.fadeOut=function(){this.game.add.tween(this).to({alpha:0},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,t.rnd.integerInRange(0,500),0,!1).autoDestroy=!0},d.layer(4-a.starType).add(a)},I=0;I<25;I++)A(I);var P=o.addTilespriteFromAtlas({name:"nebula1",group:"spaceGroup",x:0,y:0,width:t.canvas.width,height:t.canvas.height,atlas:"atlas_large",filename:"Nebula1.png"});P.count=0,P.onUpdate=function(){this.count+=.005,this.tilePosition.x-=.2*Math.sin(this.count)};var D=o.addTilespriteFromAtlas({name:"nebula2",group:"spaceGroup",x:0,y:0,width:t.canvas.width,height:t.canvas.height,atlas:"atlas_large",filename:"Nebula2.png"});D.count=0,D.onUpdate=function(){this.count+=.005,this.tilePosition.y+=.2,this.tilePosition.x+=.2};var S=o.addFromAtlas({x:this.game.world.centerX,y:this.game.canvas.height+400,name:"earth",group:"spaceGroup",filename:"earth.png",atlas:"atlas_main",visible:!0});S.scale.setTo(2,2),S.anchor.setTo(.5,.5),S.onUpdate=function(){S.angle+=.01},S.fadeOut=function(){this.game.add.tween(this).to({y:this.y-200},1*Phaser.Timer.SECOND,Phaser.Easing.Circular.In,!0,0,0,!1).autoDestroy=!0,this.game.add.tween(this.scale).to({x:2.5,y:2.5},1*Phaser.Timer.SECOND,Phaser.Easing.Circular.In,!0,0,0,!1).autoDestroy=!0},S.selfDestruct=function(){var e,a,n,s,o,r,h=this;e=this,a=this.tint,n=16711680,s=20*Phaser.Timer.SECOND,o={step:0},(r=i.game().add.tween(o).to({step:100},s)).onUpdateCallback(function(){e.tint=Phaser.Color.interpolateColor(a,n,100,o.step)}),e.tint=a,r.start(),setTimeout(function(){h.tint=16711680},20*Phaser.Timer.SECOND+1);var l=setInterval(function(){c.createExplosion(t.rnd.integerInRange(0,h.game.canvas.width),t.rnd.integerInRange(h.game.canvas.height-200,h.game.canvas.height),.25,6)},100);i.let("endExplosion",l)},d.addMany(2,[S]),d.addMany(1,[P,D]);var C=o.addFromAtlas({name:"timerContainer",group:"ui",filename:"ui_container1.png",atlas:"atlas_main",visible:!1});o.centerOnPoint("timerContainer",this.game.world.centerX,-200),C.reveal=function(){var t=this;this.visible=!0,this.game.add.tween(this).to({y:5},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,0,0,!1).onComplete.add(function(){var e=h.add({y:36,x:t.game.world.centerX,name:"timeKeeper",group:"ui_text",font:"gem",size:42,default:"00",visible:!1});e.anchor.setTo(.5,.5),e.reveal=function(){this.visible=!0,this.alpha=0,this.game.add.tween(this).to({alpha:1},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.In,!0,0,0,!1),d.add(15,this)},e.onUpdate=function(){i.get("elapsedTime");var t=i.get("elapsedTime");t+=.001*i.get("clock").elapsed,i.forceLet("elapsedTime",t);var e,a,n=i.get("roundTime"),s=parseInt((n-t).toFixed(0));s>=0?this.setText(""+s):(e=i.game(),a=i.get("gameData"),i.changeState("ENDLEVEL"),h.getGroup("ui_text").map(function(t){t.hide()}),o.getGroup("ui").map(function(t){t.hide()}),o.getGroup("secondaryWpnSprite").map(function(t){t.destroyIt()}),o.get("player").playEndSequence(function(){var t=a.level++;y("level",++t);for(var n=0;n<20;n++)setTimeout(function(){c.createExplosion(e.rnd.integerInRange(0,e.world.width),e.rnd.integerInRange(0,e.world.height),e.rnd.integerInRange(1,4),6)},e.rnd.integerInRange(0,50)*n);setTimeout(function(){o.getGroup("aliens").map(function(t){setTimeout(function(){t.destroyIt(!1)},e.rnd.integerInRange(0,500))}),o.getGroup("trashes").map(function(t){setTimeout(function(){t.destroyIt(!1)},e.rnd.integerInRange(0,500))}),o.getGroup("movingStarField").map(function(t){t.fadeOut()}),setTimeout(function(){T("NICE JOB HERO",function(){o.get("earth").fadeOut();var t=o.addTilespriteFromAtlas({name:"blue_bg",group:"spaceGroup",x:0,y:0,width:e.canvas.width,height:e.canvas.height,atlas:"atlas_large",filename:"motionBlur.jpg",alpha:0});t.count=0,t.scale.setTo(2,2),t.anchor.setTo(.5,.5),t.onUpdate=function(){this.tilePosition.y-=25},d.add(11,t),e.add.tween(t).to({alpha:1},Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){var a=o.addTilespriteFromAtlas({name:"victory_bg",group:"spaceGroup",x:0,y:0,width:e.canvas.width,height:e.canvas.height,atlas:"atlas_large",filename:"victory_bg.png",alpha:1});a.onUpdate=function(){this.tilePosition.x-=3},d.add(10,a),e.add.tween(t).to({alpha:0},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){var t,e,a;t=i.game(),e=i.get("gameData"),(a=o.addFromAtlas({y:t.world.centerY-100,name:"victoryScreenContainer",group:"ui_clear",filename:"ui_clear.png",atlas:"atlas_main",visible:!1})).anchor.setTo(.5,.5),a.reveal=function(){var n=this;this.x=-this.width-100,this.visible=!0,this.game.add.tween(this).to({x:this.game.world.centerX},1*Phaser.Timer.SECOND,Phaser.Easing.Bounce.Out,!0,0,0,!1).onComplete.add(function(){var s=o.addFromAtlas({x:n.game.world.centerX,y:n.game.world.centerY,name:"scoreContainer2",group:"ui",filename:"ui_roundContainer.png",atlas:"atlas_main",visible:!0});s.anchor.setTo(.5,.5);var r=h.add({name:"scoreText2",group:"ui_text",x:s.x,y:s.y,font:"gem",size:14,default:""+e.score});r.anchor.setTo(.5,.5),r.updateScore=function(){this.setText(""+i.get("gameData").score)},d.addMany(12,[s]),d.addMany(13,[r]),i.get("gameData").population;var l=h.add({name:"popLeft",font:"gem",x:n.x,y:n.y-10,size:24,default:"PEOPLE SAVED:",alpha:0});l.anchor.setTo(.5,.5),l.scale.setTo(2,2),l.game.add.tween(l.scale).to({x:1,y:1},100,Phaser.Easing.Linear.Out,!0,0),l.game.add.tween(l).to({alpha:1},100,Phaser.Easing.Linear.Out,!0,0).onComplete.add(function(){setTimeout(function(){var s=i.get("gameData").population,u=h.add({name:"popCount",font:"gem",x:n.x,y:n.y+30,size:45,default:"",alpha:0});u.anchor.setTo(.5,.5),u.scale.setTo(1.5,1.5),u.setText(""+7e5*(s.total-s.killed)),u.game.add.tween(u.scale).to({x:1,y:1},100,Phaser.Easing.Linear.Out,!0,0),u.game.add.tween(u).to({alpha:1},100,Phaser.Easing.Linear.Out,!0,0),d.addMany(13,[u]);var c=7e5*(s.total-s.killed),p=543211,g=0,m=0,f=setInterval(function(){i.get("pauseStatus")||(p>c&&(p=Math.round(p/2)),c-p<=0?(u.setText(0),clearInterval(f),setTimeout(function(){l.setText("MEDALS EARNED"),h.destroy("popCount");for(var e=function(e){var i=o.addFromAtlas({name:"medal_"+e,group:"medals",x:a.x+20*e-80,y:a.y+20,width:t.canvas.width,height:t.canvas.height,atlas:"atlas_main",filename:"medal_gold.png",alpha:0});i.reveal=function(){this.scale.setTo(2,2),this.game.add.tween(this.scale).to({x:1,y:1},100,Phaser.Easing.Linear.Out,!0,0),this.game.add.tween(this).to({alpha:1},100,Phaser.Easing.Linear.Out,!0,0)},d.addMany(13,[i]),setTimeout(function(){i.reveal()},50*e)},n=0;n<g;n++)e(n);setTimeout(function(){i.changeState("VICTORYSTATE"),o.getGroup("ui_buttons").map(function(t){t.reveal()}),h.get("menuButton1Text").setText("CONTINUE"),h.get("menuButton2Text").setText("SAVE AND QUIT")},50*g+100)},Phaser.Timer.SECOND)):((m+=p)>1e7&&(y("score",Math.round(e.score+2e3)),r.updateScore(),g++,m=0),c-=p,u.setText(c)))},1)},Phaser.Timer.SECOND/2)})})},a.hide=function(){this.game.add.tween(this).to({y:-this.height},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,500,0,!1)},a.reveal(),d.addMany(13,[a])})})})},1.5*Phaser.Timer.SECOND)},Phaser.Timer.SECOND/3)}))},e.hide=function(){this.game.add.tween(this).to({alpha:0},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.Out,!0,0,0,!1)},e.reveal()})},C.hide=function(){this.game.add.tween(this).to({y:-200},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,500,0,!1),h.get("timeKeeper").hide()};var O=o.addFromAtlas({name:"scoreContainer",group:"ui",filename:"ui_roundContainer.png",atlas:"atlas_main",visible:!1});O.anchor.setTo(.5,.5),O.reveal=function(){var t=this;this.x=this.game.world.width-this.width/2-10,this.y=-200,this.visible=!0,this.game.add.tween(this).to({y:20},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,0,0,!1).onComplete.add(function(){var a=h.add({name:"scoreText",group:"ui_text",x:t.x,y:t.y,font:"gem",size:14,default:""+e.score,alpha:0});a.anchor.setTo(.5,.5),a.onUpdate=function(){},a.updateScore=function(){this.setText(""+i.get("gameData").score)},a.reveal=function(){this.game.add.tween(this).to({alpha:1},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.In,!0,0,0,!1)},a.hide=function(){this.game.add.tween(this).to({alpha:0},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.In,!0,0,0,!1)},a.reveal()})},O.hide=function(){this.game.add.tween(this).to({y:-200},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,500,0,!1),h.get("scoreText").hide()};var R=o.addFromAtlas({name:"statusContainer",group:"ui",filename:"ui_statusContainer.png",atlas:"atlas_main",visible:!1});R.reveal=function(){this.x=-this.width,this.y=this.game.world.height-this.height-10,this.visible=!0,this.game.add.tween(this).to({x:10},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,0,0,!1).onComplete.add(function(){var t=o.addFromAtlas({x:R.x+7,y:R.y+22,name:"healthBar",group:"ui_overlay",filename:"ui_shieldBar.png",atlas:"atlas_main",visible:!0}),a=i.let("healthBar",o.addBasicMaskToSprite(t));a.y=t.height,f(e.player.health);var n=o.addFromAtlas({x:R.x+30,y:R.y+206,name:"specialBar",group:"ui_overlay",filename:"ui_specialBar.png",atlas:"atlas_main",visible:!0}),s=i.let("specialBar",o.addBasicMaskToSprite(n));s.y=n.height,v(100);var r=o.addFromAtlas({x:R.x+36,y:R.y+305,name:"specialWeapon",group:"ui_overlay",filename:""+p.spriteIcon,atlas:"atlas_weapons",visible:!1});r.anchor.setTo(.5,.5),r.onUpdate=function(){this.angle+=2},r.reveal=function(){this.visible=!0,r.scale.setTo(2,2),this.game.add.tween(this.scale).to({x:1.5,y:1.5},Phaser.Timer.SECOND,Phaser.Easing.Bounce.Out,!0,0,0,!1)},r.hide=function(){this.visible=!1},r.reveal(),d.addMany(14,[t,n,r])})},R.hide=function(){v(0),f(0),o.getGroup("ui_overlay").map(function(t){t.hide()}),this.game.add.tween(this).to({y:this.game.world.height+this.height},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,500,0,!1)};var B=o.addFromAtlas({name:"earthContainer",group:"ui",filename:"ui_shield.png",atlas:"atlas_main",visible:!1});B.reveal=function(){var t=this;this.x=this.game.world.width+this.width,this.y=this.game.world.height-this.height-10,this.visible=!0,this.game.add.tween(this).to({x:this.game.world.width-this.width-10},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,0,0,!1).onComplete.add(function(){t.defaultPosition.x=t.x,t.defaultPosition.y=t.y;var a=o.addFromAtlas({x:B.x+5,y:B.y+5,name:"earthBar",group:"ui_overlay",filename:"ui_healthBar.png",atlas:"atlas_main",visible:!0}),n=i.let("earthBar",o.addBasicMaskToSprite(a));n.x=-a.width;var s=e.population,r=100-s.killed/s.total*100;b(r)})},B.hide=function(){b(0),this.game.add.tween(this).to({y:this.game.world.height+this.height},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,500,0,!1)},B.takeDamage=function(){var t=this;this.game.add.tween(this).to({x:this.defaultPosition.x-5},50,Phaser.Easing.Bounce.In,!0,0,0,!1).onComplete.add(function(){t.game.add.tween(t).to({x:t.defaultPosition.x+3},50,Phaser.Easing.Bounce.Out,!0,0,0,!1).onComplete.add(function(){t.game.add.tween(t).to({x:t.defaultPosition.x},50,Phaser.Easing.Bounce.InOut,!0,0,0,!1)})})};var _=o.addFromAtlas({x:10,name:"portraitContainer",group:"ui",filename:"ui_portraitContainer.png",atlas:"atlas_main",visible:!1});_.reveal=function(){var t=this;this.y=-this.height-10,this.visible=!0,this.game.add.tween(this).to({y:10},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,0,0,!1).onComplete.add(function(){var a=o.addFromAtlas({x:t.x+2,y:t.y+2,name:"characterPortrait",group:"ui_overlay",filename:"ui_portrait_1.png",atlas:"atlas_main",alpha:0});a.reveal=function(){this.game.add.tween(this).to({alpha:1},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.In,!0,0,0,!1)},a.hide=function(){this.game.add.tween(this).to({alpha:0},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.In,!0,0,0,!1)},a.reveal();for(var i=0;i<e.player.lives;i++){var n=o.addFromAtlas({x:t.x+12+20*i,y:t.y+t.height+10,name:"lifeIcon_"+i,group:"ui_overlay",filename:"ship_icon.png",atlas:"atlas_main",alpha:0});n.anchor.setTo(.5,.5),n.reveal=function(){this.game.add.tween(this).to({alpha:1},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.In,!0,0,0,!1)},n.hide=function(){this.game.add.tween(this).to({alpha:0},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.In,!0,0,0,!1)},n.destroyIt=function(){o.destroy(this.name)},n.reveal()}d.addMany(12,[a])})},_.hide=function(){this.game.add.tween(this).to({y:-this.height},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,500,0,!1)};var L=o.addFromAtlas({name:"menuButton1",group:"ui_buttons",x:t.world.centerX,y:t.world.centerY+125,atlas:"atlas_main",filename:"ui_button.png",visible:!1});L.anchor.setTo(.5,.5),L.reveal=function(){this.visible=!0},h.add({name:"menuButton1Text",font:"gem",x:L.x,y:L.y,size:14,default:""}).anchor.setTo(.5,.5);var M=o.addFromAtlas({name:"menuButton2",group:"ui_buttons",x:t.world.centerX,y:t.world.centerY+175,atlas:"atlas_main",filename:"ui_button.png",visible:!1});M.anchor.setTo(.5,.5),M.reveal=function(){this.visible=!0},h.add({name:"menuButton2Text",font:"gem",x:M.x,y:M.y,size:14,default:""}).anchor.setTo(.5,.5);var N=o.addFromAtlas({name:"menuButtonCursor",group:"ui_buttons",x:t.world.centerX-125,atlas:"atlas_main",filename:"ui_cursor.png",visible:!1});N.anchor.setTo(.5,.5),N.reveal=function(){this.visible=!0},N.updateLocation=function(t){i.forceLet("menuButtonSelection",t);var e=o.get("menuButton"+t);this.y=e.y},N.updateLocation(1),d.addMany(12,[L,M,N]),d.addMany(13,[C,R,O,B,_]);var k=u.addGradient({name:"overlaybmd",start:"#2f2f2f",end:"#2f2f2f",width:5,height:5,render:!1}),U=o.add({x:0,y:0,name:"overlay",width:t.canvas.width,height:t.canvas.height,reference:k.cacheBitmapData,visible:!0});U.fadeIn=function(e,a){t.add.tween(this).to({alpha:1},e,Phaser.Easing.Linear.In,!0,0,0,!1),setTimeout(function(){a()},e)},U.fadeOut=function(e,a){t.add.tween(this).to({alpha:0},e,Phaser.Easing.Linear.Out,!0,0,0,!1),setTimeout(function(){a()},e)},d.addMany(10,[U])},update:function(){var t=i.game(),a=i.getState().currentState,s=i.getOnly(["starMomentum","primaryWeapon","secondaryWeapon","menuButtonSelection","elapsedTime"]),r=s.starMomentum,l=s.primaryWeapon,u=s.secondaryWeapon,p=s.menuButtonSelection,g=s.elapsedTime,f=o.getOnly(["specialWeapon","player"]),b=f.specialWeapon,T=f.player,D=n.getOnly(["DOWN","UP","LEFT","RIGHT","A","START"]),C=D.DOWN,O=D.UP,R=D.LEFT,B=D.RIGHT,_=D.A,L=D.START;void 0!==g&&(g=parseInt(g.toFixed(0)));if(o.getManyGroups(["spaceGroup","movingStarField","ship_weapons","secondaryWpnSprite","impactExplosions","playership"]).map(function(t){t.onUpdate()}),"READY"===a){if(g<15&&o.getGroup("aliens").length<5&&function(t){var e=i.game(),a=o.addFromAtlas({x:t.x,y:t.y,name:"alien_"+e.rnd.integer(),group:"aliens",atlas:"atlas_main",filename:"asteroid_mid_layer_"+e.rnd.integerInRange(1,3)+".png",visible:!0});a.anchor.setTo(.5,.5),a.scale.setTo(1.5,1.5),e.physics.enable(a,Phaser.Physics.ARCADE),a.body.velocity.y=t.iy,a.body.velocity.x=t.ix,a.angleMomentum=e.rnd.integerInRange(-5,5),a.body.bounce.setTo(1,1),a.atTarget=!1,a.maxHealth=150,a.health=a.maxHealth,a.fallThreshold=e.rnd.integerInRange(0,75),d.add(3,a),a.damageIt=function(t){this.atTarget||(this.health-=t,this.tint=16711680,this.game.add.tween(this).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),this.health<=0&&this.destroyIt())},a.removeIt=function(){o.destroy(this.name)},a.destroyIt=function(t){var a=this;void 0===t&&(t=!0);var n=i.get("gameData").score;y("score",n+=100);var s=h.get("scoreText");s.updateScore();var r={angle:e.rnd.integerInRange(-720,720),x:this.x-e.rnd.integerInRange(-25,25),y:this.y-e.rnd.integerInRange(5,25),alpha:.5};this.game.add.tween(this).to(r,e.rnd.integerInRange(150,500),Phaser.Easing.Linear.Out,!0,0,0,!1),this.body=null,e.time.events.add(Phaser.Timer.SECOND/2,function(){if(c.createExplosion(a.x,a.y,1,6),t)for(var i=0;i<5;i++)E({x:a.x,y:a.y,ix:e.rnd.integerInRange(-100,100),iy:-e.rnd.integerInRange(-20,20)});o.destroy(a.name)},this).autoDestroy=!0},a.fallToPlanet=function(){var t=this;this.tint=0,this.atTarget=!0,this.body=null,this.game.add.tween(this).to({y:this.y+60},2*Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,0).autoDestroy=!0,setTimeout(function(){t.game.add.tween(t.scale).to({x:0,y:0},1*Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,e.rnd.integerInRange(0,500)).onComplete.add(function(){t.removeIt(),x(2),c.createExplosion(t.x,t.y,.25,6)}).autoDestroy=!0},300)},a.checkLocation=function(){this.angle+=a.angleMomentum,this.angleMomentum>0&&(this.angleMomentum-=.002),this.angleMomentum<0&&(this.angleMomentum+=.002),this.y>this.height&&null!==this.body&&(this.body.collideWorldBounds=!0),this.y>this.game.canvas.height-(75+this.fallThreshold)&&(null===this.body||this.atTarget||(this.body.collideWorldBounds=!1,this.fallToPlanet()))},a.onUpdate=function(){e.physics.arcade.collide([o.get("leftBoundry"),o.get("rightBoundry")],this),this.rotate+=2,a.atTarget||(null!==this.body&&(this.body.velocity.y+2<100&&(this.body.velocity.y+=2),this.body.velocity.x>0&&(this.body.velocity.x-=.2),this.body.velocity.x<0&&(this.body.velocity.x+=.2)),this.checkLocation())}}({x:t.rnd.integerInRange(0,t.canvas.width),y:t.rnd.integerInRange(-50,-300),ix:t.rnd.integerInRange(-100,100),iy:t.rnd.integerInRange(0,80)}),15===g&&0===o.getGroup("boss").length&&function(t){var e=i.game(),a=o.addFromAtlas({x:t.x,y:t.y,name:"boss_"+e.rnd.integer(),group:"boss",atlas:"atlas_main",filename:"asteroid_large_layer_"+e.rnd.integerInRange(1,3)+".png",visible:!0});a.anchor.setTo(.5,.5),e.physics.enable(a,Phaser.Physics.ARCADE),a.body.velocity.y=t.iy,a.body.velocity.x=t.ix,a.angleMomentum=e.rnd.integerInRange(-5,5),a.body.bounce.setTo(1,1),a.atTarget=!1,a.maxHealth=4e4,a.health=a.maxHealth,a.fallThreshold=e.rnd.integerInRange(0,75),d.add(3,a),a.damageIt=function(t){this.atTarget||(this.health-=t,this.tint=16711680,this.game.add.tween(this).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),this.health<=0&&this.destroyIt())},a.removeIt=function(){o.destroy(this.name)},a.destroyIt=function(t){var a=this;void 0===t&&(t=!0);var n=i.get("gameData").score;y("score",n+=1e3);var s=h.get("scoreText");s.updateScore();var r={angle:720,x:this.x-e.rnd.integerInRange(-10,10),y:this.y-e.rnd.integerInRange(10,10),alpha:.15};this.game.add.tween(this).to(r,2*Phaser.Timer.SECOND,Phaser.Easing.Linear.Out,!0,0,0,!1),this.game.add.tween(this.scale).to({x:.5,y:.5},2*Phaser.Timer.SECOND,Phaser.Easing.Linear.Out,!0,0,0,!1),this.body=null,e.time.events.add(2*Phaser.Timer.SECOND,function(){var t=a,e=t.x,i=t.y;I(e,i,2,100),o.destroy(a.name)},this).autoDestroy=!0},a.fallToPlanet=function(){var t=this;this.tint=0,this.atTarget=!0,this.body=null,this.game.add.tween(this).to({y:this.y+60,angle:720},3*Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,0).autoDestroy=!0,setTimeout(function(){t.game.add.tween(t.scale).to({x:0,y:0},3*Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,e.rnd.integerInRange(0,500)).onComplete.add(function(){t.removeIt(),x(10),c.createExplosion(t.x,t.y,.85,6)}).autoDestroy=!0},300)},a.checkLocation=function(){this.angle+=a.angleMomentum,this.angleMomentum>0&&(this.angleMomentum-=.002),this.angleMomentum<0&&(this.angleMomentum+=.002),this.y>this.height&&null!==this.body&&(this.body.collideWorldBounds=!0),this.y>this.game.canvas.height-(75+this.fallThreshold)&&(null===this.body||this.atTarget||(this.body.collideWorldBounds=!1,this.fallToPlanet()))},a.onUpdate=function(){e.physics.arcade.collide([o.get("leftBoundry"),o.get("rightBoundry")],this),this.rotate+=2,this.atTarget||(null!==this.body&&(this.body.velocity.y+1<25&&(this.body.velocity.y+=1),this.body.velocity.x>0&&(this.body.velocity.x-=.2),this.body.velocity.x<0&&(this.body.velocity.x+=.2)),this.checkLocation())}}({x:t.rnd.integerInRange(100,t.canvas.width-100),y:t.rnd.integerInRange(-50,-100),ix:t.rnd.integerInRange(-100,100),iy:5}),o.getManyGroups(["ui_overlay","aliens","boss","trashes"]).map(function(t){void 0!==t&&t.onUpdate()}),h.getManyGroups(["ui","timeKeeper"]).map(function(t){void 0!==t&&t.onUpdate()}),B.active&&(r.x=-2,T.moveX(5)),R.active&&(r.x=2,T.moveX(-5)),O.active&&(r.y=5,T.moveY(-5)),C.active&&(r.y=-2,T.moveY(5)),O.active||C.active||(r.y=0),n.checkWithDelay({isActive:!0,key:"A",delay:l.cooldown-_.state*l.rapidFireSpd}))switch(l.reference){case"LASER":!function(){for(var t=i.game(),e=o.getOnly(["player"]).player,a=i.getOnly(["weaponData"]).weaponData.primaryWeapons.BULLET,n=0;n<3;n++){var s=c.createLaser({name:"laser_"+t.rnd.integer(),group:"ship_weapons",x:e.x-50+50*n,offset:0,y:e.y-e.height/2,spread:0,layer:2});s.onUpdate=function(){var t=this;this.accelerate(),this.y<0&&this.destroyIt(),P().map(function(e){e.game.physics.arcade.overlap(t,e,function(t,e){a.pierce||t.destroyIt(),e.damageIt(a.damage)},null,t)})}}}();break;case"LASER":!function(){for(var t=i.game(),e=o.getOnly(["player"]).player,a=i.getOnly(["weaponData"]).weaponData.primaryWeapons.MISSLE,n=function(i){var n=c.createMissle({name:"missle_"+t.rnd.integer(),group:"ship_weapons",x:e.x-25+50*i,offset:0,y:e.y-e.height/2,spread:i%2?.25:-.25,layer:2});n.onUpdate=function(){var t=this;n.isActive&&(this.accelerate(),this.y<0&&this.destroyIt(),P().map(function(e){e.game.physics.arcade.overlap(t,e,function(t,e){a.pierce||t.destroyIt(),e.damageIt(a.damage)},null,t)}))}},s=0;s<2;s++)n(s)}();break;case"BULLET":!function(){for(var t=i.game(),e=o.getOnly(["player"]).player,a=i.getOnly(["weaponData"]).weaponData.primaryWeapons.BULLET,n=function(i){setTimeout(function(){var n=c.createBullet({name:"bullet_"+t.rnd.integer(),group:"ship_weapons",x:e.x-15+10*i,offset:0,y:e.y,spread:0,layer:3});n.onUpdate=function(){var t=this;this.accelerate(),this.y<0&&this.destroyIt(),P().map(function(e){e.game.physics.arcade.overlap(t,e,function(t,e){a.pierce||t.destroyIt(),e.damageIt(a.damage)},null,t)})}},25)},s=0;s<3;s++)n(s)}()}if(n.checkWithDelay({isActive:!0,key:"B",delay:u.cooldown})){if(void 0!==b&&(v(0,!0),t.time.events.add(50,function(){v(100,!1,u.cooldown-50)}).autoDestroy=!0),"CLUSTERBOMB"===u.reference){var M=T.x,N=T.y;!function(t){var e=i.game(),a=o.getOnly(["player"]).player,n=i.getOnly(["weaponData"]).weaponData.secondaryWeapons.CLUSTERBOMB,s=c.createClusterbomb({name:"clusterbomb_"+e.rnd.integer(),group:"ship_weapons",x:a.x,y:a.y,layer:2});s.destroyIt=function(){c.createExplosion(this.x,this.y,1.25,6),o.destroy(this.name);for(var a=0;a<n.bomblets;a++)A({x:this.x,y:this.y,ix:e.rnd.integerInRange(-400,400),iy:e.rnd.integerInRange(-400,100),damage:t.damage/4,group:"ship_weapons",layer:2})},s.onUpdate=function(){var e=this;this.angle+=5,P().map(function(a){a.game.physics.arcade.overlap(e,a,function(e,a){e.hasDetonated||(e.hasDetonated=!0,e.destroyIt()),a.damageIt(t.damage)},null,e)})}}({x:M,y:N,velocity:u.velocity,damage:u.damage,bomblets:u.bomblets})}if("TRIPLEBOMB"===u.reference){var M=T.x,N=T.y;w({x:M,y:N,initialVelocity:u.initialVelocity,velocity:u.velocity,damage:u.damage,delay:1}),w({x:M,y:N,initialVelocity:u.initialVelocity,velocity:u.velocity,damage:u.damage,delay:2}),w({x:M,y:N,initialVelocity:u.initialVelocity,velocity:u.velocity,damage:u.damage,delay:3})}if("TURRET"===u.reference){var M=T.x,N=T.y;!function(t){var e=i.game(),a=o.addFromAtlas({x:t.x,y:t.y,name:"secondary_"+e.rnd.integer(),group:"secondaryWpnSprite",atlas:"atlas_main",filename:"clusterBomb.png"});e.physics.enable(a,Phaser.Physics.ARCADE),d.add(2,a),setTimeout(function(){a.destroyIt()},t.lifespan),a.fireInterval=setInterval(function(){a.x,a.y,a.width},200),a.fireInterval,a.destroyIt=function(){I(this.x,this.y,2.5,t.damage),clearInterval(this.fireInterval),o.destroy(this.name)},a.onUpdate=function(){var e=this;P().map(function(a){a.game.physics.arcade.overlap(e,a,function(e,a){e.destroyIt(),a.damageIt(t.damage)},null,e)})}}({x:M,y:N,damage:u.damage,lifespan:u.lifespan})}if("MINES"===u.reference){var M=T.x,N=T.y;!function(t){var e=i.game(),a=o.addFromAtlas({x:t.x,y:t.y,name:"secondary_"+e.rnd.integer(),group:"secondaryWpnSprite",atlas:"atlas_main",filename:"clusterBomb.png"});a.anchor.setTo(.5,.5),a.scale.setTo(1.5,1.5),e.physics.enable(a,Phaser.Physics.ARCADE),d.add(2,a),o.getGroup("secondaryWpnSprite").length>t.limit&&o.getGroup("secondaryWpnSprite")[0].destroyIt();a.destroyIt=function(){var e=this.x,a=this.y;I(e,a,3,t.damage),setTimeout(function(){I(e,a,2,t.damage)},500),clearInterval(this.fireInterval),o.destroy(this.name)},a.onUpdate=function(){var e=this;this.angle+=5,P().map(function(a){a.game.physics.arcade.overlap(e,a,function(e,a){e.destroyIt(),a.damageIt(t.damage)},null,e)})}}({x:M,y:N,damage:u.damage,limit:u.limit})}}}"VICTORYSTATE"===a&&(O.active&&o.get("menuButtonCursor").updateLocation(1),C.active&&o.get("menuButtonCursor").updateLocation(2),L.active&&(i.changeState("LOCKED"),n.disableAllInput(),1===p&&(m(),m(),e.loadNextLevel()),2===p&&(m(),S(function(){m(),e.returnToTitle()}))));"GAMEOVERSTATE"===a&&(O.active&&o.get("menuButtonCursor").updateLocation(1),C.active&&o.get("menuButtonCursor").updateLocation(2),L.active&&(clearInterval(i.get("endExplosion")),i.changeState("LOCKED"),n.disableAllInput(),1===p&&S(function(){e.retry()}),2===p&&S(function(){e.returnToTitle()})));"ENDLEVEL"===a&&T.onUpdate()}}),resolution:{width:a.width,height:a.height}}),n=new PHASER_CONTROLS,s=new PHASER_MOUSE({showDebugger:!1}),o=new PHASER_SPRITE_MANAGER,r=new PHASER_BITMAPDATA_MANAGER,h=new PHASER_TEXT_MANAGER,l=new PHASER_BUTTON_MANAGER,d=new PHASER_GROUP_MANAGER,u=new PHASER_BITMAPDATA_MANAGER,c=new WEAPON_MANAGER,p=a.store,g=JSON.stringify(p.getters._gameData());function y(t,e){i.get("gameData")[t]=e}function m(){var t=i.get("gameData");p.commit("setGamedata",t)}function f(t,e,a){void 0===e&&(e=!1),void 0===a&&(a=Phaser.Timer.SECOND/3);var n=i.game(),s=Math.ceil(.01*t*30),o=i.getAll(),r=o.healthBar,h=o.healthBarTween;void 0!==h&&h.stop(),i.forceLet("healthBarTween",n.add.tween(r).to({y:231-7.7*s},e?1:a,Phaser.Easing.Linear.Out,!0,0,0,!1))}function v(t,e,a){void 0===e&&(e=!1),void 0===a&&(a=Phaser.Timer.SECOND/3);var n=i.game(),s=Math.ceil(.01*t*6),o=i.getAll(),r=o.specialBar,h=o.specialBarTween;void 0!==h&&h.stop(),i.forceLet("specialBarTween",n.add.tween(r).to({y:48-8*s},e?1:a,Phaser.Easing.Linear.Out,!0,0,0,!1))}function b(t,e,a){void 0===e&&(e=!1),void 0===a&&(a=Phaser.Timer.SECOND/3);var n=i.game(),s=.01*t*10,o=i.getAll(),r=o.earthBar,h=o.earthBarTween;void 0!==h&&h.stop(),i.forceLet("earthBarTween",n.add.tween(r).to({x:24.4*s-244},e?1:a,Phaser.Easing.Linear.Out,!0,0,0,!1))}function x(t){var e=i.getAll().gameData,a=i.getState().currentState,n=o.getAll().earthContainer,s=e.population;s.killed+=t;var r=100-s.killed/s.total*100;r<=0&&"GAMEOVER"!==a?D():(n.takeDamage(),b(r,!0),y("population",{total:s.total,killed:s.killed}))}function T(t,e){var a=i.game(),n=t.split(" ");n.map(function(t,e){var i=h.add({name:"splashText_"+a.rnd.integer(),group:"splash",font:"gem",size:18,default:t,visible:!1});i.startSplash=function(){var t=this;this.visible=!0,this.scale.setTo(10,10),h.alignToCenter(this.name),a.add.tween(this.scale).to({x:.5,y:.5},350,Phaser.Easing.Linear.In,!0,0),a.add.tween(this).to({x:this.game.world.centerX,y:this.game.world.centerY,alpha:.75},350,Phaser.Easing.Linear.In,!0,0),setTimeout(function(){h.destroy(t.name)},350)},a.time.events.add(Phaser.Timer.SECOND/2.5*e+100,i.startSplash,i).autoDestroy=!0}),a.time.events.add(Phaser.Timer.SECOND/2.5*n.length,e,this).autoDestroy=!0}function E(t){var e=i.game(),a=o.addFromAtlas({x:t.x,y:t.y,name:"trash_"+e.rnd.integer(),group:"trashes",atlas:"atlas_main",filename:"asteroid_small_layer_"+e.rnd.integerInRange(1,3)+".png",visible:!0});a.anchor.setTo(.5,.5),a.scale.setTo(1,1),e.physics.enable(a,Phaser.Physics.ARCADE),a.body.velocity.y=t.iy,a.body.velocity.x=t.ix,a.angleMomentum=e.rnd.integerInRange(-5,5),a.body.bounce.setTo(1,1),a.atTarget=!1,a.maxHealth=50,a.health=a.maxHealth,a.fallThrehold=e.rnd.integerInRange(0,75),d.add(3,a),a.damageIt=function(t){this.health-=t,this.tint=16711680,this.game.add.tween(this).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),this.health<=0&&this.destroyIt()},a.removeIt=function(){o.destroy(this.name)},a.fallToPlanet=function(){var t=this;this.tint=0,this.atTarget=!0,this.body=null,this.game.add.tween(this).to({y:this.y+60},2*Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,0).autoDestroy=!0,setTimeout(function(){t.game.add.tween(t.scale).to({x:0,y:0},1*Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,e.rnd.integerInRange(0,500)).onComplete.add(function(){t.removeIt(),x(1),c.createExplosion(t.x,t.y,.25,6)}).autoDestroy=!0},300)},a.destroyIt=function(){var t=this,a=i.get("gameData").score;y("score",a+=25),h.get("scoreText").updateScore();var n={angle:e.rnd.integerInRange(-720,720),x:this.x-e.rnd.integerInRange(-25,25),y:this.y-e.rnd.integerInRange(5,25),alpha:.5};this.game.add.tween(this).to(n,e.rnd.integerInRange(50,200),Phaser.Easing.Linear.Out,!0,0,0,!1),this.body=null,e.time.events.add(Phaser.Timer.SECOND/3,function(){c.createExplosion(t.x,t.y,.5,6),o.destroy(t.name)},this).autoDestroy=!0},a.checkLocation=function(){this.angle+=a.angleMomentum,this.angleMomentum>0&&(this.angleMomentum-=.002),this.angleMomentum<0&&(this.angleMomentum+=.002),this.y>this.height&&null!==this.body&&(this.body.collideWorldBounds=!0),this.y>this.game.canvas.height-(50+this.fallThrehold)&&(null===this.body||this.atTarget||(this.body.collideWorldBounds=!1,this.fallToPlanet())),this.y>this.game.canvas.height+this.height&&this.removeIt()},a.onUpdate=function(){e.physics.arcade.collide([o.get("leftBoundry"),o.get("rightBoundry")],this),this.rotate+=4,null!==this.body&&(this.body.velocity.y+1<50&&(this.body.velocity.y+=1),this.body.velocity.x>0&&(this.body.velocity.x-=.2),this.body.velocity.x<0&&(this.body.velocity.x+=.2)),this.checkLocation()}}function w(t){var e=i.game(),a=o.addFromAtlas({x:t.x,y:t.y,name:"secondary_"+e.rnd.integer(),group:"secondaryWpnSprite",atlas:"atlas_main",filename:"clusterBomb.png"});a.anchor.setTo(.5,.5),e.physics.enable(a,Phaser.Physics.ARCADE),a.body.velocity.y=t.initialVelocity,d.add(2,a),a.accelerate=function(){this.body.velocity.y-=t.velocity*t.delay},a.destroyIt=function(){I(this.x,this.y,2.5,t.damage),o.destroy(this.name)},a.onUpdate=function(){var e=this;this.accelerate(),P().map(function(a){a.game.physics.arcade.overlap(e,a,function(e,a){e.destroyIt(),a.damageIt(t.damage)},null,e)})}}function A(t){i.game();var e=c.createBomblet(t);e.destroyIt=function(){I(this.x,this.y,.5,t.damage),o.destroy(this.name)},e.onUpdate=function(){var a=this;this.angle+=10,this.game.time.now>e.detonate&&this.destroyIt(),P().map(function(e){e.game.physics.arcade.overlap(a,e,function(e,a){e.destroyIt(),a.damageIt(t.damage)},null,a)})}}function I(t,e,a,n){i.game();c.createImpactExplosion(t,e,a,6).onUpdate=function(){var t=this;P().map(function(e){e.game.physics.arcade.overlap(t,e,function(t,e){e.damageIt(n)},null,t)})}}function P(){return o.getGroup("aliens").concat(o.getGroup("trashes"),o.getGroup("boss"))}function D(){i.changeState("GAMEOVER");var t=o.get("player"),e=o.get("earth");h.getGroup("ui_text").map(function(t){t.hide()}),o.getGroup("ui").map(function(t){t.hide()}),o.getGroup("secondaryWpnSprite").map(function(t){t.destroyIt()}),t.selfDestruct(),e.selfDestruct(),T("DUDE IT WAS THE FIRST LEVEL JEEZE",function(){setTimeout(function(){i.changeState("GAMEOVERSTATE"),o.getGroup("ui_buttons").map(function(t){t.reveal()}),h.get("menuButton1Text").setText("RETRY"),h.get("menuButton2Text").setText("SAVE AND QUIT")},1500)})}function S(t){var e=i.game(),a=u.addGradient({name:"overlayFadeout",start:"#ffffff",end:"#ffffff",width:5,height:5,render:!1}),n=o.add({x:0,y:0,name:"overlayFinal",width:e.world.width,height:e.world.height,reference:a.cacheBitmapData,alpha:0});d.add(20,n),e.add.tween(n).to({alpha:1},Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){setTimeout(function(){t()},500)})}i.let("gameData",JSON.parse(g)),e.game=this,this.game=i.game()},t.prototype.destroy=function(){this.game.destroy()},t}(),__phaser=new PhaserGameObject,PHASER_AUDIO=function(){return function(){}}(),PHASER_BITMAPDATA_MANAGER=function(){function t(){this.game=null,this.bmd={array:[],object:{}}}return t.prototype.assign=function(t){this.game=t},t.prototype.addGradient=function(t){if(0===this.bmd.array.filter(function(e){return e.name===t.name}).length){var e=this.game.make.bitmapData(t.width,t.height),a=e.context.createLinearGradient(0,0,0,t.height);a.addColorStop(0,t.start),a.addColorStop(1,t.end),e.context.fillStyle=a,e.context.fillRect(0,0,t.width,t.height);var i=this.game.cache.addBitmapData(t.name,e),n=this.game.make.bitmapData();return n.load(this.game.cache.getBitmapData(t.name)),t.render&&n.addToWorld(t.x,t.y),n.name=t.name,n.group=t.group,n.cacheBitmapData=i,this.bmd.array.push(n),this.bmd.object[t.name]=n,n}console.log("Duplicate key name not allowed: "+t.name)},t.prototype.addImage=function(t){if(0===this.bmd.array.filter(function(e){return e.name===t.name}).length){var e=this.game.make.bitmapData();return e.load(t.reference),e.addToWorld(t.x,t.y),t.render||e.cls(),e.name=t.name,e.group=t.group,e.cacheBitmapData=t.reference,this.bmd.array.push(e),this.bmd.object[t.name]=e,e}console.log("Duplicate key name not allowed: "+t.name)},t.prototype.addEmpty=function(t){if(0===this.bmd.array.filter(function(e){return e.name===t.name}).length){var e=this.game.make.bitmapData(t.width,t.height);return e.addToWorld(t.x,t.y),t.render||e.cls(),e.name=t.name,e.group=t.group,this.bmd.array.push(e),this.bmd.object[t.name]=e,e}console.log("Duplicate key name not allowed: "+t.name)},t.prototype.destroy=function(t){for(var e=[],a=0,i=this.bmd.array.filter(function(e){return e.name===t});a<i.length;a++){var n=i[a];e.push(n.name),n.destroy()}return delete this.bmd.object[t],this.bmd.array=this.bmd.array.filter(function(e){return e.name!==t}),e},t.prototype.destroyGroup=function(t){for(var e=[],a=0,i=this.bmd.array.filter(function(t){return t.group===name});a<i.length;a++){var n=i[a];e.push(n.name),n.destroy()}return delete this.bmd.object[name],this.bmd.array=this.bmd.array.filter(function(t){return t.group!==name}),e},t.prototype.get=function(t){return this.bmd.object[t]},t.prototype.getGroup=function(t){return this.bmd.array.filter(function(e){return e.group===t})},t.prototype.getAll=function(t){return void 0===t&&(t="BOTH"),"ARRAY"===t?this.bmd.array:"OBJECT"==t?this.bmd.object:{object:this.bmd.object,array:this.bmd.array}},t}(),PHASER_BUTTON_MANAGER=function(){function t(){this.game=null,this.resources={array:[],object:{}}}return t.prototype.assign=function(t){this.game=t.game},t.prototype.add=function(t){if(0===this.resources.array.filter(function(e){return e.name===t.name}).length){var e=this.game.add.button(t.x,t.y,t.reference,t.onclick);return e.name=t.name,e.group=t.group||null,this.resources.array.push(e),this.resources.object[t.name]=e,e}console.log("Duplicate key name not allowed: "+t.name)},t.prototype.destroy=function(t){for(var e=[],a=0,i=this.resources.array.filter(function(e){return e.key===t});a<i.length;a++){var n=i[a];e.push(n.key),n.destroy()}return delete this.resources.object[t],this.resources.array=this.resources.array.filter(function(e){return e.key!==t}),e},t.prototype.destroyGroup=function(t){for(var e=[],a=0,i=this.resources.array.filter(function(e){return e.group===t});a<i.length;a++){var n=i[a];e.push(n.key),n.destroy()}return delete this.resources.object[t],this.resources.array=this.resources.array.filter(function(e){return e.group!==t}),e},t.prototype.get=function(t){return this.resources.object[t]},t.prototype.getGroup=function(t){return this.resources.array.filter(function(e){return e.group===t})},t.prototype.getAll=function(t){return void 0===t&&(t="BOTH"),"ARRAY"===t?this.resources.array:"OBJECT"==t?this.resources.object:{object:this.resources.object,array:this.resources.array}},t}(),PHASER_CONTROLS=function(){function t(){this.IO=null,this.game=null,this.buttonSensitivity={QUICK:1,SHORT:50,LONG:150,SUPERLONG:300},this.properties={isReady:!1,allowDebugger:!0,buttonDelay:50,timingRefreshRate:1},this.directionalButtons=["UP","DOWN","LEFT","RIGHT"],this.actionButtons=["A","B","X","Y"],this.triggerButtons=["L1","L2","R1","R2","L3","R3"],this.systemButtons=["START","BACK"],this.buttonArray=this.directionalButtons.concat(this.actionButtons,this.triggerButtons,this.systemButtons),this.buttonMap={UP:{name:"UP",code:"ArrowUp"},DOWN:{name:"DOWN",code:"ArrowDown"},LEFT:{name:"LEFT",code:"ArrowLeft"},RIGHT:{name:"RIGHT",code:"ArrowRight"},A:{name:"A",code:"KeyA"},B:{name:"S",code:"KeyS"},X:{name:"D",code:"KeyD"},Y:{name:"F",code:"KeyF"},L1:{name:"Q",code:"KeyQ"},L2:{name:"W",code:"KeyW"},R1:{name:"E",code:"KeyE"},R2:{name:"R",code:"KeyR"},L3:{name:"O",code:"KeyO"},R3:{name:"P",code:"KeyP"},START:{name:"ENTER",code:"Enter"},BACK:{name:"BACKSPACE",code:"Backspace"}},this.buttonMapId={UP:1,DOWN:2,LEFT:3,RIGHT:4,A:5,B:6,X:7,Y:8,L1:9,L2:10,R1:11,R2:12,L3:13,R3:14,START:15,BACK:16},this.disabledButtons={ALL:!1,DIRECTIONAL:!1,TRIGGER:!1,ACTION:!1,SYSTEM:!1},this.debugger={enabled:!1,text:{}},this.inputDelay={delay:Array.apply(null,Array(20)).map(function(){return 0})}}return t.prototype.assign=function(t){var e=this;this.game=t;var a={font:"12px Courier New",fill:"#fff",align:"left"};this.buttonArray.forEach(function(i,n){e.debugger.text[i]=null,e.debugger.text[i]=t.add.text(10,10+15*n,"",a),e.disabledButtons[i]=!1});for(var i={buttons:{},sensitivityPress:{},sensitivityBuffer:{},state:{}},n=function(a){i.buttons[a]=t.input.keyboard.addKey(Phaser.Keyboard[s.buttonMap[a].name]),i.sensitivityPress[a]=null,i.sensitivityBuffer[a]=0,i.state[a]=function(){return e.getBtnPressType(e.IO.sensitivityBuffer[a])}},s=this,o=0,r=this.buttonArray;o<r.length;o++){n(r[o])}for(var h=function(t){i.buttons[t].onDown.add(function(a){var n,s;clearInterval(i.sensitivityPress[t]);var o=["DIRECTIONAL","ACTION","TRIGGER","SYSTEM"];Object.keys(e.buttonMap).forEach(function(t,i){if(e.buttonMap[t].code===a.event.code)for(var r=0,h=o;r<h.length;r++){var l=h[r];e[l.toLowerCase()+"Buttons"].indexOf(t)+1&&(n=l,s=t)}});var r=!1;e.disabledButtons.ALL&&(r=!0);for(var h=0,l=o;h<l.length;h++){var d=l[h];e.disabledButtons[d]&&n===d&&(r=!0)}Object.keys(e.buttonMap).forEach(function(t,a){e.disabledButtons[t]&&s===t&&(r=!0)}),r||(i.sensitivityPress[t]=setInterval(function(){i.sensitivityBuffer[t]+=1},e.properties.timingRefreshRate))},l)},l=this,d=0,u=this.buttonArray;d<u.length;d++){h(u[d])}return t.input.keyboard.onUpCallback=function(t){for(var a=0,n=e.buttonArray;a<n.length;a++){var s=n[a];t.code===e.buttonMap[s].code&&(clearInterval(i.sensitivityPress[s]),i.sensitivityBuffer[s]=0)}"Backquote"===t.code&&e.properties.allowDebugger&&(e.setDebugger(!e.debugger.enabled),e.updateDebugger())},this.properties.isReady=!0,this.IO=i,i},t.prototype.mapKeys=function(t){var e=this;this.properties.isReady=!1,this.destroyAll(),setTimeout(function(){e.buttonMap=t,e.properties.isReady=!0,e.assign(e.game)},1)},t.prototype.isReady=function(){return this.properties.isReady},t.prototype.checkWithDelay=function(t){return this.read(t.key).active===t.isActive&&(this.game.time.now>this.inputDelay.delay[this.getKeyId(t.key)]&&(this.inputDelay.delay[this.getKeyId(t.key)]=t.delay+this.game.time.now,!0))},t.prototype.isDebuggerEnabled=function(){return this.debugger.enabled},t.prototype.setDebugger=function(t){void 0===t&&(t=!0),this.debugger.enabled=t},t.prototype.updateDebugger=function(){if(this.properties.isReady)for(var t=0,e=this.buttonArray;t<e.length;t++){var a=e[t];this.debugger.text[a].setText(this.debugger.enabled?this.debuggerString(a):"").bringToTop()}},t.prototype.disableAllInput=function(){this.disabledButtons.ALL=!0},t.prototype.enableAllInput=function(){this.disabledButtons.ALL=!1},t.prototype.disableAllDirectionalButtons=function(){this.disabledButtons.DIRECTIONAL=!0},t.prototype.enableAllDirectionalButtons=function(){this.disabledButtons.DIRECTIONAL=!1},t.prototype.disableAllTriggerButtons=function(){this.disabledButtons.TRIGGER=!0},t.prototype.enableAllTriggerButtons=function(){this.disabledButtons.TRIGGER=!1},t.prototype.disableAllActionButtons=function(){this.disabledButtons.ACTION=!0},t.prototype.enableAllActionButtons=function(){this.disabledButtons.ACTION=!1},t.prototype.disableAllSystemButtons=function(){this.disabledButtons.SYSTEM=!0},t.prototype.enableAllSystemButtons=function(){this.disabledButtons.SYSTEM=!1},t.prototype.setDisableKeyProperty=function(t,e){void 0===e&&(e=!0),this.properties.isReady&&(this.disabledButtons[t.toUpperCase()]=e)},t.prototype.getKeyDisabledValue=function(t){return this.properties.isReady?this.disabledButtons[t.toUpperCase()]:null},t.prototype.clearAllControlIntervals=function(){if(this.properties.isReady)for(var t=0,e=this.buttonArray;t<e.length;t++){var a=e[t];clearInterval(this.IO.sensitivityPress[a])}},t.prototype.getKeyId=function(t){return this.buttonMapId[t.toUpperCase()]},t.prototype.read=function(t){if(this.properties.isReady){return{}[t]={id:this.buttonMapId[t.toUpperCase()],active:this.IO.state[t.toUpperCase()]().val>0,duration:this.IO.state[t.toUpperCase()]().val,state:this.IO.state[t.toUpperCase()]().state,type:this.IO.state[t.toUpperCase()]().type,disabled:this.disabledButtons[t.toUpperCase()]}}return{}},t.prototype.readMulti=function(t,e){if(void 0===e&&(e="OBJECT"),this.properties.isReady){if("OBJECT"===e){for(var a={},i=0,n=t;i<n.length;i++){a[r=n[i]]={id:this.buttonMapId[r.toUpperCase()],active:this.IO.state[r.toUpperCase()]().val>0,duration:this.IO.state[r.toUpperCase()]().val,state:this.IO.state[r.toUpperCase()]().state,type:this.IO.state[r.toUpperCase()]().type,disabled:this.disabledButtons[r.toUpperCase()]}}return a}if("ARRAY"===e){a=[];for(var s=0,o=t;s<o.length;s++){var r=o[s];a.push({id:this.buttonMapId[r.toUpperCase()],key:r,active:this.IO.state[r.toUpperCase()]().val>0,duration:this.IO.state[r.toUpperCase()]().val,state:this.IO.state[r.toUpperCase()]().state,type:this.IO.state[r.toUpperCase()]().type,disabled:this.disabledButtons[r.toUpperCase()]})}return a}}},t.prototype.getOnly=function(t){for(var e=this,a={},i=function(i){t.map(function(t){i===t&&(a[i]={id:e.buttonMapId[i.toUpperCase()],active:e.IO.state[i.toUpperCase()]().val>0,duration:e.IO.state[i.toUpperCase()]().val,state:e.IO.state[i.toUpperCase()]().state,type:e.IO.state[i.toUpperCase()]().type,disabled:e.disabledButtons[i.toUpperCase()]})})},n=0,s=this.buttonArray;n<s.length;n++){i(s[n])}return a},t.prototype.getAll=function(){for(var t={},e=0,a=this.buttonArray;e<a.length;e++){var i=a[e];t[i]={id:this.buttonMapId[i.toUpperCase()],active:this.IO.state[i.toUpperCase()]().val>0,duration:this.IO.state[i.toUpperCase()]().val,state:this.IO.state[i.toUpperCase()]().state,type:this.IO.state[i.toUpperCase()]().type,disabled:this.disabledButtons[i.toUpperCase()]}}return t},t.prototype.debuggerString=function(t){return t.toUpperCase()+" ("+this.buttonMap[t.toUpperCase()].name+"/"+this.buttonMap[t.toUpperCase()].code+") | id: "+this.buttonMapId[t.toUpperCase()]+" duration: "+this.IO.state[t.toUpperCase()]().val+" | state: "+this.IO.state[t.toUpperCase()]().state+" | type: "+this.IO.state[t.toUpperCase()]().type+" | disabled: "+this.disabledButtons[t.toUpperCase()]},t.prototype.getBtnPressType=function(t){var e=this,a="NONE",i=0,n=0;return Object.keys(this.buttonSensitivity).forEach(function(s){n++,t>e.buttonSensitivity[s]&&(a=s,i=n)}),{val:t,type:a,state:i}},t.prototype.destroyAll=function(){var t=this;this.clearAllControlIntervals(),Object.keys(this.debugger.text).forEach(function(e){t.debugger.text[e].destroy()})},t}(),PHASER_GROUP_MANAGER=function(){function t(){this.game=null,this.group={array:[],object:{}}}return t.prototype.assign=function(t,e){void 0===e&&(e=10),this.game=t;for(var a=0;a<=e;a++){var i=t.add.group();this.group.object[""+a]=i,this.group.array.push(i)}},t.prototype.layer=function(t){return this.group.object[t]},t.prototype.add=function(t,e){this.group.object[t].add(e)},t.prototype.addMany=function(t,e){var a=this;e.forEach(function(e){a.group.object[t].add(e)})},t}(),PHASER_MASTER=function(){function t(t){this._game=t.game,this.resolution=t.resolution,this.states={BOOT:"BOOT",PRELOAD:"PRELOAD",READY:"READY"},this.currentState=this.states[0],this.variables={}}return t.prototype.let=function(t,e){if(void 0===e&&(e=null),void 0===this.variables[t])return this.variables[t]=e;console.log("Cannot LET duplicate key in PHASER_MASTER: "+t)},t.prototype.forceLet=function(t,e){return void 0===e&&(e=null),this.variables[t]=e},t.prototype.delete=function(t){delete this.variables[t]},t.prototype.get=function(t){return void 0!==this.variables[t]?this.variables[t]:(console.log("Cannot GET a variable that does not exist in PHASER_MASTER."),null)},t.prototype.getAll=function(){return this.variables},t.prototype.getOnly=function(t){var e={},a=[];for(var i in this.variables)a.push({key:i,data:this.variables[i]});for(var n=function(i){a.filter(function(e){return e.key===t[i]}).map(function(t){e[t.key]=t.data})},s=0;s<t.length;s++)n(s);return e},t.prototype.changeState=function(t){void 0===t&&(t=null);var e=t.toUpperCase(),a=!1;return void 0===this.states[e]&&(this.states[e]=e,a=!0),this.currentState=e,{created:a,state:this.currentState}},t.prototype.getCurrentState=function(){return this.currentState},t.prototype.getStates=function(){return this.states},t.prototype.getResolution=function(){return this.resolution},t.prototype.checkState=function(t){return this.currentState===t.toUpperCase()},t.prototype.getState=function(){return{currentState:this.currentState}},t.prototype.game=function(){return this._game},t}(),PHASER_MOUSE=function(){function t(t){this.game=null,this.clickSensitvity={QUICK:1,SHORT:50,LONG:150,SUPERLONG:300},this.mouseMapping=[0,1,2],this.mouseMap={LEFT:0,MIDDLE:1,RIGHT:2},this.metrics={sensitivityPress:{},sensitivityBuffer:{},location:{},state:{}},this.properties={allowDebugger:!0,timingRefreshRate:1},this.inputDelay={delay:Array.apply(null,Array(2)).map(function(){return 0})},this.debugger={enabled:void 0!==t.showDebugger&&t.showDebugger,text:{},pointer:null}}return t.prototype.assign=function(t){var e=this;this.game=t;for(var a=function(t){i.metrics.sensitivityPress[t]=null,i.metrics.sensitivityBuffer[t]=0,i.metrics.location[t]={x:null,y:null},i.metrics.state[t]=function(){return e.getBtnPressType(e.metrics.sensitivityBuffer[t])}},i=this,n=0,s=this.mouseMapping;n<s.length;n++){a(s[n])}this.game.input.onDown.add(function(t){var a=e.checkMouseClick();clearInterval(e.metrics.sensitivityPress[a]),e.metrics.sensitivityPress[a]=setInterval(function(){e.metrics.sensitivityBuffer[a]+=1,e.metrics.location[a]={x:t.x,y:t.y}},e.properties.timingRefreshRate)}),this.game.input.onUp.add(function(t){var a=e.checkMouseClick();e.clearAllControlIntervals(),e.metrics.sensitivityBuffer[a]=0});var o={font:"12px Courier New",fill:"#fff",align:"left"};this.mouseMapping.forEach(function(t,a){e.debugger.text[t]=null,e.debugger.text[t]=e.game.add.text(5,e.game.height-35-15*a,"",o)}),this.debugger.pointer=this.game.add.text(5,this.game.height-20,"",o),t.canvas.oncontextmenu=function(t){t.preventDefault()}},t.prototype.checkMouseClick=function(){var t=0;return this.game.input.activePointer.leftButton.isDown&&(t=0),this.game.input.activePointer.middleButton.isDown&&(t=1),this.game.input.activePointer.rightButton.isDown&&(t=2),t},t.prototype.debuggerString=function(t){return"Button_"+t+" | {x: "+this.metrics.location[t].x+", y: "+this.metrics.location[t].y+"} | active: "+(this.metrics.sensitivityBuffer[t]>0)+" | state: "+this.metrics.state[t]().state+" | duration: "+this.metrics.state[t]().val+" | type: "+this.metrics.state[t]().type},t.prototype.setDebugger=function(t){void 0===t&&(t=!0),this.debugger.enabled=t},t.prototype.updateDebugger=function(){for(var t=0,e=this.mouseMapping;t<e.length;t++){var a=e[t];this.debugger.text[a].setText(this.debugger.enabled?this.debuggerString(a):"").bringToTop()}this.debugger.pointer.setText(this.debugger.enabled?"Pointer: {x: "+this.game.input.mousePointer.x+", y: "+this.game.input.mousePointer.y+"}":"").bringToTop()},t.prototype.clearAllControlIntervals=function(){for(var t=0,e=this.mouseMapping;t<e.length;t++){var a=e[t];this.metrics.sensitivityBuffer[a]=0,clearInterval(this.metrics.sensitivityPress[a])}},t.prototype.checkWithDelay=function(t){if(this.read(t.key).active===t.isActive){var e=this.mouseMap[t.key.toUpperCase()];return this.game.time.now>this.inputDelay.delay[e]&&(this.inputDelay.delay[e]=t.delay+this.game.time.now,!0)}return!1},t.prototype.read=function(t){void 0===t&&(t="LEFT");var e=this.mouseMap[t.toUpperCase()];return{id:e,x:this.metrics.location[e].x,y:this.metrics.location[e].y,active:this.metrics.sensitivityBuffer[e]>0,duration:this.metrics.sensitivityBuffer[e],state:this.metrics.state[e]().state,type:this.metrics.state[e]().type}},t.prototype.getBtnPressType=function(t){var e=this,a="NONE",i=0,n=0;return Object.keys(this.clickSensitvity).forEach(function(s){n++,t>e.clickSensitvity[s]&&(a=s,i=n)}),{val:t,type:a,state:i}},t}(),PHASER_PRELOADER=function(){function t(t){this.game=t.game,this.init(t.delayInSeconds,t.done)}return t.prototype.init=function(t,e){var a,i,n=this;this.game.load.onLoadStart.add(function(){(a=n.game.add.text(n.game.world.centerX,n.game.world.centerY/2,"",{font:"18px Impact",fill:"#fff",align:"center"})).anchor.set(.5),(i=n.game.add.text(n.game.world.centerX,n.game.world.centerY,"",{font:"32px Impact",fill:"#fff",align:"center"})).anchor.set(.5)},this),this.game.load.onFileComplete.add(function(t,e,n,s,o){a.setText("Please wait..."),i.setText(t+"%")},this),this.game.load.onLoadComplete.add(function(){a.setText("File loaded!"),i.setText(""),n.game.time.events.add(Phaser.Timer.SECOND*t,function(){a.destroy(),i.destroy(),e()},n).autoDestroy=!0},this)},t}(),PHASER_SPRITE_MANAGER=function(){function t(){this.game=null,this.sprites={array:[],object:{}},this.spriteCount=0}return t.prototype.assign=function(t){this.game=t},t.prototype.add=function(t){if(0===this.sprites.array.filter(function(e){return e.name===t.name}).length){t.x=void 0!==t.x?t.x:0,t.y=void 0!==t.y?t.y:0,t.group=void 0!==t.group?t.group:null,t.visible=void 0===t.visible||t.visible,t.alpha=void 0!==t.alpha?t.alpha:1,t.width=void 0!==t.width?t.width:null,t.height=void 0!==t.height?t.height:null;var e=this.game.add.sprite(t.x,t.y,t.reference);return e.name=t.name,e.group=t.group,e.defaultPosition={x:t.x,y:t.y},e.visible=t.visible,e.alpha=t.alpha,null!==t.width&&(e.width=t.width),null!==t.height&&(e.height=t.height),e.setDefaultPositions=function(t,e){this.defaultPosition.x=t,this.defaultPosition.y=e},e.getDefaultPositions=function(){return this.defaultPosition},e.init=function(){},e.onUpdate=function(){},e.reveal=function(){},e.show=function(){this.visible=!0},e.hide=function(){this.visible=!1},this.sprites.array.push(e),this.sprites.object[t.name]=e,e}console.log("Duplicate key name not allowed: "+t.name)},t.prototype.addFromAtlas=function(t){if(0===this.sprites.array.filter(function(e){return e.name===t.name}).length){t.x=void 0!==t.x?t.x:0,t.y=void 0!==t.y?t.y:0,t.group=void 0!==t.group?t.group:null,t.visible=void 0===t.visible||t.visible,t.alpha=void 0!==t.alpha?t.alpha:1,t.width=void 0!==t.width?t.width:null,t.height=void 0!==t.height?t.height:null;var e=this.game.add.sprite(t.x,t.y,t.atlas,t.filename);return e.name=t.name,e.group=t.group,e.defaultPosition={x:t.x,y:t.y},e.visible=t.visible,e.alpha=t.alpha,null!==t.width&&(e.width=t.width),null!==t.height&&(e.height=t.height),e.setDefaultPositions=function(t,e){this.defaultPosition.x=t,this.defaultPosition.y=e},e.getDefaultPositions=function(){return this.defaultPosition},e.init=function(){},e.onUpdate=function(){},e.reveal=function(){},e.show=function(){this.visible=!0},e.hide=function(){this.visible=!1},this.sprites.array.push(e),this.sprites.object[t.name]=e,e}console.log("Duplicate key name not allowed: "+t.name)},t.prototype.addTilespriteFromAtlas=function(t){if(0===this.sprites.array.filter(function(e){return e.name===t.name}).length){t.x=void 0!==t.x?t.x:0,t.y=void 0!==t.y?t.y:0,t.group=void 0!==t.group?t.group:null,t.visible=void 0===t.visible||t.visible,t.alpha=void 0!==t.alpha?t.alpha:1,t.width=void 0!==t.width?t.width:null,t.height=void 0!==t.height?t.height:null;var e=this.game.add.tileSprite(t.x,t.y,t.width,t.height,t.atlas,t.filename);return e.name=t.name,e.group=t.group,e.defaultPosition={x:t.x,y:t.y},e.visible=t.visible,e.alpha=t.alpha,null!==t.width&&(e.width=t.width),null!==t.height&&(e.height=t.height),e.setDefaultPositions=function(t,e){this.defaultPosition.x=t,this.defaultPosition.y=e},e.getDefaultPositions=function(){return this.defaultPosition},e.init=function(){},e.onUpdate=function(){},e.reveal=function(){},e.show=function(){this.visible=!0},e.hide=function(){this.visible=!1},this.sprites.array.push(e),this.sprites.object[t.name]=e,e}console.log("Duplicate key name not allowed: "+t.name)},t.prototype.addEmptySprite=function(t){if(0===this.sprites.array.filter(function(e){return e.name===t.name}).length){t.x=void 0!==t.x?t.x:0,t.y=void 0!==t.y?t.y:0,t.group=void 0!==t.group?t.group:null,t.visible=void 0===t.visible||t.visible,t.alpha=void 0!==t.alpha?t.alpha:1,t.width=void 0!==t.width?t.width:null,t.height=void 0!==t.height?t.height:null;var e=this.game.add.sprite(t.x,t.y);return e.name=t.name,e.group=t.group,e.defaultPosition={x:t.x,y:t.y},e.visible=t.visible,e.alpha=t.alpha,null!==t.width&&(e.width=t.width),null!==t.height&&(e.height=t.height),e.setDefaultPositions=function(t,e){this.defaultPosition.x=t,this.defaultPosition.y=e},e.getDefaultPositions=function(){return this.defaultPosition},e.init=function(){},e.onUpdate=function(){},e.reveal=function(){},e.show=function(){this.visible=!0},e.hide=function(){this.visible=!1},this.sprites.array.push(e),this.sprites.object[t.name]=e,e}console.log("Duplicate key name not allowed: "+t.name)},t.prototype.createBasicMask=function(t,e,a,i){var n=this.game.add.graphics(0,0);return n.beginFill(16777215),n.drawRect(t,e,a,i),n},t.prototype.addBasicMaskToSprite=function(t){var e=this.game.add.graphics(0,0);return e.beginFill(16777215),e.drawRect(t.x,t.y,t.width,t.height),t.mask=e,e},t.prototype.destroy=function(t){if(void 0!==this.sprites.object[t]){for(var e=[],a=0,i=this.sprites.array.filter(function(e){return e.name===t});a<i.length;a++){var n=i[a];e.push(n.name),n.destroy()}return delete this.sprites.object[t],this.sprites.array=this.sprites.array.filter(function(e){return e.name!==t}),e}return console.log("Cannot delete "+t+" because it does not exist."),null},t.prototype.destroyGroup=function(t){for(var e=[],a=0,i=this.sprites.array.filter(function(e){return e.group===t});a<i.length;a++){var n=i[a];e.push(n.name),n.destroy()}return delete this.sprites.object[t],this.sprites.array=this.sprites.array.filter(function(e){return e.group!==t}),e},t.prototype.get=function(t){return this.sprites.object[t]},t.prototype.getGroup=function(t){return this.sprites.array.filter(function(e){return e.group===t})},t.prototype.getManyGroups=function(t){for(var e=[],a=function(a){var n=i.sprites.array.filter(function(e){return e.group===t[a]});e=e.concat(n)},i=this,n=0;n<t.length;n++)a(n);return e},t.prototype.getOnly=function(t){for(var e={},a=function(a){i.sprites.array.filter(function(e){return e.group===t[a]||e.name===t[a]}).map(function(t){e[t.name]=t})},i=this,n=0;n<t.length;n++)a(n);return e},t.prototype.getAll=function(t){return void 0===t&&(t="OBJECT"),"ARRAY"===t?this.sprites.array:"OBJECT"==t?this.sprites.object:{object:this.sprites.object,array:this.sprites.array}},t.prototype.count=function(){return this.spriteCount++,{total:this.sprites.array.length,unique:this.spriteCount}},t.prototype.centerWorld=function(t){if(void 0===this.sprites.object[t])return console.log("Error centering sprite:  key does not exists."),null;var e=this.sprites.object[t];return e.alignIn(this.game.world.bounds,Phaser.CENTER),e},t.prototype.centerOnPoint=function(t,e,a){if(void 0===this.sprites.object[t])return console.log("Error centering sprite:  key does not exists."),null;var i=this.sprites.object[t];return i.x=e-i.width/2,i.y=a-i.height/2,i},t}(),PHASER_TEXT_MANAGER=function(){function t(){this.game=null,this.texts={array:[],object:{}}}return t.prototype.assign=function(t){this.game=t},t.prototype.add=function(t){var e=this.texts.array.filter(function(e){return e.name===t.name});if(t.x=void 0!==t.x?t.x:0,t.y=void 0!==t.y?t.y:0,t.group=void 0!==t.group?t.group:null,t.size=void 0!==t.size?t.size:12,t.default=void 0!==t.default?t.default:"",t.visible=void 0===t.visible||t.visible,t.alpha=void 0!==t.alpha?t.alpha:1,0===e.length){var a=this.game.add.bitmapText(t.x,t.y,t.font,t.default,t.size);return a.name=t.name,a.group=t.group,a.visible=t.visible,a.alpha=t.alpha,a.show=function(){this.visible=!0},a.hide=function(){this.visible=!1},this.texts.array.push(a),this.texts.object[t.name]=a,a}console.log("Duplicate key name not allowed: "+t.name)},t.prototype.destroy=function(t){for(var e=[],a=0,i=this.texts.array.filter(function(e){return e.name===t});a<i.length;a++){var n=i[a];e.push(n.name),n.destroy()}return delete this.texts.object[t],this.texts.array=this.texts.array.filter(function(e){return e.name!==t}),e},t.prototype.destroyGroup=function(t){for(var e=[],a=0,i=this.texts.array.filter(function(e){return e.group===t});a<i.length;a++){var n=i[a];e.push(n.key),n.destroy()}return delete this.texts.object[t],this.texts.array=this.texts.array.filter(function(e){return e.group!==t}),e},t.prototype.get=function(t){return this.texts.object[t]},t.prototype.getGroup=function(t){return this.texts.array.filter(function(e){return e.group===t})},t.prototype.getManyGroups=function(t){for(var e=[],a=function(a){var n=i.texts.array.filter(function(e){return e.group===t[a]});e=e.concat(n)},i=this,n=0;n<t.length;n++)a(n);return e},t.prototype.getAll=function(t){return void 0===t&&(t="OBJECT"),"ARRAY"===t?this.texts.array:"OBJECT"==t?this.texts.object:{object:this.texts.object,array:this.texts.array}},t.prototype.alignToBottomLeftCorner=function(t,e){if(void 0===e&&(e=0),void 0===this.texts.object[t])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[t],i=this.game;return a.x=e,a.y=i.canvas.height-a.height-e,a},t.prototype.alignToBottomCenter=function(t,e){if(void 0===e&&(e=0),void 0===this.texts.object[t])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[t],i=this.game;return a.x=i.canvas.width/2-a.width/2,a.y=i.canvas.height-a.height-e,a},t.prototype.alignToBottomRightCorner=function(t,e){if(void 0===e&&(e=0),void 0===this.texts.object[t])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[t],i=this.game;return a.x=i.canvas.width-a.width-e,a.y=i.canvas.height-a.height-e,a},t.prototype.alignToCenterRight=function(t,e){if(void 0===e&&(e=0),void 0===this.texts.object[t])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[t],i=this.game;return a.x=i.canvas.width-a.width-e,a.y=i.canvas.height/2-a.height/2,a},t.prototype.alignToTopRightCorner=function(t,e){if(void 0===e&&(e=0),void 0===this.texts.object[t])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[t],i=this.game;return a.x=i.canvas.width-a.width-e,a.y=e,a},t.prototype.alignToTopCenter=function(t,e){if(void 0===e&&(e=0),void 0===this.texts.object[t])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[t],i=this.game;return a.x=i.canvas.width/2-a.width/2-e,a.y=e,a},t.prototype.alignToTopLeftCorner=function(t,e){if(void 0===e&&(e=0),void 0===this.texts.object[t])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[t];this.game;return a.x=e,a.y=e,a},t.prototype.alignToCenterLeft=function(t,e){if(void 0===e&&(e=0),void 0===this.texts.object[t])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[t],i=this.game;return a.x=e,a.y=i.canvas.height/2-a.height/2,a},t.prototype.alignToCenter=function(t,e){if(void 0===e&&(e=0),void 0===this.texts.object[t])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[t],i=this.game;return a.x=i.canvas.width/2-a.width/2,a.y=i.canvas.height/2-a.height/2,a},t.prototype.center=function(t,e,a){if(void 0===e&&(e=0),void 0===a&&(a=0),void 0===this.texts.object[t])return console.log("Error centering sprite:  key does not exists."),null;var i=this.texts.object[t],n=this.game;return i.x=n.canvas.width/2-i.width/2+e,i.y=n.canvas.height/2-i.height/2+a,i},t}(),WEAPON_MANAGER=function(){function t(){}return t.prototype.assign=function(t,e,a,i,n){this.game=t,this.phaserSprites=a,this.phaserMaster=e,this.phaserGroup=i,this.atlas=n},t.prototype.createBullet=function(t){var e=this.game,a=this.phaserMaster,i=this.phaserSprites,n=this.phaserGroup,s=this.atlas,o=a.getAll().weaponData.primaryWeapons.BULLET,r=i.addFromAtlas({y:t.y,name:t.name,group:t.group,atlas:s,filename:o.spriteAnimation[0]});return o.spriteAnimation.length>1&&(r.animations.add("animate",o.spriteAnimation,1,!0),r.animations.play("animate",30,!0)),r.anchor.setTo(.5,.5),r.x=t.x+t.offset,e.physics.enable(r,Phaser.Physics.ARCADE),r.body.velocity.y=o.initialVelocity,r.accelerate=function(){r.body.velocity.y-=o.velocity,r.body.velocity.x+=t.spread},r.destroyIt=function(){i.destroy(r.name)},r.onUpdate=function(){this.accelerate(),this.y<-this.height&&this.destroyIt()},void 0!==t.layer&&n.add(t.layer,r),r},t.prototype.createMissle=function(t){var e=this.game,a=this.phaserMaster,i=this.phaserSprites,n=this.phaserGroup,s=this.atlas,o=a.getAll().weaponData.primaryWeapons.MISSLE,r=i.addFromAtlas({y:t.y,name:t.name,group:t.group,atlas:s,filename:o.spriteAnimation[0]});return o.spriteAnimation.length>1&&(r.animations.add("animate",o.spriteAnimation,1,!0),r.animations.play("animate",30,!0)),r.anchor.setTo(.5,.5),r.angle=-90,r.x=t.x+t.offset,e.physics.enable(r,Phaser.Physics.ARCADE),r.body.velocity.y=o.initialVelocity,r.isActive=!0,r.accelerate=function(){r.body.velocity.y-=o.velocity,r.body.velocity.x+=t.spread},r.destroyIt=function(){r.isActive=!1,i.destroy(r.name)},r.onUpdate=function(){r.accelerate(),r.y<-r.height&&r.destroyIt()},void 0!==t.layer&&n.add(t.layer,r),r},t.prototype.createLaser=function(t){var e=this.game,a=this.phaserMaster,i=this.phaserSprites,n=this.phaserGroup,s=this.atlas,o=a.getAll().weaponData.primaryWeapons.LASER,r=i.addFromAtlas({y:t.y,name:t.name,group:t.group,atlas:s,filename:o.spriteAnimation[0]});return o.spriteAnimation.length>1&&(r.animations.add("animate",o.spriteAnimation,1,!0),r.animations.play("animate",30,!0)),r.anchor.setTo(.5,.5),r.x=t.x+t.offset,e.physics.enable(r,Phaser.Physics.ARCADE),r.body.velocity.y=o.initialVelocity,r.accelerate=function(){r.body.velocity.y-=o.velocity,r.body.velocity.x+=t.spread},r.destroyIt=function(){i.destroy(r.name)},r.onUpdate=function(){r.accelerate(),r.y<-r.height&&r.destroyIt()},void 0!==t.layer&&n.add(t.layer,r),r},t.prototype.createClusterbomb=function(t){var e=this,a=this.game,i=this.phaserMaster,n=this.phaserSprites,s=this.phaserGroup,o=this.atlas,r=i.getAll().weaponData.secondaryWeapons.CLUSTERBOMB,h=n.addFromAtlas({x:t.x,y:t.y,name:t.name,group:t.group,atlas:o,filename:r.spriteAnimation[0]});return r.spriteAnimation.length>1&&(h.animations.add("animate",r.spriteAnimation,1,!0),h.animations.play("animate",30,!0)),a.physics.enable(h,Phaser.Physics.ARCADE),h.anchor.setTo(.5,.5),h.body.velocity.y=r.initialVelocity,h.angle=90,h.hasDetonated=!1,setTimeout(function(){h.hasDetonated||(h.hasDetonated=!0,h.destroyIt())},800),h.accelerate=function(){h.body.velocity.y>-400&&(h.body.velocity.y-=r.velocity),h.body.velocity.x+=t.spread},h.destroyIt=function(){e.createExplosion(h.x,h.y,1.25,t.layer);for(var i=0;i<r.bomblets;i++)e.createBomblet({x:h.x,y:h.y,ix:a.rnd.integerInRange(-400,400),iy:a.rnd.integerInRange(-400,100),group:t.group,layer:t.layer});n.destroy(h.name)},h.onUpdate=function(){h.angle+=5,h.accelerate(),h.y<-h.height&&h.destroyIt()},void 0!==t.layer&&s.add(t.layer,h),h},t.prototype.createTriplebomb=function(t){var e=this,a=this.game,i=this.phaserMaster,n=this.phaserSprites,s=this.phaserGroup,o=this.atlas,r=i.getAll().weaponData.secondaryWeapons.TRIPLEBOMB,h=n.addFromAtlas({x:t.x,y:t.y,name:t.name,group:t.group,atlas:o,filename:r.spriteAnimation[0]});return r.spriteAnimation.length>1&&(h.animations.add("animate",r.spriteAnimation,1,!0),h.animations.play("animate",30,!0)),a.physics.enable(h,Phaser.Physics.ARCADE),h.anchor.setTo(.5,.5),h.body.velocity.y=r.initialVelocity,h.angle=90,h.hasDetonated=!1,h.accelerate=function(){h.body.velocity.y>-500&&(h.body.velocity.y-=r.velocity),h.body.velocity.x+=t.spread},h.destroyIt=function(){e.createExplosion(h.x,h.y,1.25,t.layer),n.destroy(h.name)},h.onUpdate=function(){h.angle+=15,h.accelerate(),h.y<-h.height&&h.destroyIt()},void 0!==t.layer&&s.add(t.layer,h),h},t.prototype.createTurret=function(t){var e=this,a=this.game,i=this.phaserMaster,n=this.phaserSprites,s=this.phaserGroup,o=this.atlas,r=i.getAll().weaponData.secondaryWeapons.TURRET,h=n.addFromAtlas({x:t.x,y:t.y,name:t.name,group:t.group,atlas:o,filename:r.spriteAnimation[0]});h.anchor.setTo(.5,.5),a.physics.enable(h,Phaser.Physics.ARCADE),s.add(2,h),setTimeout(function(){h.destroyIt()},r.lifespan),h.fireInterval=setInterval(function(){var i=h.x,n=h.y,s=h.width;e.createBullet({name:"B"+a.rnd.integer(),group:"ship_wpn_preview",x:i,offset:0,y:n,spread:0,layer:t.layer}),e.createBullet({name:"B"+a.rnd.integer(),group:"ship_wpn_preview",x:i+s/2,offset:0,y:n,spread:0,layer:t.layer}),e.createBullet({name:"B"+a.rnd.integer(),group:"ship_wpn_preview",x:i-s/2,offset:0,y:n,spread:0,layer:t.layer})},200),h.fireInterval,h.destroyIt=function(){e.createExplosion(h.x,h.y,.5,t.layer),clearInterval(h.fireInterval),n.destroy(h.name)},void 0!==t.layer&&s.add(t.layer,h)},t.prototype.createBlastradius=function(t){var e=this.game,a=this.phaserMaster,i=this.phaserSprites,n=this.phaserGroup,s=this.atlas,o=a.getAll().weaponData.secondaryWeapons.BLASTRADIUS,r=i.addFromAtlas({x:t.x,y:t.y,name:t.name,group:t.group,atlas:s,filename:o.spriteAnimation[0]});if(r.anchor.setTo(.5,.5),r.scale.setTo(1,1),o.spriteAnimation.length>1){var h=r.animations.add("animate",o.spriteAnimation,30,!1);h.onStart.add(function(){},r),h.onComplete.add(function(){i.destroy(r.name)},r),h.play("animate")}e.physics.enable(r,Phaser.Physics.ARCADE),void 0!==t.layer&&n.add(t.layer,r)},t.prototype.createBomblet=function(t){var e=this,a=this.game,i=(this.phaserMaster,this.phaserSprites),n=this.phaserGroup,s=this.atlas,o=i.addFromAtlas({x:t.x,y:t.y,name:"bomblet_"+a.rnd.integer(),group:t.group,atlas:s,filename:"clusterBomb.png"});return o.anchor.setTo(.5,.5),o.scale.setTo(.5,.5),a.physics.enable(o,Phaser.Physics.ARCADE),o.body.velocity.y=t.iy,o.body.velocity.x=t.ix,o.fuse=a.time.now,o.detonate=a.time.now+a.rnd.integerInRange(1250,1800),o.destroyIt=function(){e.createExplosion(o.x,o.y,1,t.layer),i.destroy(o.name)},o.onUpdate=function(){o.angle+=5,o.game.time.now>o.detonate&&o.destroyIt()},void 0!==t.layer&&n.add(t.layer,o,t.layer),o},t.prototype.createExplosion=function(t,e,a,i){var n=this.game,s=(this.phaserMaster,this.phaserSprites),o=this.phaserGroup,r=this.atlas,h=s.addFromAtlas({name:"explosion_"+n.rnd.integer(),group:"explosions",x:t,y:e,atlas:r,filename:"explosions_Layer_1.png"});return h.scale.setTo(a,a),h.anchor.setTo(.5,.5),h.animations.add("explosion",Phaser.Animation.generateFrameNames("explosions_Layer_",1,16,".png"),1,!0),h.animations.play("explosion",30,!0),n.time.events.add(Phaser.Timer.SECOND/2,function(){s.destroy(h.name)}).autoDestroy=!0,void 0!==i&&o.add(i,h),h},t.prototype.createImpactExplosion=function(t,e,a,i){var n=this.game,s=(this.phaserMaster,this.phaserSprites),o=this.phaserGroup,r=this.atlas,h=s.addFromAtlas({name:"impact_"+n.rnd.integer(),group:"impactExplosions",x:t,y:e,atlas:r,filename:"explosions_Layer_1.png"});return h.scale.setTo(a,a),h.anchor.setTo(.5,.5),n.physics.enable(h,Phaser.Physics.ARCADE),h.animations.add("explosion",Phaser.Animation.generateFrameNames("explosions_Layer_",1,16,".png"),1,!0),h.animations.play("explosion",30,!0),n.time.events.add(Phaser.Timer.SECOND/2,function(){s.destroy(h.name)}).autoDestroy=!0,void 0!==i&&o.add(i,h),h},t}();