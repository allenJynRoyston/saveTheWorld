var PhaserGameObject=function(){function e(){this.game=null,this.global={pause:!1}}return e.prototype.init=function(e,t,a){var n=new Phaser.Game(a.width,a.height,Phaser.WEBGL,e,{preload:function(){var e=i.game();e.load.enableParallel=!0,e.stage.backgroundColor="#2f2f2f";var t="src/phaser/saveTheWorld/resources";e.load.image("background",t+"/images/starfield.png"),e.load.atlas("atlas_main",t+"/spritesheets/main/main.png",t+"/spritesheets/main/main.json",Phaser.Loader.TEXTURE_atlas_main_JSON_HASH),e.load.atlas("atlas_weapons",t+"/spritesheets/weapons/weaponsAtlas.png",t+"/spritesheets/weapons/weaponsAtlas.json",Phaser.Loader.TEXTURE_atlas_main_JSON_HASH),e.load.atlas("atlas_large",t+"/spritesheets/large/large.png",t+"/spritesheets/large/large.json",Phaser.Loader.TEXTURE_atlas_main_JSON_HASH),e.load.atlas("atlas_enemies",t+"/spritesheets/enemies/enemies.png",t+"/spritesheets/enemies/enemies.json",Phaser.Loader.TEXTURE_atlas_main_JSON_HASH),e.load.atlas("atlas_ships",t+"/spritesheets/ships/ships.png",t+"/spritesheets/ships/ships.json",Phaser.Loader.TEXTURE_atlas_main_JSON_HASH),e.load.json("weaponData",t+"/json/weaponData.json"),e.load.bitmapFont("gem",t+"/fonts/gem.png",t+"/fonts/gem.xml"),i.changeState("PRELOAD"),new PHASER_PRELOADER({game:e,delayInSeconds:0,done:function(){var e,t,a,n,r,l;e=i.game(),t=i.get("devMode"),a=s.getOnly(["overlay"]).overlay,n=i.getOnly(["clock","roundTime"]),r=n.clock,l=n.roundTime,T("WIPEOUT",function(){y.overlayBGControls({transition:"FADEOUT",delay:0,speed:250},function(){var n=function(){i.game();var e=i.getOnly(["gameData","primaryWeapon","secondaryWeapon","perk"]),t=e.gameData,a=e.primaryWeapon,n=e.secondaryWeapon,r=e.perk,l=m.createShip({name:"player",group:"playership",layer:8,shipId:t.pilot},function(e){var t=i.getOnly(["gameData"]).gameData;E(e),b("player",{health:e,lives:t.player.lives})},function(e){var t=i.getOnly(["gameData"]).gameData;t.player.lives--,s.get("lifeIcon_"+t.player.lives).destroyIt(),t.player.lives>0?(b("player",{health:100,lives:t.player.lives}),o.clearAllControlIntervals(),o.disableAllInput(),e.isDestroyed()):R()},function(e){var t=i.getState().currentState;if(!e.isInvincible&&"ENDLEVEL"!==t){var a=!1;O().map(function(t){null!==t.game&&null!==t.game.physics&&t.game.physics.arcade.overlap(e,t,function(e,t){a=!0,t.parent.damageIt(50)},null,e)}),a&&(e.isInvincible=!0,e.takeDamage(10))}});return l.attachPerk(r.reference),l.attachWeapon(a.reference),l.attachSubweapon(n.reference),l}();a.fadeOut(t?0:Phaser.Timer.SECOND/2,function(){I("SAVE THE WORLD",function(){n.moveToStart(),e.time.events.add(t?0*Phaser.Timer.SECOND:1*Phaser.Timer.SECOND,function(){I(l+" SECONDS GO",function(){e.time.events.add(t?0*Phaser.Timer.SECOND:Phaser.Timer.SECOND/2,function(){s.getGroup("ui").map(function(e){e.reveal(),i.changeState("READY")})}).autoDestroy=!0,r.start()})})})})})})}})},create:function(){var e=i.game(),t=i.get("gameData");e.physics.startSystem(Phaser.Physics.ARCADE),o.assign(e),r.assign(e),s.assign(e),l.assign(e),h.assign(e),u.assign(e),d.assign(e,20),p.assign(e),c.assign(e,i,s,d,"atlas_weapons"),g.assign(e,i,s,h,d,c,"atlas_enemies","atlas_weapons"),m.assign(e,i,s,h,d,o,c,"atlas_ships","atlas_weapons"),y.assign(e,s,p,d,"atlas_main"),i.let("roundTime",60),i.let("clock",e.time.create(!1)),i.let("elapsedTime",0),i.let("devMode",!1),i.let("starMomentum",{x:0,y:0}),i.let("pauseStatus",!1),i.let("firepowerUp",1);var a=i.let("weaponData",e.cache.getJSON("weaponData")),n=(i.let("primaryWeapon",a.primaryWeapons[t.primaryWeapon]),i.let("secondaryWeapon",a.secondaryWeapons[t.secondaryWeapon]));i.let("perk",a.perks[t.perk]);e.onPause.add(function(){i.get("clock").stop(),i.forceLet("pauseStatus",!0)},this),e.onResume.add(function(){i.get("clock").start(),i.forceLet("pauseStatus",!1)},this),y.buildOverlayBackground("#ffffff","#ffffff",19,!0),y.buildOverlayGrid(240,132,20,"logo_small.png");var f=p.addGradient({name:"boundryObj",start:"#ffffff",end:"#ffffff",width:5,height:5,render:!1}),v=s.add({x:-9,y:-e.world.height/2,name:"leftBoundry",group:"boundries",width:10,height:2*e.world.height,reference:f.cacheBitmapData,alpha:0}),x=s.add({x:e.world.width-1,y:-e.world.height/2,name:"rightBoundry",group:"boundries",width:10,height:2*e.world.height,reference:f.cacheBitmapData,alpha:0});e.physics.enable([v,x],Phaser.Physics.ARCADE),v.body.immovable=!0,x.body.immovable=!0;var T=s.addTilespriteFromAtlas({name:"background",group:"spaceGroup",x:0,y:0,width:e.canvas.width,height:e.canvas.height,atlas:"atlas_large",filename:"spacebg.png"});T.count=0,T.onUpdate=function(){this.count+=.005,this.tilePosition.y-=.2*Math.sin(this.count)},d.add(0,T);var I=i.let("emitter",e.add.emitter(e,0,0,5e3));I.makeParticles("atlas_main","particle.png"),I.gravity=0,d.layer(1).add(I);for(var S=function(t){var a=s.addFromAtlas({x:e.rnd.integerInRange(0,e.world.width),y:e.rnd.integerInRange(0,e.world.height),name:"star_"+t,group:"movingStarField",filename:"stars_layer_"+e.rnd.integerInRange(1,3)+".png",atlas:"atlas_main",visible:!0});a.starType=e.rnd.integerInRange(1,3),a.scale.setTo(a.starType/2,a.starType/2),a.onUpdate=function(){var t=.25+5*(3-a.starType),n=i.get("starMomentum");this.y>this.game.world.height&&(this.y=10,this.x=e.rnd.integerInRange(-100,e.world.width)),this.x>this.game.world.width&&(this.x=0),this.x<0&&(this.x=this.game.world.width),n.x>0&&(n.x-=.05),n.x<0&&(n.x+=.05),n.y>0&&(n.y-=.05),n.y<0&&(n.y+=.05),this.x+=(3-a.starType)*n.x,this.y+=t+(3-a.starType)*n.y},a.fadeOut=function(){this.game.add.tween(this).to({alpha:0},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,e.rnd.integerInRange(0,500),0,!1).autoDestroy=!0},d.layer(4-a.starType).add(a)},D=0;D<25;D++)S(D);var O=s.addTilespriteFromAtlas({name:"nebula1",group:"spaceGroup",x:0,y:0,width:e.canvas.width,height:e.canvas.height,atlas:"atlas_large",filename:"Nebula1.png"});O.count=0,O.onUpdate=function(){this.count+=.005,this.tilePosition.x-=.2*Math.sin(this.count)};var R=s.addTilespriteFromAtlas({name:"nebula2",group:"spaceGroup",x:0,y:0,width:e.canvas.width,height:e.canvas.height,atlas:"atlas_large",filename:"Nebula2.png"});R.count=0,R.onUpdate=function(){this.count+=.005,this.tilePosition.y+=.2,this.tilePosition.x+=.2};var B=s.addFromAtlas({x:this.game.world.centerX,y:this.game.canvas.height+400,name:"earth",group:"spaceGroup",filename:"earth.png",atlas:"atlas_main",visible:!0});B.scale.setTo(2,2),B.anchor.setTo(.5,.5),B.onUpdate=function(){B.angle+=.01},B.fadeOut=function(){this.game.add.tween(this).to({y:this.y-200},1*Phaser.Timer.SECOND,Phaser.Easing.Circular.In,!0,0,0,!1).autoDestroy=!0,this.game.add.tween(this.scale).to({x:2.5,y:2.5},1*Phaser.Timer.SECOND,Phaser.Easing.Circular.In,!0,0,0,!1).autoDestroy=!0},B.selfDestruct=function(){var t,a,n,o,r,s,l=this;t=this,a=this.tint,n=16711680,o=20*Phaser.Timer.SECOND,r={step:0},(s=i.game().add.tween(r).to({step:100},o)).onUpdateCallback(function(){t.tint=Phaser.Color.interpolateColor(a,n,100,r.step)}),t.tint=a,s.start(),setTimeout(function(){l.tint=16711680},20*Phaser.Timer.SECOND+1);var h=setInterval(function(){c.createExplosion(e.rnd.integerInRange(0,l.game.canvas.width),e.rnd.integerInRange(l.game.canvas.height-200,l.game.canvas.height),.25,6)},100);i.let("endExplosion",h)},d.addMany(2,[B]),d.addMany(1,[O,R]);var L=s.addFromAtlas({name:"timerContainer",group:"ui",filename:"ui_container1.png",atlas:"atlas_main",visible:!1});s.centerOnPoint("timerContainer",this.game.world.centerX,-200),L.reveal=function(){var t=this;this.visible=!0,this.game.add.tween(this).to({y:5},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,0,0,!1).onComplete.add(function(){var a=h.add({y:36,x:t.game.world.centerX,name:"timeKeeper",group:"ui_text",font:"gem",size:42,default:"00",visible:!1});a.anchor.setTo(.5,.5),a.reveal=function(){this.visible=!0,this.alpha=0,this.game.add.tween(this).to({alpha:1},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.In,!0,0,0,!1),d.add(15,this)},a.onUpdate=function(){var t=i.getState().currentState,a=i.getOnly(["elapsedTime","clock","roundTime"]),n=a.elapsedTime,o=a.clock,r=a.roundTime;n+=.001*o.elapsed,i.forceLet("elapsedTime",n);var l=parseInt((r-n).toFixed(0));l>=0?this.setText(""+l):0===s.getGroup("boss").length&&"READY"===t&&(s.get("timerContainer").hide(),this.hide(),setTimeout(function(){U.reveal()},500),function(e){i.game();var t=s.getOnly(["bossContainer"]).bossContainer;g.createGiantAsteroid(e,function(e){P(Math.round(e.health/e.maxHealth*100))},function(e){t.hide();var a=i.getOnly(["gameData"]).gameData;a.score+=1e4,b("score",a.score),h.getOnly(["scoreText"]).scoreText.updateScore(),C()},function(){i.changeState("ENDLEVEL"),t.hide(),_(50),setTimeout(function(){var e=i.getState().currentState;"GAMEOVER"!==e&&C()},1e3)},function(){})}({x:e.rnd.integerInRange(100,e.canvas.width-100),y:e.rnd.integerInRange(-50,-100),ix:e.rnd.integerInRange(-100,100),iy:5,layer:4}))},a.hide=function(){this.game.add.tween(this).to({alpha:0},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.Out,!0,0,0,!1)},a.reveal()})},L.hide=function(){this.game.add.tween(this).to({y:-200},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,500,0,!1),h.get("timeKeeper").hide()};var M=s.addFromAtlas({name:"scoreContainer",group:"ui",filename:"ui_roundContainer.png",atlas:"atlas_main",visible:!1});M.anchor.setTo(.5,.5),M.reveal=function(){var e=this;this.x=this.game.world.width-this.width/2-10,this.y=-200,this.visible=!0,this.game.add.tween(this).to({y:20},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,0,0,!1).onComplete.add(function(){N.reveal(e.x,e.y)})},M.hide=function(){this.game.add.tween(this).to({y:-200},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,500,0,!1),h.get("scoreText").hide()};var N=h.add({name:"scoreText",group:"ui_text",font:"gem",size:14,default:""+t.score,alpha:0});N.anchor.setTo(.5,.5),N.onUpdate=function(){},N.updateScore=function(){this.setText(""+i.get("gameData").score)},N.reveal=function(e,t){this.x=M.x,this.y=M.y,this.game.add.tween(this).to({alpha:1},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.In,!0,0,0,!1)},N.hide=function(){this.game.add.tween(this).to({alpha:0},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.In,!0,0,0,!1)};var k=s.addFromAtlas({name:"statusContainer",group:"ui",filename:"ui_statusContainer.png",atlas:"atlas_main",visible:!1});k.reveal=function(){this.x=-this.width,this.y=this.game.world.height-this.height-10,this.visible=!0,this.game.add.tween(this).to({x:10},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,0,0,!1).onComplete.add(function(){var e=s.addFromAtlas({x:k.x+7,y:k.y+22,name:"healthBar",group:"ui_overlay",filename:"ui_shieldBar.png",atlas:"atlas_main",visible:!0}),a=i.let("healthBar",s.addBasicMaskToSprite(e));a.y=e.height,E(t.player.health);var o=s.addFromAtlas({x:k.x+30,y:k.y+206,name:"specialBar",group:"ui_overlay",filename:"ui_specialBar.png",atlas:"atlas_main",visible:!0}),r=i.let("specialBar",s.addBasicMaskToSprite(o));r.y=o.height,w(100);var l=s.addFromAtlas({x:k.x+36,y:k.y+305,name:"specialWeapon",group:"ui_overlay",filename:""+n.spriteIcon,atlas:"atlas_weapons",visible:!1});l.anchor.setTo(.5,.5),l.onUpdate=function(){this.angle+=2},l.reveal=function(){this.visible=!0,l.scale.setTo(2,2),this.game.add.tween(this.scale).to({x:1.5,y:1.5},Phaser.Timer.SECOND,Phaser.Easing.Bounce.Out,!0,0,0,!1)},l.hide=function(){this.visible=!1},l.reveal(),d.addMany(14,[e,o,l])})},k.hide=function(){w(0),E(0),s.getGroup("ui_overlay").map(function(e){e.hide()}),this.game.add.tween(this).to({y:this.game.world.height+this.height},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,500,0,!1)};var G=s.addFromAtlas({name:"earthContainer",group:"ui",filename:"ui_shield.png",atlas:"atlas_main",visible:!1});G.reveal=function(){var e=this;this.x=this.game.world.width+this.width,this.y=this.game.world.height-this.height-10,this.visible=!0,this.game.add.tween(this).to({x:this.game.world.width-this.width-10},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,0,0,!1).onComplete.add(function(){e.defaultPosition.x=e.x,e.defaultPosition.y=e.y;var a=s.addFromAtlas({x:G.x+5,y:G.y+5,name:"earthBar",group:"ui_overlay",filename:"ui_healthBar.png",atlas:"atlas_main",visible:!0}),n=i.let("earthBar",s.addBasicMaskToSprite(a));n.x=-a.width;var o=t.population,r=100-o.killed/o.total*100;A(r)})},G.hide=function(){A(0),this.game.add.tween(this).to({y:this.game.world.height+this.height},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,500,0,!1)},G.takeDamage=function(){var e=this;this.game.add.tween(this).to({x:this.defaultPosition.x-5},50,Phaser.Easing.Bounce.In,!0,0,0,!1).onComplete.add(function(){e.game.add.tween(e).to({x:e.defaultPosition.x+3},50,Phaser.Easing.Bounce.Out,!0,0,0,!1).onComplete.add(function(){e.game.add.tween(e).to({x:e.defaultPosition.x},50,Phaser.Easing.Bounce.InOut,!0,0,0,!1)})})};var U=s.addFromAtlas({name:"bossContainer",group:"bosshealth",filename:"ui_shield.png",atlas:"atlas_main",visible:!1});U.anchor.setTo(.5,.5),U.reveal=function(){var e=this;this.x=this.game.world.centerX,this.y=-this.height,this.visible=!0,this.game.add.tween(this).to({y:20},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,0,0,!1).onComplete.add(function(){e.defaultPosition.x=e.x,e.defaultPosition.y=e.y;var t=s.addFromAtlas({x:U.x-U.width/2+5,y:U.y-U.height/2+5,name:"bossBar",group:"bosshealth",filename:"ui_BossHealthBar.png",atlas:"atlas_main",visible:!0}),a=i.let("bossBar",s.addBasicMaskToSprite(t));a.x=-t.width,P(100)})},U.hide=function(){P(0),this.game.add.tween(this).to({y:-this.height},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,500,0,!1)};var F=s.addFromAtlas({x:10,name:"portraitContainer",group:"ui",filename:"ui_portraitContainer.png",atlas:"atlas_main",visible:!1});F.reveal=function(){var e=this;this.y=-this.height-10,this.visible=!0,this.game.add.tween(this).to({y:10},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,0,0,!1).onComplete.add(function(){var a=s.addFromAtlas({x:e.x+2,y:e.y+2,name:"characterPortrait",group:"ui_overlay",filename:"ui_portrait_1.png",atlas:"atlas_main",alpha:0});a.reveal=function(){this.game.add.tween(this).to({alpha:1},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.In,!0,0,0,!1)},a.hide=function(){this.game.add.tween(this).to({alpha:0},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.In,!0,0,0,!1)},a.reveal();for(var n=0;n<t.player.lives;n++){var i=s.addFromAtlas({x:e.x+12+20*n,y:e.y+e.height+10,name:"lifeIcon_"+n,group:"ui_overlay",filename:"ship_icon.png",atlas:"atlas_main",alpha:0});i.anchor.setTo(.5,.5),i.reveal=function(){this.game.add.tween(this).to({alpha:1},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.In,!0,0,0,!1)},i.hide=function(){this.game.add.tween(this).to({alpha:0},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.In,!0,0,0,!1)},i.destroyIt=function(){s.destroy(this.name)},i.reveal()}d.addMany(12,[a])})},F.hide=function(){this.game.add.tween(this).to({y:-this.height},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,500,0,!1)};var W=s.addFromAtlas({name:"menuButton1",group:"ui_buttons",x:e.world.centerX,y:e.world.centerY+125,atlas:"atlas_main",filename:"ui_button.png",visible:!1});W.anchor.setTo(.5,.5),W.reveal=function(){this.visible=!0},h.add({name:"menuButton1Text",group:"ui",font:"gem",x:W.x,y:W.y,size:14,default:""}).anchor.setTo(.5,.5);var j=s.addFromAtlas({name:"menuButton2",group:"ui_buttons",x:e.world.centerX,y:e.world.centerY+175,atlas:"atlas_main",filename:"ui_button.png",visible:!1});j.anchor.setTo(.5,.5),j.reveal=function(){this.visible=!0},h.add({name:"menuButton2Text",group:"ui",font:"gem",x:j.x,y:j.y,size:14,default:""}).anchor.setTo(.5,.5);var H=s.addFromAtlas({name:"menuButtonCursor",group:"ui_buttons",x:e.world.centerX-125,atlas:"atlas_main",filename:"ui_cursor.png",visible:!1});H.anchor.setTo(.5,.5),H.reveal=function(){this.visible=!0},H.updateLocation=function(e){i.forceLet("menuButtonSelection",e);var t=s.get("menuButton"+e);this.y=t.y},H.updateLocation(1),d.addMany(12,[W,j,H]),d.addMany(13,[L,k,M,G,F]);var Y=p.addGradient({name:"overlaybmd",start:"#2f2f2f",end:"#2f2f2f",width:5,height:5,render:!1}),K=s.add({x:0,y:0,name:"overlay",width:e.canvas.width,height:e.canvas.height,reference:Y.cacheBitmapData,visible:!0});K.fadeIn=function(t,a){e.add.tween(this).to({alpha:1},t,Phaser.Easing.Linear.In,!0,0,0,!1),setTimeout(function(){a()},t)},K.fadeOut=function(t,a){e.add.tween(this).to({alpha:0},t,Phaser.Easing.Linear.Out,!0,0,0,!1),setTimeout(function(){a()},t)},d.addMany(10,[K])},update:function(){var e=i.game(),a=i.getState().currentState,n=i.getOnly(["starMomentum","primaryWeapon","secondaryWeapon","menuButtonSelection","elapsedTime"]),r=n.starMomentum,l=n.primaryWeapon,u=n.secondaryWeapon,d=n.menuButtonSelection,p=n.elapsedTime,m=s.getOnly(["specialWeapon","player"]),y=m.specialWeapon,f=m.player,v=o.getOnly(["DOWN","UP","LEFT","RIGHT","A","START"]),T=v.DOWN,E=v.UP,A=v.LEFT,P=v.RIGHT,_=v.A,I=v.START;void 0!==p&&(p=parseInt(p.toFixed(0)));if(s.getManyGroups(["spaceGroup","movingStarField","ship_weapons","ship_secondary_weapons","impactExplosions","playership","enemy_bullets"]).map(function(e){e.onUpdate()}),"READY"===a){if(s.getGroup("enemies").length<1&&0===s.getGroup("boss").length&&(O={x:e.rnd.integerInRange(100,e.canvas.width-100),y:e.rnd.integerInRange(100,400),iy:e.rnd.integerInRange(0,80),layer:3},i.game(),g.createSmallEnemy1(O,function(){},function(e){var t=i.getOnly(["gameData"]).gameData;t.score+=200,b("score",t.score),h.getOnly(["scoreText"]).scoreText.updateScore()},function(){},function(){})),s.getManyGroups(["ui_overlay","enemies","boss","trashes"]).map(function(e){void 0!==e&&e.onUpdate()}),h.getManyGroups(["ui_text","timeKeeper"]).map(function(e){void 0!==e&&e.onUpdate()}),P.active&&(r.x=-2,f.moveX(5)),A.active&&(r.x=2,f.moveX(-5)),E.active&&(r.y=5,f.moveY(-5)),T.active&&(r.y=-2,f.moveY(5)),E.active||T.active||(r.y=0),o.checkWithDelay({isActive:!0,key:"A",delay:l.cooldown-_.state*l.rapidFireSpd}))switch(l.reference){case"LASER":!function(){var e=i.game(),t=s.getOnly(["player"]).player,a={gap:30,shots:1+1*i.getOnly(["firepowerUp"]).firepowerUp},n=a.gap,o=a.shots,r=n*(o-1)/2;t.fireWeapon();for(var l=0;l<o;l++){c.createLaser({name:"laser_"+e.rnd.integer(),group:"ship_weapons",x:t.x+l*n-r,y:t.y-t.height/2,spread:0,layer:t.onLayer+1},function(){},function(e){S(e,"LASER")})}}();break;case"MISSLE":!function(){var e=i.game(),t=s.getOnly(["player"]).player,a={gap:30,shots:2+2*i.getOnly(["firepowerUp"]).firepowerUp},n=a.gap,o=a.shots,r=n*(o-1)/2;t.fireWeapon();for(var l=0;l<o;l++){c.createMissle({name:"missle_"+e.rnd.integer(),group:"ship_weapons",x:t.x+l*n-r,y:t.y-t.height/2,spread:l%2==0?-.5:.5,layer:t.onLayer+1},function(e){D(e.x+e.height,e.y,1,e.damageAmount/2)},function(e){S(e,"MISSLE")})}}();break;case"BULLET":!function(){var e=i.game(),t=s.getOnly(["player"]).player,a={gap:10,shots:2+2*i.getOnly(["firepowerUp"]).firepowerUp},n=a.gap,o=a.shots,r=n*(o-1)/2;t.fireWeapon();for(var l=function(a){setTimeout(function(){c.createBullet({name:"bullet_"+e.rnd.integer(),group:"ship_weapons",x:t.x+a*n-r,y:t.y,spread:0,layer:t.onLayer+1},function(){},function(e){S(e,"BULLET")})},25)},h=0;h<o;h++)l(h)}()}if(o.checkWithDelay({isActive:!0,key:"B",delay:u.cooldown}))switch(void 0!==y&&(w(0,!0),e.time.events.add(50,function(){w(100,!1,u.cooldown-50)}).autoDestroy=!0),u.reference){case"CLUSTERBOMB":!function(){var e=i.game(),t=s.getOnly(["player"]).player;t.fireSubweapon(),c.createClusterbomb({name:"clusterbomb_"+e.rnd.integer(),group:"ship_secondary_weapons",x:t.x,y:t.y,layer:t.onLayer+1},function(t){for(var a=0;a<t.bomblets;a++)n={x:t.x,y:t.y,ix:e.rnd.integerInRange(-400,400),iy:e.rnd.integerInRange(-400,100),damage:t.damageAmount/4,group:"ship_weapons",layer:2},void 0,void 0,void 0,function(e){S(e)},function(e){D(e.x,e.y,.5,e.damageAmount)},c.createBomblet(n,function(e){D(e.x,e.y,.5,e.damageAmount)},function(e){S(e)});var n},function(e){S(e)})}();break;case"TRIPLEBOMB":!function(){for(var e=i.game(),t=s.getOnly(["player"]).player,a=function(e){S(e)},n=function(e){},o=0;o<3;o++)setTimeout(function(){t.fireSubweapon(),c.createTriplebomb({name:"triplebomb_"+e.rnd.integer(),group:"ship_secondary_weapons",x:t.x,y:t.y,layer:t.onLayer+1},n,a)},300*o)}();break;case"TURRET":!function(){var e=i.game(),t=s.getOnly(["player"]).player,a=function(a){var n={gap:10,shots:3},i=n.gap,o=n.shots,r=i*(o-1)/2;a.fireInterval=setInterval(function(){for(var n=0;n<o;n++){c.createBullet({name:"bullet_"+e.rnd.integer(),group:"ship_secondary_weapons",x:a.x+n*i-r,y:a.y,spread:0,layer:t.onLayer+1},function(){},function(e){S(e)})}},200),a.fireInterval},n=function(e){e.x=t.x-e.offset,e.y=t.y},o=function(e){};t.fireSubweapon(),c.createTurret({name:"turret_"+e.rnd.integer(),group:"ship_secondary_weapons",x:t.x,y:t.y,offset:50,layer:t.onLayer+2},a,o,n),c.createTurret({name:"turret_"+e.rnd.integer(),group:"ship_secondary_weapons",x:t.x,y:t.y,offset:-50,layer:t.onLayer+2},a,o,n)}()}}var O;if("VICTORYSTATE"===a&&(E.active&&s.get("menuButtonCursor").updateLocation(1),T.active&&s.get("menuButtonCursor").updateLocation(2),I.active))switch(i.changeState("LOCKED"),o.disableAllInput(),d){case 1:x(),B(function(){x(),t.loadNextLevel()});break;case 2:x(),B(function(){x(),t.returnToTitle()})}if("GAMEOVERSTATE"===a&&(E.active&&s.get("menuButtonCursor").updateLocation(1),T.active&&s.get("menuButtonCursor").updateLocation(2),I.active))switch(clearInterval(i.get("endExplosion")),i.changeState("LOCKED"),o.disableAllInput(),d){case 1:B(function(){t.retry()});break;case 2:B(function(){t.returnToTitle()})}"ENDLEVEL"===a&&f.onUpdate()}});n.preserveDrawingBuffer=!0;var i=new PHASER_MASTER({game:n,resolution:{width:a.width,height:a.height}}),o=new PHASER_CONTROLS,r=new PHASER_MOUSE({showDebugger:!1}),s=new PHASER_SPRITE_MANAGER,l=new PHASER_BITMAPDATA_MANAGER,h=new PHASER_TEXT_MANAGER,u=new PHASER_BUTTON_MANAGER,d=new PHASER_GROUP_MANAGER,p=new PHASER_BITMAPDATA_MANAGER,c=new WEAPON_MANAGER,g=new ENEMY_MANAGER({showHitbox:!0}),m=new PLAYER_MANAGER,y=new UTILITY_MANAGER,f=a.store,v=JSON.stringify(f.getters._gameData());function b(e,t){i.get("gameData")[e]=t}function x(){var e=i.get("gameData");f.commit("setGamedata",e)}function T(e,t){void 0===t&&(t=function(){}),y.overlayControls({transition:e,delay:1e3,speed:250,tileDelay:5},t)}function E(e,t,a){void 0===t&&(t=!1),void 0===a&&(a=Phaser.Timer.SECOND/3);var n=i.game(),o=Math.ceil(.01*e*30),r=i.getAll(),s=r.healthBar,l=r.healthBarTween;void 0!==l&&l.stop(),i.forceLet("healthBarTween",n.add.tween(s).to({y:231-7.7*o},t?1:a,Phaser.Easing.Linear.Out,!0,0,0,!1))}function w(e,t,a){void 0===t&&(t=!1),void 0===a&&(a=Phaser.Timer.SECOND/3);var n=i.game(),o=Math.ceil(.01*e*6),r=i.getAll(),s=r.specialBar,l=r.specialBarTween;void 0!==l&&l.stop(),i.forceLet("specialBarTween",n.add.tween(s).to({y:48-8*o},t?1:a,Phaser.Easing.Linear.Out,!0,0,0,!1))}function A(e,t,a){void 0===t&&(t=!1),void 0===a&&(a=Phaser.Timer.SECOND/3);var n=i.game(),o=.01*e*10,r=i.getAll(),s=r.earthBar,l=r.earthBarTween;void 0!==l&&l.stop(),i.forceLet("earthBarTween",n.add.tween(s).to({x:24.4*o-244},t?1:a,Phaser.Easing.Linear.Out,!0,0,0,!1))}function P(e){var t=i.game(),a=.01*e*10,n=i.getAll().bossBar;void 0!==n&&t.add.tween(n).to({x:24.4*a-244},1,Phaser.Easing.Linear.Out,!0,0,0,!1)}function _(e){var t=i.getAll().gameData,a=i.getState().currentState,n=s.getAll().earthContainer,o=t.population;o.killed+=e;var r=100-o.killed/o.total*100;r<=0&&"GAMEOVER"!==a?R():(n.takeDamage(),A(r,!0),b("population",{total:o.total,killed:o.killed}))}function I(e,t){var a=i.game(),n=e.split(" ");n.map(function(e,t){var n=h.add({name:"splashText_"+a.rnd.integer(),group:"splash",font:"gem",size:18,default:e,visible:!1});n.startSplash=function(){var e=this;this.visible=!0,this.scale.setTo(10,10),h.alignToCenter(this.name),a.add.tween(this.scale).to({x:.5,y:.5},350,Phaser.Easing.Linear.In,!0,0),a.add.tween(this).to({x:this.game.world.centerX,y:this.game.world.centerY,alpha:.75},350,Phaser.Easing.Linear.In,!0,0),setTimeout(function(){h.destroy(e.name)},350)},a.time.events.add(Phaser.Timer.SECOND/2.5*t+100,n.startSplash,n).autoDestroy=!0}),a.time.events.add(Phaser.Timer.SECOND/2.5*n.length,t,this).autoDestroy=!0}function S(e,t){void 0===t&&(t=null),O().map(function(a){null!==a.game&&null!==a.game.physics&&a.game.physics.arcade.overlap(e,a,function(e,a){e.pierceStrength-=a.parent.pierceResistence,a.parent.damageIt(e.damageAmount,t),e.pierceStrength<=0&&e.destroyIt()},null,e)})}function D(e,t,a,n){c.createImpactExplosion(e,t,a,6,n,function(e){},function(e){S(e)})}function O(){return s.getGroup("enemy_hitboxes").slice()}function C(){var e=i.game(),t=i.get("gameData");i.changeState("ENDLEVEL"),h.getGroup("ui_text").map(function(e){e.hide()}),s.getGroup("ui").map(function(e){e.hide()}),s.getGroup("ship_secondary_weapons").map(function(e){e.destroyIt()}),s.get("player").playEndSequence(function(){var a=t.level++;b("level",++a);for(var n=0;n<20;n++)setTimeout(function(){var t,a,n,i;t=e.rnd.integerInRange(0,e.world.width),a=e.rnd.integerInRange(0,e.world.height),n=e.rnd.integerInRange(1,4),i=6,c.createExplosion(t,a,n,i)},e.rnd.integerInRange(0,50)*n);setTimeout(function(){s.getGroup("enemies").map(function(t){setTimeout(function(){t.destroyIt(!1)},e.rnd.integerInRange(0,500))}),s.getGroup("trashes").map(function(t){setTimeout(function(){t.destroyIt(!1)},e.rnd.integerInRange(0,500))}),s.getGroup("movingStarField").map(function(e){e.fadeOut()}),setTimeout(function(){I("NICE JOB HERO",function(){s.get("earth").fadeOut();var t=s.addTilespriteFromAtlas({name:"blue_bg",group:"spaceGroup",x:0,y:0,width:e.canvas.width,height:e.canvas.height,atlas:"atlas_large",filename:"motionBlur.jpg",alpha:0});t.count=0,t.scale.setTo(2,2),t.anchor.setTo(.5,.5),t.onUpdate=function(){this.tilePosition.y-=25},d.add(11,t),e.add.tween(t).to({alpha:1},Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){var a=s.addTilespriteFromAtlas({name:"victory_bg",group:"spaceGroup",x:0,y:0,width:e.canvas.width,height:e.canvas.height,atlas:"atlas_large",filename:"victory_bg.png",alpha:1});a.onUpdate=function(){this.tilePosition.x-=3},d.add(10,a),e.add.tween(t).to({alpha:0},Phaser.Timer.SECOND/2,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){var e,t,a;e=i.game(),t=i.get("gameData"),(a=s.addFromAtlas({y:e.world.centerY-100,name:"victoryScreenContainer",group:"ui_clear",filename:"ui_clear.png",atlas:"atlas_main",visible:!1})).anchor.setTo(.5,.5),a.reveal=function(){var n=this;this.x=-this.width-100,this.visible=!0,this.game.add.tween(this).to({x:this.game.world.centerX},1*Phaser.Timer.SECOND,Phaser.Easing.Bounce.Out,!0,0,0,!1).onComplete.add(function(){var o=s.addFromAtlas({x:n.game.world.centerX,y:n.game.world.centerY,name:"scoreContainer2",group:"ui",filename:"ui_roundContainer.png",atlas:"atlas_main",visible:!0});o.anchor.setTo(.5,.5);var r=h.add({name:"scoreText2",group:"ui_text",x:o.x,y:o.y,font:"gem",size:14,default:""+t.score});r.anchor.setTo(.5,.5),r.updateScore=function(){this.setText(""+i.get("gameData").score)},d.addMany(12,[o]),d.addMany(13,[r]),i.get("gameData").population;var l=h.add({name:"popLeft",group:"ui",font:"gem",x:n.x,y:n.y-10,size:24,default:"PEOPLE SAVED:",alpha:0});l.anchor.setTo(.5,.5),l.scale.setTo(2,2),l.game.add.tween(l.scale).to({x:1,y:1},100,Phaser.Easing.Linear.Out,!0,0),l.game.add.tween(l).to({alpha:1},100,Phaser.Easing.Linear.Out,!0,0).onComplete.add(function(){setTimeout(function(){var o=i.get("gameData").population,u=h.add({name:"popCount",font:"gem",x:n.x,y:n.y+30,size:45,default:"",alpha:0});u.anchor.setTo(.5,.5),u.scale.setTo(1.5,1.5),u.setText(""+7e5*(o.total-o.killed)),u.game.add.tween(u.scale).to({x:1,y:1},100,Phaser.Easing.Linear.Out,!0,0),u.game.add.tween(u).to({alpha:1},100,Phaser.Easing.Linear.Out,!0,0),d.addMany(13,[u]);var p=7e5*(o.total-o.killed),c=543211,g=0,m=0,y=setInterval(function(){i.get("pauseStatus")||(c>p&&(c=Math.round(c/2)),p-c<=0?(u.setText(0),clearInterval(y),setTimeout(function(){l.setText("MEDALS EARNED"),h.destroy("popCount");for(var t=function(t){var n=s.addFromAtlas({name:"medal_"+t,group:"medals",x:a.x+20*t-80,y:a.y+20,width:e.canvas.width,height:e.canvas.height,atlas:"atlas_main",filename:"medal_gold.png",alpha:0});n.reveal=function(){this.scale.setTo(2,2),this.game.add.tween(this.scale).to({x:1,y:1},100,Phaser.Easing.Linear.Out,!0,0),this.game.add.tween(this).to({alpha:1},100,Phaser.Easing.Linear.Out,!0,0)},d.addMany(13,[n]),setTimeout(function(){n.reveal()},50*t)},n=0;n<g;n++)t(n);setTimeout(function(){var e=h.getOnly(["menuButton1Text","menuButton2Text"]),t=e.menuButton1Text,a=e.menuButton2Text;i.changeState("VICTORYSTATE"),s.getGroup("ui_buttons").map(function(e){e.reveal()}),t.setText("CONTINUE"),a.setText("SAVE AND QUIT")},50*g+100)},Phaser.Timer.SECOND)):((m+=c)>1e7&&(b("score",Math.round(t.score+2e3)),r.updateScore(),g++,m=0),p-=c,u.setText(p)))},1)},Phaser.Timer.SECOND/2)})})},a.hide=function(){this.game.add.tween(this).to({y:-this.height},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,500,0,!1)},a.reveal(),d.addMany(13,[a])})})})},1.5*Phaser.Timer.SECOND)},Phaser.Timer.SECOND/3)})}function R(){i.changeState("GAMEOVER");var e=s.get("player"),t=s.get("earth");h.getGroup("ui_text").map(function(e){e.hide()}),s.getGroup("ui").map(function(e){e.hide()}),s.getGroup("ship_secondary_weapons").map(function(e){e.destroyIt()}),e.selfDestruct(),t.selfDestruct(),I("DUDE IT WAS THE FIRST LEVEL JEEZE",function(){setTimeout(function(){i.changeState("GAMEOVERSTATE"),s.getGroup("ui_buttons").map(function(e){e.reveal()}),h.get("menuButton1Text").setText("RETRY"),h.get("menuButton2Text").setText("SAVE AND QUIT")},1500)})}function B(e){y.overlayBGControls({transition:"FADEIN",delay:0,speed:250},function(){h.getManyGroups(["ui","ui_text","ui_buttons"]).map(function(e){h.destroy(e.name)}),s.getManyGroups(["ui","ui_buttons"]).map(function(e){s.destroy(e.name)}),T("WIPEIN",function(){setTimeout(function(){e()},500)})})}i.let("gameData",JSON.parse(v)),t.game=this,this.game=i.game()},e.prototype.destroy=function(){this.game.destroy()},e}(),__phaser=new PhaserGameObject,PHASER_AUDIO=function(){return function(){}}(),PHASER_BITMAPDATA_MANAGER=function(){function e(){this.game=null,this.bmd={array:[],object:{}}}return e.prototype.assign=function(e){this.game=e},e.prototype.addGradient=function(e){if(0===this.bmd.array.filter(function(t){return t.name===e.name}).length){var t=this.game.make.bitmapData(e.width,e.height),a=t.context.createLinearGradient(0,0,0,e.height);a.addColorStop(0,e.start),a.addColorStop(1,e.end),t.context.fillStyle=a,t.context.fillRect(0,0,e.width,e.height);var n=this.game.cache.addBitmapData(e.name,t),i=this.game.make.bitmapData();return i.load(this.game.cache.getBitmapData(e.name)),e.render&&i.addToWorld(e.x,e.y),i.name=e.name,i.group=e.group,i.cacheBitmapData=n,this.bmd.array.push(i),this.bmd.object[e.name]=i,i}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.addImage=function(e){if(0===this.bmd.array.filter(function(t){return t.name===e.name}).length){var t=this.game.make.bitmapData();return t.load(e.reference),t.addToWorld(e.x,e.y),e.render||t.cls(),t.name=e.name,t.group=e.group,t.cacheBitmapData=e.reference,this.bmd.array.push(t),this.bmd.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.addEmpty=function(e){if(0===this.bmd.array.filter(function(t){return t.name===e.name}).length){var t=this.game.make.bitmapData(e.width,e.height);return t.addToWorld(e.x,e.y),e.render||t.cls(),t.name=e.name,t.group=e.group,this.bmd.array.push(t),this.bmd.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.destroy=function(e){for(var t=[],a=0,n=this.bmd.array.filter(function(t){return t.name===e});a<n.length;a++){var i=n[a];t.push(i.name),i.destroy()}return delete this.bmd.object[e],this.bmd.array=this.bmd.array.filter(function(t){return t.name!==e}),t},e.prototype.destroyGroup=function(e){for(var t=[],a=0,n=this.bmd.array.filter(function(e){return e.group===name});a<n.length;a++){var i=n[a];t.push(i.name),i.destroy()}return delete this.bmd.object[name],this.bmd.array=this.bmd.array.filter(function(e){return e.group!==name}),t},e.prototype.get=function(e){return this.bmd.object[e]},e.prototype.getGroup=function(e){return this.bmd.array.filter(function(t){return t.group===e})},e.prototype.getAll=function(e){return void 0===e&&(e="BOTH"),"ARRAY"===e?this.bmd.array:"OBJECT"==e?this.bmd.object:{object:this.bmd.object,array:this.bmd.array}},e.prototype.takeSnapshot=function(){return this.game.canvas.toDataURL()},e}(),PHASER_BUTTON_MANAGER=function(){function e(){this.game=null,this.resources={array:[],object:{}}}return e.prototype.assign=function(e){this.game=e.game},e.prototype.add=function(e){if(0===this.resources.array.filter(function(t){return t.name===e.name}).length){var t=this.game.add.button(e.x,e.y,e.reference,e.onclick);return t.name=e.name,t.group=e.group||null,this.resources.array.push(t),this.resources.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.destroy=function(e){for(var t=[],a=0,n=this.resources.array.filter(function(t){return t.key===e});a<n.length;a++){var i=n[a];t.push(i.key),i.destroy()}return delete this.resources.object[e],this.resources.array=this.resources.array.filter(function(t){return t.key!==e}),t},e.prototype.destroyGroup=function(e){for(var t=[],a=0,n=this.resources.array.filter(function(t){return t.group===e});a<n.length;a++){var i=n[a];t.push(i.key),i.destroy()}return delete this.resources.object[e],this.resources.array=this.resources.array.filter(function(t){return t.group!==e}),t},e.prototype.get=function(e){return this.resources.object[e]},e.prototype.getGroup=function(e){return this.resources.array.filter(function(t){return t.group===e})},e.prototype.getAll=function(e){return void 0===e&&(e="BOTH"),"ARRAY"===e?this.resources.array:"OBJECT"==e?this.resources.object:{object:this.resources.object,array:this.resources.array}},e}(),PHASER_CONTROLS=function(){function e(){this.IO=null,this.game=null,this.buttonSensitivity={QUICK:1,SHORT:50,LONG:150,SUPERLONG:300},this.releasedKeys=[],this.properties={isReady:!1,allowDebugger:!0,buttonDelay:50,timingRefreshRate:1},this.directionalButtons=["UP","DOWN","LEFT","RIGHT"],this.actionButtons=["A","B","X","Y"],this.triggerButtons=["L1","L2","R1","R2","L3","R3"],this.systemButtons=["START","BACK"],this.buttonArray=this.directionalButtons.concat(this.actionButtons,this.triggerButtons,this.systemButtons),this.buttonMap={UP:{name:"UP",code:"ArrowUp"},DOWN:{name:"DOWN",code:"ArrowDown"},LEFT:{name:"LEFT",code:"ArrowLeft"},RIGHT:{name:"RIGHT",code:"ArrowRight"},A:{name:"A",code:"KeyA"},B:{name:"S",code:"KeyS"},X:{name:"D",code:"KeyD"},Y:{name:"F",code:"KeyF"},L1:{name:"Q",code:"KeyQ"},L2:{name:"W",code:"KeyW"},R1:{name:"E",code:"KeyE"},R2:{name:"R",code:"KeyR"},L3:{name:"O",code:"KeyO"},R3:{name:"P",code:"KeyP"},START:{name:"ENTER",code:"Enter"},BACK:{name:"BACKSPACE",code:"Backspace"}},this.buttonMapId={UP:1,DOWN:2,LEFT:3,RIGHT:4,A:5,B:6,X:7,Y:8,L1:9,L2:10,R1:11,R2:12,L3:13,R3:14,START:15,BACK:16},this.disabledButtons={ALL:!1,DIRECTIONAL:!1,TRIGGER:!1,ACTION:!1,SYSTEM:!1},this.debugger={enabled:!1,text:{}},this.inputDelay={delay:Array.apply(null,Array(20)).map(function(){return 0})}}return e.prototype.assign=function(e){var t=this;this.game=e;var a={font:"12px Courier New",fill:"#fff",align:"left"};this.buttonArray.forEach(function(n,i){t.debugger.text[n]=null,t.debugger.text[n]=e.add.text(10,10+15*i,"",a),t.disabledButtons[n]=!1});for(var n={buttons:{},sensitivityPress:{},sensitivityBuffer:{},state:{}},i=function(a){n.buttons[a]=e.input.keyboard.addKey(Phaser.Keyboard[o.buttonMap[a].name]),n.sensitivityPress[a]=null,n.sensitivityBuffer[a]=0,n.state[a]=function(){return t.getBtnPressType(t.IO.sensitivityBuffer[a])}},o=this,r=0,s=this.buttonArray;r<s.length;r++){i(s[r])}for(var l=function(e){n.buttons[e].onDown.add(function(a){var i,o;clearInterval(n.sensitivityPress[e]);var r=["DIRECTIONAL","ACTION","TRIGGER","SYSTEM"];Object.keys(t.buttonMap).forEach(function(e,n){if(t.buttonMap[e].code===a.event.code)for(var s=0,l=r;s<l.length;s++){var h=l[s];t[h.toLowerCase()+"Buttons"].indexOf(e)+1&&(i=h,o=e)}});var s=!1;t.disabledButtons.ALL&&(s=!0);for(var l=0,h=r;l<h.length;l++){var u=h[l];t.disabledButtons[u]&&i===u&&(s=!0)}Object.keys(t.buttonMap).forEach(function(e,a){t.disabledButtons[e]&&o===e&&(s=!0)}),s||(n.sensitivityPress[e]=setInterval(function(){n.sensitivityBuffer[e]+=1},t.properties.timingRefreshRate))},h)},h=this,u=0,d=this.buttonArray;u<d.length;u++){l(d[u])}return e.input.keyboard.onUpCallback=function(e){for(var a=0,i=t.buttonArray;a<i.length;a++){var o=i[a];e.code===t.buttonMap[o].code&&(t.releasedKeys.push(t.buttonMap[o].code),setTimeout(function(){t.releasedKeys.shift()},1500),clearInterval(n.sensitivityPress[o]),n.sensitivityBuffer[o]=0)}"Backquote"===e.code&&t.properties.allowDebugger&&(t.setDebugger(!t.debugger.enabled),t.updateDebugger())},this.properties.isReady=!0,this.IO=n,n},e.prototype.mapKeys=function(e){var t=this;this.properties.isReady=!1,this.destroyAll(),setTimeout(function(){t.buttonMap=e,t.properties.isReady=!0,t.assign(t.game)},1)},e.prototype.isReady=function(){return this.properties.isReady},e.prototype.checkWithDelay=function(e){return this.read(e.key).active===e.isActive&&(this.game.time.now>this.inputDelay.delay[this.getKeyId(e.key)]&&(this.inputDelay.delay[this.getKeyId(e.key)]=e.delay+this.game.time.now,!0))},e.prototype.isDebuggerEnabled=function(){return this.debugger.enabled},e.prototype.setDebugger=function(e){void 0===e&&(e=!0),this.debugger.enabled=e},e.prototype.updateDebugger=function(){if(this.properties.isReady)for(var e=0,t=this.buttonArray;e<t.length;e++){var a=t[e];this.debugger.text[a].setText(this.debugger.enabled?this.debuggerString(a):"").bringToTop()}},e.prototype.disableAllInput=function(){this.disabledButtons.ALL=!0},e.prototype.enableAllInput=function(){this.disabledButtons.ALL=!1},e.prototype.disableAllDirectionalButtons=function(){this.disabledButtons.DIRECTIONAL=!0},e.prototype.enableAllDirectionalButtons=function(){this.disabledButtons.DIRECTIONAL=!1},e.prototype.disableAllTriggerButtons=function(){this.disabledButtons.TRIGGER=!0},e.prototype.enableAllTriggerButtons=function(){this.disabledButtons.TRIGGER=!1},e.prototype.disableAllActionButtons=function(){this.disabledButtons.ACTION=!0},e.prototype.enableAllActionButtons=function(){this.disabledButtons.ACTION=!1},e.prototype.disableAllSystemButtons=function(){this.disabledButtons.SYSTEM=!0},e.prototype.enableAllSystemButtons=function(){this.disabledButtons.SYSTEM=!1},e.prototype.setDisableKeyProperty=function(e,t){void 0===t&&(t=!0),this.properties.isReady&&(this.disabledButtons[e.toUpperCase()]=t)},e.prototype.getKeyDisabledValue=function(e){return this.properties.isReady?this.disabledButtons[e.toUpperCase()]:null},e.prototype.clearAllControlIntervals=function(){if(this.properties.isReady)for(var e=0,t=this.buttonArray;e<t.length;e++){var a=t[e];clearInterval(this.IO.sensitivityPress[a])}},e.prototype.getKeyId=function(e){return this.buttonMapId[e.toUpperCase()]},e.prototype.read=function(e){if(this.properties.isReady){return{}[e]={id:this.buttonMapId[e.toUpperCase()],active:this.IO.state[e.toUpperCase()]().val>0,duration:this.IO.state[e.toUpperCase()]().val,state:this.IO.state[e.toUpperCase()]().state,type:this.IO.state[e.toUpperCase()]().type,disabled:this.disabledButtons[e.toUpperCase()]}}return{}},e.prototype.readMulti=function(e,t){if(void 0===t&&(t="OBJECT"),this.properties.isReady){if("OBJECT"===t){for(var a={},n=0,i=e;n<i.length;n++){a[s=i[n]]={id:this.buttonMapId[s.toUpperCase()],active:this.IO.state[s.toUpperCase()]().val>0,duration:this.IO.state[s.toUpperCase()]().val,state:this.IO.state[s.toUpperCase()]().state,type:this.IO.state[s.toUpperCase()]().type,disabled:this.disabledButtons[s.toUpperCase()]}}return a}if("ARRAY"===t){a=[];for(var o=0,r=e;o<r.length;o++){var s=r[o];a.push({id:this.buttonMapId[s.toUpperCase()],key:s,active:this.IO.state[s.toUpperCase()]().val>0,duration:this.IO.state[s.toUpperCase()]().val,state:this.IO.state[s.toUpperCase()]().state,type:this.IO.state[s.toUpperCase()]().type,disabled:this.disabledButtons[s.toUpperCase()]})}return a}}},e.prototype.getReleasedKeys=function(){return this.releasedKeys},e.prototype.getOnly=function(e){for(var t=this,a={},n=function(n){e.map(function(e){n===e&&(a[n]={id:t.buttonMapId[n.toUpperCase()],active:t.IO.state[n.toUpperCase()]().val>0,duration:t.IO.state[n.toUpperCase()]().val,state:t.IO.state[n.toUpperCase()]().state,type:t.IO.state[n.toUpperCase()]().type,disabled:t.disabledButtons[n.toUpperCase()]})})},i=0,o=this.buttonArray;i<o.length;i++){n(o[i])}return a},e.prototype.getAll=function(){for(var e={},t=0,a=this.buttonArray;t<a.length;t++){var n=a[t];e[n]={id:this.buttonMapId[n.toUpperCase()],active:this.IO.state[n.toUpperCase()]().val>0,duration:this.IO.state[n.toUpperCase()]().val,state:this.IO.state[n.toUpperCase()]().state,type:this.IO.state[n.toUpperCase()]().type,disabled:this.disabledButtons[n.toUpperCase()]}}return e},e.prototype.debuggerString=function(e){return e.toUpperCase()+" ("+this.buttonMap[e.toUpperCase()].name+"/"+this.buttonMap[e.toUpperCase()].code+") | id: "+this.buttonMapId[e.toUpperCase()]+" duration: "+this.IO.state[e.toUpperCase()]().val+" | state: "+this.IO.state[e.toUpperCase()]().state+" | type: "+this.IO.state[e.toUpperCase()]().type+" | disabled: "+this.disabledButtons[e.toUpperCase()]},e.prototype.getBtnPressType=function(e){var t=this,a="NONE",n=0,i=0;return Object.keys(this.buttonSensitivity).forEach(function(o){i++,e>t.buttonSensitivity[o]&&(a=o,n=i)}),{val:e,type:a,state:n}},e.prototype.destroyAll=function(){var e=this;this.clearAllControlIntervals(),Object.keys(this.debugger.text).forEach(function(t){e.debugger.text[t].destroy()})},e}(),PHASER_GROUP_MANAGER=function(){function e(){this.game=null,this.group={array:[],object:{}}}return e.prototype.assign=function(e,t){void 0===t&&(t=10),this.game=e;for(var a=0;a<=t;a++){var n=e.add.group();this.group.object[""+a]=n,this.group.array.push(n)}},e.prototype.layer=function(e){return this.group.object[e]},e.prototype.add=function(e,t){this.group.object[e].add(t)},e.prototype.addMany=function(e,t){var a=this;t.forEach(function(t){a.group.object[e].add(t)})},e}(),PHASER_MASTER=function(){function e(e){this._game=e.game,this.resolution=e.resolution,this.states={BOOT:"BOOT",PRELOAD:"PRELOAD",READY:"READY"},this.currentState=this.states[0],this.variables={}}return e.prototype.let=function(e,t){if(void 0===t&&(t=null),void 0===this.variables[e])return this.variables[e]=t;console.log("Cannot LET duplicate key in PHASER_MASTER: "+e)},e.prototype.forceLet=function(e,t){return void 0===t&&(t=null),this.variables[e]=t},e.prototype.delete=function(e){delete this.variables[e]},e.prototype.get=function(e){return void 0!==this.variables[e]?this.variables[e]:(console.log("Cannot GET a variable that does not exist in PHASER_MASTER."),null)},e.prototype.getAll=function(){return this.variables},e.prototype.getOnly=function(e){var t={},a=[];for(var n in this.variables)a.push({key:n,data:this.variables[n]});for(var i=function(n){a.filter(function(t){return t.key===e[n]}).map(function(e){t[e.key]=e.data})},o=0;o<e.length;o++)i(o);return t},e.prototype.changeState=function(e){void 0===e&&(e=null);var t=e.toUpperCase(),a=!1;return void 0===this.states[t]&&(this.states[t]=t,a=!0),this.currentState=t,{created:a,state:this.currentState}},e.prototype.getCurrentState=function(){return this.currentState},e.prototype.getStates=function(){return this.states},e.prototype.getResolution=function(){return this.resolution},e.prototype.checkState=function(e){return this.currentState===e.toUpperCase()},e.prototype.getState=function(){return{currentState:this.currentState}},e.prototype.game=function(){return this._game},e}(),PHASER_MOUSE=function(){function e(e){this.game=null,this.clickSensitvity={QUICK:1,SHORT:50,LONG:150,SUPERLONG:300},this.mouseMapping=[0,1,2],this.mouseMap={LEFT:0,MIDDLE:1,RIGHT:2},this.metrics={sensitivityPress:{},sensitivityBuffer:{},location:{},state:{}},this.properties={allowDebugger:!0,timingRefreshRate:1},this.inputDelay={delay:Array.apply(null,Array(2)).map(function(){return 0})},this.debugger={enabled:void 0!==e.showDebugger&&e.showDebugger,text:{},pointer:null}}return e.prototype.assign=function(e){var t=this;this.game=e;for(var a=function(e){n.metrics.sensitivityPress[e]=null,n.metrics.sensitivityBuffer[e]=0,n.metrics.location[e]={x:null,y:null},n.metrics.state[e]=function(){return t.getBtnPressType(t.metrics.sensitivityBuffer[e])}},n=this,i=0,o=this.mouseMapping;i<o.length;i++){a(o[i])}this.game.input.onDown.add(function(e){var a=t.checkMouseClick();clearInterval(t.metrics.sensitivityPress[a]),t.metrics.sensitivityPress[a]=setInterval(function(){t.metrics.sensitivityBuffer[a]+=1,t.metrics.location[a]={x:e.x,y:e.y}},t.properties.timingRefreshRate)}),this.game.input.onUp.add(function(e){var a=t.checkMouseClick();t.clearAllControlIntervals(),t.metrics.sensitivityBuffer[a]=0});var r={font:"12px Courier New",fill:"#fff",align:"left"};this.mouseMapping.forEach(function(e,a){t.debugger.text[e]=null,t.debugger.text[e]=t.game.add.text(5,t.game.height-35-15*a,"",r)}),this.debugger.pointer=this.game.add.text(5,this.game.height-20,"",r),e.canvas.oncontextmenu=function(e){e.preventDefault()}},e.prototype.checkMouseClick=function(){var e=0;return this.game.input.activePointer.leftButton.isDown&&(e=0),this.game.input.activePointer.middleButton.isDown&&(e=1),this.game.input.activePointer.rightButton.isDown&&(e=2),e},e.prototype.debuggerString=function(e){return"Button_"+e+" | {x: "+this.metrics.location[e].x+", y: "+this.metrics.location[e].y+"} | active: "+(this.metrics.sensitivityBuffer[e]>0)+" | state: "+this.metrics.state[e]().state+" | duration: "+this.metrics.state[e]().val+" | type: "+this.metrics.state[e]().type},e.prototype.setDebugger=function(e){void 0===e&&(e=!0),this.debugger.enabled=e},e.prototype.updateDebugger=function(){for(var e=0,t=this.mouseMapping;e<t.length;e++){var a=t[e];this.debugger.text[a].setText(this.debugger.enabled?this.debuggerString(a):"").bringToTop()}this.debugger.pointer.setText(this.debugger.enabled?"Pointer: {x: "+this.game.input.mousePointer.x+", y: "+this.game.input.mousePointer.y+"}":"").bringToTop()},e.prototype.clearAllControlIntervals=function(){for(var e=0,t=this.mouseMapping;e<t.length;e++){var a=t[e];this.metrics.sensitivityBuffer[a]=0,clearInterval(this.metrics.sensitivityPress[a])}},e.prototype.checkWithDelay=function(e){if(this.read(e.key).active===e.isActive){var t=this.mouseMap[e.key.toUpperCase()];return this.game.time.now>this.inputDelay.delay[t]&&(this.inputDelay.delay[t]=e.delay+this.game.time.now,!0)}return!1},e.prototype.read=function(e){void 0===e&&(e="LEFT");var t=this.mouseMap[e.toUpperCase()];return{id:t,x:this.metrics.location[t].x,y:this.metrics.location[t].y,active:this.metrics.sensitivityBuffer[t]>0,duration:this.metrics.sensitivityBuffer[t],state:this.metrics.state[t]().state,type:this.metrics.state[t]().type}},e.prototype.getBtnPressType=function(e){var t=this,a="NONE",n=0,i=0;return Object.keys(this.clickSensitvity).forEach(function(o){i++,e>t.clickSensitvity[o]&&(a=o,n=i)}),{val:e,type:a,state:n}},e}(),PHASER_PRELOADER=function(){function e(e){this.game=e.game,this.init(e.delayInSeconds,e.done)}return e.prototype.init=function(e,t){var a,n,i=this;this.game.load.onLoadStart.add(function(){(a=i.game.add.text(i.game.world.centerX,i.game.world.centerY/2,"",{font:"18px Impact",fill:"#fff",align:"center"})).anchor.set(.5),(n=i.game.add.text(i.game.world.centerX,i.game.world.centerY,"",{font:"32px Impact",fill:"#fff",align:"center"})).anchor.set(.5)},this),this.game.load.onFileComplete.add(function(e,t,i,o,r){a.setText("Please wait..."),n.setText(e+"%")},this),this.game.load.onLoadComplete.add(function(){a.setText("File loaded!"),n.setText(""),i.game.time.events.add(Phaser.Timer.SECOND*e,function(){a.destroy(),n.destroy(),t()},i).autoDestroy=!0},this)},e}(),PHASER_SPRITE_MANAGER=function(){function e(){this.game=null,this.sprites={array:[],object:{}},this.spriteCount=0}return e.prototype.assign=function(e){this.game=e},e.prototype.add=function(e){if(0===this.sprites.array.filter(function(t){return t.name===e.name}).length){e.x=void 0!==e.x?e.x:0,e.y=void 0!==e.y?e.y:0,e.group=void 0!==e.group?e.group:null,e.visible=void 0===e.visible||e.visible,e.alpha=void 0!==e.alpha?e.alpha:1,e.width=void 0!==e.width?e.width:null,e.height=void 0!==e.height?e.height:null;var t=this.game.add.sprite(e.x,e.y,e.reference);return t.name=e.name,t.group=e.group,t.defaultPosition={x:e.x,y:e.y},t.visible=e.visible,t.alpha=e.alpha,null!==e.width&&(t.width=e.width),null!==e.height&&(t.height=e.height),t.setDefaultPositions=function(e,t){this.defaultPosition.x=e,this.defaultPosition.y=t},t.getDefaultPositions=function(){return this.defaultPosition},t.init=function(){},t.onUpdate=function(){},t.reveal=function(){},t.show=function(){this.visible=!0},t.hide=function(){this.visible=!1},this.sprites.array.push(t),this.sprites.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.addFromAtlas=function(e){if(0===this.sprites.array.filter(function(t){return t.name===e.name}).length){e.x=void 0!==e.x?e.x:0,e.y=void 0!==e.y?e.y:0,e.group=void 0!==e.group?e.group:null,e.visible=void 0===e.visible||e.visible,e.alpha=void 0!==e.alpha?e.alpha:1,e.width=void 0!==e.width?e.width:null,e.height=void 0!==e.height?e.height:null;var t=this.game.add.sprite(e.x,e.y,e.atlas,e.filename);return t.name=e.name,t.group=e.group,t.defaultPosition={x:e.x,y:e.y},t.visible=e.visible,t.alpha=e.alpha,null!==e.width&&(t.width=e.width),null!==e.height&&(t.height=e.height),t.setDefaultPositions=function(e,t){this.defaultPosition.x=e,this.defaultPosition.y=t},t.getDefaultPositions=function(){return this.defaultPosition},t.init=function(){},t.onUpdate=function(){},t.reveal=function(){},t.show=function(){this.visible=!0},t.hide=function(){this.visible=!1},this.sprites.array.push(t),this.sprites.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.addTilespriteFromAtlas=function(e){if(0===this.sprites.array.filter(function(t){return t.name===e.name}).length){e.x=void 0!==e.x?e.x:0,e.y=void 0!==e.y?e.y:0,e.group=void 0!==e.group?e.group:null,e.visible=void 0===e.visible||e.visible,e.alpha=void 0!==e.alpha?e.alpha:1,e.width=void 0!==e.width?e.width:null,e.height=void 0!==e.height?e.height:null;var t=this.game.add.tileSprite(e.x,e.y,e.width,e.height,e.atlas,e.filename);return t.name=e.name,t.group=e.group,t.defaultPosition={x:e.x,y:e.y},t.visible=e.visible,t.alpha=e.alpha,null!==e.width&&(t.width=e.width),null!==e.height&&(t.height=e.height),t.setDefaultPositions=function(e,t){this.defaultPosition.x=e,this.defaultPosition.y=t},t.getDefaultPositions=function(){return this.defaultPosition},t.init=function(){},t.onUpdate=function(){},t.reveal=function(){},t.show=function(){this.visible=!0},t.hide=function(){this.visible=!1},this.sprites.array.push(t),this.sprites.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.addEmptySprite=function(e){if(0===this.sprites.array.filter(function(t){return t.name===e.name}).length){e.x=void 0!==e.x?e.x:0,e.y=void 0!==e.y?e.y:0,e.group=void 0!==e.group?e.group:null,e.visible=void 0===e.visible||e.visible,e.alpha=void 0!==e.alpha?e.alpha:1,e.width=void 0!==e.width?e.width:null,e.height=void 0!==e.height?e.height:null;var t=this.game.add.sprite(e.x,e.y);return t.name=e.name,t.group=e.group,t.defaultPosition={x:e.x,y:e.y},t.visible=e.visible,t.alpha=e.alpha,null!==e.width&&(t.width=e.width),null!==e.height&&(t.height=e.height),t.setDefaultPositions=function(e,t){this.defaultPosition.x=e,this.defaultPosition.y=t},t.getDefaultPositions=function(){return this.defaultPosition},t.init=function(){},t.onUpdate=function(){},t.reveal=function(){},t.show=function(){this.visible=!0},t.hide=function(){this.visible=!1},this.sprites.array.push(t),this.sprites.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.createBasicMask=function(e,t,a,n){var i=this.game.add.graphics(0,0);return i.beginFill(16777215),i.drawRect(e,t,a,n),i},e.prototype.addBasicMaskToSprite=function(e){var t=this.game.add.graphics(0,0);return t.beginFill(16777215),t.drawRect(e.x,e.y,e.width,e.height),e.mask=t,t},e.prototype.destroy=function(e){if(void 0!==this.sprites.object[e]){for(var t=[],a=0,n=this.sprites.array.filter(function(t){return t.name===e});a<n.length;a++){var i=n[a];t.push(i.name),i.destroy()}return delete this.sprites.object[e],this.sprites.array=this.sprites.array.filter(function(t){return t.name!==e}),t}return console.log("Cannot delete "+e+" because it does not exist."),null},e.prototype.destroyGroup=function(e){for(var t=[],a=0,n=this.sprites.array.filter(function(t){return t.group===e});a<n.length;a++){var i=n[a];t.push(i.name),i.destroy()}return delete this.sprites.object[e],this.sprites.array=this.sprites.array.filter(function(t){return t.group!==e}),t},e.prototype.get=function(e){return this.sprites.object[e]},e.prototype.getGroup=function(e){return this.sprites.array.filter(function(t){return t.group===e})},e.prototype.getManyGroups=function(e){for(var t=[],a=function(a){var i=n.sprites.array.filter(function(t){return t.group===e[a]});t=t.concat(i)},n=this,i=0;i<e.length;i++)a(i);return t},e.prototype.getOnly=function(e){for(var t={},a=function(a){n.sprites.array.filter(function(t){return t.group===e[a]||t.name===e[a]}).map(function(e){t[e.name]=e})},n=this,i=0;i<e.length;i++)a(i);return t},e.prototype.getAll=function(e){return void 0===e&&(e="OBJECT"),"ARRAY"===e?this.sprites.array:"OBJECT"==e?this.sprites.object:{object:this.sprites.object,array:this.sprites.array}},e.prototype.count=function(){return this.spriteCount++,{total:this.sprites.array.length,unique:this.spriteCount}},e.prototype.centerWorld=function(e){if(void 0===this.sprites.object[e])return console.log("Error centering sprite:  key does not exists."),null;var t=this.sprites.object[e];return t.alignIn(this.game.world.bounds,Phaser.CENTER),t},e.prototype.centerOnPoint=function(e,t,a){if(void 0===this.sprites.object[e])return console.log("Error centering sprite:  key does not exists."),null;var n=this.sprites.object[e];return n.x=t-n.width/2,n.y=a-n.height/2,n},e}(),PHASER_TEXT_MANAGER=function(){function e(){this.game=null,this.texts={array:[],object:{}}}return e.prototype.assign=function(e){this.game=e},e.prototype.add=function(e){var t=this.texts.array.filter(function(t){return t.name===e.name});if(e.x=void 0!==e.x?e.x:0,e.y=void 0!==e.y?e.y:0,e.group=void 0!==e.group?e.group:null,e.size=void 0!==e.size?e.size:12,e.default=void 0!==e.default?e.default:"",e.visible=void 0===e.visible||e.visible,e.alpha=void 0!==e.alpha?e.alpha:1,0===t.length){var a=this.game.add.bitmapText(e.x,e.y,e.font,e.default,e.size);return a.name=e.name,a.group=e.group,a.visible=e.visible,a.alpha=e.alpha,a.show=function(){this.visible=!0},a.hide=function(){this.visible=!1},this.texts.array.push(a),this.texts.object[e.name]=a,a}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.destroy=function(e){for(var t=[],a=0,n=this.texts.array.filter(function(t){return t.name===e});a<n.length;a++){var i=n[a];t.push(i.name),i.destroy()}return delete this.texts.object[e],this.texts.array=this.texts.array.filter(function(t){return t.name!==e}),t},e.prototype.destroyGroup=function(e){for(var t=[],a=0,n=this.texts.array.filter(function(t){return t.group===e});a<n.length;a++){var i=n[a];t.push(i.key),i.destroy()}return delete this.texts.object[e],this.texts.array=this.texts.array.filter(function(t){return t.group!==e}),t},e.prototype.get=function(e){return this.texts.object[e]},e.prototype.getGroup=function(e){return this.texts.array.filter(function(t){return t.group===e})},e.prototype.getManyGroups=function(e){for(var t=[],a=function(a){var i=n.texts.array.filter(function(t){return t.group===e[a]});t=t.concat(i)},n=this,i=0;i<e.length;i++)a(i);return t},e.prototype.getAll=function(e){return void 0===e&&(e="OBJECT"),"ARRAY"===e?this.texts.array:"OBJECT"==e?this.texts.object:{object:this.texts.object,array:this.texts.array}},e.prototype.getOnly=function(e){for(var t={},a=function(a){n.texts.array.filter(function(t){return t.group===e[a]||t.name===e[a]}).map(function(e){t[e.name]=e})},n=this,i=0;i<e.length;i++)a(i);return t},e.prototype.alignToBottomLeftCorner=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=t,a.y=n.canvas.height-a.height-t,a},e.prototype.alignToBottomCenter=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=n.canvas.width/2-a.width/2,a.y=n.canvas.height-a.height-t,a},e.prototype.alignToBottomRightCorner=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=n.canvas.width-a.width-t,a.y=n.canvas.height-a.height-t,a},e.prototype.alignToCenterRight=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=n.canvas.width-a.width-t,a.y=n.canvas.height/2-a.height/2,a},e.prototype.alignToTopRightCorner=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=n.canvas.width-a.width-t,a.y=t,a},e.prototype.alignToTopCenter=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=n.canvas.width/2-a.width/2-t,a.y=t,a},e.prototype.alignToTopLeftCorner=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e];this.game;return a.x=t,a.y=t,a},e.prototype.alignToCenterLeft=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=t,a.y=n.canvas.height/2-a.height/2,a},e.prototype.alignToCenter=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=n.canvas.width/2-a.width/2,a.y=n.canvas.height/2-a.height/2,a},e.prototype.center=function(e,t,a){if(void 0===t&&(t=0),void 0===a&&(a=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var n=this.texts.object[e],i=this.game;return n.x=i.canvas.width/2-n.width/2+t,n.y=i.canvas.height/2-n.height/2+a,n},e}(),ENEMY_MANAGER=function(){function e(e){this.showHitbox=e.showHitbox}return e.prototype.assign=function(e,t,a,n,i,o,r,s){this.game=e,this.phaserSprites=a,this.phaserMaster=t,this.phaserTexts=n,this.phaserGroup=i,this.weaponManager=o,this.atlas=r,this.atlas_weapons=s},e.prototype.collisionCheck=function(e,t){this.phaserSprites.getManyGroups(["playership"]).map(function(a){a.game.physics.arcade.overlap(e,a,function(e,a){a.takeDamage(t),e.destroyIt()},null,e)})},e.prototype.fireBullet=function(e,t){var a=this;void 0===t&&(t=!1);Phaser.Animation.generateFrameNames("e_bullet",1,1,".png").slice();this.weaponManager.createBullet({name:"enemy_bullet_"+this.game.rnd.integer(),group:"enemy_bullets",x:e.x,y:e.y,spread:0,layer:e.onLayer+1},function(){},function(e){a.collisionCheck(e,2)}).body.velocity.y=300},e.prototype.createSmallEnemy1=function(e,t,a,n,i){var o=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===n&&(n=function(){}),void 0===i&&(i=function(){});var r=this.game,s=(this.phaserMaster,this.phaserSprites),l=this.phaserGroup,h=this.atlas,u=s.addFromAtlas({x:e.x,name:"enemy_"+r.rnd.integer(),group:"enemies",atlas:h,filename:"small_1.png",visible:!0});u.anchor.setTo(.5,.5),u.scale.setTo(1,1),r.physics.enable(u,Phaser.Physics.ARCADE),u.atTarget=!1,u.maxHealth=100,u.health=u.maxHealth,u.pierceResistence=1,u.fallThreshold=r.rnd.integerInRange(0,75),u.cosWave={data:r.math.sinCosGenerator(400,.8*r.world.height,0,1).cos,count:0},u.sinWave={data:r.math.sinCosGenerator(400,200,1,10).sin,count:0},u.fireDelay=0,u.fireTimer=500,u.inPlace=!1,u.isDestroyed=!1,u.onLayer=e.layer,l.add(e.layer,u),console.log(u.sinWave);return["small_1_hitbox_1.png"].map(function(e){var t=s.addFromAtlas({name:"enemy_hitbox_"+r.rnd.integer(),group:"enemy_hitboxes",atlas:h,filename:e,alpha:o.showHitbox?.75:0});t.anchor.setTo(.5,.5),r.physics.enable(t,Phaser.Physics.ARCADE),u.addChild(t)}),u.damageIt=function(e){t(u),u.atTarget||(u.health-=e,u.tint=16711680,u.game.add.tween(u).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),u.health<=0&&u.destroyIt())},u.removeIt=function(){s.destroy(u.name)},u.destroyIt=function(){u.children.map(function(e){o.phaserSprites.destroy(e.name)}),u.isDestroyed||(u.isDestroyed=!0,u.tint=16711680,u.explodeInterval=setInterval(function(){o.weaponManager.createExplosion(u.x+r.rnd.integerInRange(-u.width/2,u.width/2),u.y+r.rnd.integerInRange(-u.height/2,u.height/2),1,u.onLayer+1)},100),u.game.add.tween(u).to({y:u.y-15,alpha:.5},750,Phaser.Easing.Linear.Out,!0,100,0,!1).onComplete.add(function(){clearInterval(u.explodeInterval),a(u),o.weaponManager.createExplosion(u.x,u.y,1,e.layer+1),s.destroy(u.name)}))},u.onUpdate=function(){i(u),r.time.now>u.fireDelay&&u.inPlace&&(u.fireDelay=r.time.now+u.fireTimer,o.fireBullet(u,!0)),u.isDestroyed?u.inPlace=!0:(u.y=-u.cosWave.data[u.cosWave.count]-u.height,u.x=u.sinWave.data[u.sinWave.count]+100,u.cosWave.count++,u.sinWave.count++,u.cosWave.count>=u.cosWave.data.length&&u.removeIt())},u.removeIt=function(){s.destroy(u.name)},u},e.prototype.createBigEnemy1=function(e,t,a,n,i){var o=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===n&&(n=function(){}),void 0===i&&(i=function(){});var r=this.game,s=(this.phaserMaster,this.phaserSprites),l=this.phaserGroup,h=this.atlas,u=s.addFromAtlas({x:e.x,name:"enemy_"+r.rnd.integer(),group:"enemies",atlas:h,filename:"big_1.png",visible:!0});u.anchor.setTo(.5,.5),u.scale.setTo(1,1),r.physics.enable(u,Phaser.Physics.ARCADE),u.atTarget=!1,u.maxHealth=1500,u.health=u.maxHealth,u.pierceResistence=4,u.fallThreshold=r.rnd.integerInRange(0,75),u.sinWave=r.math.sinCosGenerator(400+e.y,r.world.height/2,1,1),u.count=0,u.fireDelay=0,u.fireTimer=500,u.inPlace=!1,u.isDestroyed=!1,u.onLayer=e.layer,l.add(e.layer,u);return["big_1_hitbox_1.png","big_1_hitbox_2.png"].map(function(e){var t=s.addFromAtlas({name:"enemy_hitbox_"+r.rnd.integer(),group:"enemy_hitboxes",atlas:h,filename:e,alpha:o.showHitbox?.75:0});t.anchor.setTo(.5,.5),r.physics.enable(t,Phaser.Physics.ARCADE),u.addChild(t)}),u.damageIt=function(e){t(u),u.atTarget||(u.health-=e,u.tint=16711680,u.game.add.tween(u).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),u.health<=0&&u.destroyIt())},u.removeIt=function(){s.destroy(u.name)},u.destroyIt=function(){u.children.map(function(e){o.phaserSprites.destroy(e.name)}),u.isDestroyed||(u.isDestroyed=!0,u.tint=16711680,u.explodeInterval=setInterval(function(){o.weaponManager.createExplosion(u.x+r.rnd.integerInRange(-u.width/2,u.width/2),u.y+r.rnd.integerInRange(-u.height/2,u.height/2),1,u.onLayer+1)},100),u.game.add.tween(u).to({y:u.y-15,alpha:.5},750,Phaser.Easing.Linear.Out,!0,100,0,!1).onComplete.add(function(){clearInterval(u.explodeInterval),a(u),o.weaponManager.createExplosion(u.x,u.y,1,e.layer+1),s.destroy(u.name)}))},u.onUpdate=function(){i(u),r.time.now>u.fireDelay&&u.inPlace&&(u.fireDelay=r.time.now+u.fireTimer,o.fireBullet(u,!0)),!u.isDestroyed&&u.count<u.sinWave.cos.length/2?(u.y=-u.sinWave.cos[u.count]-u.height,u.count++):u.inPlace=!0},u.removeIt=function(){s.destroy(u.name)},u},e.prototype.createAsteroid=function(e,t,a,n,i){var o=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===n&&(n=function(){}),void 0===i&&(i=function(){});var r=this.game,s=(this.phaserMaster,this.phaserSprites),l=this.phaserGroup,h=this.atlas,u=s.addFromAtlas({x:e.x,y:e.y,name:"enemy_"+r.rnd.integer(),group:"enemies",atlas:h,filename:"asteroid_mid_layer_"+r.rnd.integerInRange(1,3)+".png",visible:!0});u.anchor.setTo(.5,.5),u.scale.setTo(1.5,1.5),r.physics.enable(u,Phaser.Physics.ARCADE),u.body.velocity.y=e.iy,u.body.velocity.x=e.ix,u.angleMomentum=r.rnd.integerInRange(-5,5),u.body.bounce.setTo(1,1),u.atTarget=!1,u.maxHealth=150,u.health=u.maxHealth,u.pierceResistence=4,u.fallThreshold=r.rnd.integerInRange(0,75),l.add(e.layer,u);return["1_hitbox_1.png","1_hitbox_2.png"].map(function(e){var t=s.addFromAtlas({name:"enemy_hitbox_"+r.rnd.integer(),group:"enemy_hitboxes",atlas:h,filename:e,alpha:o.showHitbox?.75:0});t.anchor.setTo(.5,.5),t.destroyIt=function(e){e.body=null,o.phaserSprites.destroy(e.name)},r.physics.enable(t,Phaser.Physics.ARCADE),u.addChild(t)}),u.damageIt=function(e,a){void 0===a&&(a=null),t(u),u.atTarget||(u.health-=e,u.tint=16711680,u.game.add.tween(u).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),u.health<=0&&u.destroyIt())},u.destroyIt=function(){var t={angle:r.rnd.integerInRange(-720,720),x:u.x-r.rnd.integerInRange(-25,25),y:u.y-r.rnd.integerInRange(5,25),alpha:.5};u.game.add.tween(u).to(t,r.rnd.integerInRange(150,500),Phaser.Easing.Linear.Out,!0,0,0,!1),u.body=null,r.time.events.add(Phaser.Timer.SECOND/2,function(){a(u),o.weaponManager.createExplosion(u.x,u.y,1,e.layer+1),s.destroy(u.name)},u).autoDestroy=!0},u.fallToPlanet=function(){u.tint=0,u.atTarget=!0,u.body=null,u.game.add.tween(u).to({y:u.y+60},2*Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,0).autoDestroy=!0,setTimeout(function(){o.game.add.tween(u.scale).to({x:0,y:0},1*Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,r.rnd.integerInRange(0,500)).onComplete.add(function(){n(u),u.removeIt(),o.weaponManager.createExplosion(u.x,u.y,.25,6)}).autoDestroy=!0},300)},u.checkLocation=function(){u.angle+=u.angleMomentum,u.angleMomentum>0&&(u.angleMomentum-=.002),u.angleMomentum<0&&(u.angleMomentum+=.002),u.y>u.height&&null!==u.body&&(u.body.collideWorldBounds=!0),u.y>o.game.canvas.height-(75+u.fallThreshold)&&(null===u.body||u.atTarget||(u.body.collideWorldBounds=!1,u.fallToPlanet()))},u.onUpdate=function(){i(u),r.physics.arcade.collide([s.get("leftBoundry"),s.get("rightBoundry")],u),u.rotate+=2,u.atTarget||(null!==u.body&&(u.body.velocity.y+2<100&&(u.body.velocity.y+=2),u.body.velocity.x>0&&(u.body.velocity.x-=.2),u.body.velocity.x<0&&(u.body.velocity.x+=.2)),u.checkLocation())},u.removeIt=function(){s.destroy(u.name)},u},e.prototype.createDebris=function(e,t,a,n,i){var o=this;void 0===t&&(t=function(e){}),void 0===a&&(a=function(e){}),void 0===n&&(n=function(e){}),void 0===i&&(i=function(e){});var r=this.game,s=(this.phaserMaster,this.phaserSprites),l=this.phaserGroup,h=this.atlas,u=s.addFromAtlas({x:e.x,y:e.y,name:"enemy_"+r.rnd.integer(),group:"enemies",atlas:h,filename:"asteroid_mid_layer_"+r.rnd.integerInRange(1,3)+".png",visible:!0});u.anchor.setTo(.5,.5),u.scale.setTo(1,1),r.physics.enable(u,Phaser.Physics.ARCADE),u.body.velocity.y=e.iy,u.body.velocity.x=e.ix,u.angleMomentum=r.rnd.integerInRange(-5,5),u.body.bounce.setTo(1,1),u.atTarget=!1,u.maxHealth=50,u.health=u.maxHealth,u.pierceResistence=1,u.fallThrehold=r.rnd.integerInRange(0,75),l.add(e.layer,u),u.damageIt=function(e,t){void 0===t&&(t=null),u.health-=e,u.tint=16711680,u.game.add.tween(u).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),u.health<=0&&u.destroyIt(u)},u.removeIt=function(){s.destroy(u.name)},u.fallToPlanet=function(){u.tint=0,u.atTarget=!0,u.body=null,u.game.add.tween(u).to({y:u.y+60},2*Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,0).autoDestroy=!0,setTimeout(function(){o.game.add.tween(u.scale).to({x:0,y:0},1*Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,r.rnd.integerInRange(0,500)).onComplete.add(function(){n(u),u.removeIt(),o.weaponManager.createExplosion(u.x,u.y,.25,6)}).autoDestroy=!0},300)},u.destroyIt=function(){var e={angle:r.rnd.integerInRange(-720,720),x:u.x-r.rnd.integerInRange(-25,25),y:u.y-r.rnd.integerInRange(5,25),alpha:.5};u.game.add.tween(u).to(e,r.rnd.integerInRange(50,200),Phaser.Easing.Linear.Out,!0,0,0,!1),u.body=null,r.time.events.add(Phaser.Timer.SECOND/3,function(){a(u),o.weaponManager.createExplosion(u.x,u.y,.5,6),s.destroy(u.name)},u).autoDestroy=!0},u.checkLocation=function(){u.angle+=u.angleMomentum,u.angleMomentum>0&&(u.angleMomentum-=.002),u.angleMomentum<0&&(u.angleMomentum+=.002),u.y>u.height&&null!==u.body&&(u.body.collideWorldBounds=!0),u.y>o.game.canvas.height-(50+u.fallThrehold)&&(null===u.body||u.atTarget||(u.body.collideWorldBounds=!1,u.fallToPlanet())),u.y>o.game.canvas.height+u.height&&u.removeIt()},u.onUpdate=function(){r.physics.arcade.collide([s.get("leftBoundry"),s.get("rightBoundry")],u),u.rotate+=4,null!==u.body&&(u.body.velocity.y+1<50&&(u.body.velocity.y+=1),u.body.velocity.x>0&&(u.body.velocity.x-=.2),u.body.velocity.x<0&&(u.body.velocity.x+=.2)),u.checkLocation()}},e.prototype.createGiantAsteroid=function(e,t,a,n,i){var o=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===n&&(n=function(){}),void 0===i&&(i=function(){});var r=this.game,s=(this.phaserMaster,this.phaserSprites),l=this.phaserGroup,h=this.atlas,u=s.addFromAtlas({x:e.x,y:e.y,name:"enemy_"+r.rnd.integer(),group:"boss",atlas:h,filename:"asteroid_large_layer_"+r.rnd.integerInRange(1,3)+".png",visible:!0});return u.anchor.setTo(.5,.5),r.physics.enable(u,Phaser.Physics.ARCADE),u.body.velocity.y=e.iy,u.body.velocity.x=e.ix,u.angleMomentum=r.rnd.integerInRange(-5,5),u.body.bounce.setTo(1,1),u.atTarget=!1,u.maxHealth=5e3,u.health=u.maxHealth,u.pierceResistence=50,l.add(e.layer,u),u.damageIt=function(e,a){void 0===a&&(a=null),t(u),u.atTarget||(u.health-=e,u.tint=16711680,u.game.add.tween(u).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),u.health<=0&&u.destroyIt())},u.destroyIt=function(t){void 0===t&&(t=!0);var n={angle:720,x:u.x-r.rnd.integerInRange(-10,10),y:u.y-r.rnd.integerInRange(10,10),alpha:.15};u.game.add.tween(u).to(n,2*Phaser.Timer.SECOND,Phaser.Easing.Linear.Out,!0,0,0,!1),u.game.add.tween(u.scale).to({x:.5,y:.5},2*Phaser.Timer.SECOND,Phaser.Easing.Linear.Out,!0,0,0,!1),u.body=null,r.time.events.add(Phaser.Timer.SECOND/2,function(){a(u),o.weaponManager.createImpactExplosion(u.x,u.y,2.5,e.layer+1),s.destroy(u.name)},u).autoDestroy=!0},u.fallToPlanet=function(){u.tint=0,u.atTarget=!0,u.body=null,u.game.add.tween(u).to({y:u.y+60},2*Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,0).autoDestroy=!0,setTimeout(function(){o.game.add.tween(u.scale).to({x:0,y:0},1*Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,r.rnd.integerInRange(0,500)).onComplete.add(function(){n(u),u.removeIt(),o.weaponManager.createExplosion(u.x,u.y,.25,6)}).autoDestroy=!0},300)},u.checkLocation=function(){u.angle+=u.angleMomentum,u.angleMomentum>0&&(u.angleMomentum-=.002),u.angleMomentum<0&&(u.angleMomentum+=.002),u.y>u.height&&null!==u.body&&(u.body.collideWorldBounds=!0),u.y>u.game.canvas.height-u.height&&(null===u.body||u.atTarget||(u.body.collideWorldBounds=!1,u.fallToPlanet()))},u.onUpdate=function(){i(u),r.physics.arcade.collide([s.get("leftBoundry"),s.get("rightBoundry")],u),u.rotate+=2,u.atTarget||(null!==u.body&&(u.body.velocity.y+1<25&&(u.body.velocity.y+=1),u.body.velocity.x>0&&(u.body.velocity.x-=.2),u.body.velocity.x<0&&(u.body.velocity.x+=.2)),u.checkLocation())},u.removeIt=function(){s.destroy(u.name)},u},e}(),PLAYER_MANAGER=function(){function e(){}return e.prototype.assign=function(e,t,a,n,i,o,r,s,l){this.game=e,this.phaserSprites=a,this.phaserMaster=t,this.phaserTexts=n,this.phaserGroup=i,this.phaserControls=o,this.weaponManager=r,this.atlas=s,this.weaponAtlas=l,this.player=null},e.prototype.createShip=function(e,t,a,n){var i=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===n&&(n=function(){});var o=this.game,r=e.shipId+1,s=(Phaser.Animation.generateFrameNames("ship_"+r+"_shield_",1,6,".png").concat(Phaser.Animation.generateFrameNames("ship_"+r+"_shield_",1,6,".png").reverse()),Phaser.Animation.generateFrameNames("ship_"+r+"_heal_",1,6,".png").concat(Phaser.Animation.generateFrameNames("ship_"+r+"_heal_",1,6,".png").reverse()),this.phaserSprites.addFromAtlas({name:e.name,group:e.group,atlas:this.atlas,filename:"ship_"+r+".png",visible:!1}));return s.anchor.setTo(.5,.5),s.scale.setTo(1,1),s.isInvincible=!1,s.isDead=!1,s.onLayer=e.layer,s.exhaustPoints={center:40,top:25,bottom:50},o.physics.enable(s,Phaser.Physics.ARCADE),this.phaserGroup.add(e.layer,s),this.createShipExhaust(s,e),s.onUpdate=function(){n(s),s.visible&&!s.isDead&&s.createTrail()},s.takeDamage=function(e){var n=i.phaserMaster.getOnly(["gameData"]).gameData.player.health-e;t(n),n>0?(s.tint=16711680,s.alpha=.75,s.game.add.tween(s).to({tint:16777215,alpha:1},100,Phaser.Easing.Linear.Out,!0,100,0,!1).onComplete.add(function(){setTimeout(function(){s.isInvincible=!1},500)})):a(s)},s.isDestroyed=function(){s.isDead=!0,i.weaponManager.createExplosion(s.x,s.y,1,6),o.add.tween(i).to({angle:o.rnd.integerInRange(-90,90),alpha:0},1e3,Phaser.Easing.Linear.In,!0,0).onComplete.add(function(){i.weaponManager.createExplosion(s.x,s.y,1,6),s.visible=!1,setTimeout(function(){t(100),s.moveToStart()},1e3)})},s.createTrail=function(){var t=i.phaserMaster.getState().currentState;if(i.phaserSprites.getGroup(e.name+"_trails").length<("ENDLEVEL"===t)||10){var a=i.phaserSprites.addFromAtlas({name:e.name+"_trail_"+o.rnd.integer(),group:e.name+"_trails",x:s.x,y:s.y,filename:"ship_body.png",atlas:"atlas_main",visible:!0});a.anchor.setTo(.5,.5),a.scale.setTo(s.scale.x-.2,s.scale.y-.2),a.alpha=.4,a.angle=s.angle,a.tint=255,i.phaserGroup.add(e.layer-1,a),a.destroySelf=function(){a.game.add.tween(a).to({alpha:0},"ENDLEVEL"===t?600:250,Phaser.Easing.Linear.In,!0,0).onComplete.add(function(){i.phaserSprites.destroy(a.name)},a)},a.destroySelf()}},s.selfDestruct=function(){s.isInvincible=!0,i.phaserSprites.get("exhaust").destroyIt(),o.add.tween(s).to({angle:720},3400,Phaser.Easing.Linear.In,!0,0).onComplete.add(function(){i.phaserSprites.destroy(s.name),i.weaponManager.createExplosion(s.x,s.y,.5,6)},i)},s.moveToStart=function(){s.isDead=!1,s.angle=0,s.alpha=1,s.visible=!0,s.isInvincible=!0,s.x=i.game.world.centerX,s.y=i.game.world.centerY+550,o.add.tween(s).to({y:o.world.centerY+200},1e3,Phaser.Easing.Exponential.InOut,!0,0,0,!1).onComplete.add(function(){i.phaserControls.enableAllInput(),setTimeout(function(){s.isInvincible=!1},1e3)})},s.fireWeapon=function(){i.phaserSprites.get(e.name+"_ship_weapon").fireWeapon()},s.fireSubweapon=function(){i.phaserSprites.get(e.name+"_ship_subweapon").fireWeapon()},s.regenerateHealth=function(e){void 0===e&&(e=!1)},s.moveX=function(e){s.x+=e,s.checkLimits()},s.moveY=function(e){s.y+=e,s.checkLimits()},s.checkLimits=function(){this.y-this.height<0&&(this.y=this.height),this.y+this.height>this.game.canvas.height&&(this.y=this.game.canvas.height-this.height),this.x<0&&(this.x=this.game.canvas.width+this.width),this.x>this.game.canvas.width+this.width&&(this.x=0)},s.playEndSequence=function(e){s.isInvincible=!0,s.game.add.tween(s.scale).to({x:2,y:2},750,Phaser.Easing.Exponential.InOut,!0,0,0,!1),s.game.add.tween(s).to({x:o.world.centerX,y:o.world.centerY+50},750,Phaser.Easing.Exponential.InOut,!0,0,0,!1).onComplete.add(function(){s.game.add.tween(s).to({y:o.world.height+200},750,Phaser.Easing.Exponential.InOut,!0,100,0,!1).onComplete.add(function(){s.game.add.tween(s).to({y:-200},1e3,Phaser.Easing.Exponential.InOut,!0,0,0,!1).onComplete.add(function(){e()},s)},s)},s)},s.attachPerk=function(t){i.attachPerk(s,e,t)},s.attachWeapon=function(t){i.attachWeaponSprite(s,e,t)},s.attachSubweapon=function(t){i.attachSubWeaponSprite(s,e,t)},this.player=s,s},e.prototype.attachPerk=function(e,t,a){var n,i,o,r=this;switch(a){case"FIREPOWER":n=Phaser.Animation.generateFrameNames("firepower_",1,8,".png").concat(Phaser.Animation.generateFrameNames("firepower_",1,8,".png").reverse()),i=30;break;case"ARMORPLATING":n=["armor_plating.png"],i=30;break;case"REGEN":n=Phaser.Animation.generateFrameNames("shield_layer_",1,8,".png").slice(),i=30}void 0!==this.phaserSprites.get(t.name+"_ship_perk")&&this.phaserSprites.destroy(t.name+"_ship_perk"),"REGEN"===a?((o=this.phaserSprites.addFromAtlas({name:t.name+"_ship_perk",group:t.group,atlas:this.atlas,filename:n[0],alpha:.5})).anchor.setTo(.5,.5),o.scale.set(1.25,1.25),o.tweenFadeIn=function(){r.game.add.tween(o).to({alpha:.8},1e3,Phaser.Easing.Linear.In,!0,8e3).onComplete.add(function(){e.regenerateHealth(!0),o.tweenFadeOut()})},o.tweenFadeOut=function(){r.game.add.tween(o).to({alpha:0},1e3,Phaser.Easing.Linear.In,!0,1e3).onComplete.add(function(){e.regenerateHealth(!1),o.tweenFadeIn()})},setTimeout(function(){void 0!==o&&o.tweenFadeOut()},500),o.animations.add("animate",n,1,!0),o.animations.play("animate",i,!0),e.addChild(o)):((o=this.phaserSprites.addFromAtlas({name:t.name+"_ship_perk",group:t.group,atlas:this.atlas,filename:n[0],visible:!0})).anchor.setTo(.5,.5),o.animations.add("animate",n,1,!0),o.animations.play("animate",i,!0),e.addChild(o))},e.prototype.attachSubWeaponSprite=function(e,t,a){var n,i;switch(a){case"CLUSTERBOMB":n=Phaser.Animation.generateFrameNames("cannon_fire_",1,8,".png").slice(),i=20;break;case"TRIPLEBOMB":n=Phaser.Animation.generateFrameNames("cannon2_fire_",1,7,".png").concat(["cannon2_fire_1.png"]),i=60;break;case"TURRET":n=["turret_base.png"],i=30}void 0!==this.phaserSprites.get(t.name+"_ship_subweapon")&&this.phaserSprites.destroy(t.name+"_ship_subweapon");var o=this.phaserSprites.addFromAtlas({name:t.name+"_ship_subweapon",group:t.group,atlas:this.weaponAtlas,filename:n[0],visible:!0});o.anchor.setTo(.5,.5),o.animations.add("fireWeapon",n,1,!0),o.fireWeapon=function(){o.animations.play("fireWeapon",i,!1)},e.addChild(o)},e.prototype.attachWeaponSprite=function(e,t,a){var n,i;switch(a){case"BULLET":n=Phaser.Animation.generateFrameNames("bullet_fire_",1,4,".png").slice(),i=60;break;case"LASER":n=Phaser.Animation.generateFrameNames("laser_fire_",1,6,".png").slice(),i=60;break;case"MISSLE":n=Phaser.Animation.generateFrameNames("missle_fire_",1,6,".png").slice(),i=30}void 0!==this.phaserSprites.get(t.name+"_ship_weapon")&&this.phaserSprites.destroy(t.name+"_ship_weapon");var o=this.phaserSprites.addFromAtlas({name:t.name+"_ship_weapon",group:t.group,atlas:this.weaponAtlas,filename:n[0],visible:!0});o.anchor.setTo(.5,.5),o.animations.add("fireWeapon",n,1,!0),o.fireWeapon=function(){o.animations.play("fireWeapon",i,!1)},e.addChild(o)},e.prototype.createShipExhaust=function(e,t){var a=this,n=this.phaserSprites.addFromAtlas({name:t.name+"_exhaust",group:t.group,x:e.x,y:e.y+e.height/2+10,atlas:this.atlas,filename:"exhaust_red_1.png",visible:!0});n.animations.add("exhaust_animation",Phaser.Animation.generateFrameNames("exhaust_red_",1,8,".png"),1,!0),n.animations.play("exhaust_animation",30,!0),n.anchor.setTo(.5,.5),e.addChild(n),n.onUpdate=function(){},n.updateCords=function(e,t){},n.destroyIt=function(){a.phaserSprites.destroy(n.name)}},e.prototype.destroyShip=function(e){this.phaserSprites.destroy(e),this.phaserSprites.destroy(e+"_exhaust"),this.phaserSprites.getGroup(e+"_trails").map(function(e){e.destroySelf()})},e}(),UTILITY_MANAGER=function(){function e(){}return e.prototype.assign=function(e,t,a,n,i){this.game=e,this.phaserSprites=t,this.phaserBitmapdata=a,this.phaserGroup=n,this.atlas=i},e.prototype.buildOverlayBackground=function(e,t,a,n){void 0===n&&(n=!1);var i=this.game,o=this.phaserBitmapdata.addGradient({name:"um_overlay__bmd",start:e,end:t,width:5,height:5,render:!1}),r=this.phaserSprites.add({x:0,y:0,name:"um_overlay__bg",width:i.world.width,height:i.world.height,reference:o.cacheBitmapData,visible:n});r.fadeIn=function(e,t){void 0===e&&(e=500),void 0===t&&(t=function(){}),r.visible=!0,r.alpha=0,i.add.tween(r).to({alpha:1},e,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){t()})},r.fadeOut=function(e,t){void 0===e&&(e=500),void 0===t&&(t=function(){}),r.visible=!0,r.alpha=1,i.add.tween(r).to({alpha:0},e,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){t()})},this.phaserGroup.add(a,r)},e.prototype.buildOverlayGrid=function(e,t,a,n){void 0===e&&(e=80),void 0===t&&(t=80);for(var i=this.game,o=0,r=0;r<Math.ceil(i.world.height/t)+1;r++)for(var s=function(s){var h=l.phaserSprites.addFromAtlas({x:s*e,y:r*t,name:"grid"+o,group:"um_grid__bg",width:e,height:t,atlas:l.atlas,filename:n,visible:!0});h.anchor.setTo(.5,.5),h.scale.setTo(1,1),h.fadeOut=function(e){h.scale.setTo(1,1),i.add.tween(h).to({height:0},e,Phaser.Easing.Linear.Out,!0,0,0,!1)},h.fadeIn=function(e){i.add.tween(h).to({height:t},e,Phaser.Easing.Linear.In,!0,0,0,!1)},h.scaleOut=function(e){i.add.tween(h.scale).to({x:0,y:0},e,Phaser.Easing.Linear.In,!0,0,0,!1)},h.scaleIn=function(e){i.add.tween(h.scale).to({x:1,y:1},e,Phaser.Easing.Linear.Out,!0,0,0,!1)},o++,l.phaserGroup.add(a,h)},l=this,h=0;h<Math.ceil(i.world.width/e)+1;h++)s(h)},e.prototype.overlayBGControls=function(e,t){var a=e.transition,n=e.delay,i=e.speed,o=this.phaserSprites.getOnly(["um_overlay__bg"]).um_overlay__bg;setTimeout(function(){switch(a){case"FADEIN":o.fadeIn(i,t);break;case"FADEOUT":o.fadeOut(i,t)}},n)},e.prototype.overlayControls=function(e,t){var a=e.transition,n=e.delay,i=e.speed,o=e.tileDelay,r=this.phaserSprites.getGroup("um_grid__bg"),s=[],l=[],h=o*r.length*.75,u=h+o*r.length;setTimeout(function(){switch(a){case"WIPEIN":r.map(function(e,t){t%2==0?l.push(e):s.push(e)}),l.map(function(e,t){setTimeout(function(){e.scaleIn(i)},o*t)}),setTimeout(function(){s.slice(0).reverse().map(function(e,t){setTimeout(function(){e.scaleIn(i)},o*t)})},h),setTimeout(function(){t()},u);break;case"WIPEOUT":r.map(function(e,t){t%2==0?l.push(e):s.push(e)}),l.map(function(e,t){setTimeout(function(){e.scaleOut(i)},o*t)}),setTimeout(function(){s.slice(0).reverse().map(function(e,t){setTimeout(function(){e.scaleOut(i)},o*t)})},h),setTimeout(function(){t()},u);break;case"FADEOUT":r.map(function(e,t){setTimeout(function(){e.fadeOut(i)},o*t)}),setTimeout(function(){t()},r.length*o+i);break;case"FADEIN":r.map(function(e,t){setTimeout(function(){e.fadeIn(i)},o*t)}),setTimeout(function(){t()},r.length*o+i)}},n)},e}(),WEAPON_MANAGER=function(){function e(){}return e.prototype.assign=function(e,t,a,n,i){this.game=e,this.phaserSprites=a,this.phaserMaster=t,this.phaserGroup=n,this.atlas=i},e.prototype.createBullet=function(e,t,a){var n=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){});var i=this.game,o=this.phaserMaster,r=this.phaserSprites,s=this.phaserGroup,l=this.atlas,h=o.getAll().weaponData.primaryWeapons.BULLET,u=r.addFromAtlas({x:e.x,y:e.y,name:e.name,group:e.group,atlas:l,filename:h.spriteAnimation[0]});return h.spriteAnimation.length>1&&(u.animations.add("animate",h.spriteAnimation,1,!0),u.animations.play("animate",30,!0)),u.anchor.setTo(.5,.5),i.physics.enable(u,Phaser.Physics.ARCADE),u.body.velocity.y=h.initialVelocity,u.pierceStrength=h.pierceStrength,u.damageAmount=h.damage,u.destroyIt=function(){n.orangeImpact(u.x+n.game.rnd.integerInRange(-5,5),u.y+n.game.rnd.integerInRange(-5,15),1,e.layer+1),t(u),r.destroy(u.name)},u.onUpdate=function(){(this.y<-this.height||this.y>this.game.canvas.height)&&this.destroyIt(),a(u)},void 0!==e.layer&&s.add(e.layer,u),u},e.prototype.createMissle=function(e,t,a){void 0===t&&(t=function(){}),void 0===a&&(a=function(){});var n=this.game,i=this.phaserMaster,o=this.phaserSprites,r=this.phaserGroup,s=this.atlas,l=i.getAll().weaponData.primaryWeapons.MISSLE,h=o.addFromAtlas({x:e.x,y:e.y,name:e.name,group:e.group,atlas:s,filename:l.spriteAnimation[0]});return l.spriteAnimation.length>1&&(h.animations.add("animate",l.spriteAnimation,1,!0),h.animations.play("animate",30,!0)),h.anchor.setTo(.5,.5),n.physics.enable(h,Phaser.Physics.ARCADE),h.body.velocity.y=l.initialVelocity,h.isActive=!0,h.pierceStrength=l.pierceStrength,h.damageAmount=l.damage,h.accelerate=function(){null!==h.body&&(h.body.velocity.y-=l.velocity,h.body.velocity.x+=e.spread)},h.removeIt=function(){h.isActive=!1,o.destroy(h.name)},h.destroyIt=function(){t(h),h.isActive=!1,o.destroy(h.name)},h.onUpdate=function(){h.accelerate(),h.y<-h.height&&h.removeIt(),a(h)},void 0!==e.layer&&r.add(e.layer,h),h},e.prototype.createLaser=function(e,t,a){var n=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){});var i=this.game,o=this.phaserMaster,r=this.phaserSprites,s=this.phaserGroup,l=this.atlas,h=o.getAll().weaponData.primaryWeapons.LASER,u=r.addFromAtlas({x:e.x,y:e.y,name:e.name,group:e.group,atlas:l,filename:h.spriteAnimation[0]});return h.spriteAnimation.length>1&&(u.animations.add("animate",h.spriteAnimation,1,!0),u.animations.play("animate",30,!0)),u.anchor.setTo(.5,.5),i.physics.enable(u,Phaser.Physics.ARCADE),u.body.velocity.y=h.initialVelocity,u.pierceStrength=h.pierceStrength,u.damageAmount=h.damage,u.accelerate=function(){null!==u.body&&(u.body.velocity.y-=h.velocity,u.body.velocity.x+=e.spread)},u.destroyIt=function(){n.electricDischarge(u.x+n.game.rnd.integerInRange(-5,5),u.y+n.game.rnd.integerInRange(-5,15),1,e.layer+1),t(u),r.destroy(u.name)},u.onUpdate=function(){u.accelerate(),u.y<-u.height&&u.destroyIt(),a(u)},void 0!==e.layer&&s.add(e.layer,u),u},e.prototype.createClusterbomb=function(e,t,a){var n=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){});var i=this.game,o=this.phaserMaster,r=this.phaserSprites,s=this.phaserGroup,l=this.atlas,h=o.getAll().weaponData.secondaryWeapons.CLUSTERBOMB,u=r.addFromAtlas({x:e.x,y:e.y,name:e.name,group:e.group,atlas:l,filename:h.spriteAnimation[0]});return h.spriteAnimation.length>1&&(u.animations.add("animate",h.spriteAnimation,1,!0),u.animations.play("animate",30,!0)),i.physics.enable(u,Phaser.Physics.ARCADE),u.anchor.setTo(.5,.5),u.body.velocity.y=h.initialVelocity,u.angle=90,u.hasDetonated=!1,u.bomblets=h.bomblets,u.pierceStrength=h.pierceStrength,u.damageAmount=h.damage,setTimeout(function(){u.hasDetonated||(u.hasDetonated=!0,u.destroyIt())},800),u.accelerate=function(){null!==u.body&&(u.body.velocity.y>-400&&(u.body.velocity.y-=h.velocity),u.body.velocity.x+=e.spread)},u.destroyIt=function(){t(u),n.createExplosion(u.x,u.y,1.25,e.layer),r.destroy(u.name)},u.onUpdate=function(){a(u),u.angle+=5,u.accelerate(),u.y<-u.height&&u.destroyIt()},void 0!==e.layer&&s.add(e.layer,u),u},e.prototype.createTriplebomb=function(e,t,a){var n=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){});var i=this.game,o=this.phaserMaster,r=this.phaserSprites,s=this.phaserGroup,l=this.atlas,h=o.getAll().weaponData.secondaryWeapons.TRIPLEBOMB,u=r.addFromAtlas({x:e.x,y:e.y,name:e.name,group:e.group,atlas:l,filename:h.spriteAnimation[0]});return h.spriteAnimation.length>1&&(u.animations.add("animate",h.spriteAnimation,1,!0),u.animations.play("animate",30,!0)),i.physics.enable(u,Phaser.Physics.ARCADE),u.anchor.setTo(.5,.5),u.body.velocity.y=h.initialVelocity,u.angle=90,u.hasDetonated=!1,u.damageAmount=h.damage,u.pierceStrength=h.pierceStrength,u.accelerate=function(){null!==u.body&&(u.body.velocity.y>-500&&(u.body.velocity.y-=h.velocity),u.body.velocity.x+=e.spread)},u.removeIt=function(){t(u),r.destroy(u.name)},u.destroyIt=function(){t(u),n.createExplosion(u.x,u.y,1.25,e.layer),r.destroy(u.name)},u.onUpdate=function(){a(u),u.angle+=15,u.accelerate(),u.y<-u.height&&u.removeIt()},void 0!==e.layer&&s.add(e.layer,u),u},e.prototype.createTurret=function(e,t,a,n){var i=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===n&&(n=function(){});var o=this.game,r=this.phaserMaster,s=this.phaserSprites,l=this.phaserGroup,h=this.atlas,u=r.getAll().weaponData.secondaryWeapons.TURRET,d=s.addFromAtlas({x:e.x,y:e.y,name:e.name,group:e.group,atlas:h,filename:u.spriteAnimation[0]});u.spriteAnimation.length>1&&(d.animations.add("animate",u.spriteAnimation,1,!0),d.animations.play("animate",30,!0)),d.anchor.setTo(.5,.5),o.physics.enable(d,Phaser.Physics.ARCADE),l.add(2,d),d.offset=e.offset,setTimeout(function(){void 0!==d&&d.destroyIt()},u.lifespan),t(d),d.destroyIt=function(){void 0!==d&&(a(d),i.createExplosion(d.x,d.y,.5,e.layer),clearInterval(d.fireInterval),s.destroy(d.name))},d.onUpdate=function(){n(d)},void 0!==e.layer&&l.add(e.layer,d)},e.prototype.createBlastradius=function(e){var t=this.game,a=this.phaserMaster,n=this.phaserSprites,i=this.phaserGroup,o=this.atlas,r=a.getAll().weaponData.secondaryWeapons.BLASTRADIUS,s=n.addFromAtlas({x:e.x,y:e.y,name:e.name,group:e.group,atlas:o,filename:r.spriteAnimation[0]});if(s.anchor.setTo(.5,.5),s.scale.setTo(1,1),r.spriteAnimation.length>1){var l=s.animations.add("animate",r.spriteAnimation,30,!1);l.onStart.add(function(){},s),l.onComplete.add(function(){n.destroy(s.name)},s),l.play("animate")}t.physics.enable(s,Phaser.Physics.ARCADE),void 0!==e.layer&&i.add(e.layer,s)},e.prototype.createBomblet=function(e,t,a){var n=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){});var i=this.game,o=(this.phaserMaster,this.phaserSprites),r=this.phaserGroup,s=this.atlas,l=o.addFromAtlas({x:e.x,y:e.y,name:"bomblet_"+i.rnd.integer(),group:e.group,atlas:s,filename:"clusterBomb.png"});return l.anchor.setTo(.5,.5),l.scale.setTo(.5,.5),i.physics.enable(l,Phaser.Physics.ARCADE),l.body.velocity.y=e.iy,l.body.velocity.x=e.ix,l.detonate=i.time.now+i.rnd.integerInRange(1250,1800),l.pierceStrength=1,l.damageAmount=100,l.destroyIt=function(){t(l),n.createExplosion(l.x,l.y,1,e.layer),o.destroy(l.name)},l.onUpdate=function(){a(l),l.angle+=5,i.time.now>l.detonate&&l.destroyIt()},void 0!==e.layer&&r.add(e.layer,l,e.layer),l},e.prototype.createExplosion=function(e,t,a,n,i,o){void 0===i&&(i=function(){}),void 0===o&&(o=function(){});var r=this.game,s=(this.phaserMaster,this.phaserSprites),l=this.phaserGroup,h=this.atlas,u=s.addFromAtlas({name:"explosion_"+r.rnd.integer(),group:"explosions",x:e,y:t,atlas:h,filename:"explosion2_layer_1.png"});return u.scale.setTo(a,a),u.anchor.setTo(.5,.5),u.animations.add("explosion",Phaser.Animation.generateFrameNames("explosion2_layer_",1,12,".png"),1,!0),u.animations.play("explosion",30,!0),r.time.events.add(Phaser.Timer.SECOND/2,function(){s.destroy(u.name)}).autoDestroy=!0,u.onDestroy=function(){},u.onUpdate=function(){o(u)},void 0!==n&&l.add(n,u),u},e.prototype.createImpactExplosion=function(e,t,a,n,i,o,r){void 0===o&&(o=function(){}),void 0===r&&(r=function(){});var s=this.game,l=(this.phaserMaster,this.phaserSprites),h=this.phaserGroup,u=this.atlas,d=l.addFromAtlas({name:"impact_"+s.rnd.integer(),group:"impactExplosions",x:e,y:t,atlas:u,filename:"explosions_Layer_1.png"});return d.scale.setTo(a,a),d.anchor.setTo(.5,.5),s.physics.enable(d,Phaser.Physics.ARCADE),d.animations.add("explosion",Phaser.Animation.generateFrameNames("explosions_Layer_",1,16,".png"),1,!0),d.animations.play("explosion",30,!0),d.damageAmount=i,s.time.events.add(Phaser.Timer.SECOND/2,function(){l.destroy(d.name)}).autoDestroy=!0,d.onDestroy=function(){},d.onUpdate=function(){r(d)},void 0!==n&&h.add(n,d),d},e.prototype.blueImpact=function(e,t,a,n){var i=this.game,o=(this.phaserMaster,this.phaserSprites),r=this.phaserGroup,s=this.atlas,l=Phaser.Animation.generateFrameNames("blue_explosion_small_layer_",1,7,".png"),h=o.addFromAtlas({name:"impact_"+i.rnd.integer(),group:"impactExplosions",x:e,y:t,atlas:s,filename:l[0]});h.scale.setTo(a,a),h.anchor.setTo(.5,.5),i.physics.enable(h,Phaser.Physics.ARCADE);var u=h.animations.add("animate",l,60,!1);return u.onStart.add(function(){},h),u.onComplete.add(function(){o.destroy(h.name)},h),u.play("animate"),h.onUpdate=function(){h.y--},void 0!==n&&r.add(n,h),h},e.prototype.orangeImpact=function(e,t,a,n){var i=this.game,o=(this.phaserMaster,this.phaserSprites),r=this.phaserGroup,s=this.atlas,l=Phaser.Animation.generateFrameNames("orange_ring_explosion_layer_",1,7,".png"),h=o.addFromAtlas({name:"impact_"+i.rnd.integer(),group:"impactExplosions",x:e,y:t,atlas:s,filename:l[0]});h.scale.setTo(a,a),h.anchor.setTo(.5,.5),i.physics.enable(h,Phaser.Physics.ARCADE);var u=h.animations.add("animate",l,60,!1);return u.onStart.add(function(){},h),u.onComplete.add(function(){o.destroy(h.name)},h),u.play("animate"),h.onUpdate=function(){h.y--},void 0!==n&&r.add(n,h),h},e.prototype.electricDischarge=function(e,t,a,n){var i=this.game,o=(this.phaserMaster,this.phaserSprites),r=this.phaserGroup,s=this.atlas,l=Phaser.Animation.generateFrameNames("disintegrate",1,10,".png"),h=o.addFromAtlas({name:"impact_"+i.rnd.integer(),group:"impactExplosions",x:e,y:t,atlas:s,filename:l[0]});h.scale.setTo(a,a),h.anchor.setTo(.5,.5),i.physics.enable(h,Phaser.Physics.ARCADE);var u=h.animations.add("animate",l,60,!1);return u.onStart.add(function(){},h),u.onComplete.add(function(){o.destroy(h.name)},h),u.play("animate"),h.onUpdate=function(){h.y--},void 0!==n&&r.add(n,h),h},e}();