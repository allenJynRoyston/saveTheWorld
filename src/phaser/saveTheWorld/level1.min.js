var PhaserGameObject=function(){function e(){this.game=null,this.global={pause:!1},this.devMode={skip:{intro:!0}}}return e.prototype.init=function(e,t,a){var n=new Phaser.Game(a.width,a.height,Phaser.WEBGL,e,{preload:function(){var e=i.game();e.load.enableParallel=!0,e.stage.backgroundColor="#2f2f2f";var t="src/phaser/saveTheWorld/resources";e.load.image("example",t+"/images/earth.png"),e.load.atlas("atlas_main",t+"/textureAtlas/main/main.png",t+"/textureAtlas/main/main.json",Phaser.Loader.TEXTURE_ATLAS_JSON_HASH),e.load.atlas("atlas_weapons",t+"/textureAtlas/weapons/weaponsAtlas.png",t+"/textureAtlas/weapons/weaponsAtlas.json",Phaser.Loader.TEXTURE_ATLAS_JSON_HASH),e.load.atlas("atlas_large",t+"/textureAtlas/large/large.png",t+"/textureAtlas/large/large.json",Phaser.Loader.TEXTURE_ATLAS_JSON_HASH),e.load.atlas("atlas_enemies",t+"/textureAtlas/enemies/enemies.png",t+"/textureAtlas/enemies/enemies.json",Phaser.Loader.TEXTURE_ATLAS_JSON_HASH),e.load.atlas("atlas_ships",t+"/textureAtlas/ships/ships.png",t+"/textureAtlas/ships/ships.json",Phaser.Loader.TEXTURE_ATLAS_JSON_HASH),e.load.json("weaponData",t+"/json/weaponData.json"),e.load.bitmapFont("gem",t+"/fonts/gem.png",t+"/fonts/gem.xml"),i.changeState("PRELOAD"),new PHASER_PRELOADER({game:e,delayInSeconds:0,done:function(){!function(){i.game(),i.get("devMode"),s.getOnly(["overlay"]).overlay;var e=i.getOnly(["clock","roundTime"]),t=e.clock;e.roundTime;s.getAll("ARRAY").map(function(e){e.init()}),p.getAll("ARRAY").map(function(e){e.init()}),C(),P("WIPEOUT",function(){f.overlayBGControls({transition:"FADEOUT",delay:0,speed:250},function(){s.getGroup("ui").map(function(e){e.reveal()});var e=function(){i.game();var e=i.getOnly(["gameData","primaryWeapon","secondaryWeapon","perk"]),t=e.gameData,a=e.primaryWeapon,n=e.secondaryWeapon,r=e.perk,l=function(e){var t=i.getOnly(["gameData"]).gameData;I(e),w("player",{health:e,lives:t.player.lives,powerup:t.player.powerup,special:t.player.special})};return g.createShip({name:"player",group:"playership",org:"gameobjects",layer:6,shipId:t.pilot,primaryWeapon:a.reference,secondaryWeapon:n.reference,perk:r.reference},l,function(e){L(),function(){var e=i.getOnly(["gameData"]).gameData,t=(s.getOnly(["powerbar"]).powerbar,e.player.powerup-1);t<0&&(t=0);w("player",{health:e.player.health,lives:e.player.lives,powerup:t,special:e.player.special}),s.get("powerbar_pow_"+t).popLost()}()},function(e){var t=i.getOnly(["gameData"]).gameData;t.player.lives--,s.getOnly(["healthbar_player"]).healthbar_player.loseLife(),t.player.lives>0?(w("player",{health:100,lives:t.player.lives,powerup:0,special:t.player.special}),o.clearAllControlIntervals(),o.disableAllInput(),setTimeout(function(){l(100),e.moveToStart()},1e3)):B()},function(e){})}();e.moveToStart(),setTimeout(function(){O()},1500),t.start(),i.changeState("READY")})})}()}})},create:function(){var e=i.game(),t=i.get("gameData");e.physics.startSystem(Phaser.Physics.ARCADE),o.assign(e),r.assign(e),s.assign(e),l.assign(e),p.assign(e),h.assign(e),u.assign(e,20),d.assign(e),c.assign(e,i,s,u,"atlas_weapons"),y.assign(e,i,s,u,"atlas_main"),m.assign(e,i,s,p,u,c,"atlas_enemies","atlas_weapons"),g.assign(e,i,s,p,u,o,c,"atlas_ships","atlas_weapons"),f.assign(e,s,d,u,"atlas_main"),i.let("roundTime",60),i.let("clock",e.time.create(!1)),i.let("elapsedTime",0),i.let("inGameSeconds",0),i.let("devMode",!1),i.let("starMomentum",{x:0,y:0}),i.let("pauseStatus",!1),i.let("bossHealth",null),i.let("powerupTimer",0),i.let("bossMode",!1),i.let("showWarningBand",!1);var a=i.let("weaponData",e.cache.getJSON("weaponData"));i.let("primaryWeapon",a.primaryWeapons[t.primaryWeapon]),i.let("secondaryWeapon",a.secondaryWeapons[t.secondaryWeapon]),i.let("perk",a.perks[t.perk]);e.onPause.add(function(){i.get("clock").stop(),i.forceLet("pauseStatus",!0)},this),e.onResume.add(function(){i.get("clock").start(),i.forceLet("pauseStatus",!1)},this),function(){var e=i.game();e.physics.startSystem(Phaser.Physics.ARCADE),f.buildOverlayBackground("#ffffff","#ffffff",19,!0),f.buildOverlayGrid(240,132,20,"logo_small");var t=d.addGradient({name:"boundryObj",start:"#ffffff",end:"#ffffff",width:5,height:5,render:!1}),a=s.add({x:-9,y:-e.world.height/2,name:"leftBoundry",group:"boundries",width:10,height:2*e.world.height,reference:t.cacheBitmapData,alpha:0}),n=s.add({x:e.world.width-1,y:-e.world.height/2,name:"rightBoundry",group:"boundries",width:10,height:2*e.world.height,reference:t.cacheBitmapData,alpha:0});e.physics.enable([a,n],Phaser.Physics.ARCADE),a.body.immovable=!0,n.body.immovable=!0}(),T(),function(){var e=i.game(),t=s.addFromAtlas({name:"scoreContainer",group:"uiScore",org:"ui",filename:"ui_roundContainer",atlas:"atlas_main",visible:!0});t.anchor.setTo(.5,.5),s.centerOnPoint("scoreContainer",e.world.width/2+t.width/2,t.height/2+t.height/2+20),u.addMany(10,[t]),t.setDefaultPositions(),t.init=function(){t.y=-100},t.reveal=function(){var a=t.getDefaultPositions().y;t.setDefaultPositions(),e.add.tween(t).to({y:a},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){})},t.hide=function(){e.add.tween(t).to({y:t.getDefaultPositions().y},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){})};var a=p.add({name:"scoreText",group:"uiScore",font:"gem",size:18,default:"1100",visible:!0});a.anchor.setTo(.5,.5),t.addChild(a),a.init=function(){a.updateScore()},a.updateScore=function(){a.setText(""+i.get("gameData").score)}}(),_(),E(),function(){var e=i.game(),t=s.addFromAtlas({y:100,name:"healthbar_player",group:"player_healthbar",org:"ui",filename:"healthbar_player",atlas:"atlas_main",visible:!0});s.centerOnPoint("healthbar_player",300,e.world.height-t.height/2-10),u.addMany(10,[t]),t.setDefaultPositions();var a=s.addFromAtlas({x:5,y:3,width:t.width-10,name:"unit_damage_player",filename:"unit_damage",atlas:"atlas_main",visible:!0});a.maxHealth=a.width-10,t.addChild(a),a.init=function(){},a.updateHealth=function(t){var n=t/100,o=i.getAll().damageBar;void 0!==o&&o.stop(),i.forceLet("damageBar",e.add.tween(a).to({width:a.maxHealth*n},500,Phaser.Easing.Linear.In,!0,500,0,!1))};var n=s.addFromAtlas({x:5,y:3,width:t.width-10,name:"unit_health_player",filename:"unit_health",atlas:"atlas_main",visible:!0});t.maxHealth=t.width-10,t.addChild(n),n.init=function(){var e=i.getOnly(["gameData"]).gameData,t=e.player.health;I(t)},n.updateHealth=function(e){var a=e/100;n.width=t.maxHealth*a},t.init=function(){t.y=t.y+200},t.reveal=function(){var a=t.getDefaultPositions().y;t.setDefaultPositions(),e.add.tween(t).to({y:a},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){t.buildLives()})},t.hide=function(){e.add.tween(t).to({y:t.getDefaultPositions().y},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){})},t.buildLives=function(){for(var a=i.getOnly(["gameData"]).gameData,n=function(a){var n=s.addFromAtlas({x:0+25*a,y:-20,name:"life_icon_"+e.rnd.integer(),group:"playerLives",filename:"ship_icon",atlas:"atlas_main",alpha:0});t.addChild(n),e.add.tween(n).to({alpha:1},250,Phaser.Easing.Linear.In,!0,250*a,0,!1),n.destroyIt=function(){e.add.tween(n).to({y:n.y-10,alpha:0},250,Phaser.Easing.Linear.In,!0,1,0,!1).onComplete.add(function(){s.destroy(n.name)})}},o=0;o<a.player.lives;o++)n(o)},t.loseLife=function(){var e=s.getGroup("playerLives"),t=e[e.length-1];t.destroyIt()}}(),function(){var e=i.game(),t=s.addFromAtlas({name:"powerbar",group:"player_pow",org:"ui",filename:"powerbar",atlas:"atlas_main",visible:!0});s.centerOnPoint("powerbar",e.world.width-140,e.world.height-t.height/2-10),u.addMany(10,[t]),t.setDefaultPositions(),t.setup=function(){for(var a=function(a){var n=s.addFromAtlas({x:8*a+5,y:9,name:"powerbar_pow_"+a,filename:"powerbar_level_"+(Math.floor(a/5)+1),group:"powerbar_bars",atlas:"atlas_main",visible:!0});n.anchor.setTo(.5,.5),n.popOut=function(t){setTimeout(function(){n.scale.setTo(1.5,1.5),e.add.tween(n.scale).to({x:1,y:1},350,Phaser.Easing.Back.InOut,!0,1,0,!1)},t)},n.popLost=function(){e.add.tween(n).to({y:n.y-5,alpha:.5},350,Phaser.Easing.Linear.In,!0,1,0,!1).onComplete.add(function(){n.y=n.getDefaultPositions().y,n.alpha=1,n.visible=!1})},t.addChild(n)},n=0;n<30;n++)a(n);var i=s.addFromAtlas({x:-20,y:0,name:"powerbar_pow",filename:"powerbar_pow",atlas:"atlas_main",visible:!0});t.addChild(i)},t.updatePowerbar=function(){for(var e=i.getOnly(["gameData"]).gameData,t=e.player.powerup,a=s.getGroup("powerbar_bars"),n=0;n<a.length;n++)a[n].visible=!0,a[n].popOut(35*n);for(var n=t;n<a.length;n++)a[n].visible=!1,a[n].popLost(35*n)},t.animateFull=function(){for(var e=s.getGroup("powerbar_bars"),t=0;t<30;t++)e[t].visible=!0,e[t].popOut(25*t)},t.init=function(){t.y=t.y+200,t.setup(),t.updatePowerbar()},t.reveal=function(){var a=t.getDefaultPositions().y;t.setDefaultPositions(),e.add.tween(t).to({y:a},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){})},t.hide=function(){e.add.tween(t).to({y:t.getDefaultPositions().y},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){})};for(var a=Phaser.Animation.generateFrameNames("special_",1,5).concat(["special_1"]),n=function(n){var i=s.addFromAtlas({x:t.width-15-30*n,y:-20,name:"special_icon_"+n,group:"special_icons",filename:""+a[0],atlas:"atlas_main",visible:!0});i.anchor.setTo(.5,.5),i.animateInterval=e.time.now,i.index=n,i.animations.add("animate",a,1,!0),i.onUpdate=function(){e.time.now>i.animateInterval&&(i.animateInterval=e.time.now+5e3,setTimeout(function(){i.animations.play("animate",10,!1)},500*i.index))},t.addChild(i)},o=0;o<8;o++)n(o)}(),function(){var e=i.game(),t=s.addEmptySprite({name:"portraitContainer",group:"player_portrait",org:"ui"});s.centerOnPoint("portraitContainer",t.width/2+20,e.world.height-t.height/2-75),u.addMany(10,[t]),t.setDefaultPositions();var a=s.addFromAtlas({x:3,y:3,name:"mockPortrait",filename:"ui_portrait_1",atlas:"atlas_main",visible:!0});t.addChild(a);var n=s.addFromAtlas({name:"staticContainer",filename:"portrait_static_1",atlas:"atlas_main",visible:!0,alpha:.4}),o=Phaser.Animation.generateFrameNames("portrait_static_",1,4).concat(Phaser.Animation.generateFrameNames("portrait_static_",3,1));n.animations.add("static",o,1,!0),n.setStaticLevel=function(e){n.animations.stop("static");var t={framerate:12,alpha:.5},a=t.framerate,i=t.alpha;switch(e){case"HEAVY":a=18,i=.3;break;case"MED":a=12,i=.2;break;case"LIGHT":a=6,i=.1}n.alpha=i,n.animations.play("static",a,!0)},t.addChild(n);var r=s.addFromAtlas({name:"portraitFrame",filename:"ui_portraitContainer",atlas:"atlas_main",visible:!0});t.addChild(r),t.init=function(){t.y=t.y+200},t.reveal=function(){var a=t.getDefaultPositions().y;t.setDefaultPositions(),e.add.tween(t).to({y:a},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){})},t.hide=function(){e.add.tween(t).to({y:t.getDefaultPositions().y},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){})}}(),function(){var e=i.game(),t=s.addFromAtlas({name:"healthbar_boss",group:"boss_healthbar",filename:"healthbar_boss",atlas:"atlas_main",visible:!0});s.centerOnPoint("healthbar_boss",e.world.width/2,25),u.addMany(10,[t]),t.setDefaultPositions();var a=s.addFromAtlas({x:5,y:3,width:t.width-10,name:"unit_damage_boss",filename:"unit_damage",atlas:"atlas_main",visible:!0});a.maxHealth=a.width,a.fillComplete=!1,t.addChild(a),a.init=function(){a.width=0},a.updateHealth=function(t){var n=t/100,o=i.getAll().enemyDamageBar;void 0!==o&&o.stop(),i.forceLet("enemyDamageBar",e.add.tween(a).to({width:a.maxHealth*n},500,Phaser.Easing.Linear.In,!0,500,0,!1))},a.fill=function(t){var n=t/100;e.add.tween(a).to({width:a.maxHealth*n},Phaser.Timer.SECOND,Phaser.Easing.Exponential.Out,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){a.fillComplete=!0})};var n=s.addFromAtlas({x:5,y:3,width:t.width-10,name:"unit_health_boss",filename:"unit_health",atlas:"atlas_main",visible:!0});n.maxHealth=n.width,n.fillComplete=!1,t.addChild(n),n.init=function(){n.width=0},n.updateHealth=function(e){if(n.fillComplete){var t=e/100;n.width=n.maxHealth*t}},n.fill=function(t,a){void 0===a&&(a=function(){});var i=t/100;e.add.tween(n).to({width:n.maxHealth*i},Phaser.Timer.SECOND,Phaser.Easing.Exponential.Out,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){n.fillComplete=!0,a()})};var o=s.addFromAtlas({x:0,y:-2,name:"bossbar_portrait",filename:"bossbar_picture",atlas:"atlas_main",visible:!0});t.addChild(o),t.init=function(){t.y=-200},t.reveal=function(){var a=t.getDefaultPositions().y;t.setDefaultPositions(),e.add.tween(t).to({y:a},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){var e,t,a;e=i.get("bossHealth"),t=s.getOnly(["unit_damage_boss","unit_health_boss"]),a=t.unit_damage_boss,t.unit_health_boss.fill(e,function(){a.updateHealth(e)})})},t.hide=function(){e.add.tween(t).to({y:t.getDefaultPositions().y},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,e.rnd.integerInRange(0,500),0,!1).onComplete.add(function(){})}}()},update:function(){var e=i.game(),a=i.getState().currentState,n=i.getOnly(["starMomentum","primaryWeapon","secondaryWeapon","menuButtonSelection","elapsedTime","powerupTimer","gameData"]),r=n.starMomentum,l=n.primaryWeapon,h=(n.secondaryWeapon,n.menuButtonSelection),u=n.elapsedTime,d=n.powerupTimer,c=n.gameData,m=s.getOnly(["player","menuButtonCursor"]),g=m.player,y=m.menuButtonCursor,f=o.getOnly(["DOWN","UP","LEFT","RIGHT","A","START"]),v=f.DOWN,b=f.UP,A=f.LEFT,T=f.RIGHT,_=f.A;f.START;"VICTORYSTATE"!==a&&"GAMEOVERSTATE"!==a&&"ENDLEVEL"!==a&&s.getManyGroups(["backgrounds","starfield","impactExplosions","playership","enemy_bullets","special_icons","itemspawns","boss_ui"]).map(function(e){e.onUpdate()});"READY"===a&&(e.time.now>d&&(i.forceLet("powerupTimer",c.player.powerup<30?e.time.now+.5*Phaser.Timer.SECOND:e.time.now+Phaser.Timer.SECOND/2),D()),e.time.now>u&&(i.forceLet("elapsedTime",e.time.now+Phaser.Timer.SECOND/2),k()),s.getManyGroups(["ui_overlay","enemies","boss","trashes"]).map(function(e){void 0!==e&&e.onUpdate()}),p.getManyGroups(["ui_text","timeKeeper"]).map(function(e){void 0!==e&&e.onUpdate()}),T.active&&(r.x=-2,g.moveX(5)),A.active&&(r.x=2,g.moveX(-5)),b.active&&(r.y=5,g.moveY(-5)),v.active&&(r.y=-2,g.moveY(5)),b.active||v.active||(r.y=0),o.checkWithDelay({isActive:!0,key:"A",delay:l.cooldown-_.state*l.rapidFireSpd})&&g.fireWeapon(),o.checkWithDelay({isActive:!0,key:"B",delay:500})&&c.player.special>0&&(!function(){var e=i.getOnly(["gameData"]).gameData,t=e.player.special-1;t<0&&(t=0);w("player",{health:e.player.health,lives:e.player.lives,powerup:e.player.powerup,special:t}),C()}(),g.fireSubweapon()));if("VICTORYSTATE"===a&&(o.checkWithDelay({isActive:!0,key:"UP",delay:100})&&y.updateLocation(1),o.checkWithDelay({isActive:!0,key:"DOWN",delay:100})&&y.updateLocation(2),o.checkWithDelay({isActive:!0,key:"START",delay:250})))switch(i.changeState("LOCKED"),o.disableAllInput(),h){case 1:x(),N(function(){x(),t.loadNextLevel()});break;case 2:x(),N(function(){x(),t.returnToTitle()})}if("GAMEOVERSTATE"===a&&(o.checkWithDelay({isActive:!0,key:"UP",delay:100})&&y.updateLocation(1),o.checkWithDelay({isActive:!0,key:"DOWN",delay:100})&&y.updateLocation(2),o.checkWithDelay({isActive:!0,key:"START",delay:100})))switch(o.disableAllInput(),h){case 1:N(function(){t.retry()});break;case 2:N(function(){t.returnToTitle()})}}});n.preserveDrawingBuffer=!0;var i=new PHASER_MASTER({game:n,resolution:{width:a.width,height:a.height}}),o=new PHASER_CONTROLS,r=new PHASER_MOUSE({showDebugger:!1}),s=new PHASER_SPRITE_MANAGER,l=new PHASER_BITMAPDATA_MANAGER,p=new PHASER_TEXT_MANAGER,h=new PHASER_BUTTON_MANAGER,u=new PHASER_GROUP_MANAGER,d=new PHASER_BITMAPDATA_MANAGER,c=new WEAPON_MANAGER,m=new ENEMY_MANAGER({showHitbox:!1}),g=new PLAYER_MANAGER,y=new ITEMSPAWN_MANAGER,f=new UTILITY_MANAGER,v=a.store,b=JSON.stringify(v.getters._gameData());function w(e,t){i.get("gameData")[e]=t}function x(){var e=i.get("gameData");v.commit("setGamedata",e)}function A(e,t,a,n,o){var r=i.game(),s={step:0},l=r.add.tween(s).to({step:100},n);l.onUpdateCallback(function(){e.tint=Phaser.Color.interpolateColor(t,a,100,s.step)}),o&&l.onComplete.add(o,r),e.tint=t,l.start()}function T(){var e=i.get("starMomentum"),t=s.addTilespriteFromAtlas({name:"bg1",group:"backgrounds",x:0,y:0,width:n.canvas.width,height:n.canvas.height,atlas:"atlas_large",filename:"Nebula3"});t.onUpdate=function(){t.tilePosition.y+=1,t.tilePosition.x+=e.x/4};var a=s.addTilespriteFromAtlas({name:"bg2",group:"backgrounds",x:0,y:0,width:n.canvas.width,height:n.canvas.height,atlas:"atlas_large",filename:"Nebula1"});a.tilePosition.x=500,a.onUpdate=function(){a.tilePosition.y+=5,a.tilePosition.x+=e.x/2},u.addMany(1,[t,a]);var o=s.addTilespriteFromAtlas({name:"fg1",group:"backgrounds",x:0,y:0,width:n.canvas.width,height:n.canvas.height,atlas:"atlas_large",filename:"Nebula2",alpha:.25});o.tilePosition.x=300,o.onUpdate=function(){o.tilePosition.y+=10,o.tilePosition.x+=e.x},u.addMany(10,[o]);for(var r=function(e){var t=s.addFromAtlas({x:n.rnd.integerInRange(0,n.world.width),y:n.rnd.integerInRange(0,n.world.height),name:"star_"+e,group:"starfield",filename:"stars_layer_"+n.rnd.integerInRange(1,3),atlas:"atlas_main",visible:!0});t.starType=n.rnd.integerInRange(1,3),t.scale.setTo(t.starType/2,t.starType/2),t.onUpdate=function(){var e=.25+5*(3-t.starType),a=i.get("starMomentum");this.y>this.game.world.height&&(this.y=10,this.x=n.rnd.integerInRange(-100,n.world.width)),this.x>this.game.world.width&&(this.x=0),this.x<0&&(this.x=this.game.world.width),a.x>0&&(a.x-=.05),a.x<0&&(a.x+=.05),a.y>0&&(a.y-=.05),a.y<0&&(a.y+=.05),this.x+=(3-t.starType)*a.x,this.y+=e+(3-t.starType)*a.y},t.fadeOut=function(){this.game.add.tween(this).to({alpha:0},Phaser.Timer.SECOND,Phaser.Easing.Back.InOut,!0,n.rnd.integerInRange(0,500),0,!1).autoDestroy=!0},u.layer(0).add(t)},l=0;l<10;l++)r(l)}function _(){var e=s.addFromAtlas({name:"menuButton1",group:"menuButtons",x:n.world.centerX,y:n.world.centerY+125,atlas:"atlas_main",filename:"ui_button",visible:!0});e.anchor.setTo(.5,.5),e.init=function(){e.visible=!1},e.reveal=function(){this.visible=!0},p.add({name:"menuButton1Text",group:"ui",font:"gem",x:e.x,y:e.y,size:14,default:""}).anchor.setTo(.5,.5);var t=s.addFromAtlas({name:"menuButton2",group:"menuButtons",x:n.world.centerX,y:n.world.centerY+175,atlas:"atlas_main",filename:"ui_button",visible:!0});t.anchor.setTo(.5,.5),t.init=function(){t.visible=!1},t.reveal=function(){this.visible=!0},p.add({name:"menuButton2Text",group:"ui",font:"gem",x:t.x,y:t.y,size:14,default:""}).anchor.setTo(.5,.5);var a=s.addFromAtlas({name:"menuButtonCursor",group:"menuButtons",x:n.world.centerX-125,atlas:"atlas_main",filename:"ui_cursor",visible:!0});a.anchor.setTo(.5,.5),a.init=function(){a.visible=!1},a.reveal=function(){this.visible=!0},a.updateLocation=function(e){i.forceLet("menuButtonSelection",e);var t=s.get("menuButton"+e);this.y=t.y},a.updateLocation(1),u.addMany(12,[e,t,a])}function E(){var e=s.addTilespriteFromAtlas({name:"showWarningBand",group:"boss_ui",x:0,y:n.world.centerY-100,width:n.canvas.width,height:100,atlas:"atlas_main",filename:"warning_band",alpha:0});e.cosWave={data:n.math.sinCosGenerator(150,100,0,1).cos,count:0},e.onUpdate=function(){i.getOnly(["showWarningBand"]).showWarningBand?(e.cosWave.count++,e.cosWave.count>e.cosWave.data.length-1&&(e.cosWave.count=0),e.alpha=Math.round(e.cosWave.data[e.cosWave.count]),e.tilePosition.x+=10):0!==e.cosWave.count&&(e.cosWave.count++,e.cosWave.count>e.cosWave.data.length-1&&(e.cosWave.count=0),e.alpha=Math.round(e.cosWave.data[e.cosWave.count]),e.tilePosition.x+=10)}}function P(e,t){void 0===t&&(t=function(){});f.overlayControls({transition:e,delay:1e3,speed:250,tileDelay:5},t)}function I(e){var t=s.getOnly(["unit_damage_player","unit_health_player"]),a=t.unit_damage_player,n=t.unit_health_player;S(e),a.updateHealth(e),n.updateHealth(e)}function S(e){var t=s.getOnly(["staticContainer"]).staticContainer;e>0&&e<15&&t.setStaticLevel("HEAVY"),e>15&&e<35&&t.setStaticLevel("MED"),e>35&&t.setStaticLevel("LIGHT")}function D(){var e=i.getOnly(["gameData"]).gameData,t=s.getOnly(["powerbar"]).powerbar,a=e.player.powerup+1;a>30?(a=30,t.animateFull()):(w("player",{health:e.player.health,lives:e.player.lives,powerup:a,special:e.player.special}),t.updatePowerbar())}function O(){var e=i.getOnly(["gameData"]).gameData,t=e.player.special+1;t>9&&(t=9),w("player",{health:e.player.health,lives:e.player.lives,powerup:e.player.powerup,special:t}),C()}function C(){for(var e=i.getOnly(["gameData"]).gameData.player.special,t=s.getGroup("special_icons"),a=0;a<t.length;a++)t[a].visible=!0;for(a=e;a<t.length;a++)t[a].visible=!1}function R(e){var t=i.game();m.createSmallEnemy1(e,function(){},function(e){var a,n,o=i.getOnly(["gameData"]).gameData;o.score+=200,w("score",o.score),p.getOnly(["scoreText"]).scoreText.updateScore(),t.rnd.integerInRange(0,10)<2&&(a=e.x,n=e.y,y.spawnPowerup(a,n,6,function(){D()}))},function(){})}function M(){n.camera.shake(.005,5e3)}function L(){var e=s.get("healthbar_player"),t={x:e.x+n.rnd.integerInRange(-2,2),y:e.y+n.rnd.integerInRange(-2,2)},a=Phaser.Easing.Bounce.InOut;n.add.tween(e).to(t,45,a,!1,1,4,!0).start()}function k(){var e,t,a=i.getOnly(["bossMode"]).bossMode,o=function(e){var t=i.getOnly(["inGameSeconds"]).inGameSeconds;return t+=e,i.forceLet("inGameSeconds",t),t}(.5);30===o&&function(){var e=this,t=i.game(),a=s.getOnly(["scoreContainer","player","healthbar_boss"]),n=a.scoreContainer,o=a.player,r=a.healthbar_boss;i.forceLet("bossMode",!0),i.forceLet("showWarningBand",!0),M();i.forceLet("bossHealth",100),o.moveTo(t.world.centerX,t.world.centerY+t.world.centerY/2,4e3,function(){t.time.events.add(2*Phaser.Timer.SECOND,function(){n.hide(),r.reveal(),i.forceLet("showWarningBand",!1)},e).autoDestroy=!0})}(),a||(o%5==0&&(e=n.rnd.integerInRange(100,n.canvas.width-100),t=0,y.spawnSpecial(e,t,6,function(){O()})),o%1==0&&R({x:n.rnd.integerInRange(100,n.canvas.width-100),y:n.rnd.integerInRange(100,400),iy:n.rnd.integerInRange(0,80),layer:3}))}function B(){i.changeState("GAMEOVER");s.get("player"),s.get("earth");o.disableAllInput(),i.changeState("GAMEOVERSTATE"),s.getGroup("ui").map(function(e){e.hide()}),setTimeout(function(){var e=n.add.bitmapData(n.width,n.height);e.drawFull(n.world);var t=e.addToWorld(n.world.centerX+100,n.world.centerY+100,.5,.5,2,2);u.add(5,t),s.getManyGroups(["backgrounds","starfield","gameobjects"]).map(function(e){e.destroy()}),f.overlayBGControls({transition:"FLASHWHITE",delay:0,speed:600},function(){t.scale.setTo(.5,.5),t.x=0,t.y=0;var e=s.addFromAtlas({x:n.world.centerX,y:n.world.centerY,width:n.world.width,height:n.world.height,name:"newspaper",group:"gameobjects",filename:"newspaper",atlas:"atlas_main",visible:!0});e.anchor.setTo(.5,.5),e.scale.setTo(3,3),e.addChild(t),u.add(6,e),A(t,0,16777215,3e3,function(){o.enableAllInput();var e=p.getOnly(["menuButton1Text","menuButton2Text"]);e.menuButton1Text,e.menuButton2Text;s.getGroup("menuButtons").map(function(e){e.reveal()}),p.get("menuButton1Text").setText("RETRY"),p.get("menuButton2Text").setText("SAVE AND QUIT")}),n.add.tween(e.scale).to({x:1,y:1},1.5*Phaser.Timer.SECOND,Phaser.Easing.Bounce.Out,!0,0,0,!1),n.add.tween(e).to({angle:35,y:e.y-50},1.5*Phaser.Timer.SECOND,Phaser.Easing.Linear.InOut,!0,0,0,!1)})},3e3)}function N(e){f.overlayBGControls({transition:"FADEIN",delay:0,speed:250},function(){p.getManyGroups(["ui","ui_text","ui_buttons"]).map(function(e){p.destroy(e.name)}),s.getManyGroups(["ui","ui_buttons"]).map(function(e){s.destroy(e.name)}),P("WIPEIN",function(){setTimeout(function(){e()},500)})})}i.let("gameData",JSON.parse(b)),t.game=this,this.game=i.game()},e.prototype.destroy=function(){this.game.destroy()},e}(),__phaser=new PhaserGameObject,PHASER_AUDIO=function(){return function(){}}(),PHASER_BITMAPDATA_MANAGER=function(){function e(){this.game=null,this.bmd={array:[],object:{}}}return e.prototype.assign=function(e){this.game=e},e.prototype.addGradient=function(e){if(0===this.bmd.array.filter(function(t){return t.name===e.name}).length){var t=this.game.make.bitmapData(e.width,e.height),a=t.context.createLinearGradient(0,0,0,e.height);a.addColorStop(0,e.start),a.addColorStop(1,e.end),t.context.fillStyle=a,t.context.fillRect(0,0,e.width,e.height);var n=this.game.cache.addBitmapData(e.name,t),i=this.game.make.bitmapData();return i.load(this.game.cache.getBitmapData(e.name)),e.render&&i.addToWorld(e.x,e.y),i.name=e.name,i.group=e.group,i.cacheBitmapData=n,this.bmd.array.push(i),this.bmd.object[e.name]=i,i}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.addImage=function(e){if(0===this.bmd.array.filter(function(t){return t.name===e.name}).length){var t=this.game.make.bitmapData();return t.load(e.reference),t.addToWorld(e.x,e.y),e.render||t.cls(),t.name=e.name,t.group=e.group,t.cacheBitmapData=e.reference,this.bmd.array.push(t),this.bmd.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.addEmpty=function(e){if(0===this.bmd.array.filter(function(t){return t.name===e.name}).length){var t=this.game.make.bitmapData(e.width,e.height);return t.addToWorld(e.x,e.y),e.render||t.cls(),t.name=e.name,t.group=e.group,this.bmd.array.push(t),this.bmd.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.destroy=function(e){for(var t=[],a=0,n=this.bmd.array.filter(function(t){return t.name===e});a<n.length;a++){var i=n[a];t.push(i.name),i.destroy()}return delete this.bmd.object[e],this.bmd.array=this.bmd.array.filter(function(t){return t.name!==e}),t},e.prototype.destroyGroup=function(e){for(var t=[],a=0,n=this.bmd.array.filter(function(e){return e.group===name});a<n.length;a++){var i=n[a];t.push(i.name),i.destroy()}return delete this.bmd.object[name],this.bmd.array=this.bmd.array.filter(function(e){return e.group!==name}),t},e.prototype.get=function(e){return this.bmd.object[e]},e.prototype.getGroup=function(e){return this.bmd.array.filter(function(t){return t.group===e})},e.prototype.getAll=function(e){return void 0===e&&(e="BOTH"),"ARRAY"===e?this.bmd.array:"OBJECT"==e?this.bmd.object:{object:this.bmd.object,array:this.bmd.array}},e.prototype.takeSnapshot=function(){return this.game.canvas.toDataURL()},e}(),PHASER_BUTTON_MANAGER=function(){function e(){this.game=null,this.resources={array:[],object:{}}}return e.prototype.assign=function(e){this.game=e.game},e.prototype.add=function(e){if(0===this.resources.array.filter(function(t){return t.name===e.name}).length){var t=this.game.add.button(e.x,e.y,e.reference,e.onclick);return t.name=e.name,t.group=e.group||null,this.resources.array.push(t),this.resources.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.destroy=function(e){for(var t=[],a=0,n=this.resources.array.filter(function(t){return t.key===e});a<n.length;a++){var i=n[a];t.push(i.key),i.destroy()}return delete this.resources.object[e],this.resources.array=this.resources.array.filter(function(t){return t.key!==e}),t},e.prototype.destroyGroup=function(e){for(var t=[],a=0,n=this.resources.array.filter(function(t){return t.group===e});a<n.length;a++){var i=n[a];t.push(i.key),i.destroy()}return delete this.resources.object[e],this.resources.array=this.resources.array.filter(function(t){return t.group!==e}),t},e.prototype.get=function(e){return this.resources.object[e]},e.prototype.getGroup=function(e){return this.resources.array.filter(function(t){return t.group===e})},e.prototype.getAll=function(e){return void 0===e&&(e="BOTH"),"ARRAY"===e?this.resources.array:"OBJECT"==e?this.resources.object:{object:this.resources.object,array:this.resources.array}},e}(),PHASER_CONTROLS=function(){function e(){this.IO=null,this.game=null,this.buttonSensitivity={QUICK:1,SHORT:50,LONG:150,SUPERLONG:300},this.releasedKeys=[],this.properties={isReady:!1,allowDebugger:!0,buttonDelay:50,timingRefreshRate:1},this.directionalButtons=["UP","DOWN","LEFT","RIGHT"],this.actionButtons=["A","B","X","Y"],this.triggerButtons=["L1","L2","R1","R2","L3","R3"],this.systemButtons=["START","BACK"],this.buttonArray=this.directionalButtons.concat(this.actionButtons,this.triggerButtons,this.systemButtons),this.buttonMap={UP:{name:"UP",code:"ArrowUp"},DOWN:{name:"DOWN",code:"ArrowDown"},LEFT:{name:"LEFT",code:"ArrowLeft"},RIGHT:{name:"RIGHT",code:"ArrowRight"},A:{name:"A",code:"KeyA"},B:{name:"S",code:"KeyS"},X:{name:"D",code:"KeyD"},Y:{name:"F",code:"KeyF"},L1:{name:"Q",code:"KeyQ"},L2:{name:"W",code:"KeyW"},R1:{name:"E",code:"KeyE"},R2:{name:"R",code:"KeyR"},L3:{name:"O",code:"KeyO"},R3:{name:"P",code:"KeyP"},START:{name:"ENTER",code:"Enter"},BACK:{name:"BACKSPACE",code:"Backspace"}},this.buttonMapId={UP:1,DOWN:2,LEFT:3,RIGHT:4,A:5,B:6,X:7,Y:8,L1:9,L2:10,R1:11,R2:12,L3:13,R3:14,START:15,BACK:16},this.disabledButtons={ALL:!1,DIRECTIONAL:!1,TRIGGER:!1,ACTION:!1,SYSTEM:!1},this.debugger={enabled:!1,text:{}},this.inputDelay={delay:Array.apply(null,Array(20)).map(function(){return 0})}}return e.prototype.assign=function(e){var t=this;this.game=e;var a={font:"12px Courier New",fill:"#fff",align:"left"};this.buttonArray.forEach(function(n,i){t.debugger.text[n]=null,t.debugger.text[n]=e.add.text(10,10+15*i,"",a),t.disabledButtons[n]=!1});for(var n={buttons:{},sensitivityPress:{},sensitivityBuffer:{},state:{}},i=function(a){n.buttons[a]=e.input.keyboard.addKey(Phaser.Keyboard[o.buttonMap[a].name]),n.sensitivityPress[a]=null,n.sensitivityBuffer[a]=0,n.state[a]=function(){return t.getBtnPressType(t.IO.sensitivityBuffer[a])}},o=this,r=0,s=this.buttonArray;r<s.length;r++){i(s[r])}for(var l=function(e){n.buttons[e].onDown.add(function(a){var i,o;clearInterval(n.sensitivityPress[e]);var r=["DIRECTIONAL","ACTION","TRIGGER","SYSTEM"];Object.keys(t.buttonMap).forEach(function(e,n){if(t.buttonMap[e].code===a.event.code)for(var s=0,l=r;s<l.length;s++){var p=l[s];t[p.toLowerCase()+"Buttons"].indexOf(e)+1&&(i=p,o=e)}});var s=!1;t.disabledButtons.ALL&&(s=!0);for(var l=0,p=r;l<p.length;l++){var h=p[l];t.disabledButtons[h]&&i===h&&(s=!0)}Object.keys(t.buttonMap).forEach(function(e,a){t.disabledButtons[e]&&o===e&&(s=!0)}),s||(n.sensitivityPress[e]=setInterval(function(){n.sensitivityBuffer[e]+=1},t.properties.timingRefreshRate))},p)},p=this,h=0,u=this.buttonArray;h<u.length;h++){l(u[h])}return e.input.keyboard.onUpCallback=function(e){for(var a=0,i=t.buttonArray;a<i.length;a++){var o=i[a];e.code===t.buttonMap[o].code&&(t.releasedKeys.push(t.buttonMap[o].code),setTimeout(function(){t.releasedKeys.shift()},1500),clearInterval(n.sensitivityPress[o]),n.sensitivityBuffer[o]=0)}"Backquote"===e.code&&t.properties.allowDebugger&&(t.setDebugger(!t.debugger.enabled),t.updateDebugger())},this.properties.isReady=!0,this.IO=n,n},e.prototype.mapKeys=function(e){var t=this;this.properties.isReady=!1,this.destroyAll(),setTimeout(function(){t.buttonMap=e,t.properties.isReady=!0,t.assign(t.game)},1)},e.prototype.isReady=function(){return this.properties.isReady},e.prototype.checkWithDelay=function(e){return this.read(e.key).active===e.isActive&&(this.game.time.now>this.inputDelay.delay[this.getKeyId(e.key)]&&(this.inputDelay.delay[this.getKeyId(e.key)]=e.delay+this.game.time.now,!0))},e.prototype.isDebuggerEnabled=function(){return this.debugger.enabled},e.prototype.setDebugger=function(e){void 0===e&&(e=!0),this.debugger.enabled=e},e.prototype.updateDebugger=function(){if(this.properties.isReady)for(var e=0,t=this.buttonArray;e<t.length;e++){var a=t[e];this.debugger.text[a].setText(this.debugger.enabled?this.debuggerString(a):"").bringToTop()}},e.prototype.disableAllInput=function(){this.disabledButtons.ALL=!0},e.prototype.enableAllInput=function(){this.disabledButtons.ALL=!1},e.prototype.disableAllDirectionalButtons=function(){this.disabledButtons.DIRECTIONAL=!0},e.prototype.enableAllDirectionalButtons=function(){this.disabledButtons.DIRECTIONAL=!1},e.prototype.disableAllTriggerButtons=function(){this.disabledButtons.TRIGGER=!0},e.prototype.enableAllTriggerButtons=function(){this.disabledButtons.TRIGGER=!1},e.prototype.disableAllActionButtons=function(){this.disabledButtons.ACTION=!0},e.prototype.enableAllActionButtons=function(){this.disabledButtons.ACTION=!1},e.prototype.disableAllSystemButtons=function(){this.disabledButtons.SYSTEM=!0},e.prototype.enableAllSystemButtons=function(){this.disabledButtons.SYSTEM=!1},e.prototype.setDisableKeyProperty=function(e,t){void 0===t&&(t=!0),this.properties.isReady&&(this.disabledButtons[e.toUpperCase()]=t)},e.prototype.getKeyDisabledValue=function(e){return this.properties.isReady?this.disabledButtons[e.toUpperCase()]:null},e.prototype.clearAllControlIntervals=function(){if(this.properties.isReady)for(var e=0,t=this.buttonArray;e<t.length;e++){var a=t[e];clearInterval(this.IO.sensitivityPress[a])}},e.prototype.getKeyId=function(e){return this.buttonMapId[e.toUpperCase()]},e.prototype.read=function(e){if(this.properties.isReady){return{}[e]={id:this.buttonMapId[e.toUpperCase()],active:this.IO.state[e.toUpperCase()]().val>0,duration:this.IO.state[e.toUpperCase()]().val,state:this.IO.state[e.toUpperCase()]().state,type:this.IO.state[e.toUpperCase()]().type,disabled:this.disabledButtons[e.toUpperCase()]}}return{}},e.prototype.readMulti=function(e,t){if(void 0===t&&(t="OBJECT"),this.properties.isReady){if("OBJECT"===t){for(var a={},n=0,i=e;n<i.length;n++){a[s=i[n]]={id:this.buttonMapId[s.toUpperCase()],active:this.IO.state[s.toUpperCase()]().val>0,duration:this.IO.state[s.toUpperCase()]().val,state:this.IO.state[s.toUpperCase()]().state,type:this.IO.state[s.toUpperCase()]().type,disabled:this.disabledButtons[s.toUpperCase()]}}return a}if("ARRAY"===t){a=[];for(var o=0,r=e;o<r.length;o++){var s=r[o];a.push({id:this.buttonMapId[s.toUpperCase()],key:s,active:this.IO.state[s.toUpperCase()]().val>0,duration:this.IO.state[s.toUpperCase()]().val,state:this.IO.state[s.toUpperCase()]().state,type:this.IO.state[s.toUpperCase()]().type,disabled:this.disabledButtons[s.toUpperCase()]})}return a}}},e.prototype.getReleasedKeys=function(){return this.releasedKeys},e.prototype.getOnly=function(e){for(var t=this,a={},n=function(n){e.map(function(e){n===e&&(a[n]={id:t.buttonMapId[n.toUpperCase()],active:t.IO.state[n.toUpperCase()]().val>0,duration:t.IO.state[n.toUpperCase()]().val,state:t.IO.state[n.toUpperCase()]().state,type:t.IO.state[n.toUpperCase()]().type,disabled:t.disabledButtons[n.toUpperCase()]})})},i=0,o=this.buttonArray;i<o.length;i++){n(o[i])}return a},e.prototype.getAll=function(){for(var e={},t=0,a=this.buttonArray;t<a.length;t++){var n=a[t];e[n]={id:this.buttonMapId[n.toUpperCase()],active:this.IO.state[n.toUpperCase()]().val>0,duration:this.IO.state[n.toUpperCase()]().val,state:this.IO.state[n.toUpperCase()]().state,type:this.IO.state[n.toUpperCase()]().type,disabled:this.disabledButtons[n.toUpperCase()]}}return e},e.prototype.debuggerString=function(e){return e.toUpperCase()+" ("+this.buttonMap[e.toUpperCase()].name+"/"+this.buttonMap[e.toUpperCase()].code+") | id: "+this.buttonMapId[e.toUpperCase()]+" duration: "+this.IO.state[e.toUpperCase()]().val+" | state: "+this.IO.state[e.toUpperCase()]().state+" | type: "+this.IO.state[e.toUpperCase()]().type+" | disabled: "+this.disabledButtons[e.toUpperCase()]},e.prototype.getBtnPressType=function(e){var t=this,a="NONE",n=0,i=0;return Object.keys(this.buttonSensitivity).forEach(function(o){i++,e>t.buttonSensitivity[o]&&(a=o,n=i)}),{val:e,type:a,state:n}},e.prototype.destroyAll=function(){var e=this;this.clearAllControlIntervals(),Object.keys(this.debugger.text).forEach(function(t){e.debugger.text[t].destroy()})},e}(),PHASER_GROUP_MANAGER=function(){function e(){this.game=null,this.group={array:[],object:{}}}return e.prototype.assign=function(e,t){void 0===t&&(t=10),this.game=e;for(var a=0;a<=t;a++){var n=e.add.group();this.group.object[""+a]=n,this.group.array.push(n)}},e.prototype.layer=function(e){return this.group.object[e]},e.prototype.add=function(e,t){this.group.object[e].add(t)},e.prototype.addMany=function(e,t){var a=this;t.forEach(function(t){a.group.object[e].add(t)})},e}(),PHASER_MASTER=function(){function e(e){this._game=e.game,this.resolution=e.resolution,this.states={BOOT:"BOOT",PRELOAD:"PRELOAD",READY:"READY"},this.currentState=this.states[0],this.variables={}}return e.prototype.let=function(e,t){if(void 0===t&&(t=null),void 0===this.variables[e])return this.variables[e]=t;console.log("Cannot LET duplicate key in PHASER_MASTER: "+e)},e.prototype.forceLet=function(e,t){return void 0===t&&(t=null),this.variables[e]=t},e.prototype.delete=function(e){delete this.variables[e]},e.prototype.get=function(e){return void 0!==this.variables[e]?this.variables[e]:(console.log("Cannot GET a variable that does not exist in PHASER_MASTER."),null)},e.prototype.getAll=function(){return this.variables},e.prototype.getOnly=function(e){var t={},a=[];for(var n in this.variables)a.push({key:n,data:this.variables[n]});for(var i=function(n){a.filter(function(t){return t.key===e[n]}).map(function(e){t[e.key]=e.data})},o=0;o<e.length;o++)i(o);return t},e.prototype.changeState=function(e){void 0===e&&(e=null);var t=e.toUpperCase(),a=!1;return void 0===this.states[t]&&(this.states[t]=t,a=!0),this.currentState=t,{created:a,state:this.currentState}},e.prototype.getCurrentState=function(){return this.currentState},e.prototype.getStates=function(){return this.states},e.prototype.getResolution=function(){return this.resolution},e.prototype.checkState=function(e){return this.currentState===e.toUpperCase()},e.prototype.getState=function(){return{currentState:this.currentState}},e.prototype.game=function(){return this._game},e}(),PHASER_MOUSE=function(){function e(e){this.game=null,this.clickSensitvity={QUICK:1,SHORT:50,LONG:150,SUPERLONG:300},this.mouseMapping=[0,1,2],this.mouseMap={LEFT:0,MIDDLE:1,RIGHT:2},this.metrics={sensitivityPress:{},sensitivityBuffer:{},location:{},state:{}},this.properties={allowDebugger:!0,timingRefreshRate:1},this.inputDelay={delay:Array.apply(null,Array(2)).map(function(){return 0})},this.debugger={enabled:void 0!==e.showDebugger&&e.showDebugger,text:{},pointer:null}}return e.prototype.assign=function(e){var t=this;this.game=e;for(var a=function(e){n.metrics.sensitivityPress[e]=null,n.metrics.sensitivityBuffer[e]=0,n.metrics.location[e]={x:null,y:null},n.metrics.state[e]=function(){return t.getBtnPressType(t.metrics.sensitivityBuffer[e])}},n=this,i=0,o=this.mouseMapping;i<o.length;i++){a(o[i])}this.game.input.onDown.add(function(e){var a=t.checkMouseClick();clearInterval(t.metrics.sensitivityPress[a]),t.metrics.sensitivityPress[a]=setInterval(function(){t.metrics.sensitivityBuffer[a]+=1,t.metrics.location[a]={x:e.x,y:e.y}},t.properties.timingRefreshRate)}),this.game.input.onUp.add(function(e){var a=t.checkMouseClick();t.clearAllControlIntervals(),t.metrics.sensitivityBuffer[a]=0});var r={font:"12px Courier New",fill:"#fff",align:"left"};this.mouseMapping.forEach(function(e,a){t.debugger.text[e]=null,t.debugger.text[e]=t.game.add.text(5,t.game.height-35-15*a,"",r)}),this.debugger.pointer=this.game.add.text(5,this.game.height-20,"",r),e.canvas.oncontextmenu=function(e){e.preventDefault()}},e.prototype.checkMouseClick=function(){var e=0;return this.game.input.activePointer.leftButton.isDown&&(e=0),this.game.input.activePointer.middleButton.isDown&&(e=1),this.game.input.activePointer.rightButton.isDown&&(e=2),e},e.prototype.debuggerString=function(e){return"Button_"+e+" | {x: "+this.metrics.location[e].x+", y: "+this.metrics.location[e].y+"} | active: "+(this.metrics.sensitivityBuffer[e]>0)+" | state: "+this.metrics.state[e]().state+" | duration: "+this.metrics.state[e]().val+" | type: "+this.metrics.state[e]().type},e.prototype.setDebugger=function(e){void 0===e&&(e=!0),this.debugger.enabled=e},e.prototype.updateDebugger=function(){for(var e=0,t=this.mouseMapping;e<t.length;e++){var a=t[e];this.debugger.text[a].setText(this.debugger.enabled?this.debuggerString(a):"").bringToTop()}this.debugger.pointer.setText(this.debugger.enabled?"Pointer: {x: "+this.game.input.mousePointer.x+", y: "+this.game.input.mousePointer.y+"}":"").bringToTop()},e.prototype.clearAllControlIntervals=function(){for(var e=0,t=this.mouseMapping;e<t.length;e++){var a=t[e];this.metrics.sensitivityBuffer[a]=0,clearInterval(this.metrics.sensitivityPress[a])}},e.prototype.checkWithDelay=function(e){if(this.read(e.key).active===e.isActive){var t=this.mouseMap[e.key.toUpperCase()];return this.game.time.now>this.inputDelay.delay[t]&&(this.inputDelay.delay[t]=e.delay+this.game.time.now,!0)}return!1},e.prototype.read=function(e){void 0===e&&(e="LEFT");var t=this.mouseMap[e.toUpperCase()];return{id:t,x:this.metrics.location[t].x,y:this.metrics.location[t].y,active:this.metrics.sensitivityBuffer[t]>0,duration:this.metrics.sensitivityBuffer[t],state:this.metrics.state[t]().state,type:this.metrics.state[t]().type}},e.prototype.getBtnPressType=function(e){var t=this,a="NONE",n=0,i=0;return Object.keys(this.clickSensitvity).forEach(function(o){i++,e>t.clickSensitvity[o]&&(a=o,n=i)}),{val:e,type:a,state:n}},e}(),PHASER_PRELOADER=function(){function e(e){this.game=e.game,this.init(e.delayInSeconds,e.done)}return e.prototype.init=function(e,t){var a,n,i=this;this.game.load.onLoadStart.add(function(){(a=i.game.add.text(i.game.world.centerX,i.game.world.centerY/2,"",{font:"18px Impact",fill:"#fff",align:"center"})).anchor.set(.5),(n=i.game.add.text(i.game.world.centerX,i.game.world.centerY,"",{font:"32px Impact",fill:"#fff",align:"center"})).anchor.set(.5)},this),this.game.load.onFileComplete.add(function(e,t,i,o,r){a.setText("Please wait..."),n.setText(e+"%")},this),this.game.load.onLoadComplete.add(function(){a.setText("File loaded!"),n.setText(""),i.game.time.events.add(Phaser.Timer.SECOND*e,function(){a.destroy(),n.destroy(),t()},i).autoDestroy=!0},this)},e}(),PHASER_SPRITE_MANAGER=function(){function e(){this.game=null,this.sprites={array:[],object:{}},this.spriteCount=0}return e.prototype.assign=function(e){this.game=e},e.prototype.add=function(e){if(0===this.sprites.array.filter(function(t){return t.name===e.name}).length){e.x=void 0!==e.x?e.x:0,e.y=void 0!==e.y?e.y:0,e.group=void 0!==e.group?e.group:null,e.org=void 0!==e.org?e.org:null,e.visible=void 0===e.visible||e.visible,e.alpha=void 0!==e.alpha?e.alpha:1,e.width=void 0!==e.width?e.width:null,e.height=void 0!==e.height?e.height:null;var t=this.game.add.sprite(e.x,e.y,e.reference);return t.name=e.name,t.group=e.group,t.org=e.org,t.defaultPosition={x:e.x,y:e.y},t.visible=e.visible,t.alpha=e.alpha,null!==e.width&&(t.width=e.width),null!==e.height&&(t.height=e.height),t.setDefaultPositions=function(e,t){this.defaultPosition.x=e||this.x,this.defaultPosition.y=t||this.y},t.getDefaultPositions=function(){return this.defaultPosition},t.init=function(){},t.onUpdate=function(){},t.reveal=function(){},t.show=function(){this.visible=!0},t.hide=function(){this.visible=!1},this.sprites.array.push(t),this.sprites.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.addFromAtlas=function(e){if(0===this.sprites.array.filter(function(t){return t.name===e.name}).length){e.x=void 0!==e.x?e.x:0,e.y=void 0!==e.y?e.y:0,e.group=void 0!==e.group?e.group:null,e.org=void 0!==e.org?e.org:null,e.visible=void 0===e.visible||e.visible,e.alpha=void 0!==e.alpha?e.alpha:1,e.width=void 0!==e.width?e.width:null,e.height=void 0!==e.height?e.height:null;var t=this.game.add.sprite(e.x,e.y,e.atlas,e.filename);return t.name=e.name,t.group=e.group,t.org=e.org,t.defaultPosition={x:e.x,y:e.y},t.visible=e.visible,t.alpha=e.alpha,null!==e.width&&(t.width=e.width),null!==e.height&&(t.height=e.height),t.setDefaultPositions=function(e,t){this.defaultPosition.x=e||this.x,this.defaultPosition.y=t||this.y},t.getDefaultPositions=function(){return this.defaultPosition},t.init=function(){},t.onUpdate=function(){},t.reveal=function(){},t.show=function(){this.visible=!0},t.hide=function(){this.visible=!1},this.sprites.array.push(t),this.sprites.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.addTilespriteFromAtlas=function(e){if(0===this.sprites.array.filter(function(t){return t.name===e.name}).length){e.x=void 0!==e.x?e.x:0,e.y=void 0!==e.y?e.y:0,e.group=void 0!==e.group?e.group:null,e.org=void 0!==e.org?e.org:null,e.visible=void 0===e.visible||e.visible,e.alpha=void 0!==e.alpha?e.alpha:1,e.width=void 0!==e.width?e.width:null,e.height=void 0!==e.height?e.height:null;var t=this.game.add.tileSprite(e.x,e.y,e.width,e.height,e.atlas,e.filename);return t.name=e.name,t.group=e.group,t.org=e.org,t.defaultPosition={x:e.x,y:e.y},t.visible=e.visible,t.alpha=e.alpha,null!==e.width&&(t.width=e.width),null!==e.height&&(t.height=e.height),t.setDefaultPositions=function(e,t){this.defaultPosition.x=e||this.x,this.defaultPosition.y=t||this.y},t.getDefaultPositions=function(){return this.defaultPosition},t.init=function(){},t.onUpdate=function(){},t.reveal=function(){},t.show=function(){this.visible=!0},t.hide=function(){this.visible=!1},this.sprites.array.push(t),this.sprites.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.addEmptySprite=function(e){if(0===this.sprites.array.filter(function(t){return t.name===e.name}).length){e.x=void 0!==e.x?e.x:0,e.y=void 0!==e.y?e.y:0,e.group=void 0!==e.group?e.group:null,e.org=void 0!==e.org?e.org:null,e.visible=void 0===e.visible||e.visible,e.alpha=void 0!==e.alpha?e.alpha:1,e.width=void 0!==e.width?e.width:null,e.height=void 0!==e.height?e.height:null;var t=this.game.add.sprite(e.x,e.y);return t.name=e.name,t.group=e.group,t.org=e.org,t.defaultPosition={x:e.x,y:e.y},t.visible=e.visible,t.alpha=e.alpha,null!==e.width&&(t.width=e.width),null!==e.height&&(t.height=e.height),t.setDefaultPositions=function(e,t){this.defaultPosition.x=e||this.x,this.defaultPosition.y=t||this.y},t.getDefaultPositions=function(){return this.defaultPosition},t.init=function(){},t.onUpdate=function(){},t.reveal=function(){},t.show=function(){this.visible=!0},t.hide=function(){this.visible=!1},this.sprites.array.push(t),this.sprites.object[e.name]=t,t}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.createBasicMask=function(e,t,a,n){var i=this.game.add.graphics(0,0);return i.beginFill(16777215),i.drawRect(e,t,a,n),i},e.prototype.addBasicMaskToSprite=function(e){var t=this.game.add.graphics(0,0);return t.beginFill(16777215),t.drawRect(e.x,e.y,e.width,e.height),e.mask=t,t},e.prototype.destroy=function(e){if(void 0!==this.sprites.object[e]){for(var t=[],a=0,n=this.sprites.array.filter(function(t){return t.name===e});a<n.length;a++){var i=n[a];t.push(i.name),i.destroy()}return delete this.sprites.object[e],this.sprites.array=this.sprites.array.filter(function(t){return t.name!==e}),t}return console.log("Cannot delete "+e+" because it does not exist."),null},e.prototype.destroyGroup=function(e){for(var t=[],a=0,n=this.sprites.array.filter(function(t){return t.group===e});a<n.length;a++){var i=n[a];t.push(i.name),i.destroy()}return delete this.sprites.object[e],this.sprites.array=this.sprites.array.filter(function(t){return t.group!==e}),t},e.prototype.get=function(e){return this.sprites.object[e]},e.prototype.getGroup=function(e){return this.sprites.array.filter(function(t){return t.group===e||t.org===e})},e.prototype.getManyGroups=function(e){for(var t=[],a=function(a){var i=n.sprites.array.filter(function(t){return t.group===e[a]||t.org===e[a]});t=t.concat(i)},n=this,i=0;i<e.length;i++)a(i);return t},e.prototype.getOnly=function(e){for(var t={},a=function(a){n.sprites.array.filter(function(t){return t.group===e[a]||t.name===e[a]}).map(function(e){t[e.name]=e})},n=this,i=0;i<e.length;i++)a(i);return t},e.prototype.getAll=function(e){return void 0===e&&(e="OBJECT"),"ARRAY"===e?this.sprites.array:"OBJECT"==e?this.sprites.object:{object:this.sprites.object,array:this.sprites.array}},e.prototype.count=function(){return this.spriteCount++,{total:this.sprites.array.length,unique:this.spriteCount}},e.prototype.centerWorld=function(e){if(void 0===this.sprites.object[e])return console.log("Error centering sprite:  key does not exists."),null;var t=this.sprites.object[e];return t.alignIn(this.game.world.bounds,Phaser.CENTER),t},e.prototype.centerOnPoint=function(e,t,a){if(void 0===this.sprites.object[e])return console.log("Error centering sprite:  key does not exists."),null;var n=this.sprites.object[e];return n.x=t-n.width/2,n.y=a-n.height/2,n},e}(),PHASER_TEXT_MANAGER=function(){function e(){this.game=null,this.texts={array:[],object:{}}}return e.prototype.assign=function(e){this.game=e},e.prototype.add=function(e){var t=this.texts.array.filter(function(t){return t.name===e.name});if(e.x=void 0!==e.x?e.x:0,e.y=void 0!==e.y?e.y:0,e.group=void 0!==e.group?e.group:null,e.size=void 0!==e.size?e.size:12,e.default=void 0!==e.default?e.default:"",e.visible=void 0===e.visible||e.visible,e.alpha=void 0!==e.alpha?e.alpha:1,0===t.length){var a=this.game.add.bitmapText(e.x,e.y,e.font,e.default,e.size);return a.name=e.name,a.group=e.group,a.visible=e.visible,a.alpha=e.alpha,a.init=function(){},a.show=function(){this.visible=!0},a.hide=function(){this.visible=!1},this.texts.array.push(a),this.texts.object[e.name]=a,a}console.log("Duplicate key name not allowed: "+e.name)},e.prototype.destroy=function(e){for(var t=[],a=0,n=this.texts.array.filter(function(t){return t.name===e});a<n.length;a++){var i=n[a];t.push(i.name),i.destroy()}return delete this.texts.object[e],this.texts.array=this.texts.array.filter(function(t){return t.name!==e}),t},e.prototype.destroyGroup=function(e){for(var t=[],a=0,n=this.texts.array.filter(function(t){return t.group===e});a<n.length;a++){var i=n[a];t.push(i.key),i.destroy()}return delete this.texts.object[e],this.texts.array=this.texts.array.filter(function(t){return t.group!==e}),t},e.prototype.get=function(e){return this.texts.object[e]},e.prototype.getGroup=function(e){return this.texts.array.filter(function(t){return t.group===e})},e.prototype.getManyGroups=function(e){for(var t=[],a=function(a){var i=n.texts.array.filter(function(t){return t.group===e[a]});t=t.concat(i)},n=this,i=0;i<e.length;i++)a(i);return t},e.prototype.getAll=function(e){return void 0===e&&(e="OBJECT"),"ARRAY"===e?this.texts.array:"OBJECT"==e?this.texts.object:{object:this.texts.object,array:this.texts.array}},e.prototype.getOnly=function(e){for(var t={},a=function(a){n.texts.array.filter(function(t){return t.group===e[a]||t.name===e[a]}).map(function(e){t[e.name]=e})},n=this,i=0;i<e.length;i++)a(i);return t},e.prototype.alignToBottomLeftCorner=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=t,a.y=n.canvas.height-a.height-t,a},e.prototype.alignToBottomCenter=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=n.canvas.width/2-a.width/2,a.y=n.canvas.height-a.height-t,a},e.prototype.alignToBottomRightCorner=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=n.canvas.width-a.width-t,a.y=n.canvas.height-a.height-t,a},e.prototype.alignToCenterRight=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=n.canvas.width-a.width-t,a.y=n.canvas.height/2-a.height/2,a},e.prototype.alignToTopRightCorner=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=n.canvas.width-a.width-t,a.y=t,a},e.prototype.alignToTopCenter=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=n.canvas.width/2-a.width/2-t,a.y=t,a},e.prototype.alignToTopLeftCorner=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e];this.game;return a.x=t,a.y=t,a},e.prototype.alignToCenterLeft=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=t,a.y=n.canvas.height/2-a.height/2,a},e.prototype.alignToCenter=function(e,t){if(void 0===t&&(t=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var a=this.texts.object[e],n=this.game;return a.x=n.canvas.width/2-a.width/2,a.y=n.canvas.height/2-a.height/2,a},e.prototype.center=function(e,t,a){if(void 0===t&&(t=0),void 0===a&&(a=0),void 0===this.texts.object[e])return console.log("Error centering sprite:  key does not exists."),null;var n=this.texts.object[e],i=this.game;return n.x=i.canvas.width/2-n.width/2+t,n.y=i.canvas.height/2-n.height/2+a,n},e}(),ENEMY_MANAGER=function(){function e(e){this.showHitbox=e.showHitbox}return e.prototype.assign=function(e,t,a,n,i,o,r,s){this.game=e,this.phaserSprites=a,this.phaserMaster=t,this.phaserTexts=n,this.phaserGroup=i,this.weaponManager=o,this.atlas=r,this.atlas_weapons=s},e.prototype.collisionCheck=function(e,t){this.phaserSprites.getManyGroups(["player_hitboxes"]).map(function(a){a.game.physics.arcade.overlap(e,a,function(e,a){a.parent.takeDamage(t),e.destroyIt()},null,e)})},e.prototype.facePlayer=function(e){var t=this.game,a=this.phaserSprites.getOnly(["player"]).player;return 1*Math.ceil(360/(2*Math.PI)*t.math.angleBetween(e.x,e.y,a.x,a.y)-90)},e.prototype.bulletCollisionWithPlayer=function(e,t){var a=this.phaserSprites.getGroup("player_hitboxes").slice();this.game.physics.arcade.overlap(a,e.bullets,function(e,a){e.isInvincible||e.isDead||e.isDamaged||(e.parent.takeDamage(t),a.destroyIt())})},e.prototype.createSmallEnemy1=function(e,t,a,n){var i=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===n&&(n=function(){});var o=this.game,r=(this.phaserMaster,this.phaserSprites),s=this.phaserGroup,l=this.atlas,p=r.addFromAtlas({name:"enemy_"+o.rnd.integer(),group:"enemies",org:"gameobjects",atlas:l,filename:"small_1",visible:!0});p.anchor.setTo(.5,.5),p.scale.setTo(1,1),p.maxHealth=100,p.health=p.maxHealth,p.pierceResistence=1,p.fallThreshold=o.rnd.integerInRange(0,75),p.cosWave={data:o.math.sinCosGenerator(200,.5*o.world.height,0,1).cos,count:0},p.sinWave={data:o.math.sinCosGenerator(o.rnd.integerInRange(200,300),1===o.rnd.integerInRange(0,1)?-50:50,1,3).sin,count:0},p.fireDelay=0,p.fireTimer=1e3,p.isInvincible=!1,p.isDamaged=!1,p.isDestroyed=!1,p.onLayer=e.layer,p.weaponSystems=[],s.add(e.layer,p);["small_1_hitbox_1"].map(function(e){var t=r.addFromAtlas({name:"enemy_hitbox_"+o.rnd.integer(),group:"enemy_hitboxes",atlas:l,filename:e,alpha:i.showHitbox?.75:0});t.anchor.setTo(.5,.5),o.physics.enable(t,Phaser.Physics.ARCADE),p.addChild(t)});var h=Phaser.Animation.generateFrameNames("bullet_fire_",1,4).slice(),u=this.phaserSprites.addFromAtlas({name:"enemy_weapons_"+this.game.rnd.integer(),group:"enemy_weapons",atlas:this.atlas_weapons,filename:h[0],visible:!0});u.anchor.setTo(.5,.5),u.angle=180,u.animations.add("fireWeapon",h,1,!0),u.sync=function(e){var t=e.x,a=e.y;u.x=t,u.y=a},u.destroyIt=function(){var e=u.x,t=u.y;i.weaponManager.blueImpact(e,t,1,p.onLayer),i.phaserSprites.destroy(u.name),setTimeout(function(){u.ammo.destroy()},4e3)},u.onUpdate=function(){d.onUpdate()},u.fire=function(){var e=r.get("player");e.isInvincible||e.isDead?(d.checkOrientation(u),d.fire(u)):d.fire(u,e.x,e.y),u.animations.play("fireWeapon",24,!1)},s.add(e.layer+1,u);var d=this.weaponManager.enemyBullet(3);return d.bulletSpeedVariance=100,d.bulletAngleVariance=20,d.onUpdate=function(){i.bulletCollisionWithPlayer(d,10)},u.ammo=d,p.weaponSystems.push(u),p.onUpdate=function(){r.get("player");n(p),p.weaponSystems.map(function(e){e.onUpdate()}),p.angle=i.facePlayer(p),p.weaponSystems.map(function(e){e.angle=i.facePlayer(p)-180}),o.time.now>p.fireDelay&&!p.isDestroyed&&p.y>.3*p.game.canvas.height&&(p.fireDelay=o.time.now+p.fireTimer,p.weaponSystems.map(function(e){u.fire()})),p.isDestroyed?p.inPlace=!0:(p.y=-p.cosWave.data[p.cosWave.count]-p.height,p.x=p.sinWave.data[p.sinWave.count]+e.x,p.cosWave.count++,p.sinWave.count++,p.cosWave.count>=p.cosWave.data.length&&p.removeIt(),p.weaponSystems.map(function(e){e.sync(p)}))},p.damageIt=function(e){t(p),p.isDamaged=!0,setTimeout(function(){p.isDamaged=!1},150),p.health-=e,p.tint=16711680,p.game.add.tween(p).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),p.health<=0&&p.destroyIt()},p.removeIt=function(){p.weaponSystems.map(function(e){e.destroyIt()}),p.children.map(function(e){i.phaserSprites.destroy(e.name)}),r.destroy(p.name)},p.destroyIt=function(){p.isDestroyed=!0,p.tint=16711680,p.weaponSystems.map(function(e){e.destroyIt()}),p.explodeInterval=setInterval(function(){i.weaponManager.createExplosion(p.x+o.rnd.integerInRange(-p.width/2,p.width/2),p.y+o.rnd.integerInRange(-p.height/2,p.height/2),1,p.onLayer+1)},250),p.game.add.tween(p).to({y:p.y+100,alpha:.5},750,Phaser.Easing.Linear.Out,!0,100,0,!1).onComplete.add(function(){a(p),clearInterval(p.explodeInterval),p.children.map(function(e){i.phaserSprites.destroy(e.name)}),r.destroy(p.name)})},p},e.prototype.createBigEnemy1=function(e,t,a,n,i){var o=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===n&&(n=function(){}),void 0===i&&(i=function(){});var r=this.game,s=(this.phaserMaster,this.phaserSprites),l=this.phaserGroup,p=this.atlas,h=s.addFromAtlas({x:e.x,name:"enemy_"+r.rnd.integer(),group:"enemies",org:"gameobjects",atlas:p,filename:"big_1",visible:!0});h.anchor.setTo(.5,.5),h.scale.setTo(1,1),r.physics.enable(h,Phaser.Physics.ARCADE),h.atTarget=!1,h.maxHealth=1500,h.health=h.maxHealth,h.pierceResistence=4,h.fallThreshold=r.rnd.integerInRange(0,75),h.sinWave=r.math.sinCosGenerator(400+e.y,r.world.height/2,1,1),h.count=0,h.fireDelay=0,h.fireTimer=500,h.inPlace=!1,h.isDestroyed=!1,h.onLayer=e.layer,l.add(e.layer,h);return["big_1_hitbox_1","big_1_hitbox_2"].map(function(e){var t=s.addFromAtlas({name:"enemy_hitbox_"+r.rnd.integer(),group:"enemy_hitboxes",atlas:p,filename:e,alpha:o.showHitbox?.75:0});t.anchor.setTo(.5,.5),r.physics.enable(t,Phaser.Physics.ARCADE),h.addChild(t)}),h.damageIt=function(e){t(h),h.atTarget||(h.health-=e,h.tint=16711680,h.game.add.tween(h).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),h.health<=0&&h.destroyIt())},h.removeIt=function(){s.destroy(h.name)},h.destroyIt=function(){h.children.map(function(e){o.phaserSprites.destroy(e.name)}),h.isDestroyed||(h.isDestroyed=!0,h.tint=16711680,h.explodeInterval=setInterval(function(){o.weaponManager.createExplosion(h.x+r.rnd.integerInRange(-h.width/2,h.width/2),h.y+r.rnd.integerInRange(-h.height/2,h.height/2),1,h.onLayer+1)},100),h.game.add.tween(h).to({y:h.y-15,alpha:.5},750,Phaser.Easing.Linear.Out,!0,100,0,!1).onComplete.add(function(){clearInterval(h.explodeInterval),a(h),o.weaponManager.createExplosion(h.x,h.y,1,e.layer+1),s.destroy(h.name)}))},h.onUpdate=function(){i(h),r.time.now>h.fireDelay&&h.inPlace&&(h.fireDelay=r.time.now+h.fireTimer),!h.isDestroyed&&h.count<h.sinWave.cos.length/2?(h.y=-h.sinWave.cos[h.count]-h.height,h.count++):h.inPlace=!0},h.removeIt=function(){s.destroy(h.name)},h},e.prototype.createAsteroid=function(e,t,a,n,i){var o=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===n&&(n=function(){}),void 0===i&&(i=function(){});var r=this.game,s=(this.phaserMaster,this.phaserSprites),l=this.phaserGroup,p=this.atlas,h=s.addFromAtlas({x:e.x,y:e.y,name:"enemy_"+r.rnd.integer(),group:"enemies",org:"gameobjects",atlas:p,filename:"asteroid_mid_layer_"+r.rnd.integerInRange(1,3),visible:!0});h.anchor.setTo(.5,.5),h.scale.setTo(1.5,1.5),r.physics.enable(h,Phaser.Physics.ARCADE),h.body.velocity.y=e.iy,h.body.velocity.x=e.ix,h.angleMomentum=r.rnd.integerInRange(-5,5),h.body.bounce.setTo(1,1),h.atTarget=!1,h.maxHealth=150,h.health=h.maxHealth,h.pierceResistence=4,h.fallThreshold=r.rnd.integerInRange(0,75),l.add(e.layer,h);return["1_hitbox_1","1_hitbox_2"].map(function(e){var t=s.addFromAtlas({name:"enemy_hitbox_"+r.rnd.integer(),group:"enemy_hitboxes",atlas:p,filename:e,alpha:o.showHitbox?.75:0});t.anchor.setTo(.5,.5),t.destroyIt=function(e){e.body=null,o.phaserSprites.destroy(e.name)},r.physics.enable(t,Phaser.Physics.ARCADE),h.addChild(t)}),h.damageIt=function(e,a){void 0===a&&(a=null),t(h),h.atTarget||(h.health-=e,h.tint=16711680,h.game.add.tween(h).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),h.health<=0&&h.destroyIt())},h.destroyIt=function(){var t={angle:r.rnd.integerInRange(-720,720),x:h.x-r.rnd.integerInRange(-25,25),y:h.y-r.rnd.integerInRange(5,25),alpha:.5};h.game.add.tween(h).to(t,r.rnd.integerInRange(150,500),Phaser.Easing.Linear.Out,!0,0,0,!1),h.body=null,r.time.events.add(Phaser.Timer.SECOND/2,function(){a(h),o.weaponManager.createExplosion(h.x,h.y,1,e.layer+1),s.destroy(h.name)},h).autoDestroy=!0},h.fallToPlanet=function(){h.tint=0,h.atTarget=!0,h.body=null,h.game.add.tween(h).to({y:h.y+60},2*Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,0).autoDestroy=!0,setTimeout(function(){o.game.add.tween(h.scale).to({x:0,y:0},1*Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,r.rnd.integerInRange(0,500)).onComplete.add(function(){n(h),h.removeIt(),o.weaponManager.createExplosion(h.x,h.y,.25,6)}).autoDestroy=!0},300)},h.checkLocation=function(){h.angle+=h.angleMomentum,h.angleMomentum>0&&(h.angleMomentum-=.002),h.angleMomentum<0&&(h.angleMomentum+=.002),h.y>h.height&&null!==h.body&&(h.body.collideWorldBounds=!0),h.y>o.game.canvas.height-(75+h.fallThreshold)&&(null===h.body||h.atTarget||(h.body.collideWorldBounds=!1,h.fallToPlanet()))},h.onUpdate=function(){i(h),r.physics.arcade.collide([s.get("leftBoundry"),s.get("rightBoundry")],h),h.rotate+=2,h.atTarget||(null!==h.body&&(h.body.velocity.y+2<100&&(h.body.velocity.y+=2),h.body.velocity.x>0&&(h.body.velocity.x-=.2),h.body.velocity.x<0&&(h.body.velocity.x+=.2)),h.checkLocation())},h.removeIt=function(){s.destroy(h.name)},h},e.prototype.createDebris=function(e,t,a,n,i){var o=this;void 0===t&&(t=function(e){}),void 0===a&&(a=function(e){}),void 0===n&&(n=function(e){}),void 0===i&&(i=function(e){});var r=this.game,s=(this.phaserMaster,this.phaserSprites),l=this.phaserGroup,p=this.atlas,h=s.addFromAtlas({x:e.x,y:e.y,name:"enemy_"+r.rnd.integer(),group:"enemies",org:"gameobjects",atlas:p,filename:"asteroid_mid_layer_"+r.rnd.integerInRange(1,3),visible:!0});h.anchor.setTo(.5,.5),h.scale.setTo(1,1),r.physics.enable(h,Phaser.Physics.ARCADE),h.body.velocity.y=e.iy,h.body.velocity.x=e.ix,h.angleMomentum=r.rnd.integerInRange(-5,5),h.body.bounce.setTo(1,1),h.atTarget=!1,h.maxHealth=50,h.health=h.maxHealth,h.pierceResistence=1,h.fallThrehold=r.rnd.integerInRange(0,75),l.add(e.layer,h),h.damageIt=function(e,t){void 0===t&&(t=null),h.health-=e,h.tint=16711680,h.game.add.tween(h).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),h.health<=0&&h.destroyIt(h)},h.removeIt=function(){s.destroy(h.name)},h.fallToPlanet=function(){h.tint=0,h.atTarget=!0,h.body=null,h.game.add.tween(h).to({y:h.y+60},2*Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,0).autoDestroy=!0,setTimeout(function(){o.game.add.tween(h.scale).to({x:0,y:0},1*Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,r.rnd.integerInRange(0,500)).onComplete.add(function(){n(h),h.removeIt(),o.weaponManager.createExplosion(h.x,h.y,.25,6)}).autoDestroy=!0},300)},h.destroyIt=function(){var e={angle:r.rnd.integerInRange(-720,720),x:h.x-r.rnd.integerInRange(-25,25),y:h.y-r.rnd.integerInRange(5,25),alpha:.5};h.game.add.tween(h).to(e,r.rnd.integerInRange(50,200),Phaser.Easing.Linear.Out,!0,0,0,!1),h.body=null,r.time.events.add(Phaser.Timer.SECOND/3,function(){a(h),o.weaponManager.createExplosion(h.x,h.y,.5,6),s.destroy(h.name)},h).autoDestroy=!0},h.checkLocation=function(){h.angle+=h.angleMomentum,h.angleMomentum>0&&(h.angleMomentum-=.002),h.angleMomentum<0&&(h.angleMomentum+=.002),h.y>h.height&&null!==h.body&&(h.body.collideWorldBounds=!0),h.y>o.game.canvas.height-(50+h.fallThrehold)&&(null===h.body||h.atTarget||(h.body.collideWorldBounds=!1,h.fallToPlanet())),h.y>o.game.canvas.height+h.height&&h.removeIt()},h.onUpdate=function(){r.physics.arcade.collide([s.get("leftBoundry"),s.get("rightBoundry")],h),h.rotate+=4,null!==h.body&&(h.body.velocity.y+1<50&&(h.body.velocity.y+=1),h.body.velocity.x>0&&(h.body.velocity.x-=.2),h.body.velocity.x<0&&(h.body.velocity.x+=.2)),h.checkLocation()}},e.prototype.createGiantAsteroid=function(e,t,a,n,i){var o=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===n&&(n=function(){}),void 0===i&&(i=function(){});var r=this.game,s=(this.phaserMaster,this.phaserSprites),l=this.phaserGroup,p=this.atlas,h=s.addFromAtlas({x:e.x,y:e.y,name:"enemy_"+r.rnd.integer(),group:"boss",atlas:p,filename:"asteroid_large_layer_"+r.rnd.integerInRange(1,3),visible:!0});return h.anchor.setTo(.5,.5),r.physics.enable(h,Phaser.Physics.ARCADE),h.body.velocity.y=e.iy,h.body.velocity.x=e.ix,h.angleMomentum=r.rnd.integerInRange(-5,5),h.body.bounce.setTo(1,1),h.atTarget=!1,h.maxHealth=5e3,h.health=h.maxHealth,h.pierceResistence=50,l.add(e.layer,h),h.damageIt=function(e,a){void 0===a&&(a=null),t(h),h.atTarget||(h.health-=e,h.tint=16711680,h.game.add.tween(h).to({tint:16777215},100,Phaser.Easing.Linear.Out,!0,0,0,!1),h.health<=0&&h.destroyIt())},h.destroyIt=function(t){void 0===t&&(t=!0);var n={angle:720,x:h.x-r.rnd.integerInRange(-10,10),y:h.y-r.rnd.integerInRange(10,10),alpha:.15};h.game.add.tween(h).to(n,2*Phaser.Timer.SECOND,Phaser.Easing.Linear.Out,!0,0,0,!1),h.game.add.tween(h.scale).to({x:.5,y:.5},2*Phaser.Timer.SECOND,Phaser.Easing.Linear.Out,!0,0,0,!1),h.body=null,r.time.events.add(Phaser.Timer.SECOND/2,function(){a(h),o.weaponManager.createImpactExplosion(h.x,h.y,2.5,e.layer+1),s.destroy(h.name)},h).autoDestroy=!0},h.fallToPlanet=function(){h.tint=0,h.atTarget=!0,h.body=null,h.game.add.tween(h).to({y:h.y+60},2*Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,0).autoDestroy=!0,setTimeout(function(){o.game.add.tween(h.scale).to({x:0,y:0},1*Phaser.Timer.SECOND,Phaser.Easing.Linear.In,!0,r.rnd.integerInRange(0,500)).onComplete.add(function(){n(h),h.removeIt(),o.weaponManager.createExplosion(h.x,h.y,.25,6)}).autoDestroy=!0},300)},h.checkLocation=function(){h.angle+=h.angleMomentum,h.angleMomentum>0&&(h.angleMomentum-=.002),h.angleMomentum<0&&(h.angleMomentum+=.002),h.y>h.height&&null!==h.body&&(h.body.collideWorldBounds=!0),h.y>h.game.canvas.height-h.height&&(null===h.body||h.atTarget||(h.body.collideWorldBounds=!1,h.fallToPlanet()))},h.onUpdate=function(){i(h),r.physics.arcade.collide([s.get("leftBoundry"),s.get("rightBoundry")],h),h.rotate+=2,h.atTarget||(null!==h.body&&(h.body.velocity.y+1<25&&(h.body.velocity.y+=1),h.body.velocity.x>0&&(h.body.velocity.x-=.2),h.body.velocity.x<0&&(h.body.velocity.x+=.2)),h.checkLocation())},h.removeIt=function(){s.destroy(h.name)},h},e}(),ITEMSPAWN_MANAGER=function(){function e(){}return e.prototype.assign=function(e,t,a,n,i){this.game=e,this.phaserSprites=a,this.phaserMaster=t,this.phaserGroup=n,this.atlas=i},e.prototype.spawnHealthpack=function(e,t,a,n){var i=this;void 0===n&&(n=function(){});var o=Phaser.Animation.generateFrameNames("healthpack_",1,4).slice(),r=this.phaserSprites.addFromAtlas({name:"healthpack_"+this.game.rnd.integer(),group:"itemspawns",x:e,y:t,atlas:this.atlas,filename:o[0]});r.animations.add("animate",o,8,!0),r.animations.play("animate"),r.anchor.setTo(.5,.5),r.blinkLifespan=this.game.time.now+10*Phaser.Timer.SECOND,r.blinkLifespanInterval=this.game.time.now,r.blinkLifespanCount=0,this.game.physics.enable(r,Phaser.Physics.ARCADE),r.body.collideWorldBounds=!0,r.body.bounce.setTo(1,1),r.body.velocity.y=this.game.rnd.integerInRange(50,50),r.body.velocity.x=this.game.rnd.integerInRange(-200,200),r.destroyIt=function(){i.phaserSprites.destroy(r.name)},r.pickedUp=function(){i.phaserSprites.destroy(r.name)},r.onUpdate=function(){i.game.time.now>r.blinkLifespan&&r.destroyIt(),i.game.time.now>r.blinkLifespan-3*Phaser.Timer.SECOND&&i.game.time.now>r.blinkLifespanInterval&&(r.blinkLifespanInterval=i.game.time.now+200-5*r.blinkLifespanCount,r.alpha=r.blinkLifespanCount%2==0?.25:1,r.blinkLifespanCount++),i.phaserSprites.getManyGroups(["playership"]).map(function(e){e.game.physics.arcade.overlap(r,e,function(e,t){n(),r.pickedUp()},null,r)})},this.phaserGroup.add(a,r)},e.prototype.spawnPowerup=function(e,t,a,n){var i=this;void 0===n&&(n=function(){});var o=Phaser.Animation.generateFrameNames("powerup_",1,4).slice(),r=this.phaserSprites.addFromAtlas({name:"healthpack_"+this.game.rnd.integer(),group:"itemspawns",x:e,y:t,atlas:this.atlas,filename:o[0]});r.animations.add("animate",o,8,!0),r.animations.play("animate"),r.anchor.setTo(.5,.5),r.blinkLifespan=this.game.time.now+10*Phaser.Timer.SECOND,r.blinkLifespanInterval=this.game.time.now,r.blinkLifespanCount=0,this.game.physics.enable(r,Phaser.Physics.ARCADE),r.body.collideWorldBounds=!0,r.body.bounce.setTo(1,1),r.body.velocity.y=this.game.rnd.integerInRange(50,50),r.body.velocity.x=this.game.rnd.integerInRange(-200,200),r.destroyIt=function(){i.phaserSprites.destroy(r.name)},r.pickedUp=function(){i.phaserSprites.destroy(r.name)},r.onUpdate=function(){i.game.time.now>r.blinkLifespan&&r.destroyIt(),i.game.time.now>r.blinkLifespan-3*Phaser.Timer.SECOND&&i.game.time.now>r.blinkLifespanInterval&&(r.blinkLifespanInterval=i.game.time.now+200-5*r.blinkLifespanCount,r.alpha=r.blinkLifespanCount%2==0?.25:1,r.blinkLifespanCount++),i.phaserSprites.getManyGroups(["playership"]).map(function(e){e.game.physics.arcade.overlap(r,e,function(e,t){n(),r.pickedUp()},null,r)})},this.phaserGroup.add(a,r)},e.prototype.spawnSpecial=function(e,t,a,n){var i=this;void 0===n&&(n=function(){});var o=Phaser.Animation.generateFrameNames("special_",1,5).slice(),r=this.phaserSprites.addFromAtlas({name:"healthpack_"+this.game.rnd.integer(),group:"itemspawns",x:e,y:t,atlas:this.atlas,filename:o[0]});r.animations.add("animate",o,8,!0),r.animations.play("animate"),r.anchor.setTo(.5,.5),r.blinkLifespan=this.game.time.now+10*Phaser.Timer.SECOND,r.blinkLifespanInterval=this.game.time.now,r.blinkLifespanCount=0,this.game.physics.enable(r,Phaser.Physics.ARCADE),r.body.collideWorldBounds=!0,r.body.bounce.setTo(1,1),r.body.velocity.y=this.game.rnd.integerInRange(50,50),r.body.velocity.x=this.game.rnd.integerInRange(-200,200),r.destroyIt=function(){i.phaserSprites.destroy(r.name)},r.pickedUp=function(){i.phaserSprites.destroy(r.name)},r.onUpdate=function(){i.game.time.now>r.blinkLifespan&&r.destroyIt(),i.game.time.now>r.blinkLifespan-3*Phaser.Timer.SECOND&&i.game.time.now>r.blinkLifespanInterval&&(r.blinkLifespanInterval=i.game.time.now+200-5*r.blinkLifespanCount,r.alpha=r.blinkLifespanCount%2==0?.25:1,r.blinkLifespanCount++),i.phaserSprites.getManyGroups(["playership"]).map(function(e){e.game.physics.arcade.overlap(r,e,function(e,t){n(),r.pickedUp()},null,r)})},this.phaserGroup.add(a,r)},e}(),PLAYER_MANAGER=function(){function e(){}return e.prototype.assign=function(e,t,a,n,i,o,r,s,l){this.game=e,this.phaserSprites=a,this.phaserMaster=t,this.phaserTexts=n,this.phaserGroup=i,this.phaserControls=o,this.weaponManager=r,this.atlas=s,this.weaponAtlas=l,this.player=null},e.prototype.createShip=function(e,t,a,n,i){var o=this;void 0===t&&(t=function(){}),void 0===a&&(a=function(){}),void 0===n&&(n=function(){}),void 0===i&&(i=function(){});var r=this.game,s=(e.shipId,this.phaserMaster.getOnly(["gameData"]).gameData),l=this.phaserMaster.getOnly(["starMomentum"]).starMomentum,p=this.phaserSprites.addFromAtlas({name:e.name,group:e.group,org:e.org,atlas:this.atlas,filename:"ship_base_form",visible:!1});p.anchor.setTo(.5,.5),p.scale.setTo(1,1),p.isInvincible=!1,p.isDead=!0,p.isDamaged=!1,p.isForceMoved=!1,p.ignoreBoundaries=null,p.onLayer=e.layer,p.primaryWeapon=e.primaryWeapon,p.secondaryWeapon=e.secondaryWeapon,p.perk=e.perk,p.weaponSystems=[],p.subweaponSystems=[],p.attachments=[],p.xCapture=[],p.yCapture=[],p.clearEnemyBulletsInterval;var h=Phaser.Animation.generateFrameNames("ship_start_",1,7).slice(),u=Phaser.Animation.generateFrameNames("ship_explode_",1,5).slice(),d=Phaser.Animation.generateFrameNames("ship_explode_",6,7).slice();p.animations.add("shipDamage",["ship_damage","ship_damage","ship_damage","ship_damage","ship_start_7"],1,!0),p.animations.add("shipStart",h,1,!0),p.animations.add("preExplode",u,1,!0),p.animations.add("preExplodeLoop",d,1,!0),r.physics.enable(p,Phaser.Physics.ARCADE),this.phaserGroup.add(e.layer,p);["ship_hitbox_1","ship_hitbox_2"].map(function(e,t){var a=o.phaserSprites.addFromAtlas({y:10,name:"player_hitbox_"+t,group:"player_hitboxes",atlas:o.atlas,filename:e,alpha:0});a.anchor.setTo(.5,.5),r.physics.enable(a,Phaser.Physics.ARCADE),p.addChild(a)});var c=Phaser.Animation.generateFrameNames("ship_fullpower_",1,7).concat(Phaser.Animation.generateFrameNames("ship_fullpower__",1,7).reverse()),m=this.phaserSprites.addFromAtlas({name:"ship_fullpower_addon",atlas:this.atlas,filename:c[0],visible:!1});m.anchor.setTo(.5,.5),m.animations.add("fullpower",c,1,!0),m.animations.play("fullpower",45,!0),p.addChild(m);var g=Phaser.Animation.generateFrameNames("exhaust_",1,3),y=this.phaserSprites.addFromAtlas({y:45,name:"bottom_exhaust",group:e.group,atlas:this.atlas,filename:g[0],alpha:1});y.anchor.setTo(.5,.5),y.animations.add("animate",g,1,!0),y.animations.play("animate",12,!0),y.sync=function(e){var t=e.x,a=e.y,n=e.alpha,i=e.isDead;y.x=t,y.y=a+40,y.alpha=i?0:n,y.visible=l.y>=0},p.attachments.push(y),this.phaserGroup.add(e.layer-1,y);var f=this.phaserSprites.addFromAtlas({y:0,name:"top_exhaust",group:e.group,atlas:this.atlas,filename:g[0],alpha:1});return f.anchor.setTo(.5,.5),f.angle=180,f.animations.add("animate",g,1,!0),f.animations.play("animate",12,!0),f.sync=function(e){var t=e.x,a=e.y,n=e.alpha;f.x=t,f.y=a,f.alpha=e.isDead?0:n,f.visible=l.y<0},p.attachments.push(f),this.phaserGroup.add(e.layer-1,f),p.clearAllEnemyBullets=function(e){p.clearEnemyBulletsInterval=r.time.now+e},p.onUpdate=function(){m.visible=s.player.powerup>=30,p.xCapture.length>0&&(p.x+=p.xCapture[0],p.xCapture.shift()),p.yCapture.length>0&&(p.y+=p.yCapture[0],p.yCapture.shift()),p.ignoreBoundaries||p.checkLimits(),p.isForceMoved;var e=[];p.weaponSystems.concat(p.subweaponSystems).map(function(t){t.angle=p.angle,t.onUpdate(),t.sync(p),e.push(t.ammo),o.bulletCollisionDetection(t.ammo)}),p.attachments.map(function(e){e.sync(p)}),i(p)},p.restoreHealth=function(e){var a=o.phaserMaster.getOnly(["gameData"]).gameData.player.health+e;a>100&&(a=100),t(a)},p.takeDamage=function(e){a(p);var i=o.phaserMaster.getOnly(["gameData"]).gameData.player.health-e;t(i),i>0?(p.animations.play("shipDamage",45,!1),p.isDamaged=!0,setTimeout(function(){p.isDamaged=!1},250),p.tint=16711680,p.alpha=.75,p.game.add.tween(p).to({tint:16777215,alpha:1},10,Phaser.Easing.Linear.Out,!0,100,0,!1).onComplete.add(function(){setTimeout(function(){p.isInvincible=!1},500)})):(p.isDestroyed(),n(p))},p.isDestroyed=function(e){void 0===e&&(e=!0),p.isDead=!0,p.isInvincible=!0,p.destroyWeaponSystems(),p.onUpdate(),o.weaponManager.createExplosion(p.x,p.y,1,6),r.add.tween(o).to({angle:r.rnd.integerInRange(-90,90),alpha:0},1e3,Phaser.Easing.Linear.In,!0,0).onComplete.add(function(){o.weaponManager.createExplosion(p.x,p.y,1,6),p.visible=!1})},p.destroyWeaponSystems=function(){p.weaponSystems.map(function(e){e.destroyIt(),e.ammo.destroy()}),p.weaponSystems=[]},p.attachPerk=function(t){o.attachPerk(p,e,t)},p.attachWeapon=function(t){o.attachWeaponSprite(p,e,t)},p.attachSubweapon=function(t){o.attachSubWeaponSprite(p,e,t)},p.fireWeapon=function(){p.weaponSystems.map(function(e){e.fire()})},p.fireSubweapon=function(){p.subweaponSystems.map(function(e){e.fire()})},p.regenerateHealth=function(e){void 0===e&&(e=!1)},p.moveX=function(e){p.xCapture[0]=e},p.moveY=function(e){p.yCapture[0]=e},p.checkLimits=function(){this.y-this.height<0&&(this.y=this.height),this.y+this.height>this.game.canvas.height&&(this.y=this.game.canvas.height-this.height),this.x<0&&(this.x=this.game.canvas.width+this.width),this.x>this.game.canvas.width+this.width&&(this.x=0)},p.moveTo=function(e,t,a,n){void 0===n&&(n=function(){}),p.isInvincible=!0,p.isForceMoved=!0,o.phaserControls.disableAllInput(),r.add.tween(p).to({x:e,y:t},a,Phaser.Easing.Exponential.InOut,!0,0,0,!1).onComplete.add(function(){p.isInvincible=!1,p.isForceMoved=!1,o.phaserControls.enableAllInput(),n()})},p.moveToStart=function(e){void 0===e&&(e=function(){}),p.isDead=!1,p.isInvincible=!0,p.ignoreBoundaries=!0,p.x=o.game.world.centerX,p.y=2*o.game.world.height,setTimeout(function(){p.alpha=1,p.visible=!0,r.add.tween(p).to({y:r.world.centerY+100},1e3,Phaser.Easing.Exponential.InOut,!0,0,0,!1).onComplete.add(function(){p.ignoreBoundaries=!1,o.phaserControls.enableAllInput(),p.attachWeapon(p.primaryWeapon),p.attachSubweapon(p.secondaryWeapon),p.animations.play("shipStart",12,!1),setTimeout(function(){p.isInvincible=!1,e()},1e3)})},100)},p.playEndSequence=function(e){p.isInvincible=!0,p.game.add.tween(p.scale).to({x:2,y:2},750,Phaser.Easing.Exponential.InOut,!0,0,0,!1),p.game.add.tween(p).to({x:r.world.centerX,y:r.world.centerY+50},750,Phaser.Easing.Exponential.InOut,!0,0,0,!1).onComplete.add(function(){p.game.add.tween(p).to({y:r.world.height+200},750,Phaser.Easing.Exponential.InOut,!0,100,0,!1).onComplete.add(function(){p.game.add.tween(p).to({y:-200},1e3,Phaser.Easing.Exponential.InOut,!0,0,0,!1).onComplete.add(function(){e()},p)},p)},p)},this.player=p,p},e.prototype.attachPerk=function(e,t,a){var n,i,o,r=this;switch(a){case"FIREPOWER":n=Phaser.Animation.generateFrameNames("firepower_",1,8).concat(Phaser.Animation.generateFrameNames("firepower_",1,8).reverse()),i=30;break;case"ARMORPLATING":n=["armor_plating"],i=30;break;case"REGEN":n=Phaser.Animation.generateFrameNames("shield_layer_",1,8).slice(),i=30}void 0!==this.phaserSprites.get(t.name+"_ship_perk")&&this.phaserSprites.destroy(t.name+"_ship_perk"),"REGEN"===a?((o=this.phaserSprites.addFromAtlas({name:t.name+"_ship_perk",group:t.group,atlas:this.atlas,filename:n[0],alpha:.5})).anchor.setTo(.5,.5),o.scale.set(1.25,1.25),o.tweenFadeIn=function(){r.game.add.tween(o).to({alpha:.8},1e3,Phaser.Easing.Linear.In,!0,8e3).onComplete.add(function(){e.regenerateHealth(!0),o.tweenFadeOut()})},o.tweenFadeOut=function(){r.game.add.tween(o).to({alpha:0},1e3,Phaser.Easing.Linear.In,!0,1e3).onComplete.add(function(){e.regenerateHealth(!1),o.tweenFadeIn()})},setTimeout(function(){void 0!==o&&o.tweenFadeOut()},500),o.animations.add("animate",n,1,!0),o.animations.play("animate",i,!0),e.addChild(o)):((o=this.phaserSprites.addFromAtlas({name:t.name+"_ship_perk",group:t.group,atlas:this.atlas,filename:n[0],visible:!0})).anchor.setTo(.5,.5),o.animations.add("animate",n,1,!0),o.animations.play("animate",i,!0),e.addChild(o))},e.prototype.attachSubWeaponSprite=function(e,t,a){var n=this,i=Phaser.Animation.generateFrameNames("laser_fire_",1,6).slice(),o=this.phaserSprites.addFromAtlas({name:"ship_weapon_"+this.game.rnd.integer(),group:t.group,atlas:this.weaponAtlas,filename:i[0]});o.anchor.setTo(.5,.5),i.length>0&&o.animations.add("fireWeapon",i,1,!0),o.onUpdate=function(){r.onUpdate()},o.sync=function(e){var t=e.x,a=e.y;o.x=t,o.y=a},o.destroyIt=function(){var t=o.x,a=o.y;n.weaponManager.blueImpact(t,a,1,e.onLayer),n.phaserSprites.destroy(o.name)},o.fire=function(){r.fireOffset(0,-32)},this.phaserGroup.add(t.layer+1,o);var r=this.weaponManager.createClusterbomb(4,function(){e.clearAllEnemyBullets(2*Phaser.Timer.SECOND)});r.onUpdate=function(){},r.trackSprite(o,0,0),o.ammo=r,e.subweaponSystems.push(o)},e.prototype.attachWeaponSprite=function(e,t,a){switch(a){case"BULLET":this.attachBullet(e,t,a);break;case"SPREAD":this.attachSpread(e,t,a);break;case"LASER":this.attachLaser(e,t,a);break;case"MISSLE":this.attachMissle(e,t,a);break;case"SHOTGUN":this.attachShotgun(e,t,a);break;case"GATLING":this.attachGatling(e,t,a)}},e.prototype.attachLaser=function(e,t,a){for(var n=this,i=Phaser.Animation.generateFrameNames("laser_fire_",1,6).slice(),o=function(o){var s=r.phaserSprites.addFromAtlas({name:"ship_weapon_"+r.game.rnd.integer(),group:t.group,atlas:r.weaponAtlas,filename:i[0],alpha:0});s.anchor.setTo(.5,.5),i.length>0&&s.animations.add("fireWeapon",i,1,!0),s.offset=35*o-70,s.index=o,s.onUpdate=function(){l.onUpdate()},s.sync=function(e){var t=e.x,a=e.y;s.x=t+s.offset,s.y=a},s.destroyIt=function(){var t=s.x,a=s.y;n.weaponManager.blueImpact(t,a,1,e.onLayer),n.phaserSprites.destroy(s.name)},s.fire=function(){var e=n.phaserMaster.getOnly(["gameData"]).gameData,t=Math.floor((e.player.powerup-1)/5);l.fireAngle=270+s.angle,0==t&&2===s.index&&(l.fireOffset(0,-32),i.length>0&&s.animations.play("fireWeapon",60,!1)),1!=t||1!==s.index&&3!==s.index||(l.fireOffset(0,-32),i.length>0&&s.animations.play("fireWeapon",60,!1)),2!=t||1!==s.index&&2!==s.index&&3!==s.index||(l.fireOffset(0,-32),i.length>0&&s.animations.play("fireWeapon",60,!1)),3!=t||0!==s.index&&1!==s.index&&3!==s.index&&4!==s.index||(l.fireOffset(0,-32),i.length>0&&s.animations.play("fireWeapon",60,!1)),t>=4&&(l.fireOffset(0,-32),i.length>0&&s.animations.play("fireWeapon",60,!1))},r.phaserGroup.add(t.layer+1,s);var l=r.weaponManager.playerBullets(4,a);l.checkOrientation(s.angle),l.onUpdate=function(){};var p=void 0;switch(o){case 0:p=0;break;case 1:p=-20;break;case 2:p=-40;break;case 3:p=-20;break;case 4:p=0}l.trackSprite(s,0,p),s.ammo=l,e.weaponSystems.push(s)},r=this,s=0;s<5;s++)o(s)},e.prototype.attachShotgun=function(e,t,a){for(var n=this,i=Phaser.Animation.generateFrameNames("bullet_fire_",1,4).slice(),o=function(o){var s=r.phaserSprites.addFromAtlas({name:"ship_weapon_"+r.game.rnd.integer(),group:t.group,atlas:r.weaponAtlas,filename:i[0]});s.anchor.setTo(.5,.5),i.length>0&&s.animations.add("fireWeapon",i,1,!0),s.offset=20*o-0,s.index=o,s.onUpdate=function(){l.onUpdate()},s.sync=function(e){var t=e.x,a=e.y;s.x=t+s.offset,s.y=a},s.destroyIt=function(){var t=s.x,a=s.y;n.weaponManager.blueImpact(t,a,1,e.onLayer),n.phaserSprites.destroy(s.name)},s.fire=function(){for(var e=n.phaserMaster.getOnly(["gameData"]).gameData,t=Math.floor((e.player.powerup-1)/5),a=0;a<5*(t+1);a++)l.fireAngle=270+s.angle,l.fire(s,null,s+1);i.length>0&&s.animations.play("fireWeapon",60,!1)},r.phaserGroup.add(t.layer+1,s);var l=r.weaponManager.playerBullets(60,a);l.checkOrientation(s.angle),l.onUpdate=function(){},l.trackSprite(s,0,-20),s.ammo=l,e.weaponSystems.push(s)},r=this,s=0;s<1;s++)o(s)},e.prototype.attachBullet=function(e,t,a){for(var n=this,i=Phaser.Animation.generateFrameNames("bullet_fire_",1,4).slice(),o=function(o){var s=r.phaserSprites.addFromAtlas({name:"ship_weapon_"+r.game.rnd.integer(),group:t.group,atlas:r.weaponAtlas,filename:i[0],alpha:0});s.anchor.setTo(.5,.5),i.length>0&&s.animations.add("fireWeapon",i,1,!0),s.offset=25*o-175,s.index=o,s.onUpdate=function(){l.onUpdate()},s.sync=function(e){var t=e.x,a=e.y;s.x=t+s.offset,s.y=a},s.destroyIt=function(){var t=s.x,a=s.y;n.weaponManager.blueImpact(t,a,1,e.onLayer),n.phaserSprites.destroy(s.name)},s.fire=function(){var e=n.phaserMaster.getOnly(["gameData"]).gameData,t=Math.floor((e.player.powerup-1)/5);l.fireAngle=270+s.angle,t>=0&&(6===s.index||8===s.index)&&(l.fireOffset(0,-35),i.length>0&&s.animations.play("fireWeapon",60,!1)),t>=1&&7===s.index&&(l.fireOffset(0,-25),i.length>0&&s.animations.play("fireWeapon",60,!1)),t>=2&&(5===s.index||9===s.index)&&(l.fireOffset(0,-15),i.length>0&&s.animations.play("fireWeapon",60,!1)),t>=3&&(4===s.index||10===s.index)&&(l.fireOffset(0,-5),i.length>0&&s.animations.play("fireWeapon",60,!1)),t>=4&&(3===s.index||11===s.index)&&(l.fireOffset(0,5),i.length>0&&s.animations.play("fireWeapon",60,!1)),t>=5&&(2===s.index||12===s.index)&&(l.fireOffset(0,15),i.length>0&&s.animations.play("fireWeapon",60,!1))},r.phaserGroup.add(t.layer+1,s);var l=r.weaponManager.playerBullets(4,a);l.checkOrientation(s.angle),l.onUpdate=function(){},l.trackSprite(s,0,-20),s.ammo=l,e.weaponSystems.push(s)},r=this,s=0;s<15;s++)o(s)},e.prototype.attachSpread=function(e,t,a){for(var n=this,i=Phaser.Animation.generateFrameNames("bullet_fire_",1,4).slice(),o=this.phaserMaster.getOnly(["gameData"]).gameData,r=Math.floor((o.player.powerup-1)/5),s=5===r?2:1,l=function(o){var l=p.phaserSprites.addFromAtlas({name:"ship_weapon_"+p.game.rnd.integer(),group:t.group,atlas:p.weaponAtlas,filename:i[0]});l.anchor.setTo(.5,.5),i.length>0&&l.animations.add("fireWeapon",i,1,!0),l.offset=20*o-10*(s-1),l.onUpdate=function(){u.onUpdate()},l.sync=function(e){var t=e.x,a=e.y;l.x=t+l.offset,l.y=a},l.destroyIt=function(){var t=l.x,a=l.y;n.weaponManager.blueImpact(t,a,1,e.onLayer),n.phaserSprites.destroy(l.name)},l.fire=function(){var e=n.phaserMaster.getOnly(["gameData"]).gameData,t=Math.floor((e.player.powerup-1)/5);u.fire(l,null,l+1),t>=0&&(u.fire(l,l.x+30,l.y-200),u.fire(l,l.x-30,l.y-200)),t>=1&&(u.fire(l,l.x+60,l.y-200),u.fire(l,l.x-60,l.y-200)),t>=2&&(u.fire(l,l.x+90,l.y-200),u.fire(l,l.x-90,l.y-200)),t>=3&&(u.fire(l,l.x+120,l.y-200),u.fire(l,l.x-120,l.y-200)),t>=4&&(u.fire(l,l.x+150,l.y-200),u.fire(l,l.x-150,l.y-200)),t>=5&&(u.fire(l,l.x+180,l.y-200),u.fire(l,l.x-180,l.y-200)),i.length>0&&l.animations.play("fireWeapon",60,!1)},p.phaserGroup.add(t.layer+1,l);var h=12*(r+2),u=p.weaponManager.playerBullets(h,a);u.checkOrientation(l.angle),u.onUpdate=function(){},l.ammo=u,e.weaponSystems.push(l)},p=this,h=0;h<s;h++)l(h)},e.prototype.attachMissle=function(e,t,a){for(var n=this,i=Phaser.Animation.generateFrameNames("missle_fire_",1,4).slice(),o=this.phaserMaster.getOnly(["gameData"]).gameData,r=Math.floor((o.player.powerup-1)/5),s=5===r?2:1,l=function(o){var l=p.phaserSprites.addFromAtlas({name:"ship_weapon_"+p.game.rnd.integer(),group:t.group,atlas:p.weaponAtlas,filename:i[0],visible:!0});l.anchor.setTo(.5,.5),i.length>0&&l.animations.add("fireWeapon",i,1,!0),l.offset=20*o-10*(s-1),l.onUpdate=function(){u.onUpdate()},l.sync=function(e){var t=e.x,a=e.y;l.x=t+l.offset,l.y=a},l.destroyIt=function(){var t=l.x,a=l.y;n.weaponManager.blueImpact(t,a,1,e.onLayer),n.phaserSprites.destroy(l.name)},l.fire=function(){var e=n.phaserMaster.getOnly(["gameData"]).gameData,t=Math.floor((e.player.powerup-1)/5);u.fireAngle=270+l.angle,u.fire(l),t>=0&&(u.fire(l),u.fire(l)),t>=1&&(u.fire(l),u.fire(l)),t>=3&&(u.fire(l),u.fire(l)),t>=4&&(u.fire(l),u.fire(l)),t>=5&&(u.fire(l),u.fire(l)),i.length>0&&l.animations.play("fireWeapon",60,!1)},p.phaserGroup.add(t.layer+1,l);var h=8*(r+2),u=p.weaponManager.playerBullets(h,a);u.checkOrientation(l.angle),u.onUpdate=function(){},l.ammo=u,e.weaponSystems.push(l)},p=this,h=0;h<s;h++)l(h)},e.prototype.attachGatling=function(e,t,a){for(var n=this,i=Phaser.Animation.generateFrameNames("missle_fire_",1,4).slice(),o=this.phaserMaster.getOnly(["gameData"]).gameData,r=(Math.floor((o.player.powerup-1)/5),function(o){var r=s.phaserSprites.addFromAtlas({name:"ship_weapon_"+s.game.rnd.integer(),group:t.group,atlas:s.weaponAtlas,filename:i[0],visible:!0});r.anchor.setTo(.5,.5),i.length>0&&r.animations.add("fireWeapon",i,1,!0),r.offset=20*o-0,r.onUpdate=function(){l.onUpdate()},r.sync=function(e){var t=e.x,a=e.y;r.x=t+r.offset,r.y=a},r.destroyIt=function(){var t=r.x,a=r.y;n.weaponManager.blueImpact(t,a,1,e.onLayer),n.phaserSprites.destroy(r.name)},r.fire=function(){var e=n.phaserMaster.getOnly(["gameData"]).gameData,t=Math.floor((e.player.powerup-1)/5);l.fireAngle=270+r.angle,l.fire(r,null,r+1),t>=1&&setTimeout(function(){l.fire(r,null,r+20)},50),t>=2&&setTimeout(function(){l.fire(r,null,r-20)},100),t>=3&&setTimeout(function(){l.fire(r,null,r+20)},150),t>=4&&setTimeout(function(){l.fire(r,null,r-20)},200),t>=5&&setTimeout(function(){l.fire(r,null,r-20)},250),i.length>0&&r.animations.play("fireWeapon",60,!1)},s.phaserGroup.add(t.layer+1,r);var l=s.weaponManager.playerBullets(45,a);l.checkOrientation(r.angle),l.onUpdate=function(){},r.ammo=l,e.weaponSystems.push(r)}),s=this,l=0;l<1;l++)r(l)},e.prototype.bulletCollisionDetection=function(e){var t=this,a=this.phaserSprites.getGroup("enemy_hitboxes").slice();this.player.clearEnemyBulletsInterval>this.game.time.now&&a.map(function(e){return e.parent.weaponSystems.map(function(e){return e.ammo.bullets.children.map(function(e){return e})})}).map(function(e){e.map(function(e){e.map(function(e){e.alive&&e.destroyIt()})})});this.game.physics.arcade.overlap(a,e.bullets,function(e,a){var n=e.parent;if(!n.isDestroyed){var i=a.weaponData;(!n.isDamaged&&!n.isDestroyed||i.ignoreDamageState&&!n.isDestroyed)&&("LASER"===i.reference&&t.weaponManager.electricDischarge(a.x,a.y-a.height,1,n.onLayer+1),"SPREAD"===i.reference&&t.weaponManager.blueImpact(a.x,a.y-a.height,1,n.onLayer+1),"SHOTGUN"===i.reference&&t.weaponManager.pelletImpact(a.x,a.y-a.height,1,n.onLayer+1),"GATLING"===i.reference&&t.weaponManager.pelletImpact(a.x,a.y-a.height,1,n.onLayer+1),"BULLET"===i.reference&&t.weaponManager.orangeImpact(a.x,a.y-a.height,1,n.onLayer+1),"MISSLE"===i.reference&&t.weaponManager.createImpactExplosion(a.x,a.y-a.height,1,n.onLayer+1,Math.round(i.damage/2)),i.reference,i.reference,n.damageIt(i.damage)),a.pierce||a.destroyIt(n.onLayer-1)}})},e.prototype.destroyShip=function(e){this.phaserSprites.destroy(e),this.phaserSprites.destroy(e+"_exhaust"),this.phaserSprites.getGroup(e+"_trails").map(function(e){e.destroySelf()})},e}(),UTILITY_MANAGER=function(){function e(){}return e.prototype.assign=function(e,t,a,n,i){this.game=e,this.phaserSprites=t,this.phaserBitmapdata=a,this.phaserGroup=n,this.atlas=i},e.prototype.buildOverlayBackground=function(e,t,a,n){void 0===n&&(n=!1);var i=this.game,o=this.phaserBitmapdata.addGradient({name:"um_overlay__bmd",start:e,end:t,width:5,height:5,render:!1}),r=this.phaserSprites.add({x:0,y:0,name:"um_overlay__bg",width:i.world.width,height:i.world.height,reference:o.cacheBitmapData,visible:n});r.flash=function(e,t){void 0===e&&(e=500),void 0===t&&(t=function(){}),r.visible=!0,r.alpha=1,setTimeout(function(){i.add.tween(r).to({alpha:0},e,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){}),t()},250)},r.fadeIn=function(e,t){void 0===e&&(e=500),void 0===t&&(t=function(){}),r.visible=!0,r.alpha=0,i.add.tween(r).to({alpha:1},e,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){t()})},r.fadeOut=function(e,t){void 0===e&&(e=500),void 0===t&&(t=function(){}),r.visible=!0,r.alpha=1,i.add.tween(r).to({alpha:0},e,Phaser.Easing.Linear.In,!0,0,0,!1).onComplete.add(function(){t()})},this.phaserGroup.add(a,r)},e.prototype.buildOverlayGrid=function(e,t,a,n){void 0===e&&(e=80),void 0===t&&(t=80);for(var i=this.game,o=0,r=0;r<Math.ceil(i.world.height/t)+1;r++)for(var s=function(s){var p=l.phaserSprites.addFromAtlas({x:s*e,y:r*t,name:"grid"+o,group:"um_grid__bg",width:e,height:t,atlas:l.atlas,filename:n,visible:!0});p.anchor.setTo(.5,.5),p.scale.setTo(1,1),p.fadeOut=function(e){p.scale.setTo(1,1),i.add.tween(p).to({height:0},e,Phaser.Easing.Linear.Out,!0,0,0,!1)},p.fadeIn=function(e){i.add.tween(p).to({height:t},e,Phaser.Easing.Linear.In,!0,0,0,!1)},p.scaleOut=function(e){i.add.tween(p.scale).to({x:0,y:0},e,Phaser.Easing.Linear.In,!0,0,0,!1)},p.scaleIn=function(e){i.add.tween(p.scale).to({x:1,y:1},e,Phaser.Easing.Linear.Out,!0,0,0,!1)},o++,l.phaserGroup.add(a,p)},l=this,p=0;p<Math.ceil(i.world.width/e)+1;p++)s(p)},e.prototype.overlayBGControls=function(e,t){var a=e.transition,n=e.delay,i=e.speed,o=this.phaserSprites.getOnly(["um_overlay__bg"]).um_overlay__bg;setTimeout(function(){switch(a){case"FLASHWHITE":o.flash(i,t);break;case"FADEIN":o.fadeIn(i,t);break;case"FADEOUT":o.fadeOut(i,t)}},n)},e.prototype.overlayControls=function(e,t){var a=e.transition,n=e.delay,i=e.speed,o=e.tileDelay,r=this.phaserSprites.getGroup("um_grid__bg"),s=[],l=[],p=o*r.length*.75,h=p+o*r.length;setTimeout(function(){switch(a){case"WIPEIN":r.map(function(e,t){t%2==0?l.push(e):s.push(e)}),l.map(function(e,t){setTimeout(function(){e.scaleIn(i)},o*t)}),setTimeout(function(){s.slice(0).reverse().map(function(e,t){setTimeout(function(){e.scaleIn(i)},o*t)})},p),setTimeout(function(){t()},h);break;case"WIPEOUT":r.map(function(e,t){t%2==0?l.push(e):s.push(e)}),l.map(function(e,t){setTimeout(function(){e.scaleOut(i)},o*t)}),setTimeout(function(){s.slice(0).reverse().map(function(e,t){setTimeout(function(){e.scaleOut(i)},o*t)})},p),setTimeout(function(){t()},h);break;case"FADEOUT":r.map(function(e,t){setTimeout(function(){e.fadeOut(i)},o*t)}),setTimeout(function(){t()},r.length*o+i);break;case"FADEIN":r.map(function(e,t){setTimeout(function(){e.fadeIn(i)},o*t)}),setTimeout(function(){t()},r.length*o+i)}},n)},e}(),WEAPON_MANAGER=function(){function e(){}return e.prototype.assign=function(e,t,a,n,i){this.game=e,this.phaserSprites=a,this.phaserMaster=t,this.phaserGroup=n,this.atlas=i},e.prototype.enemyBullet=function(e){var t=this;void 0===e&&(e=2);var a=this.game,n=(this.phaserMaster,a.add.weapon(e,this.atlas,"enemy_bullet"));return n.bulletKillType=Phaser.Weapon.KILL_CAMERA_BOUNDS,n.bulletSpeed=400,n.bulletAngleOffset=90,n.multiFire=!0,n.checkOrientation=function(e){n.bulletSpeed=-Math.abs(n.bulletSpeed),n.bulletAngleOffset=-Math.abs(n.bulletAngleOffset)},this.phaserGroup.add(7,n.bullets),n.bullets.children.map(function(e){e.destroyIt=function(a){e.kill(),t.orangeImpact(e.x+t.game.rnd.integerInRange(-5,5),e.y+t.game.rnd.integerInRange(-5,15),1,a)}}),n},e.prototype.playerBullets=function(e,t){var a=this.game,n=this.phaserMaster.getAll(["weaponData"]).weaponData.primaryWeapons[t],i=a.add.weapon(e,this.atlas,n.spriteAnimation[0]);switch(i.bulletKillType=Phaser.Weapon.KILL_CAMERA_BOUNDS,i.bulletSpeed=n.bulletSpeed,i.bulletAngleOffset=90,i.multiFire=!0,n.spriteAnimation.length>0&&(i.bullets.callAll("animations.add","animations","fire",n.spriteAnimation,20,!0),i.bullets.callAll("play",null,"fire")),t){case"MISSLE":i.bulletSpeedVariance=300,i.bulletAngleVariance=15;break;case"SHOTGUN":i.bulletSpeedVariance=1e3,i.bulletAngleOffset=-10,i.bulletAngleVariance=20;break;case"GATLING":i.bulletSpeedVariance=300,i.bulletAngleVariance=3}return i.onKill.add(function(e){}),i.checkOrientation=function(e){e<180?(i.bulletSpeed=Math.abs(i.bulletSpeed),i.bulletAngleOffset=Math.abs(i.bulletAngleOffset)):(i.bulletSpeed=-Math.abs(i.bulletSpeed),i.bulletAngleOffset=-Math.abs(i.bulletAngleOffset))},this.phaserGroup.add(8,i.bullets),i.bullets.children.map(function(e){e.weaponData=n,e.pierce=n.pierce,e.destroyIt=function(t){e.kill()}}),i},e.prototype.createClusterbomb=function(e,t){var a=this;void 0===t&&(t=function(){});var n=this.game,i=this.phaserMaster,o=(this.phaserSprites,this.phaserGroup,this.atlas,i.getAll().weaponData.secondaryWeapons.CLUSTERBOMB),r=this.createBomblet(25),s=n.add.weapon(1,this.atlas,o.spriteAnimation[0]);return s.bulletKillType=Phaser.Weapon.KILL_LIFESPAN,s.bulletSpeed=o.bulletSpeed,s.multiFire=!0,s.bulletLifespan=750,o.spriteAnimation.length>0&&(s.bullets.callAll("animations.add","animations","fire",o.spriteAnimation,20,!0),s.bullets.callAll("play",null,"fire")),s.onKill.add(function(e){t(),r.map(function(t){t.fire(e)}),a.createExplosionVacuum(e.x,e.y,1.25,8,o.damage)}),s.bullets.children.map(function(e){e.weaponData=o,e.pierce=o.pierce,e.destroyIt=function(t){e.kill()}}),this.phaserGroup.add(7,s.bullets),s},e.prototype.createBomblet=function(e){for(var t=this,a=this.game,n=this.phaserMaster,i=(this.phaserSprites,this.phaserGroup,this.atlas,n.getAll().weaponData,{reference:"BOMBLET",spriteAnimation:["icon_sw_1"],damage:25,pierce:!1}),o=[],r=0;r<e;r++){var s=a.add.weapon(1,this.atlas,i.spriteAnimation[0]);s.bulletKillType=Phaser.Weapon.KILL_LIFESPAN,s.bulletSpeed=500+a.rnd.integerInRange(50,150),s.bulletAngleVariance=140,s.bulletLifespan=a.rnd.integerInRange(50,500),i.spriteAnimation.length>0&&(s.bullets.callAll("animations.add","animations","fire",i.spriteAnimation,20,!0),s.bullets.callAll("play",null,"fire")),s.onKill.add(function(e){t.createImpactExplosion(e.x,e.y,1.25,8,i.damage)}),s.bullets.children.map(function(e){e.weaponData=i,e.pierce=i.pierce,e.destroyIt=function(t){e.kill()}}),this.phaserGroup.add(7,s.bullets),o.push(s)}return o},e.prototype.createExplosion=function(e,t,a,n,i,o){void 0===i&&(i=function(){}),void 0===o&&(o=function(){});var r=this.game,s=(this.phaserMaster,this.phaserSprites),l=this.phaserGroup,p=this.atlas,h=s.addFromAtlas({name:"explosion_"+r.rnd.integer(),group:"explosions",x:e,y:t,atlas:p,filename:"explosion2_layer_1"});return h.scale.setTo(a,a),h.anchor.setTo(.5,.5),h.animations.add("explosion",Phaser.Animation.generateFrameNames("explosion2_layer_",1,12),1,!0),h.animations.play("explosion",30,!0),r.time.events.add(Phaser.Timer.SECOND/2,function(){s.destroy(h.name)}).autoDestroy=!0,h.onDestroy=function(){},h.onUpdate=function(){o(h)},void 0!==n&&l.add(n,h),h},e.prototype.createExplosionVacuum=function(e,t,a,n,i,o,r){var s=this;void 0===o&&(o=function(){}),void 0===r&&(r=function(){});var l=this.game,p=(this.phaserMaster,this.phaserSprites),h=this.phaserGroup,u=this.atlas,d=Phaser.Animation.generateFrameNames("explosion_vacuum_",1,9).slice(),c=p.addFromAtlas({name:"impact_"+l.rnd.integer(),group:"impactExplosions",x:e,y:t,atlas:u,filename:d[0]});return c.scale.setTo(a,a),c.anchor.setTo(.5,.5),l.physics.enable(c,Phaser.Physics.ARCADE),c.animations.add("explosion",d,1,!0),c.animations.play("explosion",30,!0),c.damageAmount=i,l.time.events.add(Phaser.Timer.SECOND/2,function(){p.destroy(c.name)}).autoDestroy=!0,c.onDestroy=function(){o()},l.camera.shake(.004,500),c.onUpdate=function(){var e=s.phaserSprites.getGroup("enemy_hitboxes").slice();s.game.physics.arcade.overlap(e,c,function(e,t){var a=e.parent;a.isDamaged||a.isDestroyed||a.damageIt(t.damageAmount)}),r(c)},void 0!==n&&h.add(n,c),c},e.prototype.createExplosionVacuumFire=function(e,t,a,n,i,o,r){var s=this;void 0===o&&(o=function(){}),void 0===r&&(r=function(){});var l=this.game,p=(this.phaserMaster,this.phaserSprites),h=this.phaserGroup,u=this.atlas,d=Phaser.Animation.generateFrameNames("explosion_vacuum_inner_",1,13).slice(),c=p.addFromAtlas({name:"impact_"+l.rnd.integer(),group:"impactExplosions",x:e,y:t,atlas:u,filename:d[0]});return c.scale.setTo(a,a),c.anchor.setTo(.5,.5),l.physics.enable(c,Phaser.Physics.ARCADE),c.animations.add("explosion",d,1,!0),c.animations.play("explosion",30,!0),c.damageAmount=i,l.time.events.add(Phaser.Timer.SECOND/2,function(){p.destroy(c.name)}).autoDestroy=!0,c.onDestroy=function(){o()},l.camera.shake(.004,500),c.onUpdate=function(){var e=s.phaserSprites.getGroup("enemy_hitboxes").slice();s.game.physics.arcade.overlap(e,c,function(e,t){var a=e.parent;a.isDamaged||a.isDestroyed||a.damageIt(t.damageAmount)}),r(c)},void 0!==n&&h.add(n,c),c},e.prototype.createImpactExplosion=function(e,t,a,n,i,o,r){var s=this;void 0===o&&(o=function(){}),void 0===r&&(r=function(){});var l=this.game,p=(this.phaserMaster,this.phaserSprites),h=this.phaserGroup,u=this.atlas,d=p.addFromAtlas({name:"impact_"+l.rnd.integer(),group:"impactExplosions",x:e,y:t,atlas:u,filename:"explosions_Layer_1"});return d.scale.setTo(a,a),d.anchor.setTo(.5,.5),l.physics.enable(d,Phaser.Physics.ARCADE),d.animations.add("explosion",Phaser.Animation.generateFrameNames("explosions_Layer_",1,16),1,!0),d.animations.play("explosion",30,!0),d.damageAmount=i,l.time.events.add(Phaser.Timer.SECOND/2,function(){p.destroy(d.name)}).autoDestroy=!0,d.onDestroy=function(){o()},l.camera.shake(.002,500),d.onUpdate=function(){var e=s.phaserSprites.getGroup("enemy_hitboxes").slice();s.game.physics.arcade.overlap(e,d,function(e,t){var a=e.parent;a.isDamaged||a.isDestroyed||a.damageIt(t.damageAmount)}),r(d)},void 0!==n&&h.add(n,d),d},e.prototype.pelletImpact=function(e,t,a,n){var i=this.game,o=(this.phaserMaster,this.phaserSprites),r=this.phaserGroup,s=this.atlas,l=Phaser.Animation.generateFrameNames("sparks_",1,3),p=o.addFromAtlas({name:"impact_"+i.rnd.integer(),group:"impactExplosions",x:e,y:t,atlas:s,filename:l[0]});p.scale.setTo(a,a),p.anchor.setTo(.5,.5),i.physics.enable(p,Phaser.Physics.ARCADE);var h=p.animations.add("animate",l,60,!1);return h.onStart.add(function(){},p),h.onComplete.add(function(){o.destroy(p.name)},p),h.play("animate"),p.onUpdate=function(){},void 0!==n&&r.add(n,p),p},e.prototype.blueImpact=function(e,t,a,n){var i=this.game,o=(this.phaserMaster,this.phaserSprites),r=this.phaserGroup,s=this.atlas,l=Phaser.Animation.generateFrameNames("blue_explosion_small_layer_",1,7),p=o.addFromAtlas({name:"impact_"+i.rnd.integer(),group:"impactExplosions",x:e,y:t,atlas:s,filename:l[0]});p.scale.setTo(a,a),p.anchor.setTo(.5,.5),i.physics.enable(p,Phaser.Physics.ARCADE);var h=p.animations.add("animate",l,60,!1);return h.onStart.add(function(){},p),h.onComplete.add(function(){o.destroy(p.name)},p),h.play("animate"),p.onUpdate=function(){p.y--},void 0!==n&&r.add(n,p),p},e.prototype.orangeImpact=function(e,t,a,n){var i=this.game,o=(this.phaserMaster,this.phaserSprites),r=this.phaserGroup,s=this.atlas,l=Phaser.Animation.generateFrameNames("orange_ring_explosion_layer_",1,7),p=o.addFromAtlas({name:"impact_"+i.rnd.integer(),group:"impactExplosions",x:e,y:t,atlas:s,filename:l[0]});p.scale.setTo(a,a),p.anchor.setTo(.5,.5),i.physics.enable(p,Phaser.Physics.ARCADE);var h=p.animations.add("animate",l,60,!1);return h.onStart.add(function(){},p),h.onComplete.add(function(){o.destroy(p.name)},p),h.play("animate"),p.onUpdate=function(){p.y--},void 0!==n&&r.add(n,p),p},e.prototype.electricDischarge=function(e,t,a,n){var i=this.game,o=(this.phaserMaster,this.phaserSprites),r=this.phaserGroup,s=this.atlas,l=Phaser.Animation.generateFrameNames("disintegrate",1,10),p=o.addFromAtlas({name:"impact_"+i.rnd.integer(),group:"impactExplosions",x:e,y:t,atlas:s,filename:l[0]});p.scale.setTo(a,a),p.anchor.setTo(.5,.5),i.physics.enable(p,Phaser.Physics.ARCADE);var h=p.animations.add("animate",l,60,!1);return h.onStart.add(function(){},p),h.onComplete.add(function(){o.destroy(p.name)},p),h.play("animate"),p.onUpdate=function(){p.y--},void 0!==n&&r.add(n,p),p},e}();